<div class="card bg-base-100 shadow-xl flex flex-col">
  <div class="card-body">
    <div class="card-title">Appearance Settings Sync</div>
    <div *ngIf="savedUiSettings() as server; else currentState">
      <div class="text-sm mb-3">Synchronize the appearance of the application</div>
      <ng-container *ngTemplateOutlet="currentState; context: {server}"></ng-container>
    </div>
    <ng-template #currentState let-server="server">
      <div class="flex flex-col" *ngIf="currentUiSettings() as local">
        <div class="flex flex-row justify-between items-center gap-1 mb-3">
          <ng-container *ngIf="!server; else settingsStateManagement">
            <span class="label-text">You have not yet saved appearance settings</span>
          </ng-container>
          <ng-template #settingsStateManagement>
            <ng-container *ngIf="settingsMatch(); else settingsSwitch">
              <div class="flex flex-col">
                <span class="label">Your appearance settings are in sync</span>

                <div class="flex flex-row items-center gap-2">
                  <input type="checkbox" class="checkbox checkbox-sm" [formControl]="syncControl" />
                  <span class="label-text">
                    Use these settings everywhere I log in
                  </span>
                </div>
              </div>
              
            </ng-container>
            <ng-template #settingsSwitch>
              <span class="label-text">
                Viewing settings for
              </span>
              <span class="label-text">
                <span class="badge badge-accent" [ngClass]="{'badge-outline': viewingSaved}">Local</span>
              </span>
              <input type="checkbox" class="toggle toggle-sm" (click)="toggleView()" />
              <span class="label-alt-text">
                <span class="badge badge-primary" [ngClass]="{'badge-outline': !viewingSaved}">Server</span>
              </span>
            </ng-template>
          </ng-template>
        </div> 
        <div class="d-flex">
          <div class="flex flex-row gap-3 justify-between" *ngFor="let item of local | keyvalue">
            <span class="label-text" translate>{{'LABELS.' + item.key}}</span>
            <ng-container *ngIf="server && local[item.key] !== server[item.key]; else valuesMatch">
              <span class="tooltip tooltip-left tooltip-rounded" [ngClass]="{'tooltip-accent' : viewingSaved, 'tooltip-primary': !viewingSaved}" [attr.data-tip]="(viewingSaved ? local[item.key] : server[item.key])">
                <span class="label-text text-warning">{{viewingSaved ? server[item.key] : local[item.key]}}</span>  
              </span>
            </ng-container>
            <ng-template #valuesMatch>
              <span class="label-text">{{item.value}}</span>  
            </ng-template>
            
          </div>
        </div>
      </div>
    </ng-template>
    
    <div class="card-actions mt-3 justify-between">
      <button class="btn btn-sm btn-accent" [disabled]="settingsMatch() || viewingSaved || !userLoggedIn()" (click)="saveCurrent()">Save Current</button>
      <button class="btn btn-sm btn-secondary" *ngIf="savedUiSettings()" [disabled]="settingsMatch() || !viewingSaved" (click)="applySaved()">Apply Saved</button>
    </div>
    <div class="badge badge-warning p-3 cursor-pointer" *ngIf="!userLoggedIn()" [routerLink]="['..','auth']">You must log in before you can save your sync settings.</div>
  </div>
</div>
