(self.webpackChunkclient=self.webpackChunkclient||[]).push([[390],{9390:(ge,b,l)=>{"use strict";l.r(b),l.d(b,{PeerModule:()=>Xo});var p={};l.r(p),l.d(p,{Decoder:()=>Rt,Encoder:()=>Vn,PacketType:()=>w,protocol:()=>nr});var y={};l.r(y),l.d(y,{Manager:()=>ct,Socket:()=>Pt,connect:()=>Re,default:()=>Re,io:()=>Re,protocol:()=>nr});var k={};l.r(k),l.d(k,{fixNegotiationNeeded:()=>br,shimAddTrackRemoveTrack:()=>Cr,shimAddTrackRemoveTrackWithNative:()=>_r,shimGetDisplayMedia:()=>Xn,shimGetSendersWithDtmf:()=>gr,shimGetStats:()=>vr,shimGetUserMedia:()=>dr,shimMediaStream:()=>hr,shimOnTrack:()=>mr,shimPeerConnection:()=>It,shimSenderReceiverGetStats:()=>yr});var E={};l.r(E),l.d(E,{shimGetDisplayMedia:()=>Tr,shimGetUserMedia:()=>Sr,shimPeerConnection:()=>Dt,shimReplaceTrack:()=>xr});var L={};l.r(L),l.d(L,{shimAddTransceiver:()=>Ir,shimCreateAnswer:()=>Br,shimCreateOffer:()=>Mr,shimGetDisplayMedia:()=>ni,shimGetParameters:()=>Dr,shimGetUserMedia:()=>kr,shimOnTrack:()=>Er,shimPeerConnection:()=>Mt,shimRTCDataChannel:()=>Ar,shimReceiverGetStats:()=>Pr,shimRemoveStream:()=>Or,shimSenderGetStats:()=>Rr});var te={};l.r(te),l.d(te,{shimAudioContext:()=>Jr,shimCallbacksAPI:()=>Lr,shimConstraints:()=>Fr,shimCreateOfferLegacy:()=>Zr,shimGetUserMedia:()=>Nr,shimLocalStreamsAPI:()=>wr,shimRTCIceServerUrls:()=>Ur,shimRemoteStreamsAPI:()=>jr,shimTrackEventTransceiver:()=>$r});var ne={};l.r(ne),l.d(ne,{removeExtmapAllowMixed:()=>wt,shimAddIceCandidateNullOrEmpty:()=>ut,shimConnectionState:()=>Bt,shimMaxMessageSize:()=>Ge,shimRTCIceCandidate:()=>ft,shimSendThrowTypeError:()=>qe});var u=l(4755),d=l(9401),S=l(9812),M=l(285),I=l(9507),F=l(9129),o=l(2223);const V=new o.OlP("WindowToken",typeof window<"u"&&window.document?{providedIn:"root",factory:()=>window}:{providedIn:"root",factory:()=>{}});var U=l(7579);let f=(()=>{class t{constructor(e,n,i){this.ngZone=e,this.document=n,this.window=i,this.copySubject=new U.x,this.copyResponse$=this.copySubject.asObservable(),this.config={}}configure(e){this.config=e}copy(e){if(!this.isSupported||!e)return this.pushCopyResponse({isSuccess:!1,content:e});const n=this.copyFromContent(e);return this.pushCopyResponse(n?{content:e,isSuccess:n}:{isSuccess:!1,content:e})}get isSupported(){return!!this.document.queryCommandSupported&&!!this.document.queryCommandSupported("copy")&&!!this.window}isTargetValid(e){if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement){if(e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');return!0}throw new Error("Target should be input or textarea")}copyFromInputElement(e,n=!0){try{this.selectTarget(e);const i=this.copyText();return this.clearSelection(n?e:void 0,this.window),i&&this.isCopySuccessInIE11()}catch{return!1}}isCopySuccessInIE11(){const e=this.window.clipboardData;return!(e&&e.getData&&!e.getData("Text"))}copyFromContent(e,n=this.document.body){if(this.tempTextArea&&!n.contains(this.tempTextArea)&&this.destroy(this.tempTextArea.parentElement||void 0),!this.tempTextArea){this.tempTextArea=this.createTempTextArea(this.document,this.window);try{n.appendChild(this.tempTextArea)}catch{throw new Error("Container should be a Dom element")}}this.tempTextArea.value=e;const i=this.copyFromInputElement(this.tempTextArea,!1);return this.config.cleanUpAfterCopy&&this.destroy(this.tempTextArea.parentElement||void 0),i}destroy(e=this.document.body){this.tempTextArea&&(e.removeChild(this.tempTextArea),this.tempTextArea=void 0)}selectTarget(e){return e.select(),e.setSelectionRange(0,e.value.length),e.value.length}copyText(){return this.document.execCommand("copy")}clearSelection(e,n){e&&e.focus(),n.getSelection()?.removeAllRanges()}createTempTextArea(e,n){const i="rtl"===e.documentElement.getAttribute("dir");let s;return s=e.createElement("textarea"),s.style.fontSize="12pt",s.style.border="0",s.style.padding="0",s.style.margin="0",s.style.position="absolute",s.style[i?"right":"left"]="-9999px",s.style.top=(n.pageYOffset||e.documentElement.scrollTop)+"px",s.setAttribute("readonly",""),s}pushCopyResponse(e){this.copySubject.observers.length>0&&this.ngZone.run(()=>{this.copySubject.next(e)})}pushCopyReponse(e){this.pushCopyResponse(e)}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(o.R0b),o.LFG(u.K0),o.LFG(V,8))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),g=(()=>{class t{constructor(e,n,i,s){this.ngZone=e,this.host=n,this.renderer=i,this.clipboardSrv=s,this.cbOnSuccess=new o.vpe,this.cbOnError=new o.vpe,this.onClick=a=>{this.clipboardSrv.isSupported?this.targetElm&&this.clipboardSrv.isTargetValid(this.targetElm)?this.handleResult(this.clipboardSrv.copyFromInputElement(this.targetElm),this.targetElm.value,a):this.cbContent&&this.handleResult(this.clipboardSrv.copyFromContent(this.cbContent,this.container),this.cbContent,a):this.handleResult(!1,void 0,a)}}ngOnInit(){this.ngZone.runOutsideAngular(()=>{this.clickListener=this.renderer.listen(this.host.nativeElement,"click",this.onClick)})}ngOnDestroy(){this.clickListener&&this.clickListener(),this.clipboardSrv.destroy(this.container)}handleResult(e,n,i){let s={isSuccess:e,content:n,successMessage:this.cbSuccessMsg,event:i};e?this.cbOnSuccess.observed&&this.ngZone.run(()=>{this.cbOnSuccess.emit(s)}):this.cbOnError.observed&&this.ngZone.run(()=>{this.cbOnError.emit(s)}),this.clipboardSrv.pushCopyResponse(s)}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(o.R0b),o.Y36(o.SBq),o.Y36(o.Qsj),o.Y36(f))},t.\u0275dir=o.lG2({type:t,selectors:[["","ngxClipboard",""]],inputs:{targetElm:["ngxClipboard","targetElm"],container:"container",cbContent:"cbContent",cbSuccessMsg:"cbSuccessMsg"},outputs:{cbOnSuccess:"cbOnSuccess",cbOnError:"cbOnError"}}),t})(),_=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[u.ez]}),t})();var x=l(3900),D=l(4004),R=l(262),N=l(9646),P=l(6365),B=l(9751),j=l(3099);const K=Object.create(null);K.open="0",K.close="1",K.ping="2",K.pong="3",K.message="4",K.upgrade="5",K.noop="6";const W=Object.create(null);Object.keys(K).forEach(t=>{W[K[t]]=t});const X={type:"error",data:"parser error"},se="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),oe="function"==typeof ArrayBuffer,ie=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,De=({type:t,data:r},e,n)=>se&&r instanceof Blob?e?n(r):$(r,n):oe&&(r instanceof ArrayBuffer||ie(r))?e?n(r):$(new Blob([r]),n):n(K[t]+(r||"")),$=(t,r)=>{const e=new FileReader;return e.onload=function(){const n=e.result.split(",")[1];r("b"+(n||""))},e.readAsDataURL(t)};function Fe(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let be;function Ue(t,r){return se&&t.data instanceof Blob?t.data.arrayBuffer().then(Fe).then(r):oe&&(t.data instanceof ArrayBuffer||ie(t.data))?r(Fe(t.data)):void De(t,!1,e=>{be||(be=new TextEncoder),r(be.encode(e))})}const Se=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<64;t++)Se["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(t)]=t;const ve="function"==typeof ArrayBuffer,Me=(t,r)=>{if("string"!=typeof t)return{type:"message",data:Be(t,r)};const e=t.charAt(0);return"b"===e?{type:"message",data:Xe(t.substring(1),r)}:W[e]?t.length>1?{type:W[e],data:t.substring(1)}:{type:W[e]}:X},Xe=(t,r)=>{if(ve){const e=(t=>{let n,s,a,c,m,r=.75*t.length,e=t.length,i=0;"="===t[t.length-1]&&(r--,"="===t[t.length-2]&&r--);const h=new ArrayBuffer(r),v=new Uint8Array(h);for(n=0;n<e;n+=4)s=Se[t.charCodeAt(n)],a=Se[t.charCodeAt(n+1)],c=Se[t.charCodeAt(n+2)],m=Se[t.charCodeAt(n+3)],v[i++]=s<<2|a>>4,v[i++]=(15&a)<<4|c>>2,v[i++]=(3&c)<<6|63&m;return h})(t);return Be(e,r)}return{base64:!0,data:t}},Be=(t,r)=>"blob"===r?t instanceof Blob?t:new Blob([t]):t instanceof ArrayBuffer?t:t.buffer,$e=String.fromCharCode(30);let Oe;function re(t){if(t)return function ce(t){for(var r in re.prototype)t[r]=re.prototype[r];return t}(t)}re.prototype.on=re.prototype.addEventListener=function(t,r){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(r),this},re.prototype.once=function(t,r){function e(){this.off(t,e),r.apply(this,arguments)}return e.fn=r,this.on(t,e),this},re.prototype.off=re.prototype.removeListener=re.prototype.removeAllListeners=re.prototype.removeEventListener=function(t,r){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var e=this._callbacks["$"+t];if(!e)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var n,i=0;i<e.length;i++)if((n=e[i])===r||n.fn===r){e.splice(i,1);break}return 0===e.length&&delete this._callbacks["$"+t],this},re.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var r=new Array(arguments.length-1),e=this._callbacks["$"+t],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(e){n=0;for(var i=(e=e.slice(0)).length;n<i;++n)e[n].apply(this,r)}return this},re.prototype.emitReserved=re.prototype.emit,re.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},re.prototype.hasListeners=function(t){return!!this.listeners(t).length};const fe=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function rt(t,...r){return r.reduce((e,n)=>(t.hasOwnProperty(n)&&(e[n]=t[n]),e),{})}const yn=fe.setTimeout,_n=fe.clearTimeout;function nt(t,r){r.useNativeTimers?(t.setTimeoutFn=yn.bind(fe),t.clearTimeoutFn=_n.bind(fe)):(t.setTimeoutFn=fe.setTimeout.bind(fe),t.clearTimeoutFn=fe.clearTimeout.bind(fe))}function bn(t){return"string"==typeof t?function Sn(t){let r=0,e=0;for(let n=0,i=t.length;n<i;n++)r=t.charCodeAt(n),r<128?e+=1:r<2048?e+=2:r<55296||r>=57344?e+=3:(n++,e+=4);return e}(t):Math.ceil(1.33*(t.byteLength||t.size))}class kn extends Error{constructor(r,e,n){super(r),this.description=e,this.context=n,this.type="TransportError"}}class Ct extends re{constructor(r){super(),this.writable=!1,nt(this,r),this.opts=r,this.query=r.query,this.socket=r.socket}onError(r,e,n){return super.emitReserved("error",new kn(r,e,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(r){"open"===this.readyState&&this.write(r)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(r){const e=Me(r,this.socket.binaryType);this.onPacket(e)}onPacket(r){super.emitReserved("packet",r)}onClose(r){this.readyState="closed",super.emitReserved("close",r)}pause(r){}createUri(r,e={}){return r+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const r=this.opts.hostname;return-1===r.indexOf(":")?r:"["+r+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(r){const e=function Tn(t){let r="";for(let e in t)t.hasOwnProperty(e)&&(r.length&&(r+="&"),r+=encodeURIComponent(e)+"="+encodeURIComponent(t[e]));return r}(r);return e.length?"?"+e:""}}const qt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),it=64,zt={};let Yt,Vt=0,Ee=0;function Qt(t){let r="";do{r=qt[t%it]+r,t=Math.floor(t/it)}while(t>0);return r}function Ht(){const t=Qt(+new Date);return t!==Yt?(Vt=0,Yt=t):t+"."+Qt(Vt++)}for(;Ee<it;Ee++)zt[qt[Ee]]=Ee;let Kt=!1;try{Kt=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const En=Kt;function Wt(t){const r=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!r||En))return new XMLHttpRequest}catch{}if(!r)try{return new(fe[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch{}}function Rn(){}const Pn=null!=new Wt({xdomain:!1}).responseType;let ot=(()=>{class t extends re{constructor(e,n){super(),nt(this,n),this.opts=n,this.method=n.method||"GET",this.uri=e,this.data=void 0!==n.data?n.data:null,this.create()}create(){var e;const n=rt(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd;const i=this.xhr=new Wt(n);try{i.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&i.setRequestHeader(s,this.opts.extraHeaders[s])}}catch{}if("POST"===this.method)try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=()=>{var s;3===i.readyState&&(null===(s=this.opts.cookieJar)||void 0===s||s.parseCookies(i)),4===i.readyState&&(200===i.status||1223===i.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof i.status?i.status:0)},0))},i.send(this.data)}catch(s){return void this.setTimeoutFn(()=>{this.onError(s)},0)}typeof document<"u"&&(this.index=t.requestsCount++,t.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||null===this.xhr)){if(this.xhr.onreadystatechange=Rn,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete t.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}return t.requestsCount=0,t.requests={},t})();function Xt(){for(let t in ot.requests)ot.requests.hasOwnProperty(t)&&ot.requests[t].abort()}typeof document<"u"&&("function"==typeof attachEvent?attachEvent("onunload",Xt):"function"==typeof addEventListener&&addEventListener("onpagehide"in fe?"pagehide":"unload",Xt,!1));const bt="function"==typeof Promise&&"function"==typeof Promise.resolve?r=>Promise.resolve().then(r):(r,e)=>e(r,0),st=fe.WebSocket||fe.MozWebSocket,er=typeof navigator<"u"&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();function Dn(t,r){return"message"===t.type&&"string"!=typeof t.data&&r[0]>=48&&r[0]<=54}const Bn={websocket:class In extends Ct{constructor(r){super(r),this.supportsBinary=!r.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const r=this.uri(),e=this.opts.protocols,n=er?{}:rt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=er?new st(r,e,n):e?new st(r,e):new st(r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=r=>this.onClose({description:"websocket connection closed",context:r}),this.ws.onmessage=r=>this.onData(r.data),this.ws.onerror=r=>this.onError("websocket error",r)}write(r){this.writable=!1;for(let e=0;e<r.length;e++){const i=e===r.length-1;De(r[e],this.supportsBinary,s=>{try{this.ws.send(s)}catch{}i&&bt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const r=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=Ht()),this.supportsBinary||(e.b64=1),this.createUri(r,e)}check(){return!!st}},webtransport:class Mn extends Ct{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(r=>{this.onError("webtransport error",r)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(r=>{const e=r.readable.getReader();let n;this.writer=r.writable.getWriter();const i=()=>{e.read().then(({done:a,value:c})=>{a||(n||1!==c.byteLength||54!==c[0]?(this.onPacket(function ke(t,r,e){return Oe||(Oe=new TextDecoder),Me(r||t[0]<48||t[0]>54?t:Oe.decode(t),e)}(c,n,"arraybuffer")),n=!1):n=!0,i())}).catch(a=>{})};i();const s=this.query.sid?`0{"sid":"${this.query.sid}"}`:"0";this.writer.write((new TextEncoder).encode(s)).then(()=>this.onOpen())})}))}write(r){this.writable=!1;for(let e=0;e<r.length;e++){const n=r[e],i=e===r.length-1;Ue(n,s=>{Dn(n,s)&&this.writer.write(Uint8Array.of(54)),this.writer.write(s).then(()=>{i&&bt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})})}}doClose(){var r;null===(r=this.transport)||void 0===r||r.close()}},polling:class On extends Ct{constructor(r){if(super(r),this.polling=!1,typeof location<"u"){const n="https:"===location.protocol;let i=location.port;i||(i=n?"443":"80"),this.xd=typeof location<"u"&&r.hostname!==location.hostname||i!==r.port}this.supportsBinary=Pn&&!(r&&r.forceBase64),this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(r){this.readyState="pausing";const e=()=>{this.readyState="paused",r()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||e()})),this.writable||(n++,this.once("drain",function(){--n||e()}))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(r){((t,r)=>{const e=t.split($e),n=[];for(let i=0;i<e.length;i++){const s=Me(e[i],r);if(n.push(s),"error"===s.type)break}return n})(r,this.socket.binaryType).forEach(n=>{if("opening"===this.readyState&&"open"===n.type&&this.onOpen(),"close"===n.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const r=()=>{this.write([{type:"close"}])};"open"===this.readyState?r():this.once("open",r)}write(r){this.writable=!1,((t,r)=>{const e=t.length,n=new Array(e);let i=0;t.forEach((s,a)=>{De(s,!1,c=>{n[a]=c,++i===e&&r(n.join($e))})})})(r,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const r=this.opts.secure?"https":"http",e=this.query||{};return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=Ht()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.createUri(r,e)}request(r={}){return Object.assign(r,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new ot(this.uri(),r)}doWrite(r,e){const n=this.request({method:"POST",data:r});n.on("success",e),n.on("error",(i,s)=>{this.onError("xhr post error",i,s)})}doPoll(){const r=this.request();r.on("data",this.onData.bind(this)),r.on("error",(e,n)=>{this.onError("xhr poll error",e,n)}),this.pollXhr=r}}},wn=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,jn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Tt(t){const r=t,e=t.indexOf("["),n=t.indexOf("]");-1!=e&&-1!=n&&(t=t.substring(0,e)+t.substring(e,n).replace(/:/g,";")+t.substring(n,t.length));let i=wn.exec(t||""),s={},a=14;for(;a--;)s[jn[a]]=i[a]||"";return-1!=e&&-1!=n&&(s.source=r,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function Ln(t,r){const n=r.replace(/\/{2,9}/g,"/").split("/");return("/"==r.slice(0,1)||0===r.length)&&n.splice(0,1),"/"==r.slice(-1)&&n.splice(n.length-1,1),n}(0,s.path),s.queryKey=function Nn(t,r){const e={};return r.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,s){i&&(e[i]=s)}),e}(0,s.query),s}let tr=(()=>{class t extends re{constructor(e,n={}){super(),this.writeBuffer=[],e&&"object"==typeof e&&(n=e,e=null),e?(e=Tt(e),n.hostname=e.host,n.secure="https"===e.protocol||"wss"===e.protocol,n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=Tt(n.host).host),nt(this,n),this.secure=null!=n.secure?n.secure:typeof location<"u"&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function xn(t){let r={},e=t.split("&");for(let n=0,i=e.length;n<i;n++){let s=e[n].split("=");r[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return r}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=4,n.transport=e,this.id&&(n.sid=this.id);const i=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Bn[e](i)}open(){let e;if(this.opts.rememberUpgrade&&t.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch{return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(e){let n=this.createTransport(e),i=!1;t.priorWebsocketSuccess=!1;const s=()=>{i||(n.send([{type:"ping",data:"probe"}]),n.once("packet",O=>{if(!i)if("pong"===O.type&&"probe"===O.data){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;t.priorWebsocketSuccess="websocket"===n.name,this.transport.pause(()=>{i||"closed"!==this.readyState&&(T(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const Z=new Error("probe error");Z.transport=n.name,this.emitReserved("upgradeError",Z)}}))};function a(){i||(i=!0,T(),n.close(),n=null)}const c=O=>{const Z=new Error("probe error: "+O);Z.transport=n.name,a(),this.emitReserved("upgradeError",Z)};function m(){c("transport closed")}function h(){c("socket closed")}function v(O){n&&O.name!==n.name&&a()}const T=()=>{n.removeListener("open",s),n.removeListener("error",c),n.removeListener("close",m),this.off("close",h),this.off("upgrading",v)};n.once("open",s),n.once("error",c),n.once("close",m),this.once("close",h),this.once("upgrading",v),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{i||n.open()},200):n.open()}onOpen(){if(this.readyState="open",t.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const n=this.upgrades.length;for(;e<n;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=e.data,this.onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let i=0;i<this.writeBuffer.length;i++){const s=this.writeBuffer[i].data;if(s&&(n+=bn(s)),i>0&&n>this.maxPayload)return this.writeBuffer.slice(0,i);n+=2}return this.writeBuffer}write(e,n,i){return this.sendPacket("message",e,n,i),this}send(e,n,i){return this.sendPacket("message",e,n,i),this}sendPacket(e,n,i,s){if("function"==typeof n&&(s=n,n=void 0),"function"==typeof i&&(s=i,i=null),"closing"===this.readyState||"closed"===this.readyState)return;(i=i||{}).compress=!1!==i.compress;const a={type:e,data:n,options:i};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),s&&this.once("flush",s),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},i=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}onError(e){t.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,n){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const n=[];let i=0;const s=e.length;for(;i<s;i++)~this.transports.indexOf(e[i])&&n.push(e[i]);return n}}return t.protocol=4,t})();const Un="function"==typeof ArrayBuffer,$n=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,rr=Object.prototype.toString,Zn="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===rr.call(Blob),Jn="function"==typeof File||typeof File<"u"&&"[object FileConstructor]"===rr.call(File);function xt(t){return Un&&(t instanceof ArrayBuffer||$n(t))||Zn&&t instanceof Blob||Jn&&t instanceof File}function at(t,r){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let e=0,n=t.length;e<n;e++)if(at(t[e]))return!0;return!1}if(xt(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return at(t.toJSON(),!0);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&at(t[e]))return!0;return!1}function Gn(t){const r=[],n=t;return n.data=kt(t.data,r),n.attachments=r.length,{packet:n,buffers:r}}function kt(t,r){if(!t)return t;if(xt(t)){const e={_placeholder:!0,num:r.length};return r.push(t),e}if(Array.isArray(t)){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=kt(t[n],r);return e}if("object"==typeof t&&!(t instanceof Date)){const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=kt(t[n],r));return e}return t}function qn(t,r){return t.data=Et(t.data,r),delete t.attachments,t}function Et(t,r){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<r.length)return r[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let e=0;e<t.length;e++)t[e]=Et(t[e],r);else if("object"==typeof t)for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(t[e]=Et(t[e],r));return t}const zn=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],nr=5;var w=(()=>((w=w||{})[w.CONNECT=0]="CONNECT",w[w.DISCONNECT=1]="DISCONNECT",w[w.EVENT=2]="EVENT",w[w.ACK=3]="ACK",w[w.CONNECT_ERROR=4]="CONNECT_ERROR",w[w.BINARY_EVENT=5]="BINARY_EVENT",w[w.BINARY_ACK=6]="BINARY_ACK",w))();class Vn{constructor(r){this.replacer=r}encode(r){return r.type!==w.EVENT&&r.type!==w.ACK||!at(r)?[this.encodeAsString(r)]:this.encodeAsBinary({type:r.type===w.EVENT?w.BINARY_EVENT:w.BINARY_ACK,nsp:r.nsp,data:r.data,id:r.id})}encodeAsString(r){let e=""+r.type;return(r.type===w.BINARY_EVENT||r.type===w.BINARY_ACK)&&(e+=r.attachments+"-"),r.nsp&&"/"!==r.nsp&&(e+=r.nsp+","),null!=r.id&&(e+=r.id),null!=r.data&&(e+=JSON.stringify(r.data,this.replacer)),e}encodeAsBinary(r){const e=Gn(r),n=this.encodeAsString(e.packet),i=e.buffers;return i.unshift(n),i}}function ir(t){return"[object Object]"===Object.prototype.toString.call(t)}class Rt extends re{constructor(r){super(),this.reviver=r}add(r){let e;if("string"==typeof r){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(r);const n=e.type===w.BINARY_EVENT;n||e.type===w.BINARY_ACK?(e.type=n?w.EVENT:w.ACK,this.reconstructor=new Yn(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!xt(r)&&!r.base64)throw new Error("Unknown type: "+r);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(r),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(r){let e=0;const n={type:Number(r.charAt(0))};if(void 0===w[n.type])throw new Error("unknown packet type "+n.type);if(n.type===w.BINARY_EVENT||n.type===w.BINARY_ACK){const s=e+1;for(;"-"!==r.charAt(++e)&&e!=r.length;);const a=r.substring(s,e);if(a!=Number(a)||"-"!==r.charAt(e))throw new Error("Illegal attachments");n.attachments=Number(a)}if("/"===r.charAt(e+1)){const s=e+1;for(;++e&&","!==r.charAt(e)&&e!==r.length;);n.nsp=r.substring(s,e)}else n.nsp="/";const i=r.charAt(e+1);if(""!==i&&Number(i)==i){const s=e+1;for(;++e;){const a=r.charAt(e);if(null==a||Number(a)!=a){--e;break}if(e===r.length)break}n.id=Number(r.substring(s,e+1))}if(r.charAt(++e)){const s=this.tryParse(r.substr(e));if(!Rt.isPayloadValid(n.type,s))throw new Error("invalid payload");n.data=s}return n}tryParse(r){try{return JSON.parse(r,this.reviver)}catch{return!1}}static isPayloadValid(r,e){switch(r){case w.CONNECT:return ir(e);case w.DISCONNECT:return void 0===e;case w.CONNECT_ERROR:return"string"==typeof e||ir(e);case w.EVENT:case w.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===zn.indexOf(e[0]));case w.ACK:case w.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Yn{constructor(r){this.packet=r,this.buffers=[],this.reconPack=r}takeBinaryData(r){if(this.buffers.push(r),this.buffers.length===this.reconPack.attachments){const e=qn(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function ye(t,r,e){return t.on(r,e),function(){t.off(r,e)}}const Qn=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Pt extends re{constructor(r,e,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=r,this.nsp=e,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const r=this.io;this.subs=[ye(r,"open",this.onopen.bind(this)),ye(r,"packet",this.onpacket.bind(this)),ye(r,"error",this.onerror.bind(this)),ye(r,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...r){return r.unshift("message"),this.emit.apply(this,r),this}emit(r,...e){if(Qn.hasOwnProperty(r))throw new Error('"'+r.toString()+'" is a reserved event name');if(e.unshift(r),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const n={type:w.EVENT,data:e,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){const a=this.ids++,c=e.pop();this._registerAckCallback(a,c),n.id=a}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(r,e){var n;const i=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===i)return void(this.acks[r]=e);const s=this.io.setTimeoutFn(()=>{delete this.acks[r];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===r&&this.sendBuffer.splice(a,1);e.call(this,new Error("operation has timed out"))},i);this.acks[r]=(...a)=>{this.io.clearTimeoutFn(s),e.apply(this,[null,...a])}}emitWithAck(r,...e){const n=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((i,s)=>{e.push((a,c)=>n?a?s(a):i(c):i(a)),this.emit(r,...e)})}_addToQueue(r){let e;"function"==typeof r[r.length-1]&&(e=r.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:r,flags:Object.assign({fromQueue:!0},this.flags)};r.push((i,...s)=>n!==this._queue[0]?void 0:(null!==i?n.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(i)):(this._queue.shift(),e&&e(null,...s)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(r=!1){if(!this.connected||0===this._queue.length)return;const e=this._queue[0];e.pending&&!r||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(r){r.nsp=this.nsp,this.io._packet(r)}onopen(){"function"==typeof this.auth?this.auth(r=>{this._sendConnectPacket(r)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(r){this.packet({type:w.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},r):r})}onerror(r){this.connected||this.emitReserved("connect_error",r)}onclose(r,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",r,e)}onpacket(r){if(r.nsp===this.nsp)switch(r.type){case w.CONNECT:r.data&&r.data.sid?this.onconnect(r.data.sid,r.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case w.EVENT:case w.BINARY_EVENT:this.onevent(r);break;case w.ACK:case w.BINARY_ACK:this.onack(r);break;case w.DISCONNECT:this.ondisconnect();break;case w.CONNECT_ERROR:this.destroy();const n=new Error(r.data.message);n.data=r.data.data,this.emitReserved("connect_error",n)}}onevent(r){const e=r.data||[];null!=r.id&&e.push(this.ack(r.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(r){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const n of e)n.apply(this,r)}super.emit.apply(this,r),this._pid&&r.length&&"string"==typeof r[r.length-1]&&(this._lastOffset=r[r.length-1])}ack(r){const e=this;let n=!1;return function(...i){n||(n=!0,e.packet({type:w.ACK,id:r,data:i}))}}onack(r){const e=this.acks[r.id];"function"==typeof e&&(e.apply(this,r.data),delete this.acks[r.id])}onconnect(r,e){this.id=r,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(r=>this.emitEvent(r)),this.receiveBuffer=[],this.sendBuffer.forEach(r=>{this.notifyOutgoingListeners(r),this.packet(r)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(r=>r()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:w.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(r){return this.flags.compress=r,this}get volatile(){return this.flags.volatile=!0,this}timeout(r){return this.flags.timeout=r,this}onAny(r){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(r),this}prependAny(r){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(r),this}offAny(r){if(!this._anyListeners)return this;if(r){const e=this._anyListeners;for(let n=0;n<e.length;n++)if(r===e[n])return e.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(r){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(r),this}prependAnyOutgoing(r){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(r),this}offAnyOutgoing(r){if(!this._anyOutgoingListeners)return this;if(r){const e=this._anyOutgoingListeners;for(let n=0;n<e.length;n++)if(r===e[n])return e.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(r){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const n of e)n.apply(this,r.data)}}}function we(t){this.ms=(t=t||{}).min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}we.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var r=Math.random(),e=Math.floor(r*this.jitter*t);t=1&Math.floor(10*r)?t+e:t-e}return 0|Math.min(t,this.max)},we.prototype.reset=function(){this.attempts=0},we.prototype.setMin=function(t){this.ms=t},we.prototype.setMax=function(t){this.max=t},we.prototype.setJitter=function(t){this.jitter=t};class ct extends re{constructor(r,e){var n;super(),this.nsps={},this.subs=[],r&&"object"==typeof r&&(e=r,r=void 0),(e=e||{}).path=e.path||"/socket.io",this.opts=e,nt(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=e.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new we({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=r;const i=e.parser||p;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(r){return arguments.length?(this._reconnection=!!r,this):this._reconnection}reconnectionAttempts(r){return void 0===r?this._reconnectionAttempts:(this._reconnectionAttempts=r,this)}reconnectionDelay(r){var e;return void 0===r?this._reconnectionDelay:(this._reconnectionDelay=r,null===(e=this.backoff)||void 0===e||e.setMin(r),this)}randomizationFactor(r){var e;return void 0===r?this._randomizationFactor:(this._randomizationFactor=r,null===(e=this.backoff)||void 0===e||e.setJitter(r),this)}reconnectionDelayMax(r){var e;return void 0===r?this._reconnectionDelayMax:(this._reconnectionDelayMax=r,null===(e=this.backoff)||void 0===e||e.setMax(r),this)}timeout(r){return arguments.length?(this._timeout=r,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(r){if(~this._readyState.indexOf("open"))return this;this.engine=new tr(this.uri,this.opts);const e=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=ye(e,"open",function(){n.onopen(),r&&r()}),s=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),r?r(c):this.maybeReconnectOnOpen()},a=ye(e,"error",s);if(!1!==this._timeout){const m=this.setTimeoutFn(()=>{i(),s(new Error("timeout")),e.close()},this._timeout);this.opts.autoUnref&&m.unref(),this.subs.push(()=>{this.clearTimeoutFn(m)})}return this.subs.push(i),this.subs.push(a),this}connect(r){return this.open(r)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const r=this.engine;this.subs.push(ye(r,"ping",this.onping.bind(this)),ye(r,"data",this.ondata.bind(this)),ye(r,"error",this.onerror.bind(this)),ye(r,"close",this.onclose.bind(this)),ye(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(r){try{this.decoder.add(r)}catch(e){this.onclose("parse error",e)}}ondecoded(r){bt(()=>{this.emitReserved("packet",r)},this.setTimeoutFn)}onerror(r){this.emitReserved("error",r)}socket(r,e){let n=this.nsps[r];return n?this._autoConnect&&!n.active&&n.connect():(n=new Pt(this,r,e),this.nsps[r]=n),n}_destroy(r){const e=Object.keys(this.nsps);for(const n of e)if(this.nsps[n].active)return;this._close()}_packet(r){const e=this.encoder.encode(r);for(let n=0;n<e.length;n++)this.engine.write(e[n],r.options)}cleanup(){this.subs.forEach(r=>r()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(r,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",r,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const r=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{r.skipReconnect||(this.emitReserved("reconnect_attempt",r.backoff.attempts),!r.skipReconnect&&r.open(i=>{i?(r._reconnecting=!1,r.reconnect(),this.emitReserved("reconnect_error",i)):r.onreconnect()}))},e);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const r=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",r)}}const Ze={};function Re(t,r){"object"==typeof t&&(r=t,t=void 0);const e=function Fn(t,r="",e){let n=t;e=e||typeof location<"u"&&location,null==t&&(t=e.protocol+"//"+e.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\/\//.test(t)||(t=typeof e<"u"?e.protocol+"//"+t:"https://"+t),n=Tt(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+r,n.href=n.protocol+"://"+s+(e&&e.port===n.port?"":":"+n.port),n}(t,(r=r||{}).path||"/socket.io"),n=e.source,i=e.id;let m;return r.forceNew||r["force new connection"]||!1===r.multiplex||Ze[i]&&e.path in Ze[i].nsps?m=new ct(n,r):(Ze[i]||(Ze[i]=new ct(n,r)),m=Ze[i]),e.query&&!r.query&&(r.query=e.queryKey),m.socket(e.path,r)}Object.assign(Re,{Manager:ct,Socket:Pt,io:Re,connect:Re});class or{constructor(r){this.config=r,this.subscribersCounter={},this.eventObservables$={},this.emptyConfig={url:"",options:{}},void 0===r&&(r=this.emptyConfig),this.ioSocket=(Re||y)(r.url,r.options)}of(r){this.ioSocket.of(r)}on(r,e){this.ioSocket.on(r,e)}once(r,e){this.ioSocket.once(r,e)}connect(){return this.ioSocket.connect()}disconnect(r){return this.ioSocket.disconnect.apply(this.ioSocket,arguments)}emit(r,...e){return this.ioSocket.emit.apply(this.ioSocket,arguments)}removeListener(r,e){return this.ioSocket.removeListener.apply(this.ioSocket,arguments)}removeAllListeners(r){return this.ioSocket.removeAllListeners.apply(this.ioSocket,arguments)}fromEvent(r){return this.subscribersCounter[r]||(this.subscribersCounter[r]=0),this.subscribersCounter[r]++,this.eventObservables$[r]||(this.eventObservables$[r]=new B.y(e=>{const n=i=>{e.next(i)};return this.ioSocket.on(r,n),()=>{this.subscribersCounter[r]--,0===this.subscribersCounter[r]&&(this.ioSocket.removeListener(r,n),delete this.eventObservables$[r])}}).pipe((0,j.B)())),this.eventObservables$[r]}fromOneTimeEvent(r){return new Promise(e=>this.once(r,e))}listeners(r){return this.ioSocket.listeners(r)}listenersAny(){return this.ioSocket.listenersAny()}listenersAnyOutgoing(){return this.ioSocket.listenersAnyOutgoing()}off(r,e){return r?r&&!e?this.ioSocket.off(r):this.ioSocket.off(r,e):this.ioSocket.offAny()}onAny(r){return this.ioSocket.onAny(r)}onAnyOutgoing(r){return this.ioSocket.onAnyOutgoing(r)}prependAny(r){return this.ioSocket.prependAny(r)}prependAnyOutgoing(r){return this.ioSocket.prependAnyOutgoing(r)}timeout(r){return this.ioSocket.timeout(r)}volatile(){return this.ioSocket.volatile}}new o.OlP("__SOCKET_IO_CONFIG__");var sr=l(8819);let ar=!0,cr=!0;function Je(t,r,e){const n=t.match(r);return n&&n.length>=e&&parseInt(n[e],10)}function je(t,r,e){if(!t.RTCPeerConnection)return;const n=t.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(a,c){if(a!==r)return i.apply(this,arguments);const m=h=>{const v=e(h);v&&(c.handleEvent?c.handleEvent(v):c(v))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(c,m),i.apply(this,[a,m])};const s=n.removeEventListener;n.removeEventListener=function(a,c){if(a!==r||!this._eventMap||!this._eventMap[r])return s.apply(this,arguments);if(!this._eventMap[r].has(c))return s.apply(this,arguments);const m=this._eventMap[r].get(c);return this._eventMap[r].delete(c),0===this._eventMap[r].size&&delete this._eventMap[r],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[a,m])},Object.defineProperty(n,"on"+r,{get(){return this["_on"+r]},set(a){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),a&&this.addEventListener(r,this["_on"+r]=a)},enumerable:!0,configurable:!0})}function Hn(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(ar=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Kn(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(cr=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Ot(){if("object"==typeof window){if(ar)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function lt(t,r){cr&&console.warn(t+" is deprecated, please use "+r+" instead.")}function lr(t){return"[object Object]"===Object.prototype.toString.call(t)}function pr(t){return lr(t)?Object.keys(t).reduce(function(r,e){const n=lr(t[e]),i=n?pr(t[e]):t[e],s=n&&!Object.keys(i).length;return void 0===i||s?r:Object.assign(r,{[e]:i})},{}):t}function At(t,r,e){!r||e.has(r.id)||(e.set(r.id,r),Object.keys(r).forEach(n=>{n.endsWith("Id")?At(t,t.get(r[n]),e):n.endsWith("Ids")&&r[n].forEach(i=>{At(t,t.get(i),e)})}))}function fr(t,r,e){const n=e?"outbound-rtp":"inbound-rtp",i=new Map;if(null===r)return i;const s=[];return t.forEach(a=>{"track"===a.type&&a.trackIdentifier===r.id&&s.push(a)}),s.forEach(a=>{t.forEach(c=>{c.type===n&&c.trackId===a.id&&At(t,c,i)})}),i}const ur=Ot;function dr(t,r){const e=t&&t.navigator;if(!e.mediaDevices)return;const n=function(c){if("object"!=typeof c||c.mandatory||c.optional)return c;const m={};return Object.keys(c).forEach(h=>{if("require"===h||"advanced"===h||"mediaSource"===h)return;const v="object"==typeof c[h]?c[h]:{ideal:c[h]};void 0!==v.exact&&"number"==typeof v.exact&&(v.min=v.max=v.exact);const T=function(O,Z){return O?O+Z.charAt(0).toUpperCase()+Z.slice(1):"deviceId"===Z?"sourceId":Z};if(void 0!==v.ideal){m.optional=m.optional||[];let O={};"number"==typeof v.ideal?(O[T("min",h)]=v.ideal,m.optional.push(O),O={},O[T("max",h)]=v.ideal,m.optional.push(O)):(O[T("",h)]=v.ideal,m.optional.push(O))}void 0!==v.exact&&"number"!=typeof v.exact?(m.mandatory=m.mandatory||{},m.mandatory[T("",h)]=v.exact):["min","max"].forEach(O=>{void 0!==v[O]&&(m.mandatory=m.mandatory||{},m.mandatory[T(O,h)]=v[O])})}),c.advanced&&(m.optional=(m.optional||[]).concat(c.advanced)),m},i=function(c,m){if(r.version>=61)return m(c);if((c=JSON.parse(JSON.stringify(c)))&&"object"==typeof c.audio){const h=function(v,T,O){T in v&&!(O in v)&&(v[O]=v[T],delete v[T])};h((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),h(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=n(c.audio)}if(c&&"object"==typeof c.video){let h=c.video.facingMode;h=h&&("object"==typeof h?h:{ideal:h});const v=r.version<66;if(h&&("user"===h.exact||"environment"===h.exact||"user"===h.ideal||"environment"===h.ideal)&&(!e.mediaDevices.getSupportedConstraints||!e.mediaDevices.getSupportedConstraints().facingMode||v)){let T;if(delete c.video.facingMode,"environment"===h.exact||"environment"===h.ideal?T=["back","rear"]:("user"===h.exact||"user"===h.ideal)&&(T=["front"]),T)return e.mediaDevices.enumerateDevices().then(O=>{let Z=(O=O.filter(Q=>"videoinput"===Q.kind)).find(Q=>T.some(H=>Q.label.toLowerCase().includes(H)));return!Z&&O.length&&T.includes("back")&&(Z=O[O.length-1]),Z&&(c.video.deviceId=h.exact?{exact:Z.deviceId}:{ideal:Z.deviceId}),c.video=n(c.video),ur("chrome: "+JSON.stringify(c)),m(c)})}c.video=n(c.video)}return ur("chrome: "+JSON.stringify(c)),m(c)},s=function(c){return r.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(e.getUserMedia=function(c,m,h){i(c,v=>{e.webkitGetUserMedia(v,m,T=>{h&&h(s(T))})})}.bind(e),e.mediaDevices.getUserMedia){const c=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(m){return i(m,h=>c(h).then(v=>{if(h.audio&&!v.getAudioTracks().length||h.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(T=>{T.stop()}),new DOMException("","NotFoundError");return v},v=>Promise.reject(s(v))))}}}function Xn(t,r){if((!t.navigator.mediaDevices||!("getDisplayMedia"in t.navigator.mediaDevices))&&t.navigator.mediaDevices){if("function"!=typeof r)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");t.navigator.mediaDevices.getDisplayMedia=function(n){return r(n).then(i=>{const s=n.video&&n.video.width,a=n.video&&n.video.height;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:n.video&&n.video.frameRate||3}},s&&(n.video.mandatory.maxWidth=s),a&&(n.video.mandatory.maxHeight=a),t.navigator.mediaDevices.getUserMedia(n)})}}}function hr(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function mr(t){if("object"==typeof t&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let s;s=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):{track:i.track};const a=new Event("track");a.track=i.track,a.receiver=s,a.transceiver={receiver:s},a.streams=[n.stream],this.dispatchEvent(a)}),n.stream.getTracks().forEach(i=>{let s;s=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.id):{track:i};const a=new Event("track");a.track=i,a.receiver=s,a.transceiver={receiver:s},a.streams=[n.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else je(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function gr(t){if("object"==typeof t&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(i,s){return{track:s,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===s.kind?i.createDTMFSender(s):null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,m){let h=i.apply(this,arguments);return h||(h=r(this,c),this._senders.push(h)),h};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){s.apply(this,arguments);const m=this._senders.indexOf(c);-1!==m&&this._senders.splice(m,1)}}const e=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],e.apply(this,[s]),s.getTracks().forEach(a=>{this._senders.push(r(this,a))})};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(a=>{const c=this._senders.find(m=>m.track===a);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if("object"==typeof t&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=r.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function vr(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,i,s]=arguments;if(arguments.length>0&&"function"==typeof n)return r.apply(this,arguments);if(0===r.length&&(0===arguments.length||"function"!=typeof n))return r.apply(this,[]);const a=function(m){const h={};return m.result().forEach(T=>{const O={id:T.id,timestamp:T.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[T.type]||T.type};T.names().forEach(Z=>{O[Z]=T.stat(Z)}),h[O.id]=O}),h},c=function(m){return new Map(Object.keys(m).map(h=>[h,m[h]]))};return arguments.length>=2?r.apply(this,[function(h){i(c(a(h)))},n]):new Promise((m,h)=>{r.apply(this,[function(v){m(c(a(v)))},h])}).then(i,s)}}function yr(t){if(!("object"==typeof t&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(a=>a._pc=this),s});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=n.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(a=>fr(a,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i}),je(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>fr(s,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let i,s,a;return this.getSenders().forEach(c=>{c.track===n&&(i?a=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===n&&(s?a=!0:s=c),c.track===n)),a||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function _r(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[c.id]?-1===this._shimmedLocalStreams[c.id].indexOf(m)&&this._shimmedLocalStreams[c.id].push(m):this._shimmedLocalStreams[c.id]=[c,m],m};const e=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(h=>{if(this.getSenders().find(T=>T.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();e.apply(this,arguments);const m=this.getSenders().filter(h=>-1===c.indexOf(h));this._shimmedLocalStreams[a.id]=[a].concat(m)};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],n.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const m=this._shimmedLocalStreams[c].indexOf(a);-1!==m&&this._shimmedLocalStreams[c].splice(m,1),1===this._shimmedLocalStreams[c].length&&delete this._shimmedLocalStreams[c]}),i.apply(this,arguments)}}function Cr(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return _r(t);const e=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const v=e.apply(this);return this._reverseStreams=this._reverseStreams||{},v.map(T=>this._reverseStreams[T.id])};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(v){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},v.getTracks().forEach(T=>{if(this.getSenders().find(Z=>Z.track===T))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[v.id]){const T=new t.MediaStream(v.getTracks());this._streams[v.id]=T,this._reverseStreams[T.id]=v,v=T}n.apply(this,[v])};const i=t.RTCPeerConnection.prototype.removeStream;function s(h,v){let T=v.sdp;return Object.keys(h._reverseStreams||[]).forEach(O=>{const Z=h._reverseStreams[O];T=T.replace(new RegExp(h._streams[Z.id].id,"g"),Z.id)}),new RTCSessionDescription({type:v.type,sdp:T})}t.RTCPeerConnection.prototype.removeStream=function(v){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[v.id]||v]),delete this._reverseStreams[this._streams[v.id]?this._streams[v.id].id:v.id],delete this._streams[v.id]},t.RTCPeerConnection.prototype.addTrack=function(v,T){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const O=[].slice.call(arguments,1);if(1!==O.length||!O[0].getTracks().find(H=>H===v))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(H=>H.track===v))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const Q=this._streams[T.id];if(Q)Q.addTrack(v),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const H=new t.MediaStream([v]);this._streams[T.id]=H,this._reverseStreams[H.id]=T,this.addStream(H)}return this.getSenders().find(H=>H.track===v)},["createOffer","createAnswer"].forEach(function(h){const v=t.RTCPeerConnection.prototype[h],T={[h](){const O=arguments;return arguments.length&&"function"==typeof arguments[0]?v.apply(this,[Q=>{const H=s(this,Q);O[0].apply(null,[H])},Q=>{O[1]&&O[1].apply(null,Q)},arguments[2]]):v.apply(this,arguments).then(Q=>s(this,Q))}};t.RTCPeerConnection.prototype[h]=T[h]});const c=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function a(h,v){let T=v.sdp;return Object.keys(h._reverseStreams||[]).forEach(O=>{const Z=h._reverseStreams[O],Q=h._streams[Z.id];T=T.replace(new RegExp(Z.id,"g"),Q.id)}),new RTCSessionDescription({type:v.type,sdp:T})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const h=m.get.apply(this);return""===h.type?h:s(this,h)}}),t.RTCPeerConnection.prototype.removeTrack=function(v){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!v._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(v._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let O;this._streams=this._streams||{},Object.keys(this._streams).forEach(Z=>{this._streams[Z].getTracks().find(H=>v.track===H)&&(O=this._streams[Z])}),O&&(1===O.getTracks().length?this.removeStream(this._reverseStreams[O.id]):O.removeTrack(v.track),this.dispatchEvent(new Event("negotiationneeded")))}}function It(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const n=t.RTCPeerConnection.prototype[e],i={[e](){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};t.RTCPeerConnection.prototype[e]=i[e]})}function br(t,r){je(t,"negotiationneeded",e=>{const n=e.target;if(!(r.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var ti=l(6334),ri=l.n(ti);function Sr(t){const r=t&&t.navigator,n=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(i){return n(i).catch(s=>Promise.reject(function(i){return{name:{PermissionDeniedError:"NotAllowedError"}[i.name]||i.name,message:i.message,constraint:i.constraint,toString(){return this.name}}}(s)))}}function Tr(t){"getDisplayMedia"in t.navigator&&t.navigator.mediaDevices&&(t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||(t.navigator.mediaDevices.getDisplayMedia=t.navigator.getDisplayMedia.bind(t.navigator)))}function Dt(t,r){if(t.RTCIceGatherer&&(t.RTCIceCandidate||(t.RTCIceCandidate=function(i){return i}),t.RTCSessionDescription||(t.RTCSessionDescription=function(i){return i}),r.version<15025)){const n=Object.getOwnPropertyDescriptor(t.MediaStreamTrack.prototype,"enabled");Object.defineProperty(t.MediaStreamTrack.prototype,"enabled",{set(i){n.set.call(this,i);const s=new Event("enabled");s.enabled=i,this.dispatchEvent(s)}})}t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)&&Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new t.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),t.RTCDtmfSender&&!t.RTCDTMFSender&&(t.RTCDTMFSender=t.RTCDtmfSender);const e=ri()(t,r.version);t.RTCPeerConnection=function(i){return i&&i.iceServers&&(i.iceServers=function ei(t,r){let e=!1;return(t=JSON.parse(JSON.stringify(t))).filter(n=>{if(n&&(n.urls||n.url)){let i=n.urls||n.url;n.url&&!n.urls&&lt("RTCIceServer.url","RTCIceServer.urls");const s="string"==typeof i;return s&&(i=[i]),i=i.filter(a=>{if(0===a.indexOf("stun:"))return!1;const c=a.startsWith("turn")&&!a.startsWith("turn:[")&&a.includes("transport=udp");return c&&!e?(e=!0,!0):c&&!e}),delete n.url,n.urls=s?i[0]:i,!!i.length}})}(i.iceServers),Ot("ICE servers after filtering:",i.iceServers)),new e(i)},t.RTCPeerConnection.prototype=e.prototype}function xr(t){t.RTCRtpSender&&!("replaceTrack"in t.RTCRtpSender.prototype)&&(t.RTCRtpSender.prototype.replaceTrack=t.RTCRtpSender.prototype.setTrack)}function kr(t,r){const e=t&&t.navigator,n=t&&t.MediaStreamTrack;if(e.getUserMedia=function(i,s,a){lt("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),e.mediaDevices.getUserMedia(i).then(s,a)},!(r.version>55&&"autoGainControl"in e.mediaDevices.getSupportedConstraints())){const i=function(a,c,m){c in a&&!(m in a)&&(a[m]=a[c],delete a[c])},s=e.mediaDevices.getUserMedia.bind(e.mediaDevices);if(e.mediaDevices.getUserMedia=function(a){return"object"==typeof a&&"object"==typeof a.audio&&(a=JSON.parse(JSON.stringify(a)),i(a.audio,"autoGainControl","mozAutoGainControl"),i(a.audio,"noiseSuppression","mozNoiseSuppression")),s(a)},n&&n.prototype.getSettings){const a=n.prototype.getSettings;n.prototype.getSettings=function(){const c=a.apply(this,arguments);return i(c,"mozAutoGainControl","autoGainControl"),i(c,"mozNoiseSuppression","noiseSuppression"),c}}if(n&&n.prototype.applyConstraints){const a=n.prototype.applyConstraints;n.prototype.applyConstraints=function(c){return"audio"===this.kind&&"object"==typeof c&&(c=JSON.parse(JSON.stringify(c)),i(c,"autoGainControl","mozAutoGainControl"),i(c,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[c])}}}}function ni(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return!0===n.video?n.video={mediaSource:r}:n.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(n)})}function Er(t){"object"==typeof t&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Mt(t,r){if("object"!=typeof t||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],a={[i](){return arguments[0]=new("addIceCandidate"===i?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=a[i]});const e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,a,c]=arguments;return n.apply(this,[s||null]).then(m=>{if(r.version<53&&!a)try{m.forEach(h=>{h.type=e[h.type]||h.type})}catch(h){if("TypeError"!==h.name)throw h;m.forEach((v,T)=>{m.set(T,Object.assign({},v,{type:e[v.type]||v.type}))})}return m}).then(a,c)}}function Rr(t){if("object"!=typeof t||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(s=>s._pc=this),i});const e=t.RTCPeerConnection.prototype.addTrack;e&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=e.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Pr(t){if("object"!=typeof t||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=r.apply(this,[]);return n.forEach(i=>i._pc=this),n}),je(t,"track",e=>(e.receiver._pc=e.srcElement,e)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Or(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){lt("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&e.getTracks().includes(n.track)&&this.removeTrack(n)})})}function Ar(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Ir(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const n=arguments[1],i=n&&"sendEncodings"in n;i&&n.sendEncodings.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=r.apply(this,arguments);if(i){const{sender:a}=s,c=a.getParameters();(!("encodings"in c)||1===c.encodings.length&&0===Object.keys(c.encodings[0]).length)&&(c.encodings=n.sendEncodings,a.sendEncodings=n.sendEncodings,this.setParametersPromises.push(a.setParameters(c).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return s})}function Dr(t){if("object"!=typeof t||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const n=r.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function Mr(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function Br(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function wr(t){if("object"==typeof t&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>r.call(this,i,n)),n.getVideoTracks().forEach(i=>r.call(this,i,n))},t.RTCPeerConnection.prototype.addTrack=function(n,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(-1===n)return;this._localStreams.splice(n,1);const i=e.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function jr(t){if("object"==typeof t&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(s)>=0)return;n._remoteStreams.push(s);const a=new Event("addstream");a.stream=s,n.dispatchEvent(a)})}),r.apply(n,arguments)}}}function Lr(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,e=r.createOffer,n=r.createAnswer,i=r.setLocalDescription,s=r.setRemoteDescription,a=r.addIceCandidate;r.createOffer=function(h,v){const O=e.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return v?(O.then(h,v),Promise.resolve()):O},r.createAnswer=function(h,v){const O=n.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return v?(O.then(h,v),Promise.resolve()):O};let c=function(m,h,v){const T=i.apply(this,[m]);return v?(T.then(h,v),Promise.resolve()):T};r.setLocalDescription=c,c=function(m,h,v){const T=s.apply(this,[m]);return v?(T.then(h,v),Promise.resolve()):T},r.setRemoteDescription=c,c=function(m,h,v){const T=a.apply(this,[m]);return v?(T.then(h,v),Promise.resolve()):T},r.addIceCandidate=c}function Nr(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const e=r.mediaDevices,n=e.getUserMedia.bind(e);r.mediaDevices.getUserMedia=i=>n(Fr(i))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=function(n,i,s){r.mediaDevices.getUserMedia(n).then(i,s)}.bind(r))}function Fr(t){return t&&void 0!==t.video?Object.assign({},t,{video:pr(t.video)}):t}function Ur(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const s=[];for(let a=0;a<n.iceServers.length;a++){let c=n.iceServers[a];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(lt("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,s.push(c)):s.push(n.iceServers[a])}n.iceServers=s}return new r(n,i)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function $r(t){"object"==typeof t&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Zr(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio<"u"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(a=>"audio"===a.receiver.track.kind);!1===n.offerToReceiveAudio&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0===n.offerToReceiveAudio&&!i&&this.addTransceiver("audio"),typeof n.offerToReceiveVideo<"u"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const s=this.getTransceivers().find(a=>"video"===a.receiver.track.kind);!1===n.offerToReceiveVideo&&s?"sendrecv"===s.direction?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":"recvonly"===s.direction&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):!0===n.offerToReceiveVideo&&!s&&this.addTransceiver("video")}return r.apply(this,arguments)}}function Jr(t){"object"!=typeof t||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var ii=l(7463),pt=l.n(ii);function ft(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if("object"==typeof n&&n.candidate&&0===n.candidate.indexOf("a=")&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new r(n),s=pt().parseCandidate(n.candidate),a=Object.assign(i,s);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new r(n)},t.RTCIceCandidate.prototype=r.prototype,je(t,"icecandidate",e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e))}function Ge(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===r.browser&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();"plan-b"===m&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(function(c){if(!c||!c.sdp)return!1;const m=pt().splitSections(c.sdp);return m.shift(),m.some(h=>{const v=pt().parseMLine(h);return v&&"application"===v.kind&&-1!==v.protocol.indexOf("SCTP")})}(arguments[0])){const m=function(c){const m=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===m||m.length<2)return-1;const h=parseInt(m[1],10);return h!=h?-1:h}(arguments[0]),h=function(c){let m=65536;return"firefox"===r.browser&&(m=r.version<57?-1===c?16384:2147483637:r.version<60?57===r.version?65535:65536:2147483637),m}(m),v=function(c,m){let h=65536;"firefox"===r.browser&&57===r.version&&(h=65535);const v=pt().matchPrefix(c.sdp,"a=max-message-size:");return v.length>0?h=parseInt(v[0].substr(19),10):"firefox"===r.browser&&-1!==m&&(h=2147483637),h}(arguments[0],m);let T;T=0===h&&0===v?Number.POSITIVE_INFINITY:0===h||0===v?Math.max(h,v):Math.min(h,v);const O={};Object.defineProperty(O,"maxMessageSize",{get:()=>T}),this._sctp=O}return a.apply(this,arguments)}}function qe(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(n,i){const s=n.send;n.send=function(){const c=arguments[0];if("open"===n.readyState&&i.sctp&&(c.length||c.size||c.byteLength)>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(n,arguments)}}const e=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=e.apply(this,arguments);return r(i,this),i},je(t,"datachannel",n=>(r(n.channel,n.target),n))}function Bt(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=r[e];r[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const a=new Event("connectionstatechange",i);s.dispatchEvent(a)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function wt(t,r){if(!t.RTCPeerConnection||"chrome"===r.browser&&r.version>=71||"safari"===r.browser&&r.version>=605)return;const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&-1!==i.sdp.indexOf("\na=extmap-allow-mixed")){const s=i.sdp.split("\n").filter(a=>"a=extmap-allow-mixed"!==a.trim()).join("\n");t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return e.apply(this,arguments)}}function ut(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype.addIceCandidate;!e||0===e.length||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===r.browser&&r.version<78||"firefox"===r.browser&&r.version<68||"safari"===r.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const Gr=function oi({window:t}={},r={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const e=Ot,n=function Wn(t){const r={browser:null,version:null};if(typeof t>"u"||!t.navigator)return r.browser="Not a browser.",r;const{navigator:e}=t;if(e.mozGetUserMedia)r.browser="firefox",r.version=Je(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia||!1===t.isSecureContext&&t.webkitRTCPeerConnection&&!t.RTCIceGatherer)r.browser="chrome",r.version=Je(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=Je(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.RTCPeerConnection||!e.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=Je(e.userAgent,/AppleWebKit\/(\d+)\./,1),r.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype}return r}(t),i={browserDetails:n,commonShim:ne,extractVersion:Je,disableLog:Hn,disableWarnings:Kn};switch(n.browser){case"chrome":if(!k||!It||!r.shimChrome)return e("Chrome shim is not included in this adapter release."),i;if(null===n.version)return e("Chrome shim can not determine version, not shimming."),i;e("adapter.js shimming chrome."),i.browserShim=k,ut(t,n),dr(t,n),hr(t),It(t,n),mr(t),Cr(t,n),gr(t),vr(t),yr(t),br(t,n),ft(t),Bt(t),Ge(t,n),qe(t),wt(t,n);break;case"firefox":if(!L||!Mt||!r.shimFirefox)return e("Firefox shim is not included in this adapter release."),i;e("adapter.js shimming firefox."),i.browserShim=L,ut(t,n),kr(t,n),Mt(t,n),Er(t),Or(t),Rr(t),Pr(t),Ar(t),Ir(t),Dr(t),Mr(t),Br(t),ft(t),Bt(t),Ge(t,n),qe(t);break;case"edge":if(!E||!Dt||!r.shimEdge)return e("MS edge shim is not included in this adapter release."),i;e("adapter.js shimming edge."),i.browserShim=E,Sr(t),Tr(t),Dt(t,n),xr(t),Ge(t,n),qe(t);break;case"safari":if(!te||!r.shimSafari)return e("Safari shim is not included in this adapter release."),i;e("adapter.js shimming safari."),i.browserShim=te,ut(t,n),Ur(t),Zr(t),Lr(t),wr(t),jr(t),$r(t),Nr(t),Jr(t),ft(t),Ge(t,n),qe(t),wt(t,n);break;default:e("Unsupported browser!")}return i}({window:typeof window>"u"?void 0:window});function _e(t,r,e,n){Object.defineProperty(t,r,{get:e,set:n,enumerable:!0,configurable:!0})}var jt=Gr.default||Gr,ze=new(function(){function t(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return t.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},t.prototype.isBrowserSupported=function(){var r=this.getBrowser(),e=this.getVersion();return!!this.supportedBrowsers.includes(r)&&("chrome"===r?e>=this.minChromeVersion:"firefox"===r?e>=this.minFirefoxVersion:"safari"===r&&!this.isIOS&&e>=this.minSafariVersion)},t.prototype.getBrowser=function(){return jt.browserDetails.browser},t.prototype.getVersion=function(){return jt.browserDetails.version||0},t.prototype.isUnifiedPlanSupported=function(){var r=this.getBrowser(),e=jt.browserDetails.version||0;if("chrome"===r&&e<this.minChromeVersion)return!1;if("firefox"===r&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n,i=!1;try{(n=new RTCPeerConnection).addTransceiver("audio"),i=!0}catch{}finally{n&&n.close()}return i},t.prototype.toString=function(){return"Supports:\n    browser:".concat(this.getBrowser(),"\n    version:").concat(this.getVersion(),"\n    isIOS:").concat(this.isIOS,"\n    isWebRTCSupported:").concat(this.isWebRTCSupported(),"\n    isBrowserSupported:").concat(this.isBrowserSupported(),"\n    isUnifiedPlanSupported:").concat(this.isUnifiedPlanSupported())},t}()),qr={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},si=function(){function t(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=qr,this.browser=ze.getBrowser(),this.browserVersion=ze.getVersion(),this.supports=function(){var e,r={browser:ze.isBrowserSupported(),webRTC:ze.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!r.webRTC)return r;try{e=new RTCPeerConnection(qr),r.audioVideo=!0;var n=void 0;try{n=e.createDataChannel("_PEERJSTEST",{ordered:!0}),r.data=!0,r.reliable=!!n.ordered;try{n.binaryType="blob",r.binaryBlob=!ze.isIOS}catch{}}catch{}finally{n&&n.close()}}catch{}finally{e&&e.close()}return r}(),this.pack=sr.pack,this.unpack=sr.unpack,this._dataCount=1}return t.prototype.noop=function(){},t.prototype.validateId=function(r){return!r||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(r)},t.prototype.chunk=function(r){for(var e=[],n=r.size,i=Math.ceil(n/q.chunkedMTU),s=0,a=0;a<n;){var c=Math.min(n,a+q.chunkedMTU),m=r.slice(a,c);e.push({__peerData:this._dataCount,n:s,data:m,total:i}),a=c,s++}return this._dataCount++,e},t.prototype.blobToArrayBuffer=function(r,e){var n=new FileReader;return n.onload=function(i){i.target&&e(i.target.result)},n.readAsArrayBuffer(r),n},t.prototype.binaryStringToArrayBuffer=function(r){for(var e=new Uint8Array(r.length),n=0;n<r.length;n++)e[n]=255&r.charCodeAt(n);return e.buffer},t.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},t.prototype.isSecure=function(){return"https:"===location.protocol},t}(),q=new si,zr={};_e(zr,"Peer",()=>cn,t=>cn=t);var Ve,ai=Object.prototype.hasOwnProperty,ue="~";function Ye(){}function ci(t,r,e){this.fn=t,this.context=r,this.once=e||!1}function Vr(t,r,e,n,i){if("function"!=typeof e)throw new TypeError("The listener must be a function");var s=new ci(e,n||t,i),a=ue?ue+r:r;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],s]:t._events[a].push(s):(t._events[a]=s,t._eventsCount++),t}function dt(t,r){0==--t._eventsCount?t._events=new Ye:delete t._events[r]}function le(){this._events=new Ye,this._eventsCount=0}Object.create&&(Ye.prototype=Object.create(null),(new Ye).__proto__||(ue=!1)),le.prototype.eventNames=function(){var e,n,r=[];if(0===this._eventsCount)return r;for(n in e=this._events)ai.call(e,n)&&r.push(ue?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},le.prototype.listeners=function(r){var n=this._events[ue?ue+r:r];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,a=new Array(s);i<s;i++)a[i]=n[i].fn;return a},le.prototype.listenerCount=function(r){var n=this._events[ue?ue+r:r];return n?n.fn?1:n.length:0},le.prototype.emit=function(r,e,n,i,s,a){var c=ue?ue+r:r;if(!this._events[c])return!1;var v,T,m=this._events[c],h=arguments.length;if(m.fn){switch(m.once&&this.removeListener(r,m.fn,void 0,!0),h){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,e),!0;case 3:return m.fn.call(m.context,e,n),!0;case 4:return m.fn.call(m.context,e,n,i),!0;case 5:return m.fn.call(m.context,e,n,i,s),!0;case 6:return m.fn.call(m.context,e,n,i,s,a),!0}for(T=1,v=new Array(h-1);T<h;T++)v[T-1]=arguments[T];m.fn.apply(m.context,v)}else{var Z,O=m.length;for(T=0;T<O;T++)switch(m[T].once&&this.removeListener(r,m[T].fn,void 0,!0),h){case 1:m[T].fn.call(m[T].context);break;case 2:m[T].fn.call(m[T].context,e);break;case 3:m[T].fn.call(m[T].context,e,n);break;case 4:m[T].fn.call(m[T].context,e,n,i);break;default:if(!v)for(Z=1,v=new Array(h-1);Z<h;Z++)v[Z-1]=arguments[Z];m[T].fn.apply(m[T].context,v)}}return!0},le.prototype.on=function(r,e,n){return Vr(this,r,e,n,!1)},le.prototype.once=function(r,e,n){return Vr(this,r,e,n,!0)},le.prototype.removeListener=function(r,e,n,i){var s=ue?ue+r:r;if(!this._events[s])return this;if(!e)return dt(this,s),this;var a=this._events[s];if(a.fn)a.fn===e&&(!i||a.once)&&(!n||a.context===n)&&dt(this,s);else{for(var c=0,m=[],h=a.length;c<h;c++)(a[c].fn!==e||i&&!a[c].once||n&&a[c].context!==n)&&m.push(a[c]);m.length?this._events[s]=1===m.length?m[0]:m:dt(this,s)}return this},le.prototype.removeAllListeners=function(r){var e;return r?this._events[e=ue?ue+r:r]&&dt(this,e):(this._events=new Ye,this._eventsCount=0),this},le.prototype.off=le.prototype.removeListener,le.prototype.addListener=le.prototype.on,le.prefixed=ue,le.EventEmitter=le,Ve=le;var A={};_e(A,"LogLevel",()=>ee,t=>ee=t),_e(A,"default",()=>Yr,t=>Yr=t);var Ae=function(t,r){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var i,a,n=e.call(t),s=[];try{for(;(void 0===r||r-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(c){a={error:c}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(a)throw a.error}}return s},Ie=function(t,r,e){if(e||2===arguments.length)for(var s,n=0,i=r.length;n<i;n++)(s||!(n in r))&&(s||(s=Array.prototype.slice.call(r,0,n)),s[n]=r[n]);return t.concat(s||Array.prototype.slice.call(r))},ee=(()=>((ee=ee||{})[ee.Disabled=0]="Disabled",ee[ee.Errors=1]="Errors",ee[ee.Warnings=2]="Warnings",ee[ee.All=3]="All",ee))(),pi=function(){function t(){this._logLevel=ee.Disabled}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(r){this._logLevel=r},enumerable:!1,configurable:!0}),t.prototype.log=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];this._logLevel>=ee.All&&this._print.apply(this,Ie([ee.All],Ae(r),!1))},t.prototype.warn=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];this._logLevel>=ee.Warnings&&this._print.apply(this,Ie([ee.Warnings],Ae(r),!1))},t.prototype.error=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];this._logLevel>=ee.Errors&&this._print.apply(this,Ie([ee.Errors],Ae(r),!1))},t.prototype.setLogFunction=function(r){this._print=r},t.prototype._print=function(r){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=Ie(["PeerJS: "],Ae(e),!1);for(var s in i)i[s]instanceof Error&&(i[s]="("+i[s].name+") "+i[s].message);r>=ee.All?console.log.apply(console,Ie([],Ae(i),!1)):r>=ee.Warnings?console.warn.apply(console,Ie(["WARNING"],Ae(i),!1)):r>=ee.Errors&&console.error.apply(console,Ie(["ERROR"],Ae(i),!1))},t}(),Yr=new pi,Qr={};_e(Qr,"Socket",()=>Hr,t=>Hr=t);var Lt,de=(()=>((de=de||{}).Data="data",de.Media="media",de))(),G=(()=>((G=G||{}).BrowserIncompatible="browser-incompatible",G.Disconnected="disconnected",G.InvalidID="invalid-id",G.InvalidKey="invalid-key",G.Network="network",G.PeerUnavailable="peer-unavailable",G.SslUnavailable="ssl-unavailable",G.ServerError="server-error",G.SocketError="socket-error",G.SocketClosed="socket-closed",G.UnavailableID="unavailable-id",G.WebRTC="webrtc",G))(),me=(()=>((me=me||{}).Binary="binary",me.BinaryUTF8="binary-utf8",me.JSON="json",me))(),he=(()=>((he=he||{}).Message="message",he.Disconnected="disconnected",he.Error="error",he.Close="close",he))(),Y=(()=>((Y=Y||{}).Heartbeat="HEARTBEAT",Y.Candidate="CANDIDATE",Y.Offer="OFFER",Y.Answer="ANSWER",Y.Open="OPEN",Y.Error="ERROR",Y.IdTaken="ID-TAKEN",Y.InvalidKey="INVALID-KEY",Y.Leave="LEAVE",Y.Expire="EXPIRE",Y))();Lt=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xfcckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var t,fi=(t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])})(r,e)},function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Hr=function(t){function r(e,n,i,s,a,c){void 0===c&&(c=5e3);var m=t.call(this)||this;return m.pingInterval=c,m._disconnected=!0,m._messagesQueue=[],m._baseUrl=(e?"wss://":"ws://")+n+":"+i+s+"peerjs?key="+a,m}return fi(r,t),r.prototype.start=function(e,n){var i=this;this._id=e;var s="".concat(this._baseUrl,"&id=").concat(e,"&token=").concat(n);this._socket||!this._disconnected||(this._socket=new WebSocket(s+"&version="+Lt.version),this._disconnected=!1,this._socket.onmessage=function(a){var c;try{c=JSON.parse(a.data),A.default.log("Server message received:",c)}catch{return void A.default.log("Invalid server message",a.data)}i.emit(he.Message,c)},this._socket.onclose=function(a){i._disconnected||(A.default.log("Socket closed.",a),i._cleanup(),i._disconnected=!0,i.emit(he.Disconnected))},this._socket.onopen=function(){i._disconnected||(i._sendQueuedMessages(),A.default.log("Socket open"),i._scheduleHeartbeat())})},r.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout(function(){e._sendHeartbeat()},this.pingInterval)},r.prototype._sendHeartbeat=function(){if(this._wsOpen()){var e=JSON.stringify({type:Y.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}else A.default.log("Cannot send heartbeat, because socket closed")},r.prototype._wsOpen=function(){return!!this._socket&&1===this._socket.readyState},r.prototype._sendQueuedMessages=function(){var e,n,i=function(t,r,e){if(e||2===arguments.length)for(var s,n=0,i=r.length;n<i;n++)(s||!(n in r))&&(s||(s=Array.prototype.slice.call(r,0,n)),s[n]=r[n]);return t.concat(s||Array.prototype.slice.call(r))}([],function(t,r){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var i,a,n=e.call(t),s=[];try{for(;(void 0===r||r-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(c){a={error:c}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(a)throw a.error}}return s}(this._messagesQueue),!1);this._messagesQueue=[];try{for(var s=function(t){var r="function"==typeof Symbol&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}(i),a=s.next();!a.done;a=s.next())this.send(a.value)}catch(m){e={error:m}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}},r.prototype.send=function(e){if(!this._disconnected){if(!this._id)return void this._messagesQueue.push(e);if(!e.type)return void this.emit(he.Error,"Invalid message");if(this._wsOpen()){var n=JSON.stringify(e);this._socket.send(n)}}},r.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},r.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},r}(Ve.EventEmitter),Nt={};_e(Nt,"MediaConnection",()=>Xr,t=>Xr=t);var Ft={};_e(Ft,"Negotiator",()=>Kr,t=>Kr=t);var ht=function(){return ht=Object.assign||function(t){for(var r,e=1,n=arguments.length;e<n;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},ht.apply(this,arguments)},mt=function(t,r,e,n){return new(e||(e=Promise))(function(s,a){function c(v){try{h(n.next(v))}catch(T){a(T)}}function m(v){try{h(n.throw(v))}catch(T){a(T)}}function h(v){v.done?s(v.value):function i(s){return s instanceof e?s:new e(function(a){a(s)})}(v.value).then(c,m)}h((n=n.apply(t,r||[])).next())})},gt=function(t,r){var n,i,s,a,e={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(h){return function(v){return function m(h){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(s=2&h[0]?i.return:h[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,h[1])).done)return s;switch(i=0,s&&(h=[2&h[0],s.value]),h[0]){case 0:case 1:s=h;break;case 4:return e.label++,{value:h[1],done:!1};case 5:e.label++,i=h[1],h=[0];continue;case 7:h=e.ops.pop(),e.trys.pop();continue;default:if(!(s=(s=e.trys).length>0&&s[s.length-1])&&(6===h[0]||2===h[0])){e=0;continue}if(3===h[0]&&(!s||h[1]>s[0]&&h[1]<s[3])){e.label=h[1];break}if(6===h[0]&&e.label<s[1]){e.label=s[1],s=h;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(h);break}s[2]&&e.ops.pop(),e.trys.pop();continue}h=r.call(t,e)}catch(v){h=[6,v],i=0}finally{n=s=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([h,v])}}},Kr=function(){function t(r){this.connection=r}return t.prototype.startConnection=function(r){var e=this._startPeerConnection();if(this.connection.peerConnection=e,this.connection.type===de.Media&&r._stream&&this._addTracksToConnection(r._stream,e),r.originator){if(this.connection.type===de.Data){var n=this.connection,s=e.createDataChannel(n.label,{ordered:!!r.reliable});n.initialize(s)}this._makeOffer()}else this.handleSDP("OFFER",r.sdp)},t.prototype._startPeerConnection=function(){A.default.log("Creating RTCPeerConnection.");var r=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(r),r},t.prototype._setupListeners=function(r){var e=this,n=this.connection.peer,i=this.connection.connectionId,s=this.connection.type,a=this.connection.provider;A.default.log("Listening for ICE candidates."),r.onicecandidate=function(c){!c.candidate||!c.candidate.candidate||(A.default.log("Received ICE candidates for ".concat(n,":"),c.candidate),a.socket.send({type:Y.Candidate,payload:{candidate:c.candidate,type:s,connectionId:i},dst:n}))},r.oniceconnectionstatechange=function(){switch(r.iceConnectionState){case"failed":A.default.log("iceConnectionState is failed, closing connections to "+n),e.connection.emit("error",new Error("Negotiation of connection to "+n+" failed.")),e.connection.close();break;case"closed":A.default.log("iceConnectionState is closed, closing connections to "+n),e.connection.emit("error",new Error("Connection to "+n+" closed.")),e.connection.close();break;case"disconnected":A.default.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":r.onicecandidate=q.noop}e.connection.emit("iceStateChanged",r.iceConnectionState)},A.default.log("Listening for data channel"),r.ondatachannel=function(c){A.default.log("Received data channel");var m=c.channel;a.getConnection(n,i).initialize(m)},A.default.log("Listening for remote stream"),r.ontrack=function(c){A.default.log("Received remote stream");var m=c.streams[0],h=a.getConnection(n,i);h.type===de.Media&&e._addStreamToMediaConnection(m,h)}},t.prototype.cleanup=function(){A.default.log("Cleaning up PeerConnection to "+this.connection.peer);var r=this.connection.peerConnection;if(r){this.connection.peerConnection=null,r.onicecandidate=r.oniceconnectionstatechange=r.ondatachannel=r.ontrack=function(){};var n=!1;if(this.connection.type===de.Data){var s=this.connection.dataChannel;s&&(n=!!s.readyState&&"closed"!==s.readyState)}("closed"!==r.signalingState||n)&&r.close()}},t.prototype._makeOffer=function(){return mt(this,void 0,Promise,function(){var r,e,n,i,s,a,c;return gt(this,function(m){switch(m.label){case 0:r=this.connection.peerConnection,e=this.connection.provider,m.label=1;case 1:return m.trys.push([1,7,,8]),[4,r.createOffer(this.connection.options.constraints)];case 2:n=m.sent(),A.default.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),m.label=3;case 3:return m.trys.push([3,5,,6]),[4,r.setLocalDescription(n)];case 4:return m.sent(),A.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),i={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:q.browser},this.connection.type===de.Data&&(s=this.connection,i=ht(ht({},i),{label:s.label,reliable:s.reliable,serialization:s.serialization})),e.socket.send({type:Y.Offer,payload:i,dst:this.connection.peer}),[3,6];case 5:return"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=(a=m.sent())&&(e.emitError(G.WebRTC,a),A.default.log("Failed to setLocalDescription, ",a)),[3,6];case 6:return[3,8];case 7:return c=m.sent(),e.emitError(G.WebRTC,c),A.default.log("Failed to createOffer, ",c),[3,8];case 8:return[2]}})})},t.prototype._makeAnswer=function(){return mt(this,void 0,Promise,function(){var r,e,n,i,s;return gt(this,function(a){switch(a.label){case 0:r=this.connection.peerConnection,e=this.connection.provider,a.label=1;case 1:return a.trys.push([1,7,,8]),[4,r.createAnswer()];case 2:n=a.sent(),A.default.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),a.label=3;case 3:return a.trys.push([3,5,,6]),[4,r.setLocalDescription(n)];case 4:return a.sent(),A.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),e.socket.send({type:Y.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:q.browser},dst:this.connection.peer}),[3,6];case 5:return i=a.sent(),e.emitError(G.WebRTC,i),A.default.log("Failed to setLocalDescription, ",i),[3,6];case 6:return[3,8];case 7:return s=a.sent(),e.emitError(G.WebRTC,s),A.default.log("Failed to create answer, ",s),[3,8];case 8:return[2]}})})},t.prototype.handleSDP=function(r,e){return mt(this,void 0,Promise,function(){var n,i,s,a;return gt(this,function(c){switch(c.label){case 0:e=new RTCSessionDescription(e),n=this.connection.peerConnection,i=this.connection.provider,A.default.log("Setting remote description",e),s=this,c.label=1;case 1:return c.trys.push([1,5,,6]),[4,n.setRemoteDescription(e)];case 2:return c.sent(),A.default.log("Set remoteDescription:".concat(r," for:").concat(this.connection.peer)),"OFFER"!==r?[3,4]:[4,s._makeAnswer()];case 3:c.sent(),c.label=4;case 4:return[3,6];case 5:return a=c.sent(),i.emitError(G.WebRTC,a),A.default.log("Failed to setRemoteDescription, ",a),[3,6];case 6:return[2]}})})},t.prototype.handleCandidate=function(r){return mt(this,void 0,Promise,function(){var e,n,i,s,a,c;return gt(this,function(m){switch(m.label){case 0:A.default.log("handleCandidate:",r),e=r.candidate,n=r.sdpMLineIndex,i=r.sdpMid,s=this.connection.peerConnection,a=this.connection.provider,m.label=1;case 1:return m.trys.push([1,3,,4]),[4,s.addIceCandidate(new RTCIceCandidate({sdpMid:i,sdpMLineIndex:n,candidate:e}))];case 2:return m.sent(),A.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return c=m.sent(),a.emitError(G.WebRTC,c),A.default.log("Failed to handleCandidate, ",c),[3,4];case 4:return[2]}})})},t.prototype._addTracksToConnection=function(r,e){if(A.default.log("add tracks from stream ".concat(r.id," to peer connection")),!e.addTrack)return A.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");r.getTracks().forEach(function(n){e.addTrack(n,r)})},t.prototype._addStreamToMediaConnection=function(r,e){A.default.log("add stream ".concat(r.id," to media connection ").concat(e.connectionId)),e.addStream(r)},t}(),Ut={};_e(Ut,"BaseConnection",()=>Wr,t=>Wr=t);var mi=function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])})(r,e)};return function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Wr=function(t){function r(e,n,i){var s=t.call(this)||this;return s.peer=e,s.provider=n,s.options=i,s._open=!1,s.metadata=i.metadata,s}return mi(r,t),Object.defineProperty(r.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),r}(Ve.EventEmitter),gi=function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])})(r,e)};return function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),vt=function(){return vt=Object.assign||function(t){for(var r,e=1,n=arguments.length;e<n;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},vt.apply(this,arguments)},Xr=function(t){function r(e,n,i){var s=t.call(this,e,n,i)||this;return s._localStream=s.options._stream,s.connectionId=s.options.connectionId||r.ID_PREFIX+q.randomToken(),s._negotiator=new Ft.Negotiator(s),s._localStream&&s._negotiator.startConnection({_stream:s._localStream,originator:!0}),s}return gi(r,t),Object.defineProperty(r.prototype,"type",{get:function(){return de.Media},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),r.prototype.addStream=function(e){A.default.log("Receiving stream",e),this._remoteStream=e,t.prototype.emit.call(this,"stream",e)},r.prototype.handleMessage=function(e){var n=e.type,i=e.payload;switch(e.type){case Y.Answer:this._negotiator.handleSDP(n,i.sdp),this._open=!0;break;case Y.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:A.default.warn("Unrecognized message type:".concat(n," from peer:").concat(this.peer))}},r.prototype.answer=function(e,n){var i,s;if(void 0===n&&(n={}),this._localStream)A.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection(vt(vt({},this.options._payload),{_stream:e}));var a=this.provider._getMessages(this.connectionId);try{for(var c=function(t){var r="function"==typeof Symbol&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}(a),m=c.next();!m.done;m=c.next())this.handleMessage(m.value)}catch(v){i={error:v}}finally{try{m&&!m.done&&(s=c.return)&&s.call(c)}finally{if(i)throw i.error}}this._open=!0}},r.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,t.prototype.emit.call(this,"close"))},r.ID_PREFIX="mc_",r}(Ut.BaseConnection),$t={};_e($t,"DataConnection",()=>rn,t=>rn=t);var en={};_e(en,"EncodingQueue",()=>tn,t=>tn=t);var yi=function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])})(r,e)};return function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),tn=function(t){function r(){var e=t.call(this)||this;return e.fileReader=new FileReader,e._queue=[],e._processing=!1,e.fileReader.onload=function(n){e._processing=!1,n.target&&e.emit("done",n.target.result),e.doNextTask()},e.fileReader.onerror=function(n){A.default.error("EncodingQueue error:",n),e._processing=!1,e.destroy(),e.emit("error",n)},e}return yi(r,t),Object.defineProperty(r.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),r.prototype.enque=function(e){this.queue.push(e),!this.processing&&this.doNextTask()},r.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},r.prototype.doNextTask=function(){0!==this.size&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},r}(Ve.EventEmitter),_i=function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])})(r,e)};return function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),rn=function(t){function r(e,n,i){var s=t.call(this,e,n,i)||this;return s.stringify=JSON.stringify,s.parse=JSON.parse,s._buffer=[],s._bufferSize=0,s._buffering=!1,s._chunkedData={},s._encodingQueue=new en.EncodingQueue,s.connectionId=s.options.connectionId||r.ID_PREFIX+q.randomToken(),s.label=s.options.label||s.connectionId,s.serialization=s.options.serialization||me.Binary,s.reliable=!!s.options.reliable,s._encodingQueue.on("done",function(a){s._bufferedSend(a)}),s._encodingQueue.on("error",function(){A.default.error("DC#".concat(s.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),s.close()}),s._negotiator=new Ft.Negotiator(s),s._negotiator.startConnection(s.options._payload||{originator:!0}),s}return _i(r,t),Object.defineProperty(r.prototype,"type",{get:function(){return de.Data},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),r.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},r.prototype._configureDataChannel=function(){var e=this;(!q.supports.binaryBlob||q.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){A.default.log("DC#".concat(e.connectionId," dc connection success")),e._open=!0,e.emit("open")},this.dataChannel.onmessage=function(n){A.default.log("DC#".concat(e.connectionId," dc onmessage:"),n.data),e._handleDataMessage(n)},this.dataChannel.onclose=function(){A.default.log("DC#".concat(e.connectionId," dc closed for:"),e.peer),e.close()}},r.prototype._handleDataMessage=function(e){var n=this,i=e.data,s=i.constructor,c=i;if(this.serialization===me.Binary||this.serialization===me.BinaryUTF8){if(s===Blob)return void q.blobToArrayBuffer(i,function(h){var v=q.unpack(h);n.emit("data",v)});if(s===ArrayBuffer)c=q.unpack(i);else if(s===String){var m=q.binaryStringToArrayBuffer(i);c=q.unpack(m)}}else this.serialization===me.JSON&&(c=this.parse(i));c.__peerData?this._handleChunk(c):t.prototype.emit.call(this,"data",c)},r.prototype._handleChunk=function(e){var n=e.__peerData,i=this._chunkedData[n]||{data:[],count:0,total:e.total};if(i.data[e.n]=e.data,i.count++,this._chunkedData[n]=i,i.total===i.count){delete this._chunkedData[n];var s=new Blob(i.data);this._handleDataMessage({data:s})}},r.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,t.prototype.emit.call(this,"close"))},r.prototype.send=function(e,n){if(this.open)if(this.serialization===me.JSON)this._bufferedSend(this.stringify(e));else if(this.serialization===me.Binary||this.serialization===me.BinaryUTF8){var i=q.pack(e);if(!n&&i.size>q.chunkedMTU)return void this._sendChunks(i);q.supports.binaryBlob?this._bufferedSend(i):this._encodingQueue.enque(i)}else this._bufferedSend(e);else t.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."))},r.prototype._bufferedSend=function(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)},r.prototype._trySend=function(e){var n=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>r.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){n._buffering=!1,n._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(i){return A.default.error("DC#:".concat(this.connectionId," Error when sending:"),i),this._buffering=!0,this.close(),!1}return!0},r.prototype._tryBuffer=function(){this.open&&0!==this._buffer.length&&this._trySend(this._buffer[0])&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())},r.prototype._sendChunks=function(e){var n,i,s=q.chunk(e);A.default.log("DC#".concat(this.connectionId," Try to send ").concat(s.length," chunks..."));try{for(var a=function(t){var r="function"==typeof Symbol&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}(s),c=a.next();!c.done;c=a.next())this.send(c.value,!0)}catch(h){n={error:h}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}},r.prototype.handleMessage=function(e){var n=e.payload;switch(e.type){case Y.Answer:this._negotiator.handleSDP(e.type,n.sdp);break;case Y.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:A.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},r.ID_PREFIX="dc_",r.MAX_BUFFERED_AMOUNT=8388608,r}(Ut.BaseConnection),nn={};_e(nn,"API",()=>an,t=>an=t);var on=function(t,r,e,n){return new(e||(e=Promise))(function(s,a){function c(v){try{h(n.next(v))}catch(T){a(T)}}function m(v){try{h(n.throw(v))}catch(T){a(T)}}function h(v){v.done?s(v.value):function i(s){return s instanceof e?s:new e(function(a){a(s)})}(v.value).then(c,m)}h((n=n.apply(t,r||[])).next())})},sn=function(t,r){var n,i,s,a,e={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(h){return function(v){return function m(h){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(s=2&h[0]?i.return:h[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,h[1])).done)return s;switch(i=0,s&&(h=[2&h[0],s.value]),h[0]){case 0:case 1:s=h;break;case 4:return e.label++,{value:h[1],done:!1};case 5:e.label++,i=h[1],h=[0];continue;case 7:h=e.ops.pop(),e.trys.pop();continue;default:if(!(s=(s=e.trys).length>0&&s[s.length-1])&&(6===h[0]||2===h[0])){e=0;continue}if(3===h[0]&&(!s||h[1]>s[0]&&h[1]<s[3])){e.label=h[1];break}if(6===h[0]&&e.label<s[1]){e.label=s[1],s=h;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(h);break}s[2]&&e.ops.pop(),e.trys.pop();continue}h=r.call(t,e)}catch(v){h=[6,v],i=0}finally{n=s=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([h,v])}}},an=function(){function t(r){this._options=r}return t.prototype._buildRequest=function(r){var n=this._options,i=n.host,s=n.port,a=n.path,c=n.key,m=new URL("".concat(this._options.secure?"https":"http","://").concat(i,":").concat(s).concat(a).concat(c,"/").concat(r));return m.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),m.searchParams.set("version",Lt.version),fetch(m.href,{referrerPolicy:this._options.referrerPolicy})},t.prototype.retrieveId=function(){return on(this,void 0,Promise,function(){var r,e,n;return sn(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(200!==(r=i.sent()).status)throw new Error("Error. Status:".concat(r.status));return[2,r.text()];case 2:throw e=i.sent(),A.default.error("Error retrieving ID",e),n="","/"===this._options.path&&this._options.host!==q.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n);case 3:return[2]}})})},t.prototype.listAllPeers=function(){return on(this,void 0,Promise,function(){var r,e,n;return sn(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(200!==(r=i.sent()).status)throw 401===r.status?("",e=this._options.host===q.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+e)):new Error("Error. Status:".concat(r.status));return[2,r.json()];case 2:throw n=i.sent(),A.default.error("Error retrieving list peers",n),new Error("Could not get list peers from the server."+n);case 3:return[2]}})})},t}(),bi=function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])})(r,e)};return function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Qe=function(){return Qe=Object.assign||function(t){for(var r,e=1,n=arguments.length;e<n;e++)for(var i in r=arguments[e])Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},Qe.apply(this,arguments)},He=function(t){var r="function"==typeof Symbol&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Si=function(t,r){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var i,a,n=e.call(t),s=[];try{for(;(void 0===r||r-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(c){a={error:c}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(a)throw a.error}}return s},cn=function(t){function r(e,n){var s,i=t.call(this)||this;return i._id=null,i._lastServerId=null,i._destroyed=!1,i._disconnected=!1,i._open=!1,i._connections=new Map,i._lostMessages=new Map,e&&e.constructor==Object?n=e:e&&(s=e.toString()),n=Qe({debug:0,host:q.CLOUD_HOST,port:q.CLOUD_PORT,path:"/",key:r.DEFAULT_KEY,token:q.randomToken(),config:q.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},n),i._options=n,"/"===i._options.host&&(i._options.host=window.location.hostname),i._options.path&&("/"!==i._options.path[0]&&(i._options.path="/"+i._options.path),"/"!==i._options.path[i._options.path.length-1]&&(i._options.path+="/")),void 0===i._options.secure&&i._options.host!==q.CLOUD_HOST?i._options.secure=q.isSecure():i._options.host==q.CLOUD_HOST&&(i._options.secure=!0),i._options.logFunction&&A.default.setLogFunction(i._options.logFunction),A.default.logLevel=i._options.debug||0,i._api=new nn.API(n),i._socket=i._createServerConnection(),q.supports.audioVideo||q.supports.data?s&&!q.validateId(s)?(i._delayedAbort(G.InvalidID,'ID "'.concat(s,'" is invalid')),i):(s?i._initialize(s):i._api.retrieveId().then(function(a){return i._initialize(a)}).catch(function(a){return i._abort(G.ServerError,a)}),i):(i._delayedAbort(G.BrowserIncompatible,"The current browser does not support WebRTC"),i)}return bi(r,t),Object.defineProperty(r.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"connections",{get:function(){var e,n,i=Object.create(null);try{for(var s=He(this._connections),a=s.next();!a.done;a=s.next()){var c=Si(a.value,2);i[c[0]]=c[1]}}catch(v){e={error:v}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),r.prototype._createServerConnection=function(){var e=this,n=new Qr.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return n.on(he.Message,function(i){e._handleMessage(i)}),n.on(he.Error,function(i){e._abort(G.SocketError,i)}),n.on(he.Disconnected,function(){e.disconnected||(e.emitError(G.Network,"Lost connection to server."),e.disconnect())}),n.on(he.Close,function(){e.disconnected||e._abort(G.SocketClosed,"Underlying socket is already closed.")}),n},r.prototype._initialize=function(e){this._id=e,this.socket.start(e,this._options.token)},r.prototype._handleMessage=function(e){var n,i,s=e.type,a=e.payload,c=e.src;switch(s){case Y.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Y.Error:this._abort(G.ServerError,a.msg);break;case Y.IdTaken:this._abort(G.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case Y.InvalidKey:this._abort(G.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case Y.Leave:A.default.log("Received leave message from ".concat(c)),this._cleanupPeer(c),this._connections.delete(c);break;case Y.Expire:this.emitError(G.PeerUnavailable,"Could not connect to peer ".concat(c));break;case Y.Offer:if((H=this.getConnection(c,Q=a.connectionId))&&(H.close(),A.default.warn("Offer received for existing Connection ID:".concat(Q))),a.type===de.Media){var m=new Nt.MediaConnection(c,this,{connectionId:Q,_payload:a,metadata:a.metadata});this._addConnection(c,H=m),this.emit("call",m)}else{if(a.type!==de.Data)return void A.default.warn("Received malformed connection type:".concat(a.type));var h=new $t.DataConnection(c,this,{connectionId:Q,_payload:a,metadata:a.metadata,label:a.label,serialization:a.serialization,reliable:a.reliable});this._addConnection(c,H=h),this.emit("connection",h)}var v=this._getMessages(Q);try{for(var T=He(v),O=T.next();!O.done;O=T.next())H.handleMessage(O.value)}catch(es){n={error:es}}finally{try{O&&!O.done&&(i=T.return)&&i.call(T)}finally{if(n)throw n.error}}break;default:if(!a)return void A.default.warn("You received a malformed message from ".concat(c," of type ").concat(s));var Q,H;(H=this.getConnection(c,Q=a.connectionId))&&H.peerConnection?H.handleMessage(e):Q?this._storeMessage(Q,e):A.default.warn("You received an unrecognized message:",e)}},r.prototype._storeMessage=function(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)},r.prototype._getMessages=function(e){var n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]},r.prototype.connect=function(e,n){if(void 0===n&&(n={}),this.disconnected)return A.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(G.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var i=new $t.DataConnection(e,this,n);return this._addConnection(e,i),i},r.prototype.call=function(e,n,i){if(void 0===i&&(i={}),this.disconnected)return A.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(G.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(n){var s=new Nt.MediaConnection(e,this,Qe(Qe({},i),{_stream:n}));return this._addConnection(e,s),s}A.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},r.prototype._addConnection=function(e,n){A.default.log("add connection ".concat(n.type,":").concat(n.connectionId," to peerId:").concat(e)),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)},r.prototype._removeConnection=function(e){var n=this._connections.get(e.peer);if(n){var i=n.indexOf(e);-1!==i&&n.splice(i,1)}this._lostMessages.delete(e.connectionId)},r.prototype.getConnection=function(e,n){var i,s,a=this._connections.get(e);if(!a)return null;try{for(var c=He(a),m=c.next();!m.done;m=c.next()){var h=m.value;if(h.connectionId===n)return h}}catch(v){i={error:v}}finally{try{m&&!m.done&&(s=c.return)&&s.call(c)}finally{if(i)throw i.error}}return null},r.prototype._delayedAbort=function(e,n){var i=this;setTimeout(function(){i._abort(e,n)},0)},r.prototype._abort=function(e,n){A.default.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()},r.prototype.emitError=function(e,n){var i;A.default.error("Error:",n),(i="string"==typeof n?new Error(n):n).type=e,this.emit("error",i)},r.prototype.destroy=function(){this.destroyed||(A.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},r.prototype._cleanup=function(){var e,n;try{for(var i=He(this._connections.keys()),s=i.next();!s.done;s=i.next()){var a=s.value;this._cleanupPeer(a),this._connections.delete(a)}}catch(c){e={error:c}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}this.socket.removeAllListeners()},r.prototype._cleanupPeer=function(e){var n,i,s=this._connections.get(e);if(s)try{for(var a=He(s),c=a.next();!c.done;c=a.next())c.value.close()}catch(h){n={error:h}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}},r.prototype.disconnect=function(){if(!this.disconnected){var e=this.id;A.default.log("Disconnect peer with ID:".concat(e)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}},r.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)A.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"));A.default.error("In a hurry? We're still trying to make the initial connection!")}},r.prototype.listAllPeers=function(e){var n=this;void 0===e&&(e=function(i){}),this._api.listAllPeers().then(function(i){return e(i)}).catch(function(i){return n._abort(G.ServerError,i)})},r.DEFAULT_KEY="peerjs",r}(Ve.EventEmitter),Ti=zr.Peer,ln=l(1135),Zt=l(4707),pn=l(7414),Te=l(5698),Ke=l(9300),J=l(5855),z=l(3827),pe=l(8784);let xi=(()=>{class t{save(e){e.expirationMins=e.expirationMins||0;const n=0!==e.expirationMins?60*e.expirationMins*1e3:0,i={value:"string"==typeof e.data?e.data:JSON.stringify(e.data),expiration:0!==n?(new Date).getTime()+n:null,hasExpiration:0!==n};sessionStorage.setItem(e.key,JSON.stringify(i))}load(e){const n=sessionStorage.getItem(e);if(null!==n){const i=JSON.parse(n),s=(new Date).getTime();return!i||i.hasExpiration&&i.expiration<=s?null:JSON.parse(i.value)}return null}remove(e){sessionStorage.removeItem(e)}cleansessionStorage(){sessionStorage.clear()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Jt=(()=>{class t{constructor(e,n){this.store=e,this.cache=n,this.liveText$=new ln.X(""),this.textOutput$=new ln.X([]),this.CACHE_PERSIST_MINS=60,this.myBroadcast=!1,this.roomId=new Zt.t,this.peerMap=new Map,this.SOCKET_URL="https://socket.zipcaptions.app",this.SOCKET_PORT=443,this.SOCKET_CONFIG={url:`${this.SOCKET_URL}:${this.SOCKET_PORT}`,options:{reconnectionAttempts:10}},this.PEER_URL="peer.zipcaptions.app",this.PEER_PORT=443,this.STUN_SERVER="stun.zipcaptions.app",this.TURN_SERVER="turn.zipcaptions.app",this.TURN_PASS={ZIP_SOCKET_SERVER:"https://socket.zipcaptions.app",ZIP_SOCKET_PORT:"443",ZIP_PEER_SERVER:"peer.zipcaptions.app",ZIP_PEER_PORT:"443",ZIP_STUN_SERVER:"stun.zipcaptions.app",ZIP_TURN_SERVER:"turn.zipcaptions.app"}.ZIP_TURN_PASSWORD||"coturn",this.CONNECT_OPTS={debug:0,host:this.PEER_URL,port:this.PEER_PORT,secure:"localhost"!==this.PEER_URL,config:{iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302",`stun:${this.STUN_SERVER}`,`turn:${this.TURN_SERVER}`],credential:this.TURN_PASS}]}},this.peerServerConnected=(0,J.O4)(this.store.select(z.jT)),this.sessionJoinCode=(0,J.O4)(this.store.select(z.cJ)),this.peerCount=(0,J.O4)(this.store.select(z.tF));const i=this.cache.load("userId");i?.id&&(this.myId=i.id),console.log(`Socket Server: ${this.SOCKET_URL}:${this.SOCKET_PORT}`),console.log(`Peer Server: ${this.PEER_URL}:${this.PEER_PORT}`)}connectSocket(){this.socket&&this.socket.removeAllListeners(),this.socket=new or(this.SOCKET_CONFIG);const e=new U.x;return this.socket.on("connect",()=>{console.log("socket connected"),this.socket.emit("setId",{id:this.myId}),this.store.dispatch(P.p.socketServerConnected()),this.myId&&(e.next(this.myId),this.peerServerConnected()||this.store.dispatch(P.p.connectPeerServer()))}),this.socket.on("disconnect",()=>this.store.dispatch(P.p.socketServerDisconnected())),this.socket.on("error",n=>{e.error(n.message),this.store.dispatch(P.p.socketServerError({error:n.message}))}),this.socket.on("endBroadcast",()=>this._disconnectAllPeers()),this.socket.on("message",n=>{switch(console.log("message",n),n.message){case"room joined":n.room&&(this.cache.save({key:"roomId",data:{room:n.room,myBroadcast:this.myBroadcast},expirationMins:this.CACHE_PERSIST_MINS}),this.roomId.next(n.room));break;case"set user id":console.log("set user id",n.id,this.myId),this.myId?(this.socket.emit("setId",{id:this.myId}),n.id===this.myId&&e.next(this.myId)):n.id&&(this.myId=n.id,this.cache.save({key:"userId",data:{id:n.id},expirationMins:this.CACHE_PERSIST_MINS}),e.next(n.id)),!this.peerServerConnected()&&this.myId&&this.store.dispatch(P.p.connectPeerServer());break;case"user joined room":if(n.user&&n.user!==this.myId){if(!this.peer)throw new Error("Cannot connect to peer - peer server connection not established");this.myBroadcast&&this._connectToPeer(n.user)}break;case"user left room":if(n.user){const i=this.peerMap.get(n.user);i&&(i.addListener("close",()=>{this.peerMap.delete(n.user)}),i.close())}break;case"connect clients":if(n.clients){const i=n.clients;for(const s of i)s!==this.myId&&this._connectToPeer(s)}break;case"broadcast expired":case"broadcast ended":n.expiredAt&&this.store.dispatch(P.p.setBroadcastEndedAt({endedAt:n.expiredAt}));break;default:console.warn("UNHANDLED MESSAGE!!!",n),this.store.dispatch(P.p.socketServerMessageReceived(n))}}),e.asObservable().pipe((0,pn.V)(3e4),(0,Te.q)(1))}disconnectSocket(){const e=new U.x;return this.socket.removeListener("disconnect"),this.socket.on("disconnect",()=>{e.next(!0)}),setTimeout(()=>this.socket.disconnect(),1),e.asObservable().pipe((0,pn.V)(500),(0,Te.q)(1))}joinRoom(e){if(this.myBroadcast=!e?.room,!e?.room){const n=this.cache.load("roomId");n?.room&&(e={room:n.room,myBroadcast:n?.myBroadcast}),void 0!==n?.myBroadcast&&(this.myBroadcast=n.myBroadcast)}if(this.myBroadcast){const n=this.cache.load("joinCode");let i;n?i=n.joinCode:(i=this._generateJoinCode(),this.cache.save({key:"joinCode",data:{joinCode:i}})),this.store.dispatch(P.p.setJoinCode({joinCode:i}))}return this.socket.volatile().emit("join",{room:e?.room,myBroadcast:this.myBroadcast}),this.roomId.asObservable().pipe((0,Ke.h)(n=>!!n))}sendServerMessage(e){this.socket.volatile().emit("message",e)}connectPeerServer(){if(!this.myId)throw new Error("Must obtain ID from socket server");if(this.peer?.id===this.myId&&!this.peer.disconnected)return console.log("peer server connection already exists and appears to be connected!!!"),(0,N.of)(this.myId);const e=new Zt.t;return this.CONNECT_OPTS.config.iceServers[0].username=this.myId,this.peer=new Ti(this.myId,this.CONNECT_OPTS),this.peer.addListener("open",()=>{this.store.dispatch(P.p.peerServerConnected()),e.next(this.myId)}),this.peer.addListener("disconnected",()=>{this.peerServerConnected()&&this.store.dispatch(P.p.peerServerDisconnected())}),this.peer.once("error",n=>{this.store.dispatch(P.p.peerServerError({error:n.message})),this._reconnectPeerServer()}),this.peer.addListener("connection",n=>{this.peerMap.set(n.connectionId,n),this._handlePeerData(n)}),e.asObservable().pipe((0,Te.q)(1))}disconnectPeerServer(){if(!this.peer)throw new Error("Peer not connected");const e=new U.x;return this.peer.removeListener("close"),this.peer.addListener("disconnected",()=>{e.next(!0)}),setTimeout(()=>{this.peer.disconnect()},1),e.asObservable().pipe((0,Te.q)(1))}sendData(e,n){const i=this.peerMap.get(e);if(!i)throw new Error(`connection ${e} not found`);i.send(n)}broadcastData(e){for(const n of this.peerMap.values())n.send(e)}endBroadcast(){const e=new Zt.t,i=this.cache.load("roomId")?.room;if(!i)throw new Error("No room defined for broadcast");return this.cache.remove("roomId"),this.cache.remove("joinCode"),this.socket.once("endBroadcast",()=>{console.log("endbroadcast response recieved"),e.next(),e.complete()}),this.socket.emit("endBroadcast",{room:i}),e}leaveSession(){console.log("leaveSession",this.peerMap.size),this.cache.remove("roomId"),this.cache.remove("joinCode"),this.peerMap.forEach(e=>{e.close()}),this.textOutput$.next([]),this.liveText$.next(""),this.peerMap.clear()}_reconnectPeerServer(e){let n=e||0;const i=setTimeout(()=>{this.peer?.disconnected&&n<5?(this.peer.once("error",()=>{this._reconnectPeerServer(++n)}),this.peer.once("open",()=>{n=0,clearTimeout(i)}),this.peer?.reconnect()):n<5?this._reconnectPeerServer(++n):(this.store.dispatch(P.p.connectPeerServerFailure({error:"Peer server connection lost."})),n=0,clearTimeout(i))},1e3*n+150)}_connectToPeer(e){const n=this.peer.connect(e);this._handlePeerData(n),this.peerMap.set(e,n),this._updateConnectedPeerCount(),n.on("close",()=>{this.peerMap.delete(e),this._updateConnectedPeerCount()})}_updateConnectedPeerCount(){this.peerMap.size!==this.peerCount()&&this.store.dispatch(P.p.updateConnectedPeerCount({count:this.peerMap.size}))}_disconnectAllPeers(){for(const e of this.peerMap.values())e.close();this.peerMap.clear(),this._updateConnectedPeerCount()}_generateJoinCode(){let e="";for(let i=0;i<4;i++)e+="acdefghjkmnpqrstuvwxyz2345679".charAt(Math.floor(29*Math.random()));return e}_handlePeerData(e){e.on("close",()=>{this.myBroadcast||this.store.dispatch(P.p.setHostStatus({hostOnline:!1})),e.removeAllListeners()}),e.on("open",()=>{this.myBroadcast&&e.send({request:"joinCode"})}),e.on("data",n=>{if(n?.request)switch(n.request){case"joinCode":e.send({request:"validateJoinCode",joinCode:this.sessionJoinCode()});break;case"validateJoinCode":this._verifyJoinCode(n.joinCode)?e.send({response:"valid"}):e.send({response:"invalid"});break;case"disconnect":e.close(),this.store.dispatch(P.p.setHostStatus({hostOnline:!1}));break;case"hostOffline":this.store.dispatch(P.p.setHostStatus({hostOnline:!1}))}else if(n?.response)switch(n.response){case"valid":this.store.dispatch(P.p.setHostStatus({hostOnline:!0}));break;case"invalid":e.close(),this.store.dispatch(P.p.clearJoinCode())}else if("recognition"in n&&"type"in n)switch(n.type){case"live":this.liveText$.next(n.recognition);break;case"segment":this.textOutput$.next(n.recognition)}else console.warn("UNHANDLED DATA",n)})}_verifyJoinCode(e){const n=this.sessionJoinCode();return!(!n||!e||n!==e.toLowerCase())}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(pe.yh),o.LFG(xi))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),ki=(()=>{class t{constructor(e,n){this.actions$=e,this.peerService=n,this.connectSocketServer$=(0,I.GW)(()=>this.actions$.pipe((0,I.l4)(P.p.connectSocketServer),(0,x.w)(()=>this.peerService.connectSocket()),(0,D.U)(i=>P.p.socketServerUserIdAssigned({id:i})),(0,R.K)(i=>(0,N.of)(P.p.connectSocketServerFailure({error:i.message}))))),this.disconnectSocketServer$=(0,I.GW)(()=>this.actions$.pipe((0,I.l4)(P.p.disconnectSocketServer),(0,x.w)(()=>this.peerService.disconnectSocket()),(0,D.U)(()=>P.p.socketServerDisconnected()))),this.connectPeerServer$=(0,I.GW)(()=>this.actions$.pipe((0,I.l4)(P.p.connectPeerServer),(0,x.w)(()=>this.peerService.connectPeerServer()),(0,D.U)(i=>P.p.peerServerConnected()),(0,R.K)(i=>(0,N.of)(P.p.connectPeerServerFailure({error:i.message}))))),this.disconnectPeerServer$=(0,I.GW)(()=>this.actions$.pipe((0,I.l4)(P.p.disconnectPeerServer),(0,x.w)(()=>this.peerService.disconnectPeerServer()),(0,x.w)(()=>[P.p.peerServerDisconnected(),P.p.disconnectSocketServer()]))),this.createRoom$=(0,I.GW)(()=>this.actions$.pipe((0,I.l4)(P.p.createBroadcastRoom),(0,x.w)(()=>this.peerService.joinRoom()),(0,D.U)(i=>P.p.createBroadcastRoomSuccess({id:i})),(0,R.K)(i=>(0,N.of)(P.p.createBroadcastRoomFailure({error:i.message}))))),this.joinRoom$=(0,I.GW)(()=>this.actions$.pipe((0,I.l4)(P.p.joinBroadcastRoom),(0,x.w)(({id:i})=>this.peerService.joinRoom({room:i})),(0,D.U)(()=>P.p.joinBroadcastRoomSuccess()),(0,R.K)(i=>(0,N.of)(P.p.joinBroadcastRoomFailure({error:i.message}))))),this.leaveRoom$=(0,I.GW)(()=>this.actions$.pipe((0,I.l4)(P.p.leaveBroadcastRoom),(0,D.U)(()=>this.peerService.leaveSession()),(0,D.U)(()=>P.p.leaveBroadcastRoomSuccess()),(0,R.K)(i=>(0,N.of)(P.p.leaveBroadcastRoomFailure({error:i.message}))))),this.endBroadcast$=(0,I.GW)(()=>this.actions$.pipe((0,I.l4)(P.p.endBroadcast),(0,x.w)(()=>this.peerService.endBroadcast()),(0,D.U)(()=>P.p.endBroadcastSuccess()),(0,R.K)(i=>(0,N.of)(P.p.endBroadcastFailure({error:i.message})))))}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(I.eX),o.LFG(Jt))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac}),t})();var Ei=l(3530),Le=l(4056),Gt=l(8603),Ne=l(2809),yt=l(2513);const Ri=["modal"],Pi=["close"];let Oi=(()=>{class t{constructor(e,n){this.store=e,this.renderer=n,this.isActive=(0,J.O4)(this.store.pipe((0,pe.Ys)(yt.SB),(0,D.U)(i=>i===Ne.T.connected)))}confirmEndBroadcast(){this._openModal()}endBroadcast(){this.store.dispatch(Ne.b.disconnectRecognition({id:"broadcast"})),this.store.select(yt.SB).pipe((0,Ke.h)(e=>e===Ne.T.disconnected),(0,Te.q)(1)).subscribe(()=>{console.log("recognition ended, ending broadcast"),this.store.dispatch(P.p.endBroadcast())}),this._closeModal()}hideModal(){this._closeModal()}_openModal(){this.renderer.setAttribute(this.modal.nativeElement,"open","")}_closeModal(){this.closeButton.nativeElement.click()}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(pe.yh),o.Y36(o.Qsj))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-end-broadcast"]],viewQuery:function(e,n){if(1&e&&(o.Gf(Ri,5,o.SBq),o.Gf(Pi,5,o.SBq)),2&e){let i;o.iGM(i=o.CRH())&&(n.modal=i.first),o.iGM(i=o.CRH())&&(n.closeButton=i.first)}},decls:17,vars:3,consts:[[1,"tooltip","tooltip-left","tooltip-warning"],[1,"btn","btn-circle","btn-info",3,"click"],["name","heroSignalSlash"],[1,"modal"],["modal",""],["method","dialog",1,"modal-box","bg-base-content","text-base-100","sm:w-11/12","justify-self-center"],["translate",""],[1,"modal-action"],["translate","","type","button",1,"btn",3,"click"],["type","button","translate","",1,"btn",3,"click"],["method","dialog",1,"modal-backdrop"],["close",""]],template:function(e,n){1&e&&(o.TgZ(0,"div",0),o.ALo(1,"translate"),o.TgZ(2,"button",1),o.NdJ("click",function(){return n.confirmEndBroadcast()}),o._UZ(3,"ng-icon",2),o.qZA()(),o.TgZ(4,"dialog",3,4)(6,"form",5)(7,"p",6),o._uU(8,"MODAL.confirmEndBroadcast"),o.qZA(),o.TgZ(9,"div",7)(10,"button",8),o.NdJ("click",function(){return n.endBroadcast()}),o._uU(11,"BUTTONS.confirm"),o.qZA(),o.TgZ(12,"button",9),o.NdJ("click",function(){return n.hideModal()}),o._uU(13,"BUTTONS.decline"),o.qZA()()(),o.TgZ(14,"form",10),o._UZ(15,"button",null,11),o.qZA()()),2&e&&o.uIk("data-tip",o.lcZ(1,1,"STREAM.endBroadcast"))},dependencies:[d._Y,d.JL,M.Fv,F.Pi,F.X$]}),t})();function Ai(t,r){1&t&&(o.ynx(0),o._uU(1),o.ALo(2,"translate"),o.BQk()),2&t&&(o.xp6(1),o.Oqu(o.lcZ(2,1,"STREAM.connecting")))}function Ii(t,r){if(1&t&&(o._uU(0),o.ALo(1,"translate")),2&t){const e=o.oxw();o.hij(" ",o.lcZ(1,1,e.connected()?"STREAM.online":"STREAM.offline")," ")}}const Di=function(t,r,e){return{"badge-neutral":t,"badge-success":r,"badge-error":e}};let fn=(()=>{class t{constructor(e){this.store=e,this.connected=(0,J.O4)(this.store.select(z.sM)),this.serverError=(0,J.O4)(this.store.select(z.ok))}reconnect(){this.connected()||this.store.dispatch(P.p.connectSocketServer())}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(pe.yh))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-socket-server-status-chip"]],decls:6,vars:10,consts:[[1,"badge","h-auto",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["state",""]],template:function(e,n){if(1&e&&(o.TgZ(0,"button",0),o.NdJ("click",function(){return n.reconnect()}),o._uU(1),o.ALo(2,"translate"),o.YNc(3,Ai,3,3,"ng-container",1),o.YNc(4,Ii,2,3,"ng-template",null,2,o.W1O),o.qZA()),2&e){const i=o.MAs(5);o.Q6J("ngClass",o.kEZ(6,Di,!n.connected(),n.connected(),n.serverError())),o.xp6(1),o.hij(" ",o.lcZ(2,4,"STREAM.serverStatus"),": "),o.xp6(2),o.Q6J("ngIf",void 0===n.connected())("ngIfElse",i)}},dependencies:[u.mk,u.O5,F.X$]}),t})();function Mi(t,r){1&t&&(o.ynx(0),o._uU(1),o.ALo(2,"translate"),o.BQk()),2&t&&(o.xp6(1),o.Oqu(o.lcZ(2,1,"STREAM.connecting")))}function Bi(t,r){if(1&t&&(o._uU(0),o.ALo(1,"translate")),2&t){const e=o.oxw();o.hij(" ",o.lcZ(1,1,e.connected()?"STREAM.online":"STREAM.offline")," ")}}const wi=function(t,r,e){return{"badge-neutral":t,"badge-success":r,"badge-error":e}};let un=(()=>{class t{constructor(e){this.store=e,this.connected=(0,J.O4)(this.store.select(z.jT)),this.serverError=(0,J.O4)(this.store.select(z.ok))}reconnect(){this.connected()||this.store.dispatch(P.p.connectPeerServer())}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(pe.yh))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-peer-server-status-chip"]],decls:6,vars:10,consts:[[1,"badge","h-auto",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["state",""]],template:function(e,n){if(1&e&&(o.TgZ(0,"button",0),o.NdJ("click",function(){return n.reconnect()}),o._uU(1),o.ALo(2,"translate"),o.YNc(3,Mi,3,3,"ng-container",1),o.YNc(4,Bi,2,3,"ng-template",null,2,o.W1O),o.qZA()),2&e){const i=o.MAs(5);o.Q6J("ngClass",o.kEZ(6,wi,!n.connected(),n.connected(),n.serverError())),o.xp6(1),o.hij(" ",o.lcZ(2,4,"STREAM.peerStatus"),": "),o.xp6(2),o.Q6J("ngIf",void 0===n.connected()&&!n.serverError())("ngIfElse",i)}},dependencies:[u.mk,u.O5,F.X$]}),t})();const ji=function(t,r){return{"badge-neutral":t,"badge-success":r}};let Li=(()=>{class t{constructor(e){this.store=e,this.count=(0,J.O4)(this.store.select(z.tF))}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(pe.yh))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-connected-peer-count-chip"]],decls:3,vars:8,consts:[[1,"badge","h-auto",3,"ngClass"]],template:function(e,n){1&e&&(o.TgZ(0,"div",0),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&e&&(o.Q6J("ngClass",o.WLB(5,ji,!n.count(),n.count())),o.xp6(1),o.AsE("",o.lcZ(2,3,"STREAM.connectedPeers"),": ",n.count(),""))},dependencies:[u.mk,F.X$]}),t})();var Ce=l(9124);function Ni(t,r){if(1&t){const e=o.EpF();o.TgZ(0,"div",2),o.NdJ("click",function(){o.CHM(e);const i=o.oxw();return o.KtG(i.showCopiedToClipboard())}),o.ALo(1,"translate"),o._uU(2),o.ALo(3,"translate"),o.qZA()}if(2&t){const e=o.oxw();o.Q6J("cbContent",e.roomId),o.uIk("data-tip",o.lcZ(1,4,"STREAM.copyIdTip")),o.xp6(2),o.AsE(" ",o.lcZ(3,6,"STREAM.sessionId"),": ",e.roomId.toUpperCase(),"\n")}}function Fi(t,r){1&t&&(o.TgZ(0,"div",3)(1,"div",4),o._uU(2,"STREAM.sessionIdCopied"),o.qZA()()),2&t&&o.Q6J("@slideInUpOnEnter",void 0)("@fadeOutOnLeave",void 0)}let Ui=(()=>{class t{constructor(){this.showToast=(0,o.tdS)(!1)}showCopiedToClipboard(){this.showToast.set(!0),setTimeout(()=>this.showToast.set(!1),1500)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-room-id"]],inputs:{roomId:"roomId"},decls:2,vars:2,consts:[["class","badge h-auto badge-primary text-xl sm:text-2xl md:text-4xl lg:text-6xl cursor-pointer tooltip tooltip-bottom","ngxClipboard","",3,"cbContent","click",4,"ngIf"],["class","toast z-10",4,"ngIf"],["ngxClipboard","",1,"badge","h-auto","badge-primary","text-xl","sm:text-2xl","md:text-4xl","lg:text-6xl","cursor-pointer","tooltip","tooltip-bottom",3,"cbContent","click"],[1,"toast","z-10"],["translate","",1,"alert","alert-info"]],template:function(e,n){1&e&&(o.YNc(0,Ni,4,8,"div",0),o.YNc(1,Fi,3,2,"div",1)),2&e&&(o.Q6J("ngIf",n.roomId),o.xp6(1),o.Q6J("ngIf",n.showToast()))},dependencies:[u.O5,F.Pi,g,F.X$],data:{animation:[(0,Ce.Jm)(),(0,Ce.QQ)()]}}),t})();function $i(t,r){if(1&t){const e=o.EpF();o.TgZ(0,"div",2),o.NdJ("click",function(){o.CHM(e);const i=o.oxw();return o.KtG(i.showCopiedToClipboard())}),o.ALo(1,"translate"),o._uU(2),o.ALo(3,"translate"),o.qZA()}if(2&t){const e=o.oxw();o.Q6J("cbContent",e.joinCode),o.uIk("data-tip",o.lcZ(1,4,"STREAM.copyJoinCodeTip")),o.xp6(2),o.AsE(" ",o.lcZ(3,6,"STREAM.joinCode"),": ",e.joinCode.toUpperCase(),"\n")}}function Zi(t,r){1&t&&(o.TgZ(0,"div",3)(1,"div",4),o._uU(2,"STREAM.joinCodeCopied"),o.qZA()()),2&t&&o.Q6J("@slideInUpOnEnter",void 0)("@fadeOutOnLeave",void 0)}let Ji=(()=>{class t{constructor(){this.showToast=(0,o.tdS)(!1)}showCopiedToClipboard(){this.showToast.set(!0),setTimeout(()=>this.showToast.set(!1),1500)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-join-code"]],inputs:{joinCode:"joinCode"},decls:2,vars:2,consts:[["class","badge h-auto badge-info text-xl sm:text-2xl md:text-4xl lg:text-6xl cursor-pointer tooltip tooltip-bottom","ngxClipboard","",3,"cbContent","click",4,"ngIf"],["class","toast z-10",4,"ngIf"],["ngxClipboard","",1,"badge","h-auto","badge-info","text-xl","sm:text-2xl","md:text-4xl","lg:text-6xl","cursor-pointer","tooltip","tooltip-bottom",3,"cbContent","click"],[1,"toast","z-10"],["translate","",1,"alert","alert-info"]],template:function(e,n){1&e&&(o.YNc(0,$i,4,8,"div",0),o.YNc(1,Zi,3,2,"div",1)),2&e&&(o.Q6J("ngIf",n.joinCode),o.xp6(1),o.Q6J("ngIf",n.showToast()))},dependencies:[u.O5,F.Pi,g,F.X$],data:{animation:[(0,Ce.Jm)(),(0,Ce.QQ)()]}}),t})();var _t=l(2722),Gi=l(5536),qi=l(5741);let zi=(()=>{class t{constructor(e,n,i){this.store=e,this.recognitionService=n,this.peerService=i,this.onDestroy$=new U.x,this.recognitionConnected=(0,J.O4)(this.store.select(yt.n7)),this.liveText=(0,J.Dx)((0,o.Flj)(()=>this.recognitionConnected()?this.recognitionService.getLiveOutput("broadcast")():"")),this.recognizedText=(0,J.Dx)((0,o.Flj)(()=>this.recognitionConnected()?this.recognitionService.getRecognizedText("broadcast")():[]))}ngOnInit(){this.store.dispatch(Ne.b.connectRecognition({id:"broadcast"})),this.liveText.pipe((0,_t.R)(this.onDestroy$)).subscribe(e=>{this.peerService.broadcastData({recognition:e,type:"live"})}),this.recognizedText.pipe((0,_t.R)(this.onDestroy$)).subscribe(e=>{this.peerService.broadcastData({recognition:e,type:"segment"})})}ngOnDestroy(){this.recognitionConnected()&&this.store.dispatch(Ne.b.disconnectRecognition({id:"broadcast"})),this.onDestroy$.next()}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(pe.yh),o.Y36(Gi.W),o.Y36(Jt))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-broadcast-room"]],decls:1,vars:0,consts:[[1,"flex","basis-full","overflow-y-hidden"]],template:function(e,n){1&e&&o._UZ(0,"app-recognition-render",0)},dependencies:[qi.U],data:{animation:[(0,Ce.nh)(),(0,Ce.B5)()]}}),t})();const Vi=["modal"];let Yi=(()=>{class t{constructor(e,n,i,s){this.store=e,this.renderer=n,this.router=i,this.fb=s,this.accepted=(0,J.O4)(this.store.select(Gt.NE)),this.saveSettingControl=this.fb.control(this.accepted())}ngAfterViewInit(){this.accepted()||this._openModal()}accept(){this.store.dispatch(Le.q.setPeerConnectionsAccepted({accepted:!0,save:this.saveSettingControl.value})),this._closeModal()}decline(){this.store.dispatch(Le.q.setPeerConnectionsAccepted({accepted:!1,save:this.saveSettingControl.value})),this._closeModal(),this.router.navigate([""])}_openModal(){this.renderer.setAttribute(this.modal.nativeElement,"open","")}_closeModal(){this.renderer.removeAttribute(this.modal.nativeElement,"open")}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(pe.yh),o.Y36(o.Qsj),o.Y36(S.F0),o.Y36(d.qu))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-accept-peer-connections-modal"]],viewQuery:function(e,n){if(1&e&&o.Gf(Vi,5,o.SBq),2&e){let i;o.iGM(i=o.CRH())&&(n.modal=i.first)}},decls:26,vars:1,consts:[[3,"click"],["open",""],[1,"modal"],["modal",""],["method","dialog",1,"modal-box","bg-base-content","text-base-100","sm:w-11/12","justify-self-center"],[1,"flex","flex-row","gap-3","items-center","bg-warning","rounded-lg","mb-3"],[1,"badge","badge-warning","h-10","w-10"],["name","heroExclamationTriangle",1,"text-error","text-3xl"],["translate","",1,"font-bold","text-2xl"],["translate","",1,"text-base","mt-2"],[1,"modal-action"],["type","button","translate","",1,"btn",3,"click"],[1,"form-control"],["translate","",1,"label","cursor-pointer"],["translate","",1,"label-text","text-base-100"],["type","checkbox",1,"checkbox","checkbox-sm","checkbox-primary",3,"formControl"]],template:function(e,n){if(1&e){const i=o.EpF();o.TgZ(0,"button",0,1),o.NdJ("click",function(){o.CHM(i);const a=o.MAs(3);return o.KtG(a.showModal())}),o.qZA(),o.TgZ(2,"dialog",2,3)(4,"form",4)(5,"div",5)(6,"div",6),o._UZ(7,"ng-icon",7),o.qZA(),o.TgZ(8,"h1",8),o._uU(9,"MODAL.accessModalTitle"),o.qZA()(),o.TgZ(10,"p",9),o._uU(11,"MODAL.accessP1"),o.qZA(),o.TgZ(12,"p",9),o._uU(13,"MODAL.accessP2"),o.qZA(),o.TgZ(14,"p",9),o._uU(15,"MODAL.accessP3"),o.qZA(),o.TgZ(16,"div",10)(17,"button",11),o.NdJ("click",function(){return n.decline()}),o._uU(18,"BUTTONS.decline"),o.qZA(),o.TgZ(19,"button",11),o.NdJ("click",function(){return n.accept()}),o._uU(20,"BUTTONS.confirm"),o.qZA()(),o.TgZ(21,"div",12)(22,"label",13)(23,"span",14),o._uU(24,"LABELS.rememberSetting"),o.qZA(),o._UZ(25,"input",15),o.qZA()()()()}2&e&&(o.xp6(25),o.Q6J("formControl",n.saveSettingControl))},dependencies:[d._Y,d.Wl,d.JJ,d.JL,d.oH,M.Fv,F.Pi]}),t})();function Qi(t,r){1&t&&(o.ynx(0),o._UZ(1,"app-socket-server-status-chip")(2,"app-peer-server-status-chip"),o.BQk())}function Hi(t,r){if(1&t&&(o.TgZ(0,"div",11),o._UZ(1,"app-room-id",12)(2,"app-join-code",13),o.qZA()),2&t){const e=o.oxw(2);o.xp6(1),o.Q6J("roomId",e.roomId()),o.xp6(1),o.Q6J("joinCode",e.joinCode())}}function Ki(t,r){if(1&t&&(o.TgZ(0,"div",14),o._uU(1),o.qZA()),2&t){const e=r.ngIf;o.xp6(1),o.Oqu(e)}}function Wi(t,r){1&t&&(o.ynx(0),o.TgZ(1,"div",15),o._UZ(2,"app-connected-peer-count-chip")(3,"app-end-broadcast"),o.qZA(),o.BQk())}function Xi(t,r){if(1&t&&(o.TgZ(0,"div",6),o.YNc(1,Qi,3,0,"ng-container",7),o.YNc(2,Hi,3,2,"ng-template",null,8,o.W1O),o.YNc(4,Ki,2,1,"div",9),o._UZ(5,"div",10),o.YNc(6,Wi,4,0,"ng-container",5),o.qZA()),2&t){const e=o.MAs(3),n=o.oxw();o.xp6(1),o.Q6J("ngIf",!n.isBroadcasting())("ngIfElse",e),o.xp6(3),o.Q6J("ngIf",n.serverError()),o.xp6(2),o.Q6J("ngIf",n.isBroadcasting())}}function eo(t,r){1&t&&(o.TgZ(0,"div",16)(1,"span",17),o._uU(2,"STREAM.permissionRequired"),o.qZA()())}function to(t,r){1&t&&o._UZ(0,"app-broadcast-room",18)}function ro(t,r){if(1&t){const e=o.EpF();o.TgZ(0,"div",23)(1,"button",34),o.NdJ("click",function(){o.CHM(e);const i=o.oxw(2);return o.KtG(i.createRoom())}),o._uU(2,"STREAM.createBroadcast"),o.qZA(),o.TgZ(3,"div",25),o._uU(4," STREAM.broadcastExplanantion "),o.qZA()()}if(2&t){const e=o.oxw(2);o.xp6(1),o.Q6J("disabled",e.serverOffline()||e.serverError())}}function no(t,r){1&t&&(o.TgZ(0,"span",35),o._uU(1,"Invalid ID"),o.qZA())}function io(t,r){1&t&&(o.TgZ(0,"span",35),o._uU(1,"Required"),o.qZA())}function oo(t,r){1&t&&(o.TgZ(0,"span",35),o._uU(1,"Invalid ID"),o.qZA())}function so(t,r){1&t&&(o.TgZ(0,"span",35),o._uU(1,"Required"),o.qZA())}const dn=function(t){return{"text-error":t}},hn=function(t){return{"input-error":t}},ao=function(t,r){return{"btn-primary":t,"btn-neutral":r}};function co(t,r){if(1&t){const e=o.EpF();o.TgZ(0,"div",19)(1,"div",20),o.YNc(2,ro,5,1,"div",21),o.TgZ(3,"form",22),o.NdJ("submit",function(){o.CHM(e);const i=o.oxw();return o.KtG(i.joinSession())}),o.TgZ(4,"div",23)(5,"button",24),o._uU(6,"STREAM.joinSession"),o.qZA(),o.TgZ(7,"div",25),o._uU(8," STREAM.joinSessionExplanation "),o.qZA()(),o.TgZ(9,"div",23)(10,"div",26)(11,"label",27)(12,"span",28),o._uU(13,"STREAM.sessionId"),o.qZA()(),o._UZ(14,"input",29),o.TgZ(15,"label",30),o.YNc(16,no,2,0,"span",31),o.YNc(17,io,2,0,"span",31),o.qZA()(),o.TgZ(18,"div",26)(19,"label",27)(20,"span",28),o._uU(21,"STREAM.joinCode"),o.qZA()(),o._UZ(22,"input",32),o.TgZ(23,"label",30),o.YNc(24,oo,2,0,"span",31),o.YNc(25,so,2,0,"span",31),o.qZA()(),o.TgZ(26,"button",33),o._uU(27,"BUTTONS.connect"),o.qZA()()()()()}if(2&t){const e=o.oxw();o.xp6(2),o.Q6J("ngIf",!e.disableBroadcast()),o.xp6(1),o.Q6J("formGroup",e.joinSessionFormGroup),o.xp6(2),o.Q6J("disabled",e.serverOffline()||e.serverError()),o.xp6(7),o.Q6J("ngClass",o.VKq(13,dn,e.joinSessionFormGroup.controls.session.invalid&&e.joinSessionFormGroup.controls.session.touched)),o.xp6(2),o.Q6J("ngClass",o.VKq(15,hn,e.joinSessionFormGroup.controls.session.invalid&&e.joinSessionFormGroup.controls.session.touched)),o.xp6(2),o.Q6J("ngIf",e.joinSessionFormGroup.controls.session.hasError("invalid")&&e.joinSessionFormGroup.controls.session.touched),o.xp6(1),o.Q6J("ngIf",e.joinSessionFormGroup.controls.session.hasError("required")&&e.joinSessionFormGroup.controls.session.touched),o.xp6(3),o.Q6J("ngClass",o.VKq(17,dn,e.joinSessionFormGroup.controls.joinCode.invalid&&e.joinSessionFormGroup.controls.joinCode.touched)),o.xp6(2),o.Q6J("ngClass",o.VKq(19,hn,e.joinSessionFormGroup.controls.joinCode.invalid&&e.joinSessionFormGroup.controls.joinCode.touched)),o.xp6(2),o.Q6J("ngIf",e.joinSessionFormGroup.controls.joinCode.hasError("invalid")&&e.joinSessionFormGroup.controls.joinCode.touched),o.xp6(1),o.Q6J("ngIf",e.joinSessionFormGroup.controls.joinCode.hasError("required")&&e.joinSessionFormGroup.controls.joinCode.touched),o.xp6(1),o.Q6J("ngClass",o.WLB(21,ao,e.joinSessionFormGroup.valid,e.joinSessionFormGroup.invalid))("disabled",e.serverOffline()||e.serverError())}}function lo(t,r){1&t&&o._UZ(0,"app-accept-peer-connections-modal")}let po=(()=>{class t{constructor(e,n,i,s){this.store=e,this.fb=n,this.router=i,this.route=s,this.joinSessionFormGroup=this.fb.group({session:this.fb.control("",[d.kI.required,a=>this._validateSessionId(a)]),joinCode:this.fb.control("",[d.kI.required,a=>this._validateJoinCode(a)])}),this.acceptedPeerConnections=(0,J.O4)(this.store.select(Gt.NE)),this.socketServerConnected=(0,J.O4)(this.store.select(z.sM)),this.peerServerConnected=(0,J.O4)(this.store.select(z.jT)),this.roomId=(0,J.O4)(this.store.select(z.Zc)),this.joinCode=(0,J.O4)(this.store.select(z.cJ)),this.isBroadcasting=(0,J.O4)(this.store.select(z.fg)),this.serverError=(0,J.O4)(this.store.select(z.ok)),this.serverOffline=(0,J.O4)(this.store.select(z.gR)),this.disableBroadcast=(0,J.O4)(this.store.pipe((0,pe.Ys)(Gt.$W),(0,D.U)(a=>a===Le.h.mobile))),this._injectDashIfRequired(),(0,o.cEC)(()=>{this.acceptedPeerConnections()&&!this.socketServerConnected()&&this.store.dispatch(P.p.connectSocketServer())},{allowSignalWrites:!0})}ngOnInit(){this.acceptedPeerConnections()&&!this.socketServerConnected()&&this.store.dispatch(P.p.connectSocketServer())}ngOnDestroy(){this.store.dispatch(Ne.b.resetRecogntionState())}canDeactivate(){return!(0,J.O4)(this.store.select(z.fg))()}createRoom(){this.store.dispatch(P.p.createBroadcastRoom())}joinSession(){if(this.joinSessionFormGroup.updateValueAndValidity(),this.joinSessionFormGroup.valid){const e=this.joinSessionFormGroup.value.session,n=this.joinSessionFormGroup.value.joinCode;this.store.dispatch(P.p.setJoinCode({joinCode:n})),this.router.navigate([e],{queryParams:{joinCode:n},relativeTo:this.route})}else this.joinSessionFormGroup.markAllAsTouched();return!1}_validateSessionId(e){return e.value&&!new RegExp(/^([acdefghjkmnpqrstuvwxyz2345679]{4})-([acdefghjkmnpqrstuvwxyz2345679]{4})$/i).test(e.value)?{invalid:!0}:null}_validateJoinCode(e){return e.value&&!new RegExp(/^([acdefghjkmnpqrstuvwxyz2345679]{4})$/i).test(e.value)?{invalid:!0}:null}_injectDashIfRequired(){const e=this.joinSessionFormGroup.controls.session;e.valueChanges.pipe((0,J.sL)()).subscribe(n=>{n&&n.length>4&&"-"!==n[4]&&e.setValue(n.slice(0,4)+"-"+n.slice(4,n.length))})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(pe.yh),o.Y36(d.qu),o.Y36(S.F0),o.Y36(S.gz))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-peer-landing"]],hostBindings:function(e,n){1&e&&o.NdJ("beforeunload",function(){return n.acceptedPeerConnections()},!1,o.Jf7)},decls:8,vars:5,consts:[[1,"flex","flex-col","basis-full","overflow-hidden","flex-grow-0","bg-base-300","text-base-content"],["class","flex flex-row gap-3 items-center p-3",4,"ngIf","ngIfElse"],["acceptPermissions",""],["class","flex basis-full overflow-y-hidden",4,"ngIf","ngIfElse"],["landing",""],[4,"ngIf"],[1,"flex","flex-row","gap-3","items-center","p-3"],[4,"ngIf","ngIfElse"],["broadcastControls",""],["class","badge h-auto badge-error",4,"ngIf"],[1,"flex","flex-1"],[1,"flex","flex-row","flex-wrap","gap-3"],[3,"roomId"],[3,"joinCode"],[1,"badge","h-auto","badge-error"],[1,"flex","flex-grow","flex-row","flex-wrap-reverse","items-center","gap-3","justify-end"],[1,"flex","flex-row","self-stretch","gap-3","items-center","justify-center","p-3","text-warning","text-lg"],["translate",""],[1,"flex","basis-full","overflow-y-hidden"],[1,"flex","basis-full","items-stretch","justify-center","overflow-y-auto"],[1,"flex","flex-col","basis-full","max-w-4xl","lg:gap-24","sm:gap-12","gap-6","p-3"],["class","form-row",4,"ngIf"],[1,"flex","flex-col","sm:gap-12","gap-6",3,"formGroup","submit"],[1,"form-row"],["translate","",1,"hidden","sm:block","w-64","btn","btn-primary","btn-lg",3,"disabled"],["translate","",1,"flex","basis-1/2"],[1,"form-control"],[1,"label"],["translate","",1,"label-text",3,"ngClass"],["type","text","maxlength","9","placeholder","A79E-F2GV","formControlName","session",1,"input","input-bordered","input-lg",3,"ngClass"],[1,"label","no-height"],["class","label-alt-text text-error text-xs",4,"ngIf"],["type","text","maxlength","4","placeholder","E5F6","formControlName","joinCode",1,"input","input-bordered","input-lg",3,"ngClass"],["translate","",1,"w-64","btn","btn-lg","mt-3",3,"ngClass","disabled"],["translate","",1,"w-64","btn","btn-primary","btn-lg",3,"disabled","click"],[1,"label-alt-text","text-error","text-xs"]],template:function(e,n){if(1&e&&(o.TgZ(0,"div",0),o.YNc(1,Xi,7,4,"div",1),o.YNc(2,eo,3,0,"ng-template",null,2,o.W1O),o.YNc(4,to,1,0,"app-broadcast-room",3),o.YNc(5,co,28,24,"ng-template",null,4,o.W1O),o.YNc(7,lo,1,0,"app-accept-peer-connections-modal",5),o.qZA()),2&e){const i=o.MAs(3),s=o.MAs(6);o.xp6(1),o.Q6J("ngIf",n.acceptedPeerConnections())("ngIfElse",i),o.xp6(3),o.Q6J("ngIf",n.isBroadcasting())("ngIfElse",s),o.xp6(3),o.Q6J("ngIf",!n.acceptedPeerConnections())}},dependencies:[u.mk,u.O5,d._Y,d.Fj,d.JJ,d.JL,d.nD,d.sg,d.u,F.Pi,Oi,fn,un,Li,Ui,Ji,zi,Yi],styles:[".form-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.75rem}@media (min-width: 640px){.form-row[_ngcontent-%COMP%]{flex-direction:row;gap:3rem}}@media (min-width: 1024px){.form-row[_ngcontent-%COMP%]{gap:6rem}}"]}),t})();var fo=l(8505),uo=l(4986),ho=l(2805),go=l(4482),vo=l(5403);const _o=["modal"],Co=["close"];let bo=(()=>{class t{set showDialog(e){e&&this._openModal()}constructor(e,n,i,s){this.store=e,this.renderer=n,this.router=i,this.route=s,this.dialogClosed=new o.vpe,this.confirmationRequired=(0,J.O4)(this.store.select(z.tN))}confirmLeaveBroadcast(){this.confirmationRequired()?this._openModal():this.leaveBroadcast()}leaveBroadcast(){this.store.dispatch(P.p.leaveBroadcastRoom()),this.store.select(z.mo).pipe((0,Ke.h)(e=>!e),(0,Te.q)(1)).subscribe(()=>{this.dialogClosed.next(!0)}),this._closeModal(),this.router.navigate([".."],{queryParams:{joinCode:null},queryParamsHandling:"merge",relativeTo:this.route})}hideModal(){this.dialogClosed.next(!1),this._closeModal()}_openModal(){this.renderer.setAttribute(this.modal.nativeElement,"open","")}_closeModal(){this.closeButton.nativeElement.click()}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(pe.yh),o.Y36(o.Qsj),o.Y36(S.F0),o.Y36(S.gz))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-leave-session"]],viewQuery:function(e,n){if(1&e&&(o.Gf(_o,5,o.SBq),o.Gf(Co,5,o.SBq)),2&e){let i;o.iGM(i=o.CRH())&&(n.modal=i.first),o.iGM(i=o.CRH())&&(n.closeButton=i.first)}},inputs:{showDialog:"showDialog"},outputs:{dialogClosed:"dialogClosed"},decls:15,vars:0,consts:[["translate","",1,"btn","btn-sm",3,"click"],[1,"modal"],["modal",""],["method","dialog",1,"modal-box","bg-base-content","text-base-100","sm:w-11/12","justify-self-center"],["translate",""],[1,"modal-action"],["translate","","type","button",1,"btn",3,"click"],["type","button","translate","",1,"btn",3,"click"],["method","dialog",1,"modal-backdrop"],["close",""]],template:function(e,n){1&e&&(o.TgZ(0,"button",0),o.NdJ("click",function(){return n.confirmLeaveBroadcast()}),o._uU(1,"STREAM.leaveSession"),o.qZA(),o.TgZ(2,"dialog",1,2)(4,"form",3)(5,"p",4),o._uU(6,"MODAL.confirmLeaveSession"),o.qZA(),o.TgZ(7,"div",5)(8,"button",6),o.NdJ("click",function(){return n.leaveBroadcast()}),o._uU(9,"BUTTONS.confirm"),o.qZA(),o.TgZ(10,"button",7),o.NdJ("click",function(){return n.hideModal()}),o._uU(11,"BUTTONS.decline"),o.qZA()()(),o.TgZ(12,"form",8),o._UZ(13,"button",null,9),o.qZA()())},dependencies:[d._Y,d.JL,F.Pi]}),t})();var So=l(1589),To=l(3643),xo=l(213);function ko(t,r){1&t&&(o.TgZ(0,"label",11),o._UZ(1,"ng-icon",12),o.qZA()),2&t&&o.Q6J("@slideInRightOnEnter",void 0)("@slideOutRightOnLeave",void 0)}function Eo(t,r){1&t&&o._UZ(0,"app-recognition-control-sidebar"),2&t&&o.Q6J("@slideInRightOnEnter",void 0)}let Ro=(()=>{class t{constructor(e,n,i){this.store=e,this.peerService=n,this.cd=i,this.liveText=(0,o.tdS)(""),this.textOutput=(0,o.tdS)([]),this.onDestroy$=new U.x;const s=(0,J.O4)(this.store.select(z.jT)),a=(0,J.O4)(this.store.select(z.tN));this.connected=(0,o.Flj)(()=>s()&&a()),this.error=(0,J.O4)(this.store.select(yt.W5)),this.hasLiveResults=(0,o.Flj)(()=>!(""==this.liveText()&&0===this.textOutput().length))}ngOnInit(){this.peerService.liveText$.pipe((0,_t.R)(this.onDestroy$)).subscribe(e=>{this.liveText.set(e),this.cd.detectChanges()}),this.peerService.textOutput$.pipe((0,_t.R)(this.onDestroy$)).subscribe(e=>{this.textOutput.set(e),this.cd.detectChanges()})}ngOnDestroy(){this.onDestroy$.next()}updateDom(){this.cd.detectChanges()}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(pe.yh),o.Y36(Jt),o.Y36(o.sBO))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-broadcast-render"]],decls:11,vars:7,consts:[[1,"drawer","drawer-end"],["id","drawer-enable","type","checkbox",1,"drawer-toggle",3,"change"],["enable",""],[1,"drawer-content","overflow-hidden"],[1,"flex","flex-col","h-full","overflow-hidden"],["hintText","HINTS.streamConnected",1,"flex","flex-grow-0","flex-shrink","basis-full","overflow-y-hidden",3,"connected","hasLiveResults","textOutput","error"],[1,"flex","flex-grow","flex-shrink",3,"text"],["for","drawer-enable","class","drawer-button btn btn-ghost btn-half-circle-left btn-info fixed top-1/2 right-0",4,"ngIf"],[1,"drawer-side"],["for","drawer-enable",1,"drawer-overlay","opacity-0"],[4,"ngIf"],["for","drawer-enable",1,"drawer-button","btn","btn-ghost","btn-half-circle-left","btn-info","fixed","top-1/2","right-0"],["name","heroChevronLeft",1,"text-2xl"]],template:function(e,n){if(1&e&&(o.TgZ(0,"div",0)(1,"input",1,2),o.NdJ("change",function(){return n.updateDom()}),o.qZA(),o.TgZ(3,"div",3)(4,"div",4),o._UZ(5,"app-recognized-text",5)(6,"app-recognized-live-text",6),o.qZA(),o.YNc(7,ko,2,2,"label",7),o.qZA(),o.TgZ(8,"div",8),o._UZ(9,"label",9),o.YNc(10,Eo,1,1,"app-recognition-control-sidebar",10),o.qZA()()),2&e){const i=o.MAs(2);o.xp6(5),o.Q6J("connected",n.connected)("hasLiveResults",n.hasLiveResults)("textOutput",n.textOutput)("error",n.error),o.xp6(1),o.Q6J("text",n.liveText),o.xp6(1),o.Q6J("ngIf",n.connected()),o.xp6(3),o.Q6J("ngIf",i.checked)}},dependencies:[u.O5,M.Fv,So.M,To.c,xo.h],styles:[".drawer-end[_ngcontent-%COMP%]   .drawer-toggle[_ngcontent-%COMP%] ~ .drawer-side[_ngcontent-%COMP%]{align-items:center}"],data:{animation:[(0,Ce.nh)(),(0,Ce.Jm)(),(0,Ce.vc)(),(0,Ce.B5)()]}}),t})();var mn=l(2847);function Po(t,r){1&t&&(o.TgZ(0,"div",12),o._uU(1,"HINTS.hostConnecting"),o.qZA())}const Oo=function(t,r){return{"badge-success":t,"badge-info":r}};function Ao(t,r){if(1&t){const e=o.EpF();o.TgZ(0,"div",8)(1,"div",9),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.YNc(4,Po,2,0,"div",10),o.TgZ(5,"app-leave-session",11),o.NdJ("dialogClosed",function(i){o.CHM(e);const s=o.oxw(3);return o.KtG(s.leaveSessionDialogClosed(i))}),o.qZA()()}if(2&t){const e=o.oxw(3);o.xp6(1),o.Q6J("ngClass",o.WLB(6,Oo,e.hostOnline(),!e.hostOnline())),o.xp6(1),o.Oqu(o.lcZ(3,4,e.hostOnline()?"STREAM.connected":"HINTS.verifyingConnection")),o.xp6(2),o.Q6J("ngIf",!e.hostOnline()),o.xp6(1),o.Q6J("showDialog",e.showLeaveBroadcastDialog())}}const gn=function(){return[".."]};function Io(t,r){1&t&&(o.TgZ(0,"div",13)(1,"button",14),o._uU(2,"BUTTONS.goBack"),o.qZA()()),2&t&&(o.xp6(1),o.Q6J("routerLink",o.DdM(1,gn)))}function Do(t,r){if(1&t&&(o.TgZ(0,"div"),o._uU(1),o.ALo(2,"translate"),o.ALo(3,"timeago"),o.qZA()),2&t){const e=o.oxw().ngIf;o.xp6(1),o.AsE(" ",o.lcZ(2,2,"STREAM.broadcastEnded")," ",o.lcZ(3,4,e),". ")}}function Mo(t,r){1&t&&(o.TgZ(0,"div",17),o._uU(1,"STREAM.noSessionForRoom"),o.qZA())}function Bo(t,r){if(1&t&&(o.TgZ(0,"div",15),o.YNc(1,Do,4,6,"div",1),o.YNc(2,Mo,2,0,"ng-template",null,16,o.W1O),o.qZA()),2&t){const e=r.ngIf,n=o.MAs(3);o.xp6(1),o.Q6J("ngIf",e>1)("ngIfElse",n)}}function wo(t,r){1&t&&o._UZ(0,"app-broadcast-render",18)}function jo(t,r){if(1&t&&(o.TgZ(0,"span"),o._uU(1),o.qZA()),2&t){const e=o.oxw(2).ngIf,n=o.oxw(3);o.xp6(1),o.hij("Time left: ",n.HOST_ONLINE_TIMEOUT_SECONDS-e,"")}}function Lo(t,r){1&t&&(o.TgZ(0,"span",17),o._uU(1,"STREAM.noSessionForRoom"),o.qZA())}function No(t,r){if(1&t&&(o.ynx(0),o.YNc(1,jo,2,1,"span",1),o.YNc(2,Lo,2,0,"ng-template",null,20,o.W1O),o.BQk()),2&t){const e=o.MAs(3),n=o.oxw().ngIf,i=o.oxw(3);o.xp6(1),o.Q6J("ngIf",n<i.HOST_ONLINE_TIMEOUT_SECONDS)("ngIfElse",e)}}function Fo(t,r){1&t&&(o.TgZ(0,"span",17),o._uU(1,"STREAM.hostOffline"),o.qZA())}function Uo(t,r){if(1&t&&(o.TgZ(0,"div",15),o.YNc(1,No,4,2,"ng-container",1),o.YNc(2,Fo,2,0,"ng-template",null,19,o.W1O),o.qZA()),2&t){const e=o.MAs(3),n=o.oxw(3);o.xp6(1),o.Q6J("ngIf",void 0===n.hostOnline())("ngIfElse",e)}}function $o(t,r){if(1&t&&(o.ynx(0),o.YNc(1,Ao,6,9,"div",4),o.YNc(2,Io,3,2,"div",5),o.YNc(3,Bo,4,2,"div",6),o.YNc(4,wo,1,0,"app-broadcast-render",7),o.YNc(5,Uo,4,2,"div",6),o.ALo(6,"async"),o.BQk()),2&t){const e=o.oxw(2);o.xp6(1),o.Q6J("ngIf",e.isViewing()),o.xp6(1),o.Q6J("ngIf",e.broadcastEndedTimestamp()),o.xp6(1),o.Q6J("ngIf",e.broadcastEndedTimestamp()),o.xp6(1),o.Q6J("ngIf",e.hostOnline()),o.xp6(1),o.Q6J("ngIf",!e.broadcastEndedTimestamp()&&!e.hostOnline()&&e.verifyJoinCodeTimer&&o.lcZ(6,5,e.verifyJoinCodeTimer))}}function Zo(t,r){if(1&t&&(o.ynx(0),o.YNc(1,$o,7,7,"ng-container",1),o.BQk()),2&t){const e=o.oxw(),n=o.MAs(5);o.xp6(1),o.Q6J("ngIf",e.joinCode())("ngIfElse",n)}}function Jo(t,r){1&t&&(o.TgZ(0,"div",21)(1,"div",22),o._uU(2,"STREAM.connectionPendingHint"),o.qZA(),o._UZ(3,"app-socket-server-status-chip")(4,"app-peer-server-status-chip"),o.qZA())}function Go(t,r){1&t&&(o.TgZ(0,"span",36),o._uU(1,"Invalid ID"),o.qZA())}function qo(t,r){1&t&&(o.TgZ(0,"span",36),o._uU(1,"Required"),o.qZA())}const zo=function(t){return{"text-error":t}},Vo=function(t){return{"input-error":t}};function Yo(t,r){if(1&t){const e=o.EpF();o.TgZ(0,"div",23)(1,"form",24),o.NdJ("submit",function(){o.CHM(e);const i=o.oxw();return o.KtG(i.rejoin())}),o.TgZ(2,"div",25),o._uU(3,"STREAM.joinCodeRequired"),o.qZA(),o.TgZ(4,"div",26)(5,"div",27)(6,"label",28)(7,"span",29),o._uU(8,"STREAM.joinCode"),o.qZA()(),o._UZ(9,"input",30),o.TgZ(10,"label",31),o.YNc(11,Go,2,0,"span",32),o.YNc(12,qo,2,0,"span",32),o.qZA()(),o.TgZ(13,"div",33)(14,"button",34),o._uU(15,"BUTTONS.connect"),o.qZA(),o.TgZ(16,"button",35),o._uU(17,"BUTTONS.cancel"),o.qZA()()()()()}if(2&t){const e=o.oxw();o.xp6(1),o.Q6J("formGroup",e.formGroup),o.xp6(6),o.Q6J("ngClass",o.VKq(6,zo,e.formGroup.controls.joinCode.invalid&&e.formGroup.controls.joinCode.touched)),o.xp6(2),o.Q6J("ngClass",o.VKq(8,Vo,e.formGroup.controls.joinCode.invalid&&e.formGroup.controls.joinCode.touched)),o.xp6(2),o.Q6J("ngIf",e.formGroup.controls.joinCode.hasError("invalid")&&e.formGroup.controls.joinCode.touched),o.xp6(1),o.Q6J("ngIf",e.formGroup.controls.joinCode.hasError("required")&&e.formGroup.controls.joinCode.touched),o.xp6(4),o.Q6J("routerLink",o.DdM(10,gn))}}let Qo=(()=>{class t{constructor(e,n,i,s){this.route=e,this.router=n,this.fb=i,this.store=s,this.showLeaveBroadcastDialog=(0,o.tdS)(!1),this.dialogClosedSubject=new U.x,this.HOST_ONLINE_TIMEOUT_SECONDS=30,this.roomId=this.route.snapshot.params.id.toLowerCase(),this.joinCode=(0,J.O4)(this.store.select(z.cJ)),this.isViewing=(0,J.O4)(this.store.select(z.mo)),this.hostOnline=(0,J.O4)(this.store.select(z.tN)),this.serverError=(0,J.O4)(this.store.select(z.ok)),this.broadcastEndedTimestamp=(0,J.O4)(this.store.select(z.XF));const a=(0,J.O4)(this.store.select(z.sM)),c=(0,J.O4)(this.store.select(z.jT));this.connected=(0,o.Flj)(()=>a()&&c()),this.formGroup=this.fb.group({joinCode:this.fb.control("",[d.kI.required,d.kI.minLength(4),d.kI.maxLength(4)])}),"joinCode"in this.route.snapshot.queryParams&&this.route.snapshot.queryParams.joinCode!==this.joinCode()?this._updateJoinCodeAndConnect(this.route.snapshot.queryParams.joinCode.toLowerCase()):this._joinRoom(),(0,o.cEC)(()=>{this.isViewing()?this.store.dispatch(Le.q.hideFooter()):this.store.dispatch(Le.q.showFooter())},{allowSignalWrites:!0})}canDeactivate(){return!this.isViewing()||!this.hostOnline()||(this.showLeaveBroadcastDialog.set(!0),this.dialogClosedSubject.asObservable().pipe((0,Te.q)(1),(0,fo.b)(()=>this.showLeaveBroadcastDialog.set(!1))))}ngOnDestroy(){(this.isViewing()||this.broadcastEndedTimestamp())&&this.store.dispatch(P.p.leaveBroadcastRoom()),this.store.dispatch(Le.q.showFooter())}rejoin(){if(this.formGroup.updateValueAndValidity(),this.formGroup.valid){const e=this.formGroup.value.joinCode;this._updateQueryParamsCode(e),this._updateJoinCodeAndConnect(e)}else this.formGroup.markAllAsTouched()}leaveSessionDialogClosed(e){this.dialogClosedSubject.next(e)}_updateQueryParamsCode(e){this.router.navigate([],{relativeTo:this.route,queryParams:{joinCode:e},queryParamsHandling:"merge"})}_joinRoom(){this.connected()?this.store.dispatch(P.p.joinBroadcastRoom({id:this.roomId})):(this.store.pipe((0,pe.Ys)(z.jT),(0,Ke.h)(e=>!!e),(0,Te.q)(1)).subscribe(()=>{this.store.dispatch(P.p.joinBroadcastRoom({id:this.roomId}))}),this.store.dispatch(P.p.connectSocketServer())),this.verifyJoinCodeTimer=function mo(t=0,r=uo.z){return t<0&&(t=0),(0,ho.H)(t,t,r)}(1e3).pipe(function yo(t,r=!1){return(0,go.e)((e,n)=>{let i=0;e.subscribe((0,vo.x)(n,s=>{const a=t(s,i++);(a||r)&&n.next(s),!a&&n.complete()}))})}(e=>e<this.HOST_ONLINE_TIMEOUT_SECONDS&&void 0===this.hostOnline()),(0,D.U)(e=>e+1))}_updateJoinCodeAndConnect(e){this.store.dispatch(P.p.setJoinCode({joinCode:e})),this.store.select(z.cJ).pipe((0,Ke.h)(n=>n===e),(0,Te.q)(1)).subscribe(()=>{this._joinRoom()})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(S.gz),o.Y36(S.F0),o.Y36(d.qu),o.Y36(pe.yh))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-view-broadcast"]],hostBindings:function(e,n){1&e&&o.NdJ("beforeunload",function(){return n.joinCode()},!1,o.Jf7)},decls:6,vars:2,consts:[[1,"flex","flex-col","w-full","h-full"],[4,"ngIf","ngIfElse"],["connectingToServer",""],["setJoinCode",""],["class","flex flex-row items-center justify-between p-3",4,"ngIf"],["class","flex flex-row items-center justify-end p-3",4,"ngIf"],["class","flex flex-col basis-full self-center justify-center px-3 text-center",4,"ngIf"],["class","flex basis-full overflow-y-hidden",4,"ngIf"],[1,"flex","flex-row","items-center","justify-between","p-3"],[1,"badge","h-auto",3,"ngClass"],["class","text-sm text-accent flex flex-row text-center","translate","",4,"ngIf"],[3,"showDialog","dialogClosed"],["translate","",1,"text-sm","text-accent","flex","flex-row","text-center"],[1,"flex","flex-row","items-center","justify-end","p-3"],["translate","",1,"btn","btn-primary",3,"routerLink"],[1,"flex","flex-col","basis-full","self-center","justify-center","px-3","text-center"],["noRoomFound",""],["translate",""],[1,"flex","basis-full","overflow-y-hidden"],["hostDisconnected",""],["timedOut",""],[1,"flex","flex-col","basis-full","justify-center","items-center","gap-12"],["translate","",1,"text-2xl","text-error-content","w-1/2","text-center"],[1,"flex","basis-full","justify-center"],[1,"flex","flex-col","gap-12","p-3","sm:p-12","max-w-2xl",3,"formGroup","submit"],["translate","",1,"text-3xl","sm:text-5xl","text-center"],[1,"flex","flex-row","flex-wrap","items-center","justify-between","gap-12","sm:gap-24"],[1,"form-control"],[1,"label"],["translate","",1,"label-text",3,"ngClass"],["type","text","placeholder","E5F6","formControlName","joinCode",1,"input","input-bordered","input-lg",3,"ngClass"],[1,"label","no-height"],["class","label-alt-text text-error text-xs",4,"ngIf"],[1,"flex","flex-row","gap-3"],["translate","",1,"btn","btn-lg","btn-primary","mt-3"],["translate","","type","button",1,"btn","btn-lg","mt-3",3,"routerLink"],[1,"label-alt-text","text-error","text-xs"]],template:function(e,n){if(1&e&&(o.TgZ(0,"div",0),o.YNc(1,Zo,2,2,"ng-container",1),o.YNc(2,Jo,5,0,"ng-template",null,2,o.W1O),o.YNc(4,Yo,18,11,"ng-template",null,3,o.W1O),o.qZA()),2&e){const i=o.MAs(3);o.xp6(1),o.Q6J("ngIf",n.connected())("ngIfElse",i)}},dependencies:[u.mk,u.O5,S.rH,d._Y,d.Fj,d.JJ,d.JL,d.sg,d.u,F.Pi,bo,fn,un,Ro,u.Ov,F.X$,mn.wr]}),t})();const vn=(t,r,e,n)=>t.canDeactivate?t.canDeactivate():confirm("WARNING: Leaving this page will end the current broadcast."),Ho=[{path:"",component:po,canDeactivate:[vn]},{path:":id",component:Qo,canDeactivate:[vn]}];let Ko=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[S.Bz.forChild(Ho),S.Bz]}),t})(),Wo=(()=>{class t{constructor(e){this.store=e,this.userId=(0,J.O4)(this.store.pipe((0,pe.Ys)(z.h4),(0,D.U)(n=>n.id)))}sendSocketDisconnected(){console.log("dispatching socket disconnected"),this.store.dispatch(P.p.socketServerDisconnected())}sendUserIdAssigned(){console.log("dispatching socketUserIdAssigned",this.userId()),this.store.dispatch(P.p.socketServerUserIdAssigned({id:this.userId()||""}))}sendConnectPeerServer(){this.store.dispatch(P.p.connectPeerServer())}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(pe.yh))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-socket-debug"]],standalone:!0,features:[o.jDz],decls:7,vars:0,consts:[[1,"flex","flex-col","gap-3","bg-transparent"],[1,"btn","btn-sm",3,"click"]],template:function(e,n){1&e&&(o.TgZ(0,"div",0)(1,"button",1),o.NdJ("click",function(){return n.sendSocketDisconnected()}),o._uU(2,"Socket Disconnected Event"),o.qZA(),o.TgZ(3,"button",1),o.NdJ("click",function(){return n.sendUserIdAssigned()}),o._uU(4,"User Id Assigned Event"),o.qZA(),o.TgZ(5,"button",1),o.NdJ("click",function(){return n.sendConnectPeerServer()}),o._uU(6,"Connect Peer Server Event"),o.qZA()())},dependencies:[u.ez]}),t})(),Xo=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[u.ez,Ko,S.Bz,d.UX,M.sU,F.aw.forChild({extend:!0}),I.sQ.forFeature([ki]),Ei.c,_,mn.$L,Wo]}),t})()},8819:(ge,b,l)=>{var p=l(3417).MY,y=l(3417).cx;function E(u){this.index=0,this.dataBuffer=u,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function L(){this.bufferBuilder=new p}function te(u){var d=u.charCodeAt(0);return d<=2047?"00":d<=65535?"000":d<=2097151?"0000":d<=67108863?"00000":"000000"}ge.exports={unpack:function(u){return new E(u).unpack()},pack:function(u){var d=new L;return d.pack(u),d.getBuffer()}},E.prototype.unpack=function(){var d,u=this.unpack_uint8();if(u<128)return u;if((224^u)<32)return(224^u)-32;if((d=160^u)<=15)return this.unpack_raw(d);if((d=176^u)<=15)return this.unpack_string(d);if((d=144^u)<=15)return this.unpack_array(d);if((d=128^u)<=15)return this.unpack_map(d);switch(u){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return d=this.unpack_uint16(),this.unpack_string(d);case 217:return d=this.unpack_uint32(),this.unpack_string(d);case 218:return d=this.unpack_uint16(),this.unpack_raw(d);case 219:return d=this.unpack_uint32(),this.unpack_raw(d);case 220:return d=this.unpack_uint16(),this.unpack_array(d);case 221:return d=this.unpack_uint32(),this.unpack_array(d);case 222:return d=this.unpack_uint16(),this.unpack_map(d);case 223:return d=this.unpack_uint32(),this.unpack_map(d)}},E.prototype.unpack_uint8=function(){var u=255&this.dataView[this.index];return this.index++,u},E.prototype.unpack_uint16=function(){var u=this.read(2),d=256*(255&u[0])+(255&u[1]);return this.index+=2,d},E.prototype.unpack_uint32=function(){var u=this.read(4),d=256*(256*(256*u[0]+u[1])+u[2])+u[3];return this.index+=4,d},E.prototype.unpack_uint64=function(){var u=this.read(8),d=256*(256*(256*(256*(256*(256*(256*u[0]+u[1])+u[2])+u[3])+u[4])+u[5])+u[6])+u[7];return this.index+=8,d},E.prototype.unpack_int8=function(){var u=this.unpack_uint8();return u<128?u:u-256},E.prototype.unpack_int16=function(){var u=this.unpack_uint16();return u<32768?u:u-65536},E.prototype.unpack_int32=function(){var u=this.unpack_uint32();return u<Math.pow(2,31)?u:u-Math.pow(2,32)},E.prototype.unpack_int64=function(){var u=this.unpack_uint64();return u<Math.pow(2,63)?u:u-Math.pow(2,64)},E.prototype.unpack_raw=function(u){if(this.length<this.index+u)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+u+" "+this.length);var d=this.dataBuffer.slice(this.index,this.index+u);return this.index+=u,d},E.prototype.unpack_string=function(u){for(var I,F,d=this.read(u),S=0,M="";S<u;)(I=d[S])<128?(M+=String.fromCharCode(I),S++):(192^I)<32?(F=(192^I)<<6|63&d[S+1],M+=String.fromCharCode(F),S+=2):(F=(15&I)<<12|(63&d[S+1])<<6|63&d[S+2],M+=String.fromCharCode(F),S+=3);return this.index+=u,M},E.prototype.unpack_array=function(u){for(var d=new Array(u),S=0;S<u;S++)d[S]=this.unpack();return d},E.prototype.unpack_map=function(u){for(var d={},S=0;S<u;S++){var M=this.unpack(),I=this.unpack();d[M]=I}return d},E.prototype.unpack_float=function(){var u=this.unpack_uint32();return(0==u>>31?1:-1)*(8388607&u|8388608)*Math.pow(2,(u>>23&255)-127-23)},E.prototype.unpack_double=function(){var u=this.unpack_uint32(),d=this.unpack_uint32(),M=(u>>20&2047)-1023;return(0==u>>31?1:-1)*((1048575&u|1048576)*Math.pow(2,M-20)+d*Math.pow(2,M-52))},E.prototype.read=function(u){var d=this.index;if(d+u<=this.length)return this.dataView.subarray(d,d+u);throw new Error("BinaryPackFailure: read index out of range")},L.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},L.prototype.pack=function(u){var d=typeof u;if("string"===d)this.pack_string(u);else if("number"===d)Math.floor(u)===u?this.pack_integer(u):this.pack_double(u);else if("boolean"===d)!0===u?this.bufferBuilder.append(195):!1===u&&this.bufferBuilder.append(194);else if("undefined"===d)this.bufferBuilder.append(192);else{if("object"!==d)throw new Error('Type "'+d+'" not yet supported');if(null===u)this.bufferBuilder.append(192);else{var S=u.constructor;if(S==Array)this.pack_array(u);else if(S==Blob||S==File||u instanceof Blob||u instanceof File)this.pack_bin(u);else if(S==ArrayBuffer)this.pack_bin(y.useArrayBufferView?new Uint8Array(u):u);else if("BYTES_PER_ELEMENT"in u)this.pack_bin(y.useArrayBufferView?new Uint8Array(u.buffer):u.buffer);else if(S==Object||S.toString().startsWith("class"))this.pack_object(u);else if(S==Date)this.pack_string(u.toString());else{if("function"!=typeof u.toBinaryPack)throw new Error('Type "'+S.toString()+'" not yet supported');this.bufferBuilder.append(u.toBinaryPack())}}}this.bufferBuilder.flush()},L.prototype.pack_bin=function(u){var d=u.length||u.byteLength||u.size;if(d<=15)this.pack_uint8(160+d);else if(d<=65535)this.bufferBuilder.append(218),this.pack_uint16(d);else{if(!(d<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(d)}this.bufferBuilder.append(u)},L.prototype.pack_string=function(u){var d=function ne(u){return u.length>600?new Blob([u]).size:u.replace(/[^\u0000-\u007F]/g,te).length}(u);if(d<=15)this.pack_uint8(176+d);else if(d<=65535)this.bufferBuilder.append(216),this.pack_uint16(d);else{if(!(d<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(d)}this.bufferBuilder.append(u)},L.prototype.pack_array=function(u){var d=u.length;if(d<=15)this.pack_uint8(144+d);else if(d<=65535)this.bufferBuilder.append(220),this.pack_uint16(d);else{if(!(d<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(d)}for(var S=0;S<d;S++)this.pack(u[S])},L.prototype.pack_integer=function(u){if(u>=-32&&u<=127)this.bufferBuilder.append(255&u);else if(u>=0&&u<=255)this.bufferBuilder.append(204),this.pack_uint8(u);else if(u>=-128&&u<=127)this.bufferBuilder.append(208),this.pack_int8(u);else if(u>=0&&u<=65535)this.bufferBuilder.append(205),this.pack_uint16(u);else if(u>=-32768&&u<=32767)this.bufferBuilder.append(209),this.pack_int16(u);else if(u>=0&&u<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(u);else if(u>=-2147483648&&u<=2147483647)this.bufferBuilder.append(210),this.pack_int32(u);else if(u>=-0x8000000000000000&&u<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(u);else{if(!(u>=0&&u<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(u)}},L.prototype.pack_double=function(u){var d=0;u<0&&(d=1,u=-u);var S=Math.floor(Math.log(u)/Math.LN2),M=u/Math.pow(2,S)-1,I=Math.floor(M*Math.pow(2,52)),F=Math.pow(2,32),o=d<<31|S+1023<<20|I/F&1048575,V=I%F;this.bufferBuilder.append(203),this.pack_int32(o),this.pack_int32(V)},L.prototype.pack_object=function(u){var S=Object.keys(u).length;if(S<=15)this.pack_uint8(128+S);else if(S<=65535)this.bufferBuilder.append(222),this.pack_uint16(S);else{if(!(S<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(S)}for(var M in u)u.hasOwnProperty(M)&&(this.pack(M),this.pack(u[M]))},L.prototype.pack_uint8=function(u){this.bufferBuilder.append(u)},L.prototype.pack_uint16=function(u){this.bufferBuilder.append(u>>8),this.bufferBuilder.append(255&u)},L.prototype.pack_uint32=function(u){var d=4294967295&u;this.bufferBuilder.append((4278190080&d)>>>24),this.bufferBuilder.append((16711680&d)>>>16),this.bufferBuilder.append((65280&d)>>>8),this.bufferBuilder.append(255&d)},L.prototype.pack_uint64=function(u){var d=u/Math.pow(2,32),S=u%Math.pow(2,32);this.bufferBuilder.append((4278190080&d)>>>24),this.bufferBuilder.append((16711680&d)>>>16),this.bufferBuilder.append((65280&d)>>>8),this.bufferBuilder.append(255&d),this.bufferBuilder.append((4278190080&S)>>>24),this.bufferBuilder.append((16711680&S)>>>16),this.bufferBuilder.append((65280&S)>>>8),this.bufferBuilder.append(255&S)},L.prototype.pack_int8=function(u){this.bufferBuilder.append(255&u)},L.prototype.pack_int16=function(u){this.bufferBuilder.append((65280&u)>>8),this.bufferBuilder.append(255&u)},L.prototype.pack_int32=function(u){this.bufferBuilder.append(u>>>24&255),this.bufferBuilder.append((16711680&u)>>>16),this.bufferBuilder.append((65280&u)>>>8),this.bufferBuilder.append(255&u)},L.prototype.pack_int64=function(u){var d=Math.floor(u/Math.pow(2,32)),S=u%Math.pow(2,32);this.bufferBuilder.append((4278190080&d)>>>24),this.bufferBuilder.append((16711680&d)>>>16),this.bufferBuilder.append((65280&d)>>>8),this.bufferBuilder.append(255&d),this.bufferBuilder.append((4278190080&S)>>>24),this.bufferBuilder.append((16711680&S)>>>16),this.bufferBuilder.append((65280&S)>>>8),this.bufferBuilder.append(255&S)}},3417:ge=>{var b={};b.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),b.useArrayBufferView=!b.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch{return!0}}(),ge.exports.cx=b;var l=ge.exports.xE;function p(){this._pieces=[],this._parts=[]}typeof window<"u"&&(l=ge.exports.xE=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),p.prototype.append=function(y){"number"==typeof y?this._pieces.push(y):(this.flush(),this._parts.push(y))},p.prototype.flush=function(){if(this._pieces.length>0){var y=new Uint8Array(this._pieces);b.useArrayBufferView||(y=y.buffer),this._parts.push(y),this._pieces=[]}},p.prototype.getBuffer=function(){if(this.flush(),b.useBlobBuilder){for(var y=new l,k=0,E=this._parts.length;k<E;k++)y.append(this._parts[k]);return y.getBlob()}return new Blob(this._parts)},ge.exports.MY=p},6334:(ge,b,l)=>{"use strict";var p=l(7463);function k(d,S,M,I,F){var o=p.writeRtpDescription(d.kind,S);if(o+=p.writeIceParameters(d.iceGatherer.getLocalParameters()),o+=p.writeDtlsParameters(d.dtlsTransport.getLocalParameters(),"offer"===M?"actpass":F||"active"),o+="a=mid:"+d.mid+"\r\n",o+=d.rtpSender&&d.rtpReceiver?"a=sendrecv\r\n":d.rtpSender?"a=sendonly\r\n":d.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",d.rtpSender){var V=d.rtpSender._initialTrackId||d.rtpSender.track.id;d.rtpSender._initialTrackId=V;var U="msid:"+(I?I.id:"-")+" "+V+"\r\n";o+="a="+U,o+="a=ssrc:"+d.sendEncodingParameters[0].ssrc+" "+U,d.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+d.sendEncodingParameters[0].rtx.ssrc+" "+U,o+="a=ssrc-group:FID "+d.sendEncodingParameters[0].ssrc+" "+d.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+d.sendEncodingParameters[0].ssrc+" cname:"+p.localCName+"\r\n",d.rtpSender&&d.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+d.sendEncodingParameters[0].rtx.ssrc+" cname:"+p.localCName+"\r\n"),o}function L(d,S){var M={codecs:[],headerExtensions:[],fecMechanisms:[]},I=function(o,V){o=parseInt(o,10);for(var U=0;U<V.length;U++)if(V[U].payloadType===o||V[U].preferredPayloadType===o)return V[U]},F=function(o,V,U,f){var g=I(o.parameters.apt,U),C=I(V.parameters.apt,f);return g&&C&&g.name.toLowerCase()===C.name.toLowerCase()};return d.codecs.forEach(function(o){for(var V=0;V<S.codecs.length;V++){var U=S.codecs[V];if(o.name.toLowerCase()===U.name.toLowerCase()&&o.clockRate===U.clockRate){if("rtx"===o.name.toLowerCase()&&o.parameters&&U.parameters.apt&&!F(o,U,d.codecs,S.codecs))continue;(U=JSON.parse(JSON.stringify(U))).numChannels=Math.min(o.numChannels,U.numChannels),M.codecs.push(U),U.rtcpFeedback=U.rtcpFeedback.filter(function(f){for(var g=0;g<o.rtcpFeedback.length;g++)if(o.rtcpFeedback[g].type===f.type&&o.rtcpFeedback[g].parameter===f.parameter)return!0;return!1});break}}}),d.headerExtensions.forEach(function(o){for(var V=0;V<S.headerExtensions.length;V++){var U=S.headerExtensions[V];if(o.uri===U.uri){M.headerExtensions.push(U);break}}}),M}function te(d,S,M){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[S][d].indexOf(M)}function ne(d,S){var M=d.getRemoteCandidates().find(function(I){return S.foundation===I.foundation&&S.ip===I.ip&&S.port===I.port&&S.priority===I.priority&&S.protocol===I.protocol&&S.type===I.type});return M||d.addRemoteCandidate(S),!M}function u(d,S){var M=new Error(S);return M.name=d,M.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[d],M}ge.exports=function(d,S){function M(f,g){g.addTrack(f),g.dispatchEvent(new d.MediaStreamTrackEvent("addtrack",{track:f}))}function F(f,g,C,_){var x=new Event("track");x.track=g,x.receiver=C,x.transceiver={receiver:C},x.streams=_,d.setTimeout(function(){f._dispatchEvent("track",x)})}var o=function(f){var g=this,C=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(x){g[x]=C[x].bind(C)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",f=JSON.parse(JSON.stringify(f||{})),this.usingBundle="max-bundle"===f.bundlePolicy,"negotiate"===f.rtcpMuxPolicy)throw u("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(f.rtcpMuxPolicy||(f.rtcpMuxPolicy="require"),f.iceTransportPolicy){case"all":case"relay":break;default:f.iceTransportPolicy="all"}switch(f.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:f.bundlePolicy="balanced"}if(f.iceServers=function E(d,S){var M=!1;return(d=JSON.parse(JSON.stringify(d))).filter(function(I){if(I&&(I.urls||I.url)){var F=I.urls||I.url;I.url&&!I.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o="string"==typeof F;return o&&(F=[F]),F=F.filter(function(V){return 0!==V.indexOf("turn:")||-1===V.indexOf("transport=udp")||-1!==V.indexOf("turn:[")||M?0===V.indexOf("stun:")&&S>=14393&&-1===V.indexOf("?transport=udp"):(M=!0,!0)}),delete I.url,I.urls=o?F[0]:F,!!F.length}})}(f.iceServers||[],S),this._iceGatherers=[],f.iceCandidatePoolSize)for(var _=f.iceCandidatePoolSize;_>0;_--)this._iceGatherers.push(new d.RTCIceGatherer({iceServers:f.iceServers,gatherPolicy:f.iceTransportPolicy}));else f.iceCandidatePoolSize=0;this._config=f,this.transceivers=[],this._sdpSessionId=p.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(o.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(o.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),o.prototype.onicecandidate=null,o.prototype.onaddstream=null,o.prototype.ontrack=null,o.prototype.onremovestream=null,o.prototype.onsignalingstatechange=null,o.prototype.oniceconnectionstatechange=null,o.prototype.onconnectionstatechange=null,o.prototype.onicegatheringstatechange=null,o.prototype.onnegotiationneeded=null,o.prototype.ondatachannel=null,o.prototype._dispatchEvent=function(f,g){this._isClosed||(this.dispatchEvent(g),"function"==typeof this["on"+f]&&this["on"+f](g))},o.prototype._emitGatheringStateChange=function(){var f=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",f)},o.prototype.getConfiguration=function(){return this._config},o.prototype.getLocalStreams=function(){return this.localStreams},o.prototype.getRemoteStreams=function(){return this.remoteStreams},o.prototype._createTransceiver=function(f,g){var _={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:f,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&this.transceivers.length>0)_.iceTransport=this.transceivers[0].iceTransport,_.dtlsTransport=this.transceivers[0].dtlsTransport;else{var x=this._createIceAndDtlsTransports();_.iceTransport=x.iceTransport,_.dtlsTransport=x.dtlsTransport}return g||this.transceivers.push(_),_},o.prototype.addTrack=function(f,g){if(this._isClosed)throw u("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(D){return D.track===f}))throw u("InvalidAccessError","Track already exists.");for(var _,x=0;x<this.transceivers.length;x++)!this.transceivers[x].track&&this.transceivers[x].kind===f.kind&&(_=this.transceivers[x]);return _||(_=this._createTransceiver(f.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(g)&&this.localStreams.push(g),_.track=f,_.stream=g,_.rtpSender=new d.RTCRtpSender(f,_.dtlsTransport),_.rtpSender},o.prototype.addStream=function(f){var g=this;if(S>=15025)f.getTracks().forEach(function(_){g.addTrack(_,f)});else{var C=f.clone();f.getTracks().forEach(function(_,x){var D=C.getTracks()[x];_.addEventListener("enabled",function(R){D.enabled=R.enabled})}),C.getTracks().forEach(function(_){g.addTrack(_,C)})}},o.prototype.removeTrack=function(f){if(this._isClosed)throw u("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(f instanceof d.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var g=this.transceivers.find(function(x){return x.rtpSender===f});if(!g)throw u("InvalidAccessError","Sender was not created by this connection.");var C=g.stream;g.rtpSender.stop(),g.rtpSender=null,g.track=null,g.stream=null,-1===this.transceivers.map(function(x){return x.stream}).indexOf(C)&&this.localStreams.indexOf(C)>-1&&this.localStreams.splice(this.localStreams.indexOf(C),1),this._maybeFireNegotiationNeeded()},o.prototype.removeStream=function(f){var g=this;f.getTracks().forEach(function(C){var _=g.getSenders().find(function(x){return x.track===C});_&&g.removeTrack(_)})},o.prototype.getSenders=function(){return this.transceivers.filter(function(f){return!!f.rtpSender}).map(function(f){return f.rtpSender})},o.prototype.getReceivers=function(){return this.transceivers.filter(function(f){return!!f.rtpReceiver}).map(function(f){return f.rtpReceiver})},o.prototype._createIceGatherer=function(f,g){var C=this;if(g&&f>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var _=new d.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(_,"state",{value:"new",writable:!0}),this.transceivers[f].bufferedCandidateEvents=[],this.transceivers[f].bufferCandidates=function(x){var D=!x.candidate||0===Object.keys(x.candidate).length;_.state=D?"completed":"gathering",null!==C.transceivers[f].bufferedCandidateEvents&&C.transceivers[f].bufferedCandidateEvents.push(x)},_.addEventListener("localcandidate",this.transceivers[f].bufferCandidates),_},o.prototype._gather=function(f,g){var C=this,_=this.transceivers[g].iceGatherer;if(!_.onlocalcandidate){var x=this.transceivers[g].bufferedCandidateEvents;this.transceivers[g].bufferedCandidateEvents=null,_.removeEventListener("localcandidate",this.transceivers[g].bufferCandidates),_.onlocalcandidate=function(D){if(!(C.usingBundle&&g>0)){var R=new Event("icecandidate");R.candidate={sdpMid:f,sdpMLineIndex:g};var N=D.candidate,P=!N||0===Object.keys(N).length;if(P)("new"===_.state||"gathering"===_.state)&&(_.state="completed");else{"new"===_.state&&(_.state="gathering"),N.component=1,N.ufrag=_.getLocalParameters().usernameFragment;var B=p.writeCandidate(N);R.candidate=Object.assign(R.candidate,p.parseCandidate(B)),R.candidate.candidate=B,R.candidate.toJSON=function(){return{candidate:R.candidate.candidate,sdpMid:R.candidate.sdpMid,sdpMLineIndex:R.candidate.sdpMLineIndex,usernameFragment:R.candidate.usernameFragment}}}var j=p.getMediaSections(C._localDescription.sdp);j[R.candidate.sdpMLineIndex]+=P?"a=end-of-candidates\r\n":"a="+R.candidate.candidate+"\r\n",C._localDescription.sdp=p.getDescription(C._localDescription.sdp)+j.join("");var K=C.transceivers.every(function(W){return W.iceGatherer&&"completed"===W.iceGatherer.state});"gathering"!==C.iceGatheringState&&(C.iceGatheringState="gathering",C._emitGatheringStateChange()),P||C._dispatchEvent("icecandidate",R),K&&(C._dispatchEvent("icecandidate",new Event("icecandidate")),C.iceGatheringState="complete",C._emitGatheringStateChange())}},d.setTimeout(function(){x.forEach(function(D){_.onlocalcandidate(D)})},0)}},o.prototype._createIceAndDtlsTransports=function(){var f=this,g=new d.RTCIceTransport(null);g.onicestatechange=function(){f._updateIceConnectionState(),f._updateConnectionState()};var C=new d.RTCDtlsTransport(g);return C.ondtlsstatechange=function(){f._updateConnectionState()},C.onerror=function(){Object.defineProperty(C,"state",{value:"failed",writable:!0}),f._updateConnectionState()},{iceTransport:g,dtlsTransport:C}},o.prototype._disposeIceAndDtlsTransports=function(f){var g=this.transceivers[f].iceGatherer;g&&(delete g.onlocalcandidate,delete this.transceivers[f].iceGatherer);var C=this.transceivers[f].iceTransport;C&&(delete C.onicestatechange,delete this.transceivers[f].iceTransport);var _=this.transceivers[f].dtlsTransport;_&&(delete _.ondtlsstatechange,delete _.onerror,delete this.transceivers[f].dtlsTransport)},o.prototype._transceive=function(f,g,C){var _=L(f.localCapabilities,f.remoteCapabilities);g&&f.rtpSender&&(_.encodings=f.sendEncodingParameters,_.rtcp={cname:p.localCName,compound:f.rtcpParameters.compound},f.recvEncodingParameters.length&&(_.rtcp.ssrc=f.recvEncodingParameters[0].ssrc),f.rtpSender.send(_)),C&&f.rtpReceiver&&_.codecs.length>0&&("video"===f.kind&&f.recvEncodingParameters&&S<15019&&f.recvEncodingParameters.forEach(function(x){delete x.rtx}),_.encodings=f.recvEncodingParameters.length?f.recvEncodingParameters:[{}],_.rtcp={compound:f.rtcpParameters.compound},f.rtcpParameters.cname&&(_.rtcp.cname=f.rtcpParameters.cname),f.sendEncodingParameters.length&&(_.rtcp.ssrc=f.sendEncodingParameters[0].ssrc),f.rtpReceiver.receive(_))},o.prototype.setLocalDescription=function(f){var C,_,g=this;if(-1===["offer","answer"].indexOf(f.type))return Promise.reject(u("TypeError",'Unsupported type "'+f.type+'"'));if(!te("setLocalDescription",f.type,g.signalingState)||g._isClosed)return Promise.reject(u("InvalidStateError","Can not set local "+f.type+" in state "+g.signalingState));if("offer"===f.type)C=p.splitSections(f.sdp),_=C.shift(),C.forEach(function(D,R){var N=p.parseRtpParameters(D);g.transceivers[R].localCapabilities=N}),g.transceivers.forEach(function(D,R){g._gather(D.mid,R)});else if("answer"===f.type){C=p.splitSections(g._remoteDescription.sdp),_=C.shift();var x=p.matchPrefix(_,"a=ice-lite").length>0;C.forEach(function(D,R){var N=g.transceivers[R],P=N.iceGatherer,B=N.iceTransport,j=N.dtlsTransport,K=N.localCapabilities,W=N.remoteCapabilities;if(!(p.isRejected(D)&&0===p.matchPrefix(D,"a=bundle-only").length||N.rejected)){var se=p.getIceParameters(D,_),oe=p.getDtlsParameters(D,_);x&&(oe.role="server"),(!g.usingBundle||0===R)&&(g._gather(N.mid,R),"new"===B.state&&B.start(P,se,x?"controlling":"controlled"),"new"===j.state&&j.start(oe));var ie=L(K,W);g._transceive(N,ie.codecs.length>0,!1)}})}return g._localDescription={type:f.type,sdp:f.sdp},g._updateSignalingState("offer"===f.type?"have-local-offer":"stable"),Promise.resolve()},o.prototype.setRemoteDescription=function(f){var g=this;if(-1===["offer","answer"].indexOf(f.type))return Promise.reject(u("TypeError",'Unsupported type "'+f.type+'"'));if(!te("setRemoteDescription",f.type,g.signalingState)||g._isClosed)return Promise.reject(u("InvalidStateError","Can not set remote "+f.type+" in state "+g.signalingState));var C={};g.remoteStreams.forEach(function(B){C[B.id]=B});var _=[],x=p.splitSections(f.sdp),D=x.shift(),R=p.matchPrefix(D,"a=ice-lite").length>0,N=p.matchPrefix(D,"a=group:BUNDLE ").length>0;g.usingBundle=N;var P=p.matchPrefix(D,"a=ice-options:")[0];return g.canTrickleIceCandidates=!!P&&P.substr(14).split(" ").indexOf("trickle")>=0,x.forEach(function(B,j){var K=p.splitLines(B),W=p.getKind(B),X=p.isRejected(B)&&0===p.matchPrefix(B,"a=bundle-only").length,se=K[0].substr(2).split(" ")[2],oe=p.getDirection(B,D),ie=p.parseMsid(B),De=p.getMid(B)||p.generateIdentifier();if(X||"application"===W&&("DTLS/SCTP"===se||"UDP/DTLS/SCTP"===se))g.transceivers[j]={mid:De,kind:W,protocol:se,rejected:!0};else{!X&&g.transceivers[j]&&g.transceivers[j].rejected&&(g.transceivers[j]=g._createTransceiver(W,!0));var $,Fe,be,Ue,ae,Se,We,Pe,ve,Xe,Be,Me=p.parseRtpParameters(B);X||(Xe=p.getIceParameters(B,D),(Be=p.getDtlsParameters(B,D)).role="client"),We=p.parseRtpEncodingParameters(B);var $e=p.parseRtcpParameters(B),et=p.matchPrefix(B,"a=end-of-candidates",D).length>0,xe=p.matchPrefix(B,"a=candidate:").map(function(ce){return p.parseCandidate(ce)}).filter(function(ce){return 1===ce.component});if(("offer"===f.type||"answer"===f.type)&&!X&&N&&j>0&&g.transceivers[j]&&(g._disposeIceAndDtlsTransports(j),g.transceivers[j].iceGatherer=g.transceivers[0].iceGatherer,g.transceivers[j].iceTransport=g.transceivers[0].iceTransport,g.transceivers[j].dtlsTransport=g.transceivers[0].dtlsTransport,g.transceivers[j].rtpSender&&g.transceivers[j].rtpSender.setTransport(g.transceivers[0].dtlsTransport),g.transceivers[j].rtpReceiver&&g.transceivers[j].rtpReceiver.setTransport(g.transceivers[0].dtlsTransport)),"offer"!==f.type||X)"answer"!==f.type||X||(Fe=($=g.transceivers[j]).iceGatherer,be=$.iceTransport,Ue=$.dtlsTransport,ae=$.rtpReceiver,Se=$.sendEncodingParameters,Pe=$.localCapabilities,g.transceivers[j].recvEncodingParameters=We,g.transceivers[j].remoteCapabilities=Me,g.transceivers[j].rtcpParameters=$e,xe.length&&"new"===be.state&&(!R&&!et||N&&0!==j?xe.forEach(function(ce){ne($.iceTransport,ce)}):be.setRemoteCandidates(xe)),(!N||0===j)&&("new"===be.state&&be.start(Fe,Xe,"controlling"),"new"===Ue.state&&Ue.start(Be)),!L($.localCapabilities,$.remoteCapabilities).codecs.filter(function(ce){return"rtx"===ce.name.toLowerCase()}).length&&$.sendEncodingParameters[0].rtx&&delete $.sendEncodingParameters[0].rtx,g._transceive($,"sendrecv"===oe||"recvonly"===oe,"sendrecv"===oe||"sendonly"===oe),!ae||"sendrecv"!==oe&&"sendonly"!==oe?delete $.rtpReceiver:(ve=ae.track,ie?(C[ie.stream]||(C[ie.stream]=new d.MediaStream),M(ve,C[ie.stream]),_.push([ve,ae,C[ie.stream]])):(C.default||(C.default=new d.MediaStream),M(ve,C.default),_.push([ve,ae,C.default]))));else{($=g.transceivers[j]||g._createTransceiver(W)).mid=De,$.iceGatherer||($.iceGatherer=g._createIceGatherer(j,N)),xe.length&&"new"===$.iceTransport.state&&(!et||N&&0!==j?xe.forEach(function(ce){ne($.iceTransport,ce)}):$.iceTransport.setRemoteCandidates(xe)),Pe=d.RTCRtpReceiver.getCapabilities(W),S<15019&&(Pe.codecs=Pe.codecs.filter(function(ce){return"rtx"!==ce.name})),Se=$.sendEncodingParameters||[{ssrc:1001*(2*j+2)}];var ke,Oe=!1;"sendrecv"===oe||"sendonly"===oe?(Oe=!$.rtpReceiver,ae=$.rtpReceiver||new d.RTCRtpReceiver($.dtlsTransport,W),Oe&&(ve=ae.track,ie&&"-"===ie.stream||(ie?(C[ie.stream]||(C[ie.stream]=new d.MediaStream,Object.defineProperty(C[ie.stream],"id",{get:function(){return ie.stream}})),Object.defineProperty(ve,"id",{get:function(){return ie.track}}),ke=C[ie.stream]):(C.default||(C.default=new d.MediaStream),ke=C.default)),ke&&(M(ve,ke),$.associatedRemoteMediaStreams.push(ke)),_.push([ve,ae,ke]))):$.rtpReceiver&&$.rtpReceiver.track&&($.associatedRemoteMediaStreams.forEach(function(ce){var fe=ce.getTracks().find(function(rt){return rt.id===$.rtpReceiver.track.id});fe&&function I(f,g){g.removeTrack(f),g.dispatchEvent(new d.MediaStreamTrackEvent("removetrack",{track:f}))}(fe,ce)}),$.associatedRemoteMediaStreams=[]),$.localCapabilities=Pe,$.remoteCapabilities=Me,$.rtpReceiver=ae,$.rtcpParameters=$e,$.sendEncodingParameters=Se,$.recvEncodingParameters=We,g._transceive(g.transceivers[j],!1,Oe)}}}),void 0===g._dtlsRole&&(g._dtlsRole="offer"===f.type?"active":"passive"),g._remoteDescription={type:f.type,sdp:f.sdp},g._updateSignalingState("offer"===f.type?"have-remote-offer":"stable"),Object.keys(C).forEach(function(B){var j=C[B];if(j.getTracks().length){if(-1===g.remoteStreams.indexOf(j)){g.remoteStreams.push(j);var K=new Event("addstream");K.stream=j,d.setTimeout(function(){g._dispatchEvent("addstream",K)})}_.forEach(function(W){j.id===W[2].id&&F(g,W[0],W[1],[j])})}}),_.forEach(function(B){B[2]||F(g,B[0],B[1],[])}),d.setTimeout(function(){g&&g.transceivers&&g.transceivers.forEach(function(B){B.iceTransport&&"new"===B.iceTransport.state&&B.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),B.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},o.prototype.close=function(){this.transceivers.forEach(function(f){f.iceTransport&&f.iceTransport.stop(),f.dtlsTransport&&f.dtlsTransport.stop(),f.rtpSender&&f.rtpSender.stop(),f.rtpReceiver&&f.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},o.prototype._updateSignalingState=function(f){this.signalingState=f;var g=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",g)},o.prototype._maybeFireNegotiationNeeded=function(){var f=this;"stable"!==this.signalingState||!0===this.needNegotiation||(this.needNegotiation=!0,d.setTimeout(function(){if(f.needNegotiation){f.needNegotiation=!1;var g=new Event("negotiationneeded");f._dispatchEvent("negotiationneeded",g)}},0))},o.prototype._updateIceConnectionState=function(){var f,g={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(_){_.iceTransport&&!_.rejected&&g[_.iceTransport.state]++}),f="new",g.failed>0?f="failed":g.checking>0?f="checking":g.disconnected>0?f="disconnected":g.new>0?f="new":g.connected>0?f="connected":g.completed>0&&(f="completed"),f!==this.iceConnectionState){this.iceConnectionState=f;var C=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",C)}},o.prototype._updateConnectionState=function(){var f,g={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(_){_.iceTransport&&_.dtlsTransport&&!_.rejected&&(g[_.iceTransport.state]++,g[_.dtlsTransport.state]++)}),g.connected+=g.completed,f="new",g.failed>0?f="failed":g.connecting>0?f="connecting":g.disconnected>0?f="disconnected":g.new>0?f="new":g.connected>0&&(f="connected"),f!==this.connectionState){this.connectionState=f;var C=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",C)}},o.prototype.createOffer=function(){var f=this;if(f._isClosed)return Promise.reject(u("InvalidStateError","Can not call createOffer after close"));var g=f.transceivers.filter(function(R){return"audio"===R.kind}).length,C=f.transceivers.filter(function(R){return"video"===R.kind}).length,_=arguments[0];if(_){if(_.mandatory||_.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==_.offerToReceiveAudio&&(g=!0===_.offerToReceiveAudio?1:!1===_.offerToReceiveAudio?0:_.offerToReceiveAudio),void 0!==_.offerToReceiveVideo&&(C=!0===_.offerToReceiveVideo?1:!1===_.offerToReceiveVideo?0:_.offerToReceiveVideo)}for(f.transceivers.forEach(function(R){"audio"===R.kind?--g<0&&(R.wantReceive=!1):"video"===R.kind&&--C<0&&(R.wantReceive=!1)});g>0||C>0;)g>0&&(f._createTransceiver("audio"),g--),C>0&&(f._createTransceiver("video"),C--);var x=p.writeSessionBoilerplate(f._sdpSessionId,f._sdpSessionVersion++);f.transceivers.forEach(function(R,N){var P=R.track,B=R.kind,j=R.mid||p.generateIdentifier();R.mid=j,R.iceGatherer||(R.iceGatherer=f._createIceGatherer(N,f.usingBundle));var K=d.RTCRtpSender.getCapabilities(B);S<15019&&(K.codecs=K.codecs.filter(function(X){return"rtx"!==X.name})),K.codecs.forEach(function(X){"H264"===X.name&&void 0===X.parameters["level-asymmetry-allowed"]&&(X.parameters["level-asymmetry-allowed"]="1"),R.remoteCapabilities&&R.remoteCapabilities.codecs&&R.remoteCapabilities.codecs.forEach(function(se){X.name.toLowerCase()===se.name.toLowerCase()&&X.clockRate===se.clockRate&&(X.preferredPayloadType=se.payloadType)})}),K.headerExtensions.forEach(function(X){(R.remoteCapabilities&&R.remoteCapabilities.headerExtensions||[]).forEach(function(oe){X.uri===oe.uri&&(X.id=oe.id)})});var W=R.sendEncodingParameters||[{ssrc:1001*(2*N+1)}];P&&S>=15019&&"video"===B&&!W[0].rtx&&(W[0].rtx={ssrc:W[0].ssrc+1}),R.wantReceive&&(R.rtpReceiver=new d.RTCRtpReceiver(R.dtlsTransport,B)),R.localCapabilities=K,R.sendEncodingParameters=W}),"max-compat"!==f._config.bundlePolicy&&(x+="a=group:BUNDLE "+f.transceivers.map(function(R){return R.mid}).join(" ")+"\r\n"),x+="a=ice-options:trickle\r\n",f.transceivers.forEach(function(R,N){x+=k(R,R.localCapabilities,"offer",R.stream,f._dtlsRole),x+="a=rtcp-rsize\r\n",R.iceGatherer&&"new"!==f.iceGatheringState&&(0===N||!f.usingBundle)&&(R.iceGatherer.getLocalCandidates().forEach(function(P){P.component=1,x+="a="+p.writeCandidate(P)+"\r\n"}),"completed"===R.iceGatherer.state&&(x+="a=end-of-candidates\r\n"))});var D=new d.RTCSessionDescription({type:"offer",sdp:x});return Promise.resolve(D)},o.prototype.createAnswer=function(){var f=this;if(f._isClosed)return Promise.reject(u("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==f.signalingState&&"have-local-pranswer"!==f.signalingState)return Promise.reject(u("InvalidStateError","Can not call createAnswer in signalingState "+f.signalingState));var g=p.writeSessionBoilerplate(f._sdpSessionId,f._sdpSessionVersion++);f.usingBundle&&(g+="a=group:BUNDLE "+f.transceivers.map(function(x){return x.mid}).join(" ")+"\r\n"),g+="a=ice-options:trickle\r\n";var C=p.getMediaSections(f._remoteDescription.sdp).length;f.transceivers.forEach(function(x,D){if(!(D+1>C)){if(x.rejected)return"application"===x.kind?g+="DTLS/SCTP"===x.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+x.protocol+" webrtc-datachannel\r\n":"audio"===x.kind?g+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===x.kind&&(g+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(g+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+x.mid+"\r\n");var R;x.stream&&("audio"===x.kind?R=x.stream.getAudioTracks()[0]:"video"===x.kind&&(R=x.stream.getVideoTracks()[0]),R&&S>=15019&&"video"===x.kind&&!x.sendEncodingParameters[0].rtx&&(x.sendEncodingParameters[0].rtx={ssrc:x.sendEncodingParameters[0].ssrc+1}));var N=L(x.localCapabilities,x.remoteCapabilities);!N.codecs.filter(function(B){return"rtx"===B.name.toLowerCase()}).length&&x.sendEncodingParameters[0].rtx&&delete x.sendEncodingParameters[0].rtx,g+=k(x,N,"answer",x.stream,f._dtlsRole),x.rtcpParameters&&x.rtcpParameters.reducedSize&&(g+="a=rtcp-rsize\r\n")}});var _=new d.RTCSessionDescription({type:"answer",sdp:g});return Promise.resolve(_)},o.prototype.addIceCandidate=function(f){var C,g=this;return f&&void 0===f.sdpMLineIndex&&!f.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(_,x){if(!g._remoteDescription)return x(u("InvalidStateError","Can not add ICE candidate without a remote description"));if(f&&""!==f.candidate){var R=f.sdpMLineIndex;if(f.sdpMid)for(var N=0;N<g.transceivers.length;N++)if(g.transceivers[N].mid===f.sdpMid){R=N;break}var P=g.transceivers[R];if(!P)return x(u("OperationError","Can not add ICE candidate"));if(P.rejected)return _();var B=Object.keys(f.candidate).length>0?p.parseCandidate(f.candidate):{};if("tcp"===B.protocol&&(0===B.port||9===B.port)||B.component&&1!==B.component)return _();if((0===R||R>0&&P.iceTransport!==g.transceivers[0].iceTransport)&&!ne(P.iceTransport,B))return x(u("OperationError","Can not add ICE candidate"));var j=f.candidate.trim();0===j.indexOf("a=")&&(j=j.substr(2)),(C=p.getMediaSections(g._remoteDescription.sdp))[R]+="a="+(B.type?j:"end-of-candidates")+"\r\n",g._remoteDescription.sdp=p.getDescription(g._remoteDescription.sdp)+C.join("")}else for(var D=0;D<g.transceivers.length&&(g.transceivers[D].rejected||(g.transceivers[D].iceTransport.addRemoteCandidate({}),(C=p.getMediaSections(g._remoteDescription.sdp))[D]+="a=end-of-candidates\r\n",g._remoteDescription.sdp=p.getDescription(g._remoteDescription.sdp)+C.join(""),!g.usingBundle));D++);_()})},o.prototype.getStats=function(f){if(f&&f instanceof d.MediaStreamTrack){var g=null;if(this.transceivers.forEach(function(_){_.rtpSender&&_.rtpSender.track===f?g=_.rtpSender:_.rtpReceiver&&_.rtpReceiver.track===f&&(g=_.rtpReceiver)}),!g)throw u("InvalidAccessError","Invalid selector.");return g.getStats()}var C=[];return this.transceivers.forEach(function(_){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(x){_[x]&&C.push(_[x].getStats())})}),Promise.all(C).then(function(_){var x=new Map;return _.forEach(function(D){D.forEach(function(R){x.set(R.id,R)})}),x})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(f){var g=d[f];if(g&&g.prototype&&g.prototype.getStats){var C=g.prototype.getStats;g.prototype.getStats=function(){return C.apply(this).then(function(_){var x=new Map;return Object.keys(_).forEach(function(D){_[D].type=function y(d){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type}(_[D]),x.set(D,_[D])}),x})}}});var U=["createOffer","createAnswer"];return U.forEach(function(f){var g=o.prototype[f];o.prototype[f]=function(){var C=arguments;return"function"==typeof C[0]||"function"==typeof C[1]?g.apply(this,[arguments[2]]).then(function(_){"function"==typeof C[0]&&C[0].apply(null,[_])},function(_){"function"==typeof C[1]&&C[1].apply(null,[_])}):g.apply(this,arguments)}}),(U=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(f){var g=o.prototype[f];o.prototype[f]=function(){var C=arguments;return"function"==typeof C[1]||"function"==typeof C[2]?g.apply(this,arguments).then(function(){"function"==typeof C[1]&&C[1].apply(null)},function(_){"function"==typeof C[2]&&C[2].apply(null,[_])}):g.apply(this,arguments)}}),["getStats"].forEach(function(f){var g=o.prototype[f];o.prototype[f]=function(){var C=arguments;return"function"==typeof C[1]?g.apply(this,arguments).then(function(){"function"==typeof C[1]&&C[1].apply(null)}):g.apply(this,arguments)}}),o}},7463:ge=>{"use strict";var b={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};b.localCName=b.generateIdentifier(),b.splitLines=function(l){return l.trim().split("\n").map(function(p){return p.trim()})},b.splitSections=function(l){return l.split("\nm=").map(function(y,k){return(k>0?"m="+y:y).trim()+"\r\n"})},b.getDescription=function(l){var p=b.splitSections(l);return p&&p[0]},b.getMediaSections=function(l){var p=b.splitSections(l);return p.shift(),p},b.matchPrefix=function(l,p){return b.splitLines(l).filter(function(y){return 0===y.indexOf(p)})},b.parseCandidate=function(l){for(var p,y={foundation:(p=0===l.indexOf("a=candidate:")?l.substring(12).split(" "):l.substring(10).split(" "))[0],component:parseInt(p[1],10),protocol:p[2].toLowerCase(),priority:parseInt(p[3],10),ip:p[4],address:p[4],port:parseInt(p[5],10),type:p[7]},k=8;k<p.length;k+=2)switch(p[k]){case"raddr":y.relatedAddress=p[k+1];break;case"rport":y.relatedPort=parseInt(p[k+1],10);break;case"tcptype":y.tcpType=p[k+1];break;case"ufrag":y.ufrag=p[k+1],y.usernameFragment=p[k+1];break;default:y[p[k]]=p[k+1]}return y},b.writeCandidate=function(l){var p=[];p.push(l.foundation),p.push(l.component),p.push(l.protocol.toUpperCase()),p.push(l.priority),p.push(l.address||l.ip),p.push(l.port);var y=l.type;return p.push("typ"),p.push(y),"host"!==y&&l.relatedAddress&&l.relatedPort&&(p.push("raddr"),p.push(l.relatedAddress),p.push("rport"),p.push(l.relatedPort)),l.tcpType&&"tcp"===l.protocol.toLowerCase()&&(p.push("tcptype"),p.push(l.tcpType)),(l.usernameFragment||l.ufrag)&&(p.push("ufrag"),p.push(l.usernameFragment||l.ufrag)),"candidate:"+p.join(" ")},b.parseIceOptions=function(l){return l.substr(14).split(" ")},b.parseRtpMap=function(l){var p=l.substr(9).split(" "),y={payloadType:parseInt(p.shift(),10)};return p=p[0].split("/"),y.name=p[0],y.clockRate=parseInt(p[1],10),y.channels=3===p.length?parseInt(p[2],10):1,y.numChannels=y.channels,y},b.writeRtpMap=function(l){var p=l.payloadType;void 0!==l.preferredPayloadType&&(p=l.preferredPayloadType);var y=l.channels||l.numChannels||1;return"a=rtpmap:"+p+" "+l.name+"/"+l.clockRate+(1!==y?"/"+y:"")+"\r\n"},b.parseExtmap=function(l){var p=l.substr(9).split(" ");return{id:parseInt(p[0],10),direction:p[0].indexOf("/")>0?p[0].split("/")[1]:"sendrecv",uri:p[1]}},b.writeExtmap=function(l){return"a=extmap:"+(l.id||l.preferredId)+(l.direction&&"sendrecv"!==l.direction?"/"+l.direction:"")+" "+l.uri+"\r\n"},b.parseFmtp=function(l){for(var y,p={},k=l.substr(l.indexOf(" ")+1).split(";"),E=0;E<k.length;E++)p[(y=k[E].trim().split("="))[0].trim()]=y[1];return p},b.writeFmtp=function(l){var p="",y=l.payloadType;if(void 0!==l.preferredPayloadType&&(y=l.preferredPayloadType),l.parameters&&Object.keys(l.parameters).length){var k=[];Object.keys(l.parameters).forEach(function(E){k.push(l.parameters[E]?E+"="+l.parameters[E]:E)}),p+="a=fmtp:"+y+" "+k.join(";")+"\r\n"}return p},b.parseRtcpFb=function(l){var p=l.substr(l.indexOf(" ")+1).split(" ");return{type:p.shift(),parameter:p.join(" ")}},b.writeRtcpFb=function(l){var p="",y=l.payloadType;return void 0!==l.preferredPayloadType&&(y=l.preferredPayloadType),l.rtcpFeedback&&l.rtcpFeedback.length&&l.rtcpFeedback.forEach(function(k){p+="a=rtcp-fb:"+y+" "+k.type+(k.parameter&&k.parameter.length?" "+k.parameter:"")+"\r\n"}),p},b.parseSsrcMedia=function(l){var p=l.indexOf(" "),y={ssrc:parseInt(l.substr(7,p-7),10)},k=l.indexOf(":",p);return k>-1?(y.attribute=l.substr(p+1,k-p-1),y.value=l.substr(k+1)):y.attribute=l.substr(p+1),y},b.parseSsrcGroup=function(l){var p=l.substr(13).split(" ");return{semantics:p.shift(),ssrcs:p.map(function(y){return parseInt(y,10)})}},b.getMid=function(l){var p=b.matchPrefix(l,"a=mid:")[0];if(p)return p.substr(6)},b.parseFingerprint=function(l){var p=l.substr(14).split(" ");return{algorithm:p[0].toLowerCase(),value:p[1]}},b.getDtlsParameters=function(l,p){return{role:"auto",fingerprints:b.matchPrefix(l+p,"a=fingerprint:").map(b.parseFingerprint)}},b.writeDtlsParameters=function(l,p){var y="a=setup:"+p+"\r\n";return l.fingerprints.forEach(function(k){y+="a=fingerprint:"+k.algorithm+" "+k.value+"\r\n"}),y},b.parseCryptoLine=function(l){var p=l.substr(9).split(" ");return{tag:parseInt(p[0],10),cryptoSuite:p[1],keyParams:p[2],sessionParams:p.slice(3)}},b.writeCryptoLine=function(l){return"a=crypto:"+l.tag+" "+l.cryptoSuite+" "+("object"==typeof l.keyParams?b.writeCryptoKeyParams(l.keyParams):l.keyParams)+(l.sessionParams?" "+l.sessionParams.join(" "):"")+"\r\n"},b.parseCryptoKeyParams=function(l){if(0!==l.indexOf("inline:"))return null;var p=l.substr(7).split("|");return{keyMethod:"inline",keySalt:p[0],lifeTime:p[1],mkiValue:p[2]?p[2].split(":")[0]:void 0,mkiLength:p[2]?p[2].split(":")[1]:void 0}},b.writeCryptoKeyParams=function(l){return l.keyMethod+":"+l.keySalt+(l.lifeTime?"|"+l.lifeTime:"")+(l.mkiValue&&l.mkiLength?"|"+l.mkiValue+":"+l.mkiLength:"")},b.getCryptoParameters=function(l,p){return b.matchPrefix(l+p,"a=crypto:").map(b.parseCryptoLine)},b.getIceParameters=function(l,p){var y=b.matchPrefix(l+p,"a=ice-ufrag:")[0],k=b.matchPrefix(l+p,"a=ice-pwd:")[0];return y&&k?{usernameFragment:y.substr(12),password:k.substr(10)}:null},b.writeIceParameters=function(l){return"a=ice-ufrag:"+l.usernameFragment+"\r\na=ice-pwd:"+l.password+"\r\n"},b.parseRtpParameters=function(l){for(var p={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},k=b.splitLines(l)[0].split(" "),E=3;E<k.length;E++){var L=k[E],te=b.matchPrefix(l,"a=rtpmap:"+L+" ")[0];if(te){var ne=b.parseRtpMap(te),u=b.matchPrefix(l,"a=fmtp:"+L+" ");switch(ne.parameters=u.length?b.parseFmtp(u[0]):{},ne.rtcpFeedback=b.matchPrefix(l,"a=rtcp-fb:"+L+" ").map(b.parseRtcpFb),p.codecs.push(ne),ne.name.toUpperCase()){case"RED":case"ULPFEC":p.fecMechanisms.push(ne.name.toUpperCase())}}}return b.matchPrefix(l,"a=extmap:").forEach(function(d){p.headerExtensions.push(b.parseExtmap(d))}),p},b.writeRtpDescription=function(l,p){var y="";y+="m="+l+" ",y+=p.codecs.length>0?"9":"0",y+=" UDP/TLS/RTP/SAVPF ",y+=p.codecs.map(function(E){return void 0!==E.preferredPayloadType?E.preferredPayloadType:E.payloadType}).join(" ")+"\r\n",y+="c=IN IP4 0.0.0.0\r\n",y+="a=rtcp:9 IN IP4 0.0.0.0\r\n",p.codecs.forEach(function(E){y+=b.writeRtpMap(E),y+=b.writeFmtp(E),y+=b.writeRtcpFb(E)});var k=0;return p.codecs.forEach(function(E){E.maxptime>k&&(k=E.maxptime)}),k>0&&(y+="a=maxptime:"+k+"\r\n"),y+="a=rtcp-mux\r\n",p.headerExtensions&&p.headerExtensions.forEach(function(E){y+=b.writeExtmap(E)}),y},b.parseRtpEncodingParameters=function(l){var ne,p=[],y=b.parseRtpParameters(l),k=-1!==y.fecMechanisms.indexOf("RED"),E=-1!==y.fecMechanisms.indexOf("ULPFEC"),L=b.matchPrefix(l,"a=ssrc:").map(function(S){return b.parseSsrcMedia(S)}).filter(function(S){return"cname"===S.attribute}),te=L.length>0&&L[0].ssrc,u=b.matchPrefix(l,"a=ssrc-group:FID").map(function(S){return S.substr(17).split(" ").map(function(I){return parseInt(I,10)})});u.length>0&&u[0].length>1&&u[0][0]===te&&(ne=u[0][1]),y.codecs.forEach(function(S){if("RTX"===S.name.toUpperCase()&&S.parameters.apt){var M={ssrc:te,codecPayloadType:parseInt(S.parameters.apt,10)};te&&ne&&(M.rtx={ssrc:ne}),p.push(M),k&&((M=JSON.parse(JSON.stringify(M))).fec={ssrc:te,mechanism:E?"red+ulpfec":"red"},p.push(M))}}),0===p.length&&te&&p.push({ssrc:te});var d=b.matchPrefix(l,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,p.forEach(function(S){S.maxBitrate=d})),p},b.parseRtcpParameters=function(l){var p={},y=b.matchPrefix(l,"a=ssrc:").map(function(L){return b.parseSsrcMedia(L)}).filter(function(L){return"cname"===L.attribute})[0];y&&(p.cname=y.value,p.ssrc=y.ssrc);var k=b.matchPrefix(l,"a=rtcp-rsize");p.reducedSize=k.length>0,p.compound=0===k.length;var E=b.matchPrefix(l,"a=rtcp-mux");return p.mux=E.length>0,p},b.parseMsid=function(l){var p,y=b.matchPrefix(l,"a=msid:");if(1===y.length)return{stream:(p=y[0].substr(7).split(" "))[0],track:p[1]};var k=b.matchPrefix(l,"a=ssrc:").map(function(E){return b.parseSsrcMedia(E)}).filter(function(E){return"msid"===E.attribute});return k.length>0?{stream:(p=k[0].value.split(" "))[0],track:p[1]}:void 0},b.parseSctpDescription=function(l){var k,p=b.parseMLine(l),y=b.matchPrefix(l,"a=max-message-size:");y.length>0&&(k=parseInt(y[0].substr(19),10)),isNaN(k)&&(k=65536);var E=b.matchPrefix(l,"a=sctp-port:");if(E.length>0)return{port:parseInt(E[0].substr(12),10),protocol:p.fmt,maxMessageSize:k};if(b.matchPrefix(l,"a=sctpmap:").length>0){var te=b.matchPrefix(l,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(te[0],10),protocol:te[1],maxMessageSize:k}}},b.writeSctpDescription=function(l,p){var y=[];return y="DTLS/SCTP"!==l.protocol?["m="+l.kind+" 9 "+l.protocol+" "+p.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+p.port+"\r\n"]:["m="+l.kind+" 9 "+l.protocol+" "+p.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+p.port+" "+p.protocol+" 65535\r\n"],void 0!==p.maxMessageSize&&y.push("a=max-message-size:"+p.maxMessageSize+"\r\n"),y.join("")},b.generateSessionId=function(){return Math.random().toString().substr(2,21)},b.writeSessionBoilerplate=function(l,p,y){var E=void 0!==p?p:2;return"v=0\r\no="+(y||"thisisadapterortc")+" "+(l||b.generateSessionId())+" "+E+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},b.writeMediaSection=function(l,p,y,k){var E=b.writeRtpDescription(l.kind,p);if(E+=b.writeIceParameters(l.iceGatherer.getLocalParameters()),E+=b.writeDtlsParameters(l.dtlsTransport.getLocalParameters(),"offer"===y?"actpass":"active"),E+="a=mid:"+l.mid+"\r\n",E+=l.direction?"a="+l.direction+"\r\n":l.rtpSender&&l.rtpReceiver?"a=sendrecv\r\n":l.rtpSender?"a=sendonly\r\n":l.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",l.rtpSender){var L="msid:"+k.id+" "+l.rtpSender.track.id+"\r\n";E+="a="+L,E+="a=ssrc:"+l.sendEncodingParameters[0].ssrc+" "+L,l.sendEncodingParameters[0].rtx&&(E+="a=ssrc:"+l.sendEncodingParameters[0].rtx.ssrc+" "+L,E+="a=ssrc-group:FID "+l.sendEncodingParameters[0].ssrc+" "+l.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return E+="a=ssrc:"+l.sendEncodingParameters[0].ssrc+" cname:"+b.localCName+"\r\n",l.rtpSender&&l.sendEncodingParameters[0].rtx&&(E+="a=ssrc:"+l.sendEncodingParameters[0].rtx.ssrc+" cname:"+b.localCName+"\r\n"),E},b.getDirection=function(l,p){for(var y=b.splitLines(l),k=0;k<y.length;k++)switch(y[k]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return y[k].substr(2)}return p?b.getDirection(p):"sendrecv"},b.getKind=function(l){return b.splitLines(l)[0].split(" ")[0].substr(2)},b.isRejected=function(l){return"0"===l.split(" ",2)[1]},b.parseMLine=function(l){var y=b.splitLines(l)[0].substr(2).split(" ");return{kind:y[0],port:parseInt(y[1],10),protocol:y[2],fmt:y.slice(3).join(" ")}},b.parseOLine=function(l){var y=b.matchPrefix(l,"o=")[0].substr(2).split(" ");return{username:y[0],sessionId:y[1],sessionVersion:parseInt(y[2],10),netType:y[3],addressType:y[4],address:y[5]}},b.isValidSDP=function(l){if("string"!=typeof l||0===l.length)return!1;for(var p=b.splitLines(l),y=0;y<p.length;y++)if(p[y].length<2||"="!==p[y].charAt(1))return!1;return!0},ge.exports=b}}]);