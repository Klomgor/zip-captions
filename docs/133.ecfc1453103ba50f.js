(self.webpackChunkclient=self.webpackChunkclient||[]).push([[133],{9133:(ee,x,p)=>{"use strict";p.r(x),p.d(x,{PeerModule:()=>fa});var h={};p.r(h),p.d(h,{Decoder:()=>Lt,Encoder:()=>mi,PacketType:()=>J,protocol:()=>hn});var _={};p.r(_),p.d(_,{Manager:()=>yt,Socket:()=>Ft,connect:()=>Ie,default:()=>Ie,io:()=>Ie,protocol:()=>hn});var I={};p.r(I),p.d(I,{fixNegotiationNeeded:()=>wn,shimAddTrackRemoveTrack:()=>In,shimAddTrackRemoveTrackWithNative:()=>An,shimGetDisplayMedia:()=>Ci,shimGetSendersWithDtmf:()=>Rn,shimGetStats:()=>Pn,shimGetUserMedia:()=>xn,shimMediaStream:()=>kn,shimOnTrack:()=>En,shimPeerConnection:()=>Ut,shimSenderReceiverGetStats:()=>On});var S={};p.r(S),p.d(S,{shimGetDisplayMedia:()=>Dn,shimGetUserMedia:()=>Bn,shimPeerConnection:()=>Zt,shimReplaceTrack:()=>Mn});var M={};p.r(M),p.d(M,{shimAddTransceiver:()=>$n,shimCreateAnswer:()=>qn,shimCreateOffer:()=>Gn,shimGetDisplayMedia:()=>ki,shimGetParameters:()=>Jn,shimGetUserMedia:()=>Ln,shimOnTrack:()=>Fn,shimPeerConnection:()=>$t,shimRTCDataChannel:()=>Zn,shimReceiverGetStats:()=>Nn,shimRemoveStream:()=>Un,shimSenderGetStats:()=>jn});var U={};p.r(U),p.d(U,{shimAudioContext:()=>er,shimCallbacksAPI:()=>Yn,shimConstraints:()=>Hn,shimCreateOfferLegacy:()=>Xn,shimGetUserMedia:()=>Qn,shimLocalStreamsAPI:()=>zn,shimRTCIceServerUrls:()=>Wn,shimRemoteStreamsAPI:()=>Vn,shimTrackEventTransceiver:()=>Kn});var D={};p.r(D),p.d(D,{removeExtmapAllowMixed:()=>Gt,shimAddIceCandidateNullOrEmpty:()=>St,shimConnectionState:()=>Jt,shimMaxMessageSize:()=>Xe,shimRTCIceCandidate:()=>Ct,shimSendThrowTypeError:()=>et});var f=p(4755),l=p(9401),y=p(9812),A=p(285),T=p(9507),E=p(9129),r=p(2223);const L=new r.OlP("WindowToken",typeof window<"u"&&window.document?{providedIn:"root",factory:()=>window}:{providedIn:"root",factory:()=>{}});var j=p(7579);let d=(()=>{class n{constructor(e,t,o){this.ngZone=e,this.document=t,this.window=o,this.copySubject=new j.x,this.copyResponse$=this.copySubject.asObservable(),this.config={}}configure(e){this.config=e}copy(e){if(!this.isSupported||!e)return this.pushCopyResponse({isSuccess:!1,content:e});const t=this.copyFromContent(e);return this.pushCopyResponse(t?{content:e,isSuccess:t}:{isSuccess:!1,content:e})}get isSupported(){return!!this.document.queryCommandSupported&&!!this.document.queryCommandSupported("copy")&&!!this.window}isTargetValid(e){if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement){if(e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');return!0}throw new Error("Target should be input or textarea")}copyFromInputElement(e,t=!0){try{this.selectTarget(e);const o=this.copyText();return this.clearSelection(t?e:void 0,this.window),o&&this.isCopySuccessInIE11()}catch{return!1}}isCopySuccessInIE11(){const e=this.window.clipboardData;return!(e&&e.getData&&!e.getData("Text"))}copyFromContent(e,t=this.document.body){if(this.tempTextArea&&!t.contains(this.tempTextArea)&&this.destroy(this.tempTextArea.parentElement||void 0),!this.tempTextArea){this.tempTextArea=this.createTempTextArea(this.document,this.window);try{t.appendChild(this.tempTextArea)}catch{throw new Error("Container should be a Dom element")}}this.tempTextArea.value=e;const o=this.copyFromInputElement(this.tempTextArea,!1);return this.config.cleanUpAfterCopy&&this.destroy(this.tempTextArea.parentElement||void 0),o}destroy(e=this.document.body){this.tempTextArea&&(e.removeChild(this.tempTextArea),this.tempTextArea=void 0)}selectTarget(e){return e.select(),e.setSelectionRange(0,e.value.length),e.value.length}copyText(){return this.document.execCommand("copy")}clearSelection(e,t){e&&e.focus(),t.getSelection()?.removeAllRanges()}createTempTextArea(e,t){const o="rtl"===e.documentElement.getAttribute("dir");let s;return s=e.createElement("textarea"),s.style.fontSize="12pt",s.style.border="0",s.style.padding="0",s.style.margin="0",s.style.position="absolute",s.style[o?"right":"left"]="-9999px",s.style.top=(t.pageYOffset||e.documentElement.scrollTop)+"px",s.setAttribute("readonly",""),s}pushCopyResponse(e){this.copySubject.observers.length>0&&this.ngZone.run(()=>{this.copySubject.next(e)})}pushCopyReponse(e){this.pushCopyResponse(e)}}return n.\u0275fac=function(e){return new(e||n)(r.LFG(r.R0b),r.LFG(f.K0),r.LFG(L,8))},n.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),u=(()=>{class n{constructor(e,t,o,s){this.ngZone=e,this.host=t,this.renderer=o,this.clipboardSrv=s,this.cbOnSuccess=new r.vpe,this.cbOnError=new r.vpe,this.onClick=a=>{this.clipboardSrv.isSupported?this.targetElm&&this.clipboardSrv.isTargetValid(this.targetElm)?this.handleResult(this.clipboardSrv.copyFromInputElement(this.targetElm),this.targetElm.value,a):this.cbContent&&this.handleResult(this.clipboardSrv.copyFromContent(this.cbContent,this.container),this.cbContent,a):this.handleResult(!1,void 0,a)}}ngOnInit(){this.ngZone.runOutsideAngular(()=>{this.clickListener=this.renderer.listen(this.host.nativeElement,"click",this.onClick)})}ngOnDestroy(){this.clickListener&&this.clickListener(),this.clipboardSrv.destroy(this.container)}handleResult(e,t,o){let s={isSuccess:e,content:t,successMessage:this.cbSuccessMsg,event:o};e?this.cbOnSuccess.observed&&this.ngZone.run(()=>{this.cbOnSuccess.emit(s)}):this.cbOnError.observed&&this.ngZone.run(()=>{this.cbOnError.emit(s)}),this.clipboardSrv.pushCopyResponse(s)}}return n.\u0275fac=function(e){return new(e||n)(r.Y36(r.R0b),r.Y36(r.SBq),r.Y36(r.Qsj),r.Y36(d))},n.\u0275dir=r.lG2({type:n,selectors:[["","ngxClipboard",""]],inputs:{targetElm:["ngxClipboard","targetElm"],container:"container",cbContent:"cbContent",cbSuccessMsg:"cbSuccessMsg"},outputs:{cbOnSuccess:"cbOnSuccess",cbOnError:"cbOnError"}}),n})(),b=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=r.oAB({type:n}),n.\u0275inj=r.cJS({imports:[f.ez]}),n})();var k=p(3900),B=p(4004),O=p(262),Z=p(9646),w=p(6365),P=p(5855),$=p(9751),oe=p(3099);const Y=Object.create(null);Y.open="0",Y.close="1",Y.ping="2",Y.pong="3",Y.message="4",Y.upgrade="5",Y.noop="6";const K=Object.create(null);Object.keys(Y).forEach(n=>{K[Y[n]]=n});const ce={type:"error",data:"parser error"},ae="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),se="function"==typeof ArrayBuffer,qe=n=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,G=({type:n,data:i},e,t)=>ae&&i instanceof Blob?e?t(i):ze(i,t):se&&(i instanceof ArrayBuffer||qe(i))?e?t(i):ze(new Blob([i]),t):t(Y[n]+(i||"")),ze=(n,i)=>{const e=new FileReader;return e.onload=function(){const t=e.result.split(",")[1];i("b"+(t||""))},e.readAsDataURL(n)};function Pe(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let Be;function ye(n,i){return ae&&n.data instanceof Blob?n.data.arrayBuffer().then(Pe).then(i):se&&(n.data instanceof ArrayBuffer||qe(n.data))?i(Pe(n.data)):void G(n,!1,e=>{Be||(Be=new TextEncoder),i(Be.encode(e))})}const Ee=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<64;n++)Ee["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(n)]=n;const pt="function"==typeof ArrayBuffer,je=(n,i)=>{if("string"!=typeof n)return{type:"message",data:Ye(n,i)};const e=n.charAt(0);return"b"===e?{type:"message",data:Ve(n.substring(1),i)}:K[e]?n.length>1?{type:K[e],data:n.substring(1)}:{type:K[e]}:ce},Ve=(n,i)=>{if(pt){const e=(n=>{let t,s,a,c,g,i=.75*n.length,e=n.length,o=0;"="===n[n.length-1]&&(i--,"="===n[n.length-2]&&i--);const m=new ArrayBuffer(i),C=new Uint8Array(m);for(t=0;t<e;t+=4)s=Ee[n.charCodeAt(t)],a=Ee[n.charCodeAt(t+1)],c=Ee[n.charCodeAt(t+2)],g=Ee[n.charCodeAt(t+3)],C[o++]=s<<2|a>>4,C[o++]=(15&a)<<4|c>>2,C[o++]=(3&c)<<6|63&g;return m})(n);return Ye(e,i)}return{base64:!0,data:n}},Ye=(n,i)=>"blob"===i?n instanceof Blob?n:new Blob([n]):n instanceof ArrayBuffer?n:n.buffer,Qe=String.fromCharCode(30);let Te;function z(n){if(n)return function ft(n){for(var i in z.prototype)n[i]=z.prototype[i];return n}(n)}z.prototype.on=z.prototype.addEventListener=function(n,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(i),this},z.prototype.once=function(n,i){function e(){this.off(n,e),i.apply(this,arguments)}return e.fn=i,this.on(n,e),this},z.prototype.off=z.prototype.removeListener=z.prototype.removeAllListeners=z.prototype.removeEventListener=function(n,i){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var e=this._callbacks["$"+n];if(!e)return this;if(1==arguments.length)return delete this._callbacks["$"+n],this;for(var t,o=0;o<e.length;o++)if((t=e[o])===i||t.fn===i){e.splice(o,1);break}return 0===e.length&&delete this._callbacks["$"+n],this},z.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),e=this._callbacks["$"+n],t=1;t<arguments.length;t++)i[t-1]=arguments[t];if(e){t=0;for(var o=(e=e.slice(0)).length;t<o;++t)e[t].apply(this,i)}return this},z.prototype.emitReserved=z.prototype.emit,z.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]},z.prototype.hasListeners=function(n){return!!this.listeners(n).length};const fe=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function en(n,...i){return i.reduce((e,t)=>(n.hasOwnProperty(t)&&(e[t]=n[t]),e),{})}const Ur=fe.setTimeout,Zr=fe.clearTimeout;function dt(n,i){i.useNativeTimers?(n.setTimeoutFn=Ur.bind(fe),n.clearTimeoutFn=Zr.bind(fe)):(n.setTimeoutFn=fe.setTimeout.bind(fe),n.clearTimeoutFn=fe.clearTimeout.bind(fe))}function Jr(n){return"string"==typeof n?function Gr(n){let i=0,e=0;for(let t=0,o=n.length;t<o;t++)i=n.charCodeAt(t),i<128?e+=1:i<2048?e+=2:i<55296||i>=57344?e+=3:(t++,e+=4);return e}(n):Math.ceil(1.33*(n.byteLength||n.size))}class Vr extends Error{constructor(i,e,t){super(i),this.description=e,this.context=t,this.type="TransportError"}}class Ot extends z{constructor(i){super(),this.writable=!1,dt(this,i),this.opts=i,this.query=i.query,this.socket=i.socket}onError(i,e,t){return super.emitReserved("error",new Vr(i,e,t)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(i){"open"===this.readyState&&this.write(i)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(i){const e=je(i,this.socket.binaryType);this.onPacket(e)}onPacket(i){super.emitReserved("packet",i)}onClose(i){this.readyState="closed",super.emitReserved("close",i)}pause(i){}createUri(i,e={}){return i+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const i=this.opts.hostname;return-1===i.indexOf(":")?i:"["+i+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(i){const e=function qr(n){let i="";for(let e in n)n.hasOwnProperty(e)&&(i.length&&(i+="&"),i+=encodeURIComponent(e)+"="+encodeURIComponent(n[e]));return i}(i);return e.length?"?"+e:""}}const tn="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ht=64,nn={};let on,rn=0,Ae=0;function sn(n){let i="";do{i=tn[n%ht]+i,n=Math.floor(n/ht)}while(n>0);return i}function an(){const n=sn(+new Date);return n!==on?(rn=0,on=n):n+"."+sn(rn++)}for(;Ae<ht;Ae++)nn[tn[Ae]]=Ae;let cn=!1;try{cn=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Yr=cn;function ln(n){const i=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!i||Yr))return new XMLHttpRequest}catch{}if(!i)try{return new(fe[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch{}}function Qr(){}const Hr=null!=new ln({xdomain:!1}).responseType;let mt=(()=>{class n extends z{constructor(e,t){super(),dt(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=void 0!==t.data?t.data:null,this.create()}create(){var e;const t=en(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const o=this.xhr=new ln(t);try{o.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){o.setDisableHeaderCheck&&o.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&o.setRequestHeader(s,this.opts.extraHeaders[s])}}catch{}if("POST"===this.method)try{o.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{o.setRequestHeader("Accept","*/*")}catch{}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(o),"withCredentials"in o&&(o.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(o.timeout=this.opts.requestTimeout),o.onreadystatechange=()=>{var s;3===o.readyState&&(null===(s=this.opts.cookieJar)||void 0===s||s.parseCookies(o)),4===o.readyState&&(200===o.status||1223===o.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof o.status?o.status:0)},0))},o.send(this.data)}catch(s){return void this.setTimeoutFn(()=>{this.onError(s)},0)}typeof document<"u"&&(this.index=n.requestsCount++,n.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||null===this.xhr)){if(this.xhr.onreadystatechange=Qr,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete n.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}return n.requestsCount=0,n.requests={},n})();function pn(){for(let n in mt.requests)mt.requests.hasOwnProperty(n)&&mt.requests[n].abort()}typeof document<"u"&&("function"==typeof attachEvent?attachEvent("onunload",pn):"function"==typeof addEventListener&&addEventListener("onpagehide"in fe?"pagehide":"unload",pn,!1));const At="function"==typeof Promise&&"function"==typeof Promise.resolve?i=>Promise.resolve().then(i):(i,e)=>e(i,0),gt=fe.WebSocket||fe.MozWebSocket,un=typeof navigator<"u"&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();function ei(n,i){return"message"===n.type&&"string"!=typeof n.data&&i[0]>=48&&i[0]<=54}const ni={websocket:class Xr extends Ot{constructor(i){super(i),this.supportsBinary=!i.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const i=this.uri(),e=this.opts.protocols,t=un?{}:en(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(t.headers=this.opts.extraHeaders);try{this.ws=un?new gt(i,e,t):e?new gt(i,e):new gt(i)}catch(o){return this.emitReserved("error",o)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=i=>this.onClose({description:"websocket connection closed",context:i}),this.ws.onmessage=i=>this.onData(i.data),this.ws.onerror=i=>this.onError("websocket error",i)}write(i){this.writable=!1;for(let e=0;e<i.length;e++){const o=e===i.length-1;G(i[e],this.supportsBinary,s=>{try{this.ws.send(s)}catch{}o&&At(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const i=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=an()),this.supportsBinary||(e.b64=1),this.createUri(i,e)}check(){return!!gt}},webtransport:class ti extends Ot{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(i=>{this.onError("webtransport error",i)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(i=>{const e=i.readable.getReader();let t;this.writer=i.writable.getWriter();const o=()=>{e.read().then(({done:a,value:c})=>{a||(t||1!==c.byteLength||54!==c[0]?(this.onPacket(function Pt(n,i,e){return Te||(Te=new TextDecoder),je(i||n[0]<48||n[0]>54?n:Te.decode(n),e)}(c,t,"arraybuffer")),t=!1):t=!0,o())}).catch(a=>{})};o();const s=this.query.sid?`0{"sid":"${this.query.sid}"}`:"0";this.writer.write((new TextEncoder).encode(s)).then(()=>this.onOpen())})}))}write(i){this.writable=!1;for(let e=0;e<i.length;e++){const t=i[e],o=e===i.length-1;ye(t,s=>{ei(t,s)&&this.writer.write(Uint8Array.of(54)),this.writer.write(s).then(()=>{o&&At(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})})}}doClose(){var i;null===(i=this.transport)||void 0===i||i.close()}},polling:class Wr extends Ot{constructor(i){if(super(i),this.polling=!1,typeof location<"u"){const t="https:"===location.protocol;let o=location.port;o||(o=t?"443":"80"),this.xd=typeof location<"u"&&i.hostname!==location.hostname||o!==i.port}this.supportsBinary=Hr&&!(i&&i.forceBase64),this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(i){this.readyState="pausing";const e=()=>{this.readyState="paused",i()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",function(){--t||e()})),this.writable||(t++,this.once("drain",function(){--t||e()}))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(i){((n,i)=>{const e=n.split(Qe),t=[];for(let o=0;o<e.length;o++){const s=je(e[o],i);if(t.push(s),"error"===s.type)break}return t})(i,this.socket.binaryType).forEach(t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const i=()=>{this.write([{type:"close"}])};"open"===this.readyState?i():this.once("open",i)}write(i){this.writable=!1,((n,i)=>{const e=n.length,t=new Array(e);let o=0;n.forEach((s,a)=>{G(s,!1,c=>{t[a]=c,++o===e&&i(t.join(Qe))})})})(i,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const i=this.opts.secure?"https":"http",e=this.query||{};return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=an()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.createUri(i,e)}request(i={}){return Object.assign(i,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new mt(this.uri(),i)}doWrite(i,e){const t=this.request({method:"POST",data:i});t.on("success",e),t.on("error",(o,s)=>{this.onError("xhr post error",o,s)})}doPoll(){const i=this.request();i.on("data",this.onData.bind(this)),i.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=i}}},ri=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ii=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function wt(n){const i=n,e=n.indexOf("["),t=n.indexOf("]");-1!=e&&-1!=t&&(n=n.substring(0,e)+n.substring(e,t).replace(/:/g,";")+n.substring(t,n.length));let o=ri.exec(n||""),s={},a=14;for(;a--;)s[ii[a]]=o[a]||"";return-1!=e&&-1!=t&&(s.source=i,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function oi(n,i){const t=i.replace(/\/{2,9}/g,"/").split("/");return("/"==i.slice(0,1)||0===i.length)&&t.splice(0,1),"/"==i.slice(-1)&&t.splice(t.length-1,1),t}(0,s.path),s.queryKey=function si(n,i){const e={};return i.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(t,o,s){o&&(e[o]=s)}),e}(0,s.query),s}let fn=(()=>{class n extends z{constructor(e,t={}){super(),this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=wt(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=wt(t.host).host),dt(this,t),this.secure=null!=t.secure?t.secure:typeof location<"u"&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function zr(n){let i={},e=n.split("&");for(let t=0,o=e.length;t<o;t++){let s=e[t].split("=");i[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return i}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const o=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new ni[e](o)}open(){let e;if(this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch{return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),o=!1;n.priorWebsocketSuccess=!1;const s=()=>{o||(t.send([{type:"ping",data:"probe"}]),t.once("packet",F=>{if(!o)if("pong"===F.type&&"probe"===F.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;n.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{o||"closed"!==this.readyState&&(R(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const q=new Error("probe error");q.transport=t.name,this.emitReserved("upgradeError",q)}}))};function a(){o||(o=!0,R(),t.close(),t=null)}const c=F=>{const q=new Error("probe error: "+F);q.transport=t.name,a(),this.emitReserved("upgradeError",q)};function g(){c("transport closed")}function m(){c("socket closed")}function C(F){t&&F.name!==t.name&&a()}const R=()=>{t.removeListener("open",s),t.removeListener("error",c),t.removeListener("close",g),this.off("close",m),this.off("upgrading",C)};t.once("open",s),t.once("error",c),t.once("close",g),this.once("close",m),this.once("upgrading",C),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{o||t.open()},200):t.open()}onOpen(){if(this.readyState="open",n.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let o=0;o<this.writeBuffer.length;o++){const s=this.writeBuffer[o].data;if(s&&(t+=Jr(s)),o>0&&t>this.maxPayload)return this.writeBuffer.slice(0,o);t+=2}return this.writeBuffer}write(e,t,o){return this.sendPacket("message",e,t,o),this}send(e,t,o){return this.sendPacket("message",e,t,o),this}sendPacket(e,t,o,s){if("function"==typeof t&&(s=t,t=void 0),"function"==typeof o&&(s=o,o=null),"closing"===this.readyState||"closed"===this.readyState)return;(o=o||{}).compress=!1!==o.compress;const a={type:e,data:t,options:o};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),s&&this.once("flush",s),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},o=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?o():e()}):this.upgrading?o():e()),this}onError(e){n.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let o=0;const s=e.length;for(;o<s;o++)~this.transports.indexOf(e[o])&&t.push(e[o]);return t}}return n.protocol=4,n})();const ci="function"==typeof ArrayBuffer,li=n=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,dn=Object.prototype.toString,pi="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===dn.call(Blob),ui="function"==typeof File||typeof File<"u"&&"[object FileConstructor]"===dn.call(File);function Bt(n){return ci&&(n instanceof ArrayBuffer||li(n))||pi&&n instanceof Blob||ui&&n instanceof File}function vt(n,i){if(!n||"object"!=typeof n)return!1;if(Array.isArray(n)){for(let e=0,t=n.length;e<t;e++)if(vt(n[e]))return!0;return!1}if(Bt(n))return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return vt(n.toJSON(),!0);for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)&&vt(n[e]))return!0;return!1}function fi(n){const i=[],t=n;return t.data=Dt(n.data,i),t.attachments=i.length,{packet:t,buffers:i}}function Dt(n,i){if(!n)return n;if(Bt(n)){const e={_placeholder:!0,num:i.length};return i.push(n),e}if(Array.isArray(n)){const e=new Array(n.length);for(let t=0;t<n.length;t++)e[t]=Dt(n[t],i);return e}if("object"==typeof n&&!(n instanceof Date)){const e={};for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=Dt(n[t],i));return e}return n}function di(n,i){return n.data=Mt(n.data,i),delete n.attachments,n}function Mt(n,i){if(!n)return n;if(n&&!0===n._placeholder){if("number"==typeof n.num&&n.num>=0&&n.num<i.length)return i[n.num];throw new Error("illegal attachments")}if(Array.isArray(n))for(let e=0;e<n.length;e++)n[e]=Mt(n[e],i);else if("object"==typeof n)for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&(n[e]=Mt(n[e],i));return n}const hi=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],hn=5;var J=(()=>((J=J||{})[J.CONNECT=0]="CONNECT",J[J.DISCONNECT=1]="DISCONNECT",J[J.EVENT=2]="EVENT",J[J.ACK=3]="ACK",J[J.CONNECT_ERROR=4]="CONNECT_ERROR",J[J.BINARY_EVENT=5]="BINARY_EVENT",J[J.BINARY_ACK=6]="BINARY_ACK",J))();class mi{constructor(i){this.replacer=i}encode(i){return i.type!==J.EVENT&&i.type!==J.ACK||!vt(i)?[this.encodeAsString(i)]:this.encodeAsBinary({type:i.type===J.EVENT?J.BINARY_EVENT:J.BINARY_ACK,nsp:i.nsp,data:i.data,id:i.id})}encodeAsString(i){let e=""+i.type;return(i.type===J.BINARY_EVENT||i.type===J.BINARY_ACK)&&(e+=i.attachments+"-"),i.nsp&&"/"!==i.nsp&&(e+=i.nsp+","),null!=i.id&&(e+=i.id),null!=i.data&&(e+=JSON.stringify(i.data,this.replacer)),e}encodeAsBinary(i){const e=fi(i),t=this.encodeAsString(e.packet),o=e.buffers;return o.unshift(t),o}}function mn(n){return"[object Object]"===Object.prototype.toString.call(n)}class Lt extends z{constructor(i){super(),this.reviver=i}add(i){let e;if("string"==typeof i){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(i);const t=e.type===J.BINARY_EVENT;t||e.type===J.BINARY_ACK?(e.type=t?J.EVENT:J.ACK,this.reconstructor=new gi(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!Bt(i)&&!i.base64)throw new Error("Unknown type: "+i);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(i),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(i){let e=0;const t={type:Number(i.charAt(0))};if(void 0===J[t.type])throw new Error("unknown packet type "+t.type);if(t.type===J.BINARY_EVENT||t.type===J.BINARY_ACK){const s=e+1;for(;"-"!==i.charAt(++e)&&e!=i.length;);const a=i.substring(s,e);if(a!=Number(a)||"-"!==i.charAt(e))throw new Error("Illegal attachments");t.attachments=Number(a)}if("/"===i.charAt(e+1)){const s=e+1;for(;++e&&","!==i.charAt(e)&&e!==i.length;);t.nsp=i.substring(s,e)}else t.nsp="/";const o=i.charAt(e+1);if(""!==o&&Number(o)==o){const s=e+1;for(;++e;){const a=i.charAt(e);if(null==a||Number(a)!=a){--e;break}if(e===i.length)break}t.id=Number(i.substring(s,e+1))}if(i.charAt(++e)){const s=this.tryParse(i.substr(e));if(!Lt.isPayloadValid(t.type,s))throw new Error("invalid payload");t.data=s}return t}tryParse(i){try{return JSON.parse(i,this.reviver)}catch{return!1}}static isPayloadValid(i,e){switch(i){case J.CONNECT:return mn(e);case J.DISCONNECT:return void 0===e;case J.CONNECT_ERROR:return"string"==typeof e||mn(e);case J.EVENT:case J.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===hi.indexOf(e[0]));case J.ACK:case J.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class gi{constructor(i){this.packet=i,this.buffers=[],this.reconPack=i}takeBinaryData(i){if(this.buffers.push(i),this.buffers.length===this.reconPack.attachments){const e=di(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function be(n,i,e){return n.on(i,e),function(){n.off(i,e)}}const vi=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ft extends z{constructor(i,e,t){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=i,this.nsp=e,t&&t.auth&&(this.auth=t.auth),this._opts=Object.assign({},t),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const i=this.io;this.subs=[be(i,"open",this.onopen.bind(this)),be(i,"packet",this.onpacket.bind(this)),be(i,"error",this.onerror.bind(this)),be(i,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...i){return i.unshift("message"),this.emit.apply(this,i),this}emit(i,...e){if(vi.hasOwnProperty(i))throw new Error('"'+i.toString()+'" is a reserved event name');if(e.unshift(i),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const t={type:J.EVENT,data:e,options:{}};if(t.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){const a=this.ids++,c=e.pop();this._registerAckCallback(a,c),t.id=a}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(t),this.packet(t)):this.sendBuffer.push(t)),this.flags={},this}_registerAckCallback(i,e){var t;const o=null!==(t=this.flags.timeout)&&void 0!==t?t:this._opts.ackTimeout;if(void 0===o)return void(this.acks[i]=e);const s=this.io.setTimeoutFn(()=>{delete this.acks[i];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===i&&this.sendBuffer.splice(a,1);e.call(this,new Error("operation has timed out"))},o);this.acks[i]=(...a)=>{this.io.clearTimeoutFn(s),e.apply(this,[null,...a])}}emitWithAck(i,...e){const t=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((o,s)=>{e.push((a,c)=>t?a?s(a):o(c):o(a)),this.emit(i,...e)})}_addToQueue(i){let e;"function"==typeof i[i.length-1]&&(e=i.pop());const t={id:this._queueSeq++,tryCount:0,pending:!1,args:i,flags:Object.assign({fromQueue:!0},this.flags)};i.push((o,...s)=>t!==this._queue[0]?void 0:(null!==o?t.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(o)):(this._queue.shift(),e&&e(null,...s)),t.pending=!1,this._drainQueue())),this._queue.push(t),this._drainQueue()}_drainQueue(i=!1){if(!this.connected||0===this._queue.length)return;const e=this._queue[0];e.pending&&!i||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(i){i.nsp=this.nsp,this.io._packet(i)}onopen(){"function"==typeof this.auth?this.auth(i=>{this._sendConnectPacket(i)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(i){this.packet({type:J.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},i):i})}onerror(i){this.connected||this.emitReserved("connect_error",i)}onclose(i,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",i,e)}onpacket(i){if(i.nsp===this.nsp)switch(i.type){case J.CONNECT:i.data&&i.data.sid?this.onconnect(i.data.sid,i.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case J.EVENT:case J.BINARY_EVENT:this.onevent(i);break;case J.ACK:case J.BINARY_ACK:this.onack(i);break;case J.DISCONNECT:this.ondisconnect();break;case J.CONNECT_ERROR:this.destroy();const t=new Error(i.data.message);t.data=i.data.data,this.emitReserved("connect_error",t)}}onevent(i){const e=i.data||[];null!=i.id&&e.push(this.ack(i.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(i){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const t of e)t.apply(this,i)}super.emit.apply(this,i),this._pid&&i.length&&"string"==typeof i[i.length-1]&&(this._lastOffset=i[i.length-1])}ack(i){const e=this;let t=!1;return function(...o){t||(t=!0,e.packet({type:J.ACK,id:i,data:o}))}}onack(i){const e=this.acks[i.id];"function"==typeof e&&(e.apply(this,i.data),delete this.acks[i.id])}onconnect(i,e){this.id=i,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(i=>this.emitEvent(i)),this.receiveBuffer=[],this.sendBuffer.forEach(i=>{this.notifyOutgoingListeners(i),this.packet(i)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(i=>i()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:J.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(i){return this.flags.compress=i,this}get volatile(){return this.flags.volatile=!0,this}timeout(i){return this.flags.timeout=i,this}onAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(i),this}prependAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(i),this}offAny(i){if(!this._anyListeners)return this;if(i){const e=this._anyListeners;for(let t=0;t<e.length;t++)if(i===e[t])return e.splice(t,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(i),this}prependAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(i),this}offAnyOutgoing(i){if(!this._anyOutgoingListeners)return this;if(i){const e=this._anyOutgoingListeners;for(let t=0;t<e.length;t++)if(i===e[t])return e.splice(t,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(i){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const t of e)t.apply(this,i.data)}}}function Ne(n){this.ms=(n=n||{}).min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}Ne.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var i=Math.random(),e=Math.floor(i*this.jitter*n);n=1&Math.floor(10*i)?n+e:n-e}return 0|Math.min(n,this.max)},Ne.prototype.reset=function(){this.attempts=0},Ne.prototype.setMin=function(n){this.ms=n},Ne.prototype.setMax=function(n){this.max=n},Ne.prototype.setJitter=function(n){this.jitter=n};class yt extends z{constructor(i,e){var t;super(),this.nsps={},this.subs=[],i&&"object"==typeof i&&(e=i,i=void 0),(e=e||{}).path=e.path||"/socket.io",this.opts=e,dt(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(t=e.randomizationFactor)&&void 0!==t?t:.5),this.backoff=new Ne({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=i;const o=e.parser||h;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(i){return arguments.length?(this._reconnection=!!i,this):this._reconnection}reconnectionAttempts(i){return void 0===i?this._reconnectionAttempts:(this._reconnectionAttempts=i,this)}reconnectionDelay(i){var e;return void 0===i?this._reconnectionDelay:(this._reconnectionDelay=i,null===(e=this.backoff)||void 0===e||e.setMin(i),this)}randomizationFactor(i){var e;return void 0===i?this._randomizationFactor:(this._randomizationFactor=i,null===(e=this.backoff)||void 0===e||e.setJitter(i),this)}reconnectionDelayMax(i){var e;return void 0===i?this._reconnectionDelayMax:(this._reconnectionDelayMax=i,null===(e=this.backoff)||void 0===e||e.setMax(i),this)}timeout(i){return arguments.length?(this._timeout=i,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(i){if(~this._readyState.indexOf("open"))return this;this.engine=new fn(this.uri,this.opts);const e=this.engine,t=this;this._readyState="opening",this.skipReconnect=!1;const o=be(e,"open",function(){t.onopen(),i&&i()}),s=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),i?i(c):this.maybeReconnectOnOpen()},a=be(e,"error",s);if(!1!==this._timeout){const g=this.setTimeoutFn(()=>{o(),s(new Error("timeout")),e.close()},this._timeout);this.opts.autoUnref&&g.unref(),this.subs.push(()=>{this.clearTimeoutFn(g)})}return this.subs.push(o),this.subs.push(a),this}connect(i){return this.open(i)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const i=this.engine;this.subs.push(be(i,"ping",this.onping.bind(this)),be(i,"data",this.ondata.bind(this)),be(i,"error",this.onerror.bind(this)),be(i,"close",this.onclose.bind(this)),be(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(i){try{this.decoder.add(i)}catch(e){this.onclose("parse error",e)}}ondecoded(i){At(()=>{this.emitReserved("packet",i)},this.setTimeoutFn)}onerror(i){this.emitReserved("error",i)}socket(i,e){let t=this.nsps[i];return t?this._autoConnect&&!t.active&&t.connect():(t=new Ft(this,i,e),this.nsps[i]=t),t}_destroy(i){const e=Object.keys(this.nsps);for(const t of e)if(this.nsps[t].active)return;this._close()}_packet(i){const e=this.encoder.encode(i);for(let t=0;t<e.length;t++)this.engine.write(e[t],i.options)}cleanup(){this.subs.forEach(i=>i()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(i,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",i,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const i=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const t=this.setTimeoutFn(()=>{i.skipReconnect||(this.emitReserved("reconnect_attempt",i.backoff.attempts),!i.skipReconnect&&i.open(o=>{o?(i._reconnecting=!1,i.reconnect(),this.emitReserved("reconnect_error",o)):i.onreconnect()}))},e);this.opts.autoUnref&&t.unref(),this.subs.push(()=>{this.clearTimeoutFn(t)})}}onreconnect(){const i=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",i)}}const We={};function Ie(n,i){"object"==typeof n&&(i=n,n=void 0);const e=function ai(n,i="",e){let t=n;e=e||typeof location<"u"&&location,null==n&&(n=e.protocol+"//"+e.host),"string"==typeof n&&("/"===n.charAt(0)&&(n="/"===n.charAt(1)?e.protocol+n:e.host+n),/^(https?|wss?):\/\//.test(n)||(n=typeof e<"u"?e.protocol+"//"+n:"https://"+n),t=wt(n)),t.port||(/^(http|ws)$/.test(t.protocol)?t.port="80":/^(http|ws)s$/.test(t.protocol)&&(t.port="443")),t.path=t.path||"/";const s=-1!==t.host.indexOf(":")?"["+t.host+"]":t.host;return t.id=t.protocol+"://"+s+":"+t.port+i,t.href=t.protocol+"://"+s+(e&&e.port===t.port?"":":"+t.port),t}(n,(i=i||{}).path||"/socket.io"),t=e.source,o=e.id;let g;return i.forceNew||i["force new connection"]||!1===i.multiplex||We[o]&&e.path in We[o].nsps?g=new yt(t,i):(We[o]||(We[o]=new yt(t,i)),g=We[o]),e.query&&!i.query&&(i.query=e.queryKey),g.socket(e.path,i)}Object.assign(Ie,{Manager:yt,Socket:Ft,io:Ie,connect:Ie});class gn{constructor(i){this.config=i,this.subscribersCounter={},this.eventObservables$={},this.emptyConfig={url:"",options:{}},void 0===i&&(i=this.emptyConfig),this.ioSocket=(Ie||_)(i.url,i.options)}of(i){this.ioSocket.of(i)}on(i,e){this.ioSocket.on(i,e)}once(i,e){this.ioSocket.once(i,e)}connect(){return this.ioSocket.connect()}disconnect(i){return this.ioSocket.disconnect.apply(this.ioSocket,arguments)}emit(i,...e){return this.ioSocket.emit.apply(this.ioSocket,arguments)}removeListener(i,e){return this.ioSocket.removeListener.apply(this.ioSocket,arguments)}removeAllListeners(i){return this.ioSocket.removeAllListeners.apply(this.ioSocket,arguments)}fromEvent(i){return this.subscribersCounter[i]||(this.subscribersCounter[i]=0),this.subscribersCounter[i]++,this.eventObservables$[i]||(this.eventObservables$[i]=new $.y(e=>{const t=o=>{e.next(o)};return this.ioSocket.on(i,t),()=>{this.subscribersCounter[i]--,0===this.subscribersCounter[i]&&(this.ioSocket.removeListener(i,t),delete this.eventObservables$[i])}}).pipe((0,oe.B)())),this.eventObservables$[i]}fromOneTimeEvent(i){return new Promise(e=>this.once(i,e))}listeners(i){return this.ioSocket.listeners(i)}listenersAny(){return this.ioSocket.listenersAny()}listenersAnyOutgoing(){return this.ioSocket.listenersAnyOutgoing()}off(i,e){return i?i&&!e?this.ioSocket.off(i):this.ioSocket.off(i,e):this.ioSocket.offAny()}onAny(i){return this.ioSocket.onAny(i)}onAnyOutgoing(i){return this.ioSocket.onAnyOutgoing(i)}prependAny(i){return this.ioSocket.prependAny(i)}prependAnyOutgoing(i){return this.ioSocket.prependAnyOutgoing(i)}timeout(i){return this.ioSocket.timeout(i)}volatile(){return this.ioSocket.volatile}}new r.OlP("__SOCKET_IO_CONFIG__");var vn=p(8819);let yn=!0,_n=!0;function Ke(n,i,e){const t=n.match(i);return t&&t.length>=e&&parseInt(t[e],10)}function Ue(n,i,e){if(!n.RTCPeerConnection)return;const t=n.RTCPeerConnection.prototype,o=t.addEventListener;t.addEventListener=function(a,c){if(a!==i)return o.apply(this,arguments);const g=m=>{const C=e(m);C&&(c.handleEvent?c.handleEvent(C):c(C))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(c,g),o.apply(this,[a,g])};const s=t.removeEventListener;t.removeEventListener=function(a,c){if(a!==i||!this._eventMap||!this._eventMap[i])return s.apply(this,arguments);if(!this._eventMap[i].has(c))return s.apply(this,arguments);const g=this._eventMap[i].get(c);return this._eventMap[i].delete(c),0===this._eventMap[i].size&&delete this._eventMap[i],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[a,g])},Object.defineProperty(t,"on"+i,{get(){return this["_on"+i]},set(a){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),a&&this.addEventListener(i,this["_on"+i]=a)},enumerable:!0,configurable:!0})}function yi(n){return"boolean"!=typeof n?new Error("Argument type: "+typeof n+". Please use a boolean."):(yn=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function _i(n){return"boolean"!=typeof n?new Error("Argument type: "+typeof n+". Please use a boolean."):(_n=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function jt(){if("object"==typeof window){if(yn)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function _t(n,i){_n&&console.warn(n+" is deprecated, please use "+i+" instead.")}function bn(n){return"[object Object]"===Object.prototype.toString.call(n)}function Cn(n){return bn(n)?Object.keys(n).reduce(function(i,e){const t=bn(n[e]),o=t?Cn(n[e]):n[e],s=t&&!Object.keys(o).length;return void 0===o||s?i:Object.assign(i,{[e]:o})},{}):n}function Nt(n,i,e){!i||e.has(i.id)||(e.set(i.id,i),Object.keys(i).forEach(t=>{t.endsWith("Id")?Nt(n,n.get(i[t]),e):t.endsWith("Ids")&&i[t].forEach(o=>{Nt(n,n.get(o),e)})}))}function Sn(n,i,e){const t=e?"outbound-rtp":"inbound-rtp",o=new Map;if(null===i)return o;const s=[];return n.forEach(a=>{"track"===a.type&&a.trackIdentifier===i.id&&s.push(a)}),s.forEach(a=>{n.forEach(c=>{c.type===t&&c.trackId===a.id&&Nt(n,c,o)})}),o}const Tn=jt;function xn(n,i){const e=n&&n.navigator;if(!e.mediaDevices)return;const t=function(c){if("object"!=typeof c||c.mandatory||c.optional)return c;const g={};return Object.keys(c).forEach(m=>{if("require"===m||"advanced"===m||"mediaSource"===m)return;const C="object"==typeof c[m]?c[m]:{ideal:c[m]};void 0!==C.exact&&"number"==typeof C.exact&&(C.min=C.max=C.exact);const R=function(F,q){return F?F+q.charAt(0).toUpperCase()+q.slice(1):"deviceId"===q?"sourceId":q};if(void 0!==C.ideal){g.optional=g.optional||[];let F={};"number"==typeof C.ideal?(F[R("min",m)]=C.ideal,g.optional.push(F),F={},F[R("max",m)]=C.ideal,g.optional.push(F)):(F[R("",m)]=C.ideal,g.optional.push(F))}void 0!==C.exact&&"number"!=typeof C.exact?(g.mandatory=g.mandatory||{},g.mandatory[R("",m)]=C.exact):["min","max"].forEach(F=>{void 0!==C[F]&&(g.mandatory=g.mandatory||{},g.mandatory[R(F,m)]=C[F])})}),c.advanced&&(g.optional=(g.optional||[]).concat(c.advanced)),g},o=function(c,g){if(i.version>=61)return g(c);if((c=JSON.parse(JSON.stringify(c)))&&"object"==typeof c.audio){const m=function(C,R,F){R in C&&!(F in C)&&(C[F]=C[R],delete C[R])};m((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),m(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=t(c.audio)}if(c&&"object"==typeof c.video){let m=c.video.facingMode;m=m&&("object"==typeof m?m:{ideal:m});const C=i.version<66;if(m&&("user"===m.exact||"environment"===m.exact||"user"===m.ideal||"environment"===m.ideal)&&(!e.mediaDevices.getSupportedConstraints||!e.mediaDevices.getSupportedConstraints().facingMode||C)){let R;if(delete c.video.facingMode,"environment"===m.exact||"environment"===m.ideal?R=["back","rear"]:("user"===m.exact||"user"===m.ideal)&&(R=["front"]),R)return e.mediaDevices.enumerateDevices().then(F=>{let q=(F=F.filter(te=>"videoinput"===te.kind)).find(te=>R.some(ne=>te.label.toLowerCase().includes(ne)));return!q&&F.length&&R.includes("back")&&(q=F[F.length-1]),q&&(c.video.deviceId=m.exact?{exact:q.deviceId}:{ideal:q.deviceId}),c.video=t(c.video),Tn("chrome: "+JSON.stringify(c)),g(c)})}c.video=t(c.video)}return Tn("chrome: "+JSON.stringify(c)),g(c)},s=function(c){return i.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(e.getUserMedia=function(c,g,m){o(c,C=>{e.webkitGetUserMedia(C,g,R=>{m&&m(s(R))})})}.bind(e),e.mediaDevices.getUserMedia){const c=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(g){return o(g,m=>c(m).then(C=>{if(m.audio&&!C.getAudioTracks().length||m.video&&!C.getVideoTracks().length)throw C.getTracks().forEach(R=>{R.stop()}),new DOMException("","NotFoundError");return C},C=>Promise.reject(s(C))))}}}function Ci(n,i){if((!n.navigator.mediaDevices||!("getDisplayMedia"in n.navigator.mediaDevices))&&n.navigator.mediaDevices){if("function"!=typeof i)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");n.navigator.mediaDevices.getDisplayMedia=function(t){return i(t).then(o=>{const s=t.video&&t.video.width,a=t.video&&t.video.height;return t.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:t.video&&t.video.frameRate||3}},s&&(t.video.mandatory.maxWidth=s),a&&(t.video.mandatory.maxHeight=a),n.navigator.mediaDevices.getUserMedia(t)})}}}function kn(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function En(n){if("object"==typeof n&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const i=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",o=>{let s;s=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===o.track.id):{track:o.track};const a=new Event("track");a.track=o.track,a.receiver=s,a.transceiver={receiver:s},a.streams=[t.stream],this.dispatchEvent(a)}),t.stream.getTracks().forEach(o=>{let s;s=n.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===o.id):{track:o};const a=new Event("track");a.track=o,a.receiver=s,a.transceiver={receiver:s},a.streams=[t.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),i.apply(this,arguments)}}else Ue(n,"track",i=>(i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i))}function Rn(n){if("object"==typeof n&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const i=function(o,s){return{track:s,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===s.kind?o.createDTMFSender(s):null),this._dtmf},_pc:o}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(c,g){let m=o.apply(this,arguments);return m||(m=i(this,c),this._senders.push(m)),m};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(c){s.apply(this,arguments);const g=this._senders.indexOf(c);-1!==g&&this._senders.splice(g,1)}}const e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],e.apply(this,[s]),s.getTracks().forEach(a=>{this._senders.push(i(this,a))})};const t=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],t.apply(this,[s]),s.getTracks().forEach(a=>{const c=this._senders.find(g=>g.track===a);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if("object"==typeof n&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const i=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const t=i.apply(this,[]);return t.forEach(o=>o._pc=this),t},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function Pn(n){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[t,o,s]=arguments;if(arguments.length>0&&"function"==typeof t)return i.apply(this,arguments);if(0===i.length&&(0===arguments.length||"function"!=typeof t))return i.apply(this,[]);const a=function(g){const m={};return g.result().forEach(R=>{const F={id:R.id,timestamp:R.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[R.type]||R.type};R.names().forEach(q=>{F[q]=R.stat(q)}),m[F.id]=F}),m},c=function(g){return new Map(Object.keys(g).map(m=>[m,g[m]]))};return arguments.length>=2?i.apply(this,[function(m){o(c(a(m)))},t]):new Promise((g,m)=>{i.apply(this,[function(C){g(c(a(C)))},m])}).then(o,s)}}function On(n){if(!("object"==typeof n&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(a=>a._pc=this),s});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=t.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(a=>Sn(a,s.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const o=e.apply(this,[]);return o.forEach(s=>s._pc=this),o}),Ue(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(s=>Sn(s,o.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype)||!("getStats"in n.RTCRtpReceiver.prototype))return;const i=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const t=arguments[0];let o,s,a;return this.getSenders().forEach(c=>{c.track===t&&(o?a=!0:o=c)}),this.getReceivers().forEach(c=>(c.track===t&&(s?a=!0:s=c),c.track===t)),a||o&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function An(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const i=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const g=i.apply(this,arguments);return this._shimmedLocalStreams[c.id]?-1===this._shimmedLocalStreams[c.id].indexOf(g)&&this._shimmedLocalStreams[c.id].push(g):this._shimmedLocalStreams[c.id]=[c,g],g};const e=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(m=>{if(this.getSenders().find(R=>R.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();e.apply(this,arguments);const g=this.getSenders().filter(m=>-1===c.indexOf(m));this._shimmedLocalStreams[a.id]=[a].concat(g)};const t=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],t.apply(this,arguments)};const o=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const g=this._shimmedLocalStreams[c].indexOf(a);-1!==g&&this._shimmedLocalStreams[c].splice(g,1),1===this._shimmedLocalStreams[c].length&&delete this._shimmedLocalStreams[c]}),o.apply(this,arguments)}}function In(n,i){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&i.version>=65)return An(n);const e=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const C=e.apply(this);return this._reverseStreams=this._reverseStreams||{},C.map(R=>this._reverseStreams[R.id])};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(C){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},C.getTracks().forEach(R=>{if(this.getSenders().find(q=>q.track===R))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[C.id]){const R=new n.MediaStream(C.getTracks());this._streams[C.id]=R,this._reverseStreams[R.id]=C,C=R}t.apply(this,[C])};const o=n.RTCPeerConnection.prototype.removeStream;function s(m,C){let R=C.sdp;return Object.keys(m._reverseStreams||[]).forEach(F=>{const q=m._reverseStreams[F];R=R.replace(new RegExp(m._streams[q.id].id,"g"),q.id)}),new RTCSessionDescription({type:C.type,sdp:R})}n.RTCPeerConnection.prototype.removeStream=function(C){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[C.id]||C]),delete this._reverseStreams[this._streams[C.id]?this._streams[C.id].id:C.id],delete this._streams[C.id]},n.RTCPeerConnection.prototype.addTrack=function(C,R){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const F=[].slice.call(arguments,1);if(1!==F.length||!F[0].getTracks().find(ne=>ne===C))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(ne=>ne.track===C))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const te=this._streams[R.id];if(te)te.addTrack(C),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const ne=new n.MediaStream([C]);this._streams[R.id]=ne,this._reverseStreams[ne.id]=R,this.addStream(ne)}return this.getSenders().find(ne=>ne.track===C)},["createOffer","createAnswer"].forEach(function(m){const C=n.RTCPeerConnection.prototype[m],R={[m](){const F=arguments;return arguments.length&&"function"==typeof arguments[0]?C.apply(this,[te=>{const ne=s(this,te);F[0].apply(null,[ne])},te=>{F[1]&&F[1].apply(null,te)},arguments[2]]):C.apply(this,arguments).then(te=>s(this,te))}};n.RTCPeerConnection.prototype[m]=R[m]});const c=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function a(m,C){let R=C.sdp;return Object.keys(m._reverseStreams||[]).forEach(F=>{const q=m._reverseStreams[F],te=m._streams[q.id];R=R.replace(new RegExp(q.id,"g"),te.id)}),new RTCSessionDescription({type:C.type,sdp:R})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const g=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const m=g.get.apply(this);return""===m.type?m:s(this,m)}}),n.RTCPeerConnection.prototype.removeTrack=function(C){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!C._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(C._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let F;this._streams=this._streams||{},Object.keys(this._streams).forEach(q=>{this._streams[q].getTracks().find(ne=>C.track===ne)&&(F=this._streams[q])}),F&&(1===F.getTracks().length?this.removeStream(this._reverseStreams[F.id]):F.removeTrack(C.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Ut(n,i){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){const t=n.RTCPeerConnection.prototype[e],o={[e](){return arguments[0]=new("addIceCandidate"===e?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}};n.RTCPeerConnection.prototype[e]=o[e]})}function wn(n,i){Ue(n,"negotiationneeded",e=>{const t=e.target;if(!(i.version<72||t.getConfiguration&&"plan-b"===t.getConfiguration().sdpSemantics)||"stable"===t.signalingState)return e})}var Ti=p(6334),xi=p.n(Ti);function Bn(n){const i=n&&n.navigator,t=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(o){return t(o).catch(s=>Promise.reject(function(o){return{name:{PermissionDeniedError:"NotAllowedError"}[o.name]||o.name,message:o.message,constraint:o.constraint,toString(){return this.name}}}(s)))}}function Dn(n){"getDisplayMedia"in n.navigator&&n.navigator.mediaDevices&&(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||(n.navigator.mediaDevices.getDisplayMedia=n.navigator.getDisplayMedia.bind(n.navigator)))}function Zt(n,i){if(n.RTCIceGatherer&&(n.RTCIceCandidate||(n.RTCIceCandidate=function(o){return o}),n.RTCSessionDescription||(n.RTCSessionDescription=function(o){return o}),i.version<15025)){const t=Object.getOwnPropertyDescriptor(n.MediaStreamTrack.prototype,"enabled");Object.defineProperty(n.MediaStreamTrack.prototype,"enabled",{set(o){t.set.call(this,o);const s=new Event("enabled");s.enabled=o,this.dispatchEvent(s)}})}n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)&&Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new n.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),n.RTCDtmfSender&&!n.RTCDTMFSender&&(n.RTCDTMFSender=n.RTCDtmfSender);const e=xi()(n,i.version);n.RTCPeerConnection=function(o){return o&&o.iceServers&&(o.iceServers=function Si(n,i){let e=!1;return(n=JSON.parse(JSON.stringify(n))).filter(t=>{if(t&&(t.urls||t.url)){let o=t.urls||t.url;t.url&&!t.urls&&_t("RTCIceServer.url","RTCIceServer.urls");const s="string"==typeof o;return s&&(o=[o]),o=o.filter(a=>{if(0===a.indexOf("stun:"))return!1;const c=a.startsWith("turn")&&!a.startsWith("turn:[")&&a.includes("transport=udp");return c&&!e?(e=!0,!0):c&&!e}),delete t.url,t.urls=s?o[0]:o,!!o.length}})}(o.iceServers),jt("ICE servers after filtering:",o.iceServers)),new e(o)},n.RTCPeerConnection.prototype=e.prototype}function Mn(n){n.RTCRtpSender&&!("replaceTrack"in n.RTCRtpSender.prototype)&&(n.RTCRtpSender.prototype.replaceTrack=n.RTCRtpSender.prototype.setTrack)}function Ln(n,i){const e=n&&n.navigator,t=n&&n.MediaStreamTrack;if(e.getUserMedia=function(o,s,a){_t("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),e.mediaDevices.getUserMedia(o).then(s,a)},!(i.version>55&&"autoGainControl"in e.mediaDevices.getSupportedConstraints())){const o=function(a,c,g){c in a&&!(g in a)&&(a[g]=a[c],delete a[c])},s=e.mediaDevices.getUserMedia.bind(e.mediaDevices);if(e.mediaDevices.getUserMedia=function(a){return"object"==typeof a&&"object"==typeof a.audio&&(a=JSON.parse(JSON.stringify(a)),o(a.audio,"autoGainControl","mozAutoGainControl"),o(a.audio,"noiseSuppression","mozNoiseSuppression")),s(a)},t&&t.prototype.getSettings){const a=t.prototype.getSettings;t.prototype.getSettings=function(){const c=a.apply(this,arguments);return o(c,"mozAutoGainControl","autoGainControl"),o(c,"mozNoiseSuppression","noiseSuppression"),c}}if(t&&t.prototype.applyConstraints){const a=t.prototype.applyConstraints;t.prototype.applyConstraints=function(c){return"audio"===this.kind&&"object"==typeof c&&(c=JSON.parse(JSON.stringify(c)),o(c,"autoGainControl","mozAutoGainControl"),o(c,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[c])}}}}function ki(n,i){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(t){if(!t||!t.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,Promise.reject(o)}return!0===t.video?t.video={mediaSource:i}:t.video.mediaSource=i,n.navigator.mediaDevices.getUserMedia(t)})}function Fn(n){"object"==typeof n&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $t(n,i){if("object"!=typeof n||!n.RTCPeerConnection&&!n.mozRTCPeerConnection)return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const s=n.RTCPeerConnection.prototype[o],a={[o](){return arguments[0]=new("addIceCandidate"===o?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};n.RTCPeerConnection.prototype[o]=a[o]});const e={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},t=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,a,c]=arguments;return t.apply(this,[s||null]).then(g=>{if(i.version<53&&!a)try{g.forEach(m=>{m.type=e[m.type]||m.type})}catch(m){if("TypeError"!==m.name)throw m;g.forEach((C,R)=>{g.set(R,Object.assign({},C,{type:e[C.type]||C.type}))})}return g}).then(a,c)}}function jn(n){if("object"!=typeof n||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const i=n.RTCPeerConnection.prototype.getSenders;i&&(n.RTCPeerConnection.prototype.getSenders=function(){const o=i.apply(this,[]);return o.forEach(s=>s._pc=this),o});const e=n.RTCPeerConnection.prototype.addTrack;e&&(n.RTCPeerConnection.prototype.addTrack=function(){const o=e.apply(this,arguments);return o._pc=this,o}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Nn(n){if("object"!=typeof n||!n.RTCPeerConnection||!n.RTCRtpSender||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const i=n.RTCPeerConnection.prototype.getReceivers;i&&(n.RTCPeerConnection.prototype.getReceivers=function(){const t=i.apply(this,[]);return t.forEach(o=>o._pc=this),t}),Ue(n,"track",e=>(e.receiver._pc=e.srcElement,e)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Un(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){_t("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function Zn(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function $n(n){if("object"!=typeof n||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.addTransceiver;i&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const t=arguments[1],o=t&&"sendEncodings"in t;o&&t.sendEncodings.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=i.apply(this,arguments);if(o){const{sender:a}=s,c=a.getParameters();(!("encodings"in c)||1===c.encodings.length&&0===Object.keys(c.encodings[0]).length)&&(c.encodings=t.sendEncodings,a.sendEncodings=t.sendEncodings,this.setParametersPromises.push(a.setParameters(c).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return s})}function Jn(n){if("object"!=typeof n||!n.RTCRtpSender)return;const i=n.RTCRtpSender.prototype.getParameters;i&&(n.RTCRtpSender.prototype.getParameters=function(){const t=i.apply(this,arguments);return"encodings"in t||(t.encodings=[].concat(this.sendEncodings||[{}])),t})}function Gn(n){if("object"!=typeof n||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function qn(n){if("object"!=typeof n||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function zn(n){if("object"==typeof n&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const i=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(o=>i.call(this,o,t)),t.getVideoTracks().forEach(o=>i.call(this,o,t))},n.RTCPeerConnection.prototype.addTrack=function(t,...o){return o&&o.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),i.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const o=e.getTracks();this.getSenders().forEach(s=>{o.includes(s.track)&&this.removeTrack(s)})})}}function Vn(n){if("object"==typeof n&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=t=>{t.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const s=new Event("addstream");s.stream=o,this.dispatchEvent(s)})})}});const i=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(s=>{if(t._remoteStreams||(t._remoteStreams=[]),t._remoteStreams.indexOf(s)>=0)return;t._remoteStreams.push(s);const a=new Event("addstream");a.stream=s,t.dispatchEvent(a)})}),i.apply(t,arguments)}}}function Yn(n){if("object"!=typeof n||!n.RTCPeerConnection)return;const i=n.RTCPeerConnection.prototype,e=i.createOffer,t=i.createAnswer,o=i.setLocalDescription,s=i.setRemoteDescription,a=i.addIceCandidate;i.createOffer=function(m,C){const F=e.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return C?(F.then(m,C),Promise.resolve()):F},i.createAnswer=function(m,C){const F=t.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return C?(F.then(m,C),Promise.resolve()):F};let c=function(g,m,C){const R=o.apply(this,[g]);return C?(R.then(m,C),Promise.resolve()):R};i.setLocalDescription=c,c=function(g,m,C){const R=s.apply(this,[g]);return C?(R.then(m,C),Promise.resolve()):R},i.setRemoteDescription=c,c=function(g,m,C){const R=a.apply(this,[g]);return C?(R.then(m,C),Promise.resolve()):R},i.addIceCandidate=c}function Qn(n){const i=n&&n.navigator;if(i.mediaDevices&&i.mediaDevices.getUserMedia){const e=i.mediaDevices,t=e.getUserMedia.bind(e);i.mediaDevices.getUserMedia=o=>t(Hn(o))}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=function(t,o,s){i.mediaDevices.getUserMedia(t).then(o,s)}.bind(i))}function Hn(n){return n&&void 0!==n.video?Object.assign({},n,{video:Cn(n.video)}):n}function Wn(n){if(!n.RTCPeerConnection)return;const i=n.RTCPeerConnection;n.RTCPeerConnection=function(t,o){if(t&&t.iceServers){const s=[];for(let a=0;a<t.iceServers.length;a++){let c=t.iceServers[a];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(_t("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,s.push(c)):s.push(t.iceServers[a])}t.iceServers=s}return new i(t,o)},n.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in i&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:()=>i.generateCertificate})}function Kn(n){"object"==typeof n&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Xn(n){const i=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(t){if(t){typeof t.offerToReceiveAudio<"u"&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);const o=this.getTransceivers().find(a=>"audio"===a.receiver.track.kind);!1===t.offerToReceiveAudio&&o?"sendrecv"===o.direction?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":"recvonly"===o.direction&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):!0===t.offerToReceiveAudio&&!o&&this.addTransceiver("audio"),typeof t.offerToReceiveVideo<"u"&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);const s=this.getTransceivers().find(a=>"video"===a.receiver.track.kind);!1===t.offerToReceiveVideo&&s?"sendrecv"===s.direction?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":"recvonly"===s.direction&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):!0===t.offerToReceiveVideo&&!s&&this.addTransceiver("video")}return i.apply(this,arguments)}}function er(n){"object"!=typeof n||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}var Ei=p(7463),bt=p.n(Ei);function Ct(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const i=n.RTCIceCandidate;n.RTCIceCandidate=function(t){if("object"==typeof t&&t.candidate&&0===t.candidate.indexOf("a=")&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substr(2)),t.candidate&&t.candidate.length){const o=new i(t),s=bt().parseCandidate(t.candidate),a=Object.assign(o,s);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new i(t)},n.RTCIceCandidate.prototype=i.prototype,Ue(n,"icecandidate",e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new n.RTCIceCandidate(e.candidate),writable:"false"}),e))}function Xe(n,i){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const a=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===i.browser&&i.version>=76){const{sdpSemantics:g}=this.getConfiguration();"plan-b"===g&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(function(c){if(!c||!c.sdp)return!1;const g=bt().splitSections(c.sdp);return g.shift(),g.some(m=>{const C=bt().parseMLine(m);return C&&"application"===C.kind&&-1!==C.protocol.indexOf("SCTP")})}(arguments[0])){const g=function(c){const g=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===g||g.length<2)return-1;const m=parseInt(g[1],10);return m!=m?-1:m}(arguments[0]),m=function(c){let g=65536;return"firefox"===i.browser&&(g=i.version<57?-1===c?16384:2147483637:i.version<60?57===i.version?65535:65536:2147483637),g}(g),C=function(c,g){let m=65536;"firefox"===i.browser&&57===i.version&&(m=65535);const C=bt().matchPrefix(c.sdp,"a=max-message-size:");return C.length>0?m=parseInt(C[0].substr(19),10):"firefox"===i.browser&&-1!==g&&(m=2147483637),m}(arguments[0],g);let R;R=0===m&&0===C?Number.POSITIVE_INFINITY:0===m||0===C?Math.max(m,C):Math.min(m,C);const F={};Object.defineProperty(F,"maxMessageSize",{get:()=>R}),this._sctp=F}return a.apply(this,arguments)}}function et(n){if(!n.RTCPeerConnection||!("createDataChannel"in n.RTCPeerConnection.prototype))return;function i(t,o){const s=t.send;t.send=function(){const c=arguments[0];if("open"===t.readyState&&o.sctp&&(c.length||c.size||c.byteLength)>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return s.apply(t,arguments)}}const e=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const o=e.apply(this,arguments);return i(o,this),o},Ue(n,"datachannel",t=>(i(t.channel,t.target),t))}function Jt(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const i=n.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const t=i[e];i[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const s=o.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const a=new Event("connectionstatechange",o);s.dispatchEvent(a)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}})}function Gt(n,i){if(!n.RTCPeerConnection||"chrome"===i.browser&&i.version>=71||"safari"===i.browser&&i.version>=605)return;const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&-1!==o.sdp.indexOf("\na=extmap-allow-mixed")){const s=o.sdp.split("\n").filter(a=>"a=extmap-allow-mixed"!==a.trim()).join("\n");n.RTCSessionDescription&&o instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:o.type,sdp:s}):o.sdp=s}return e.apply(this,arguments)}}function St(n,i){if(!n.RTCPeerConnection||!n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype.addIceCandidate;!e||0===e.length||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===i.browser&&i.version<78||"firefox"===i.browser&&i.version<68||"safari"===i.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const tr=function Ri({window:n}={},i={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const e=jt,t=function bi(n){const i={browser:null,version:null};if(typeof n>"u"||!n.navigator)return i.browser="Not a browser.",i;const{navigator:e}=n;if(e.mozGetUserMedia)i.browser="firefox",i.version=Ke(e.userAgent,/Firefox\/(\d+)\./,1);else if(e.webkitGetUserMedia||!1===n.isSecureContext&&n.webkitRTCPeerConnection&&!n.RTCIceGatherer)i.browser="chrome",i.version=Ke(e.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.mediaDevices&&e.userAgent.match(/Edge\/(\d+).(\d+)$/))i.browser="edge",i.version=Ke(e.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!n.RTCPeerConnection||!e.userAgent.match(/AppleWebKit\/(\d+)\./))return i.browser="Not a supported browser.",i;i.browser="safari",i.version=Ke(e.userAgent,/AppleWebKit\/(\d+)\./,1),i.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype}return i}(n),o={browserDetails:t,commonShim:D,extractVersion:Ke,disableLog:yi,disableWarnings:_i};switch(t.browser){case"chrome":if(!I||!Ut||!i.shimChrome)return e("Chrome shim is not included in this adapter release."),o;if(null===t.version)return e("Chrome shim can not determine version, not shimming."),o;e("adapter.js shimming chrome."),o.browserShim=I,St(n,t),xn(n,t),kn(n),Ut(n,t),En(n),In(n,t),Rn(n),Pn(n),On(n),wn(n,t),Ct(n),Jt(n),Xe(n,t),et(n),Gt(n,t);break;case"firefox":if(!M||!$t||!i.shimFirefox)return e("Firefox shim is not included in this adapter release."),o;e("adapter.js shimming firefox."),o.browserShim=M,St(n,t),Ln(n,t),$t(n,t),Fn(n),Un(n),jn(n),Nn(n),Zn(n),$n(n),Jn(n),Gn(n),qn(n),Ct(n),Jt(n),Xe(n,t),et(n);break;case"edge":if(!S||!Zt||!i.shimEdge)return e("MS edge shim is not included in this adapter release."),o;e("adapter.js shimming edge."),o.browserShim=S,Bn(n),Dn(n),Zt(n,t),Mn(n),Xe(n,t),et(n);break;case"safari":if(!U||!i.shimSafari)return e("Safari shim is not included in this adapter release."),o;e("adapter.js shimming safari."),o.browserShim=U,St(n,t),Wn(n),Xn(n),Yn(n),zn(n),Vn(n),Kn(n),Qn(n),er(n),Ct(n),Xe(n,t),et(n),Gt(n,t);break;default:e("Unsupported browser!")}return o}({window:typeof window>"u"?void 0:window});function xe(n,i,e,t){Object.defineProperty(n,i,{get:e,set:t,enumerable:!0,configurable:!0})}var qt=tr.default||tr,tt=new(function(){function n(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return n.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},n.prototype.isBrowserSupported=function(){var i=this.getBrowser(),e=this.getVersion();return!!this.supportedBrowsers.includes(i)&&("chrome"===i?e>=this.minChromeVersion:"firefox"===i?e>=this.minFirefoxVersion:"safari"===i&&!this.isIOS&&e>=this.minSafariVersion)},n.prototype.getBrowser=function(){return qt.browserDetails.browser},n.prototype.getVersion=function(){return qt.browserDetails.version||0},n.prototype.isUnifiedPlanSupported=function(){var i=this.getBrowser(),e=qt.browserDetails.version||0;if("chrome"===i&&e<this.minChromeVersion)return!1;if("firefox"===i&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var t,o=!1;try{(t=new RTCPeerConnection).addTransceiver("audio"),o=!0}catch{}finally{t&&t.close()}return o},n.prototype.toString=function(){return"Supports:\n    browser:".concat(this.getBrowser(),"\n    version:").concat(this.getVersion(),"\n    isIOS:").concat(this.isIOS,"\n    isWebRTCSupported:").concat(this.isWebRTCSupported(),"\n    isBrowserSupported:").concat(this.isBrowserSupported(),"\n    isUnifiedPlanSupported:").concat(this.isUnifiedPlanSupported())},n}()),nr={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},Pi=function(){function n(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=nr,this.browser=tt.getBrowser(),this.browserVersion=tt.getVersion(),this.supports=function(){var e,i={browser:tt.isBrowserSupported(),webRTC:tt.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!i.webRTC)return i;try{e=new RTCPeerConnection(nr),i.audioVideo=!0;var t=void 0;try{t=e.createDataChannel("_PEERJSTEST",{ordered:!0}),i.data=!0,i.reliable=!!t.ordered;try{t.binaryType="blob",i.binaryBlob=!tt.isIOS}catch{}}catch{}finally{t&&t.close()}}catch{}finally{e&&e.close()}return i}(),this.pack=vn.pack,this.unpack=vn.unpack,this._dataCount=1}return n.prototype.noop=function(){},n.prototype.validateId=function(i){return!i||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(i)},n.prototype.chunk=function(i){for(var e=[],t=i.size,o=Math.ceil(t/W.chunkedMTU),s=0,a=0;a<t;){var c=Math.min(t,a+W.chunkedMTU),g=i.slice(a,c);e.push({__peerData:this._dataCount,n:s,data:g,total:o}),a=c,s++}return this._dataCount++,e},n.prototype.blobToArrayBuffer=function(i,e){var t=new FileReader;return t.onload=function(o){o.target&&e(o.target.result)},t.readAsArrayBuffer(i),t},n.prototype.binaryStringToArrayBuffer=function(i){for(var e=new Uint8Array(i.length),t=0;t<i.length;t++)e[t]=255&i.charCodeAt(t);return e.buffer},n.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},n.prototype.isSecure=function(){return"https:"===location.protocol},n}(),W=new Pi,rr={};xe(rr,"Peer",()=>yr,n=>yr=n);var nt,Oi=Object.prototype.hasOwnProperty,pe="~";function rt(){}function Ai(n,i,e){this.fn=n,this.context=i,this.once=e||!1}function ir(n,i,e,t,o){if("function"!=typeof e)throw new TypeError("The listener must be a function");var s=new Ai(e,t||n,o),a=pe?pe+i:i;return n._events[a]?n._events[a].fn?n._events[a]=[n._events[a],s]:n._events[a].push(s):(n._events[a]=s,n._eventsCount++),n}function Tt(n,i){0==--n._eventsCount?n._events=new rt:delete n._events[i]}function le(){this._events=new rt,this._eventsCount=0}Object.create&&(rt.prototype=Object.create(null),(new rt).__proto__||(pe=!1)),le.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)Oi.call(e,t)&&i.push(pe?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},le.prototype.listeners=function(i){var t=this._events[pe?pe+i:i];if(!t)return[];if(t.fn)return[t.fn];for(var o=0,s=t.length,a=new Array(s);o<s;o++)a[o]=t[o].fn;return a},le.prototype.listenerCount=function(i){var t=this._events[pe?pe+i:i];return t?t.fn?1:t.length:0},le.prototype.emit=function(i,e,t,o,s,a){var c=pe?pe+i:i;if(!this._events[c])return!1;var C,R,g=this._events[c],m=arguments.length;if(g.fn){switch(g.once&&this.removeListener(i,g.fn,void 0,!0),m){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,e),!0;case 3:return g.fn.call(g.context,e,t),!0;case 4:return g.fn.call(g.context,e,t,o),!0;case 5:return g.fn.call(g.context,e,t,o,s),!0;case 6:return g.fn.call(g.context,e,t,o,s,a),!0}for(R=1,C=new Array(m-1);R<m;R++)C[R-1]=arguments[R];g.fn.apply(g.context,C)}else{var q,F=g.length;for(R=0;R<F;R++)switch(g[R].once&&this.removeListener(i,g[R].fn,void 0,!0),m){case 1:g[R].fn.call(g[R].context);break;case 2:g[R].fn.call(g[R].context,e);break;case 3:g[R].fn.call(g[R].context,e,t);break;case 4:g[R].fn.call(g[R].context,e,t,o);break;default:if(!C)for(q=1,C=new Array(m-1);q<m;q++)C[q-1]=arguments[q];g[R].fn.apply(g[R].context,C)}}return!0},le.prototype.on=function(i,e,t){return ir(this,i,e,t,!1)},le.prototype.once=function(i,e,t){return ir(this,i,e,t,!0)},le.prototype.removeListener=function(i,e,t,o){var s=pe?pe+i:i;if(!this._events[s])return this;if(!e)return Tt(this,s),this;var a=this._events[s];if(a.fn)a.fn===e&&(!o||a.once)&&(!t||a.context===t)&&Tt(this,s);else{for(var c=0,g=[],m=a.length;c<m;c++)(a[c].fn!==e||o&&!a[c].once||t&&a[c].context!==t)&&g.push(a[c]);g.length?this._events[s]=1===g.length?g[0]:g:Tt(this,s)}return this},le.prototype.removeAllListeners=function(i){var e;return i?this._events[e=pe?pe+i:i]&&Tt(this,e):(this._events=new rt,this._eventsCount=0),this},le.prototype.off=le.prototype.removeListener,le.prototype.addListener=le.prototype.on,le.prefixed=pe,le.EventEmitter=le,nt=le;var N={};xe(N,"LogLevel",()=>ie,n=>ie=n),xe(N,"default",()=>or,n=>or=n);var De=function(n,i){var e="function"==typeof Symbol&&n[Symbol.iterator];if(!e)return n;var o,a,t=e.call(n),s=[];try{for(;(void 0===i||i-- >0)&&!(o=t.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(e=t.return)&&e.call(t)}finally{if(a)throw a.error}}return s},Me=function(n,i,e){if(e||2===arguments.length)for(var s,t=0,o=i.length;t<o;t++)(s||!(t in i))&&(s||(s=Array.prototype.slice.call(i,0,t)),s[t]=i[t]);return n.concat(s||Array.prototype.slice.call(i))},ie=(()=>((ie=ie||{})[ie.Disabled=0]="Disabled",ie[ie.Errors=1]="Errors",ie[ie.Warnings=2]="Warnings",ie[ie.All=3]="All",ie))(),wi=function(){function n(){this._logLevel=ie.Disabled}return Object.defineProperty(n.prototype,"logLevel",{get:function(){return this._logLevel},set:function(i){this._logLevel=i},enumerable:!1,configurable:!0}),n.prototype.log=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];this._logLevel>=ie.All&&this._print.apply(this,Me([ie.All],De(i),!1))},n.prototype.warn=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];this._logLevel>=ie.Warnings&&this._print.apply(this,Me([ie.Warnings],De(i),!1))},n.prototype.error=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];this._logLevel>=ie.Errors&&this._print.apply(this,Me([ie.Errors],De(i),!1))},n.prototype.setLogFunction=function(i){this._print=i},n.prototype._print=function(i){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var o=Me(["PeerJS: "],De(e),!1);for(var s in o)o[s]instanceof Error&&(o[s]="("+o[s].name+") "+o[s].message);i>=ie.All?console.log.apply(console,Me([],De(o),!1)):i>=ie.Warnings?console.warn.apply(console,Me(["WARNING"],De(o),!1)):i>=ie.Errors&&console.error.apply(console,Me(["ERROR"],De(o),!1))},n}(),or=new wi,sr={};xe(sr,"Socket",()=>ar,n=>ar=n);var zt,de=(()=>((de=de||{}).Data="data",de.Media="media",de))(),V=(()=>((V=V||{}).BrowserIncompatible="browser-incompatible",V.Disconnected="disconnected",V.InvalidID="invalid-id",V.InvalidKey="invalid-key",V.Network="network",V.PeerUnavailable="peer-unavailable",V.SslUnavailable="ssl-unavailable",V.ServerError="server-error",V.SocketError="socket-error",V.SocketClosed="socket-closed",V.UnavailableID="unavailable-id",V.WebRTC="webrtc",V))(),ge=(()=>((ge=ge||{}).Binary="binary",ge.BinaryUTF8="binary-utf8",ge.JSON="json",ge))(),he=(()=>((he=he||{}).Message="message",he.Disconnected="disconnected",he.Error="error",he.Close="close",he))(),X=(()=>((X=X||{}).Heartbeat="HEARTBEAT",X.Candidate="CANDIDATE",X.Offer="OFFER",X.Answer="ANSWER",X.Open="OPEN",X.Error="ERROR",X.IdTaken="ID-TAKEN",X.InvalidKey="INVALID-KEY",X.Leave="LEAVE",X.Expire="EXPIRE",X))();zt=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xfcckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var n,Bi=(n=function(i,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s])})(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}n(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),ar=function(n){function i(e,t,o,s,a,c){void 0===c&&(c=5e3);var g=n.call(this)||this;return g.pingInterval=c,g._disconnected=!0,g._messagesQueue=[],g._baseUrl=(e?"wss://":"ws://")+t+":"+o+s+"peerjs?key="+a,g}return Bi(i,n),i.prototype.start=function(e,t){var o=this;this._id=e;var s="".concat(this._baseUrl,"&id=").concat(e,"&token=").concat(t);this._socket||!this._disconnected||(this._socket=new WebSocket(s+"&version="+zt.version),this._disconnected=!1,this._socket.onmessage=function(a){var c;try{c=JSON.parse(a.data),N.default.log("Server message received:",c)}catch{return void N.default.log("Invalid server message",a.data)}o.emit(he.Message,c)},this._socket.onclose=function(a){o._disconnected||(N.default.log("Socket closed.",a),o._cleanup(),o._disconnected=!0,o.emit(he.Disconnected))},this._socket.onopen=function(){o._disconnected||(o._sendQueuedMessages(),N.default.log("Socket open"),o._scheduleHeartbeat())})},i.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout(function(){e._sendHeartbeat()},this.pingInterval)},i.prototype._sendHeartbeat=function(){if(this._wsOpen()){var e=JSON.stringify({type:X.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}else N.default.log("Cannot send heartbeat, because socket closed")},i.prototype._wsOpen=function(){return!!this._socket&&1===this._socket.readyState},i.prototype._sendQueuedMessages=function(){var e,t,o=function(n,i,e){if(e||2===arguments.length)for(var s,t=0,o=i.length;t<o;t++)(s||!(t in i))&&(s||(s=Array.prototype.slice.call(i,0,t)),s[t]=i[t]);return n.concat(s||Array.prototype.slice.call(i))}([],function(n,i){var e="function"==typeof Symbol&&n[Symbol.iterator];if(!e)return n;var o,a,t=e.call(n),s=[];try{for(;(void 0===i||i-- >0)&&!(o=t.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(e=t.return)&&e.call(t)}finally{if(a)throw a.error}}return s}(this._messagesQueue),!1);this._messagesQueue=[];try{for(var s=function(n){var i="function"==typeof Symbol&&Symbol.iterator,e=i&&n[i],t=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&t>=n.length&&(n=void 0),{value:n&&n[t++],done:!n}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}(o),a=s.next();!a.done;a=s.next())this.send(a.value)}catch(g){e={error:g}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}},i.prototype.send=function(e){if(!this._disconnected){if(!this._id)return void this._messagesQueue.push(e);if(!e.type)return void this.emit(he.Error,"Invalid message");if(this._wsOpen()){var t=JSON.stringify(e);this._socket.send(t)}}},i.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},i.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},i}(nt.EventEmitter),Vt={};xe(Vt,"MediaConnection",()=>pr,n=>pr=n);var Yt={};xe(Yt,"Negotiator",()=>cr,n=>cr=n);var xt=function(){return xt=Object.assign||function(n){for(var i,e=1,t=arguments.length;e<t;e++)for(var o in i=arguments[e])Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o]);return n},xt.apply(this,arguments)},kt=function(n,i,e,t){return new(e||(e=Promise))(function(s,a){function c(C){try{m(t.next(C))}catch(R){a(R)}}function g(C){try{m(t.throw(C))}catch(R){a(R)}}function m(C){C.done?s(C.value):function o(s){return s instanceof e?s:new e(function(a){a(s)})}(C.value).then(c,g)}m((t=t.apply(n,i||[])).next())})},Et=function(n,i){var t,o,s,a,e={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(m){return function(C){return function g(m){if(t)throw new TypeError("Generator is already executing.");for(;e;)try{if(t=1,o&&(s=2&m[0]?o.return:m[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,m[1])).done)return s;switch(o=0,s&&(m=[2&m[0],s.value]),m[0]){case 0:case 1:s=m;break;case 4:return e.label++,{value:m[1],done:!1};case 5:e.label++,o=m[1],m=[0];continue;case 7:m=e.ops.pop(),e.trys.pop();continue;default:if(!(s=(s=e.trys).length>0&&s[s.length-1])&&(6===m[0]||2===m[0])){e=0;continue}if(3===m[0]&&(!s||m[1]>s[0]&&m[1]<s[3])){e.label=m[1];break}if(6===m[0]&&e.label<s[1]){e.label=s[1],s=m;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(m);break}s[2]&&e.ops.pop(),e.trys.pop();continue}m=i.call(n,e)}catch(C){m=[6,C],o=0}finally{t=s=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([m,C])}}},cr=function(){function n(i){this.connection=i}return n.prototype.startConnection=function(i){var e=this._startPeerConnection();if(this.connection.peerConnection=e,this.connection.type===de.Media&&i._stream&&this._addTracksToConnection(i._stream,e),i.originator){if(this.connection.type===de.Data){var t=this.connection,s=e.createDataChannel(t.label,{ordered:!!i.reliable});t.initialize(s)}this._makeOffer()}else this.handleSDP("OFFER",i.sdp)},n.prototype._startPeerConnection=function(){N.default.log("Creating RTCPeerConnection.");var i=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(i),i},n.prototype._setupListeners=function(i){var e=this,t=this.connection.peer,o=this.connection.connectionId,s=this.connection.type,a=this.connection.provider;N.default.log("Listening for ICE candidates."),i.onicecandidate=function(c){!c.candidate||!c.candidate.candidate||(N.default.log("Received ICE candidates for ".concat(t,":"),c.candidate),a.socket.send({type:X.Candidate,payload:{candidate:c.candidate,type:s,connectionId:o},dst:t}))},i.oniceconnectionstatechange=function(){switch(i.iceConnectionState){case"failed":N.default.log("iceConnectionState is failed, closing connections to "+t),e.connection.emit("error",new Error("Negotiation of connection to "+t+" failed.")),e.connection.close();break;case"closed":N.default.log("iceConnectionState is closed, closing connections to "+t),e.connection.emit("error",new Error("Connection to "+t+" closed.")),e.connection.close();break;case"disconnected":N.default.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":i.onicecandidate=W.noop}e.connection.emit("iceStateChanged",i.iceConnectionState)},N.default.log("Listening for data channel"),i.ondatachannel=function(c){N.default.log("Received data channel");var g=c.channel;a.getConnection(t,o).initialize(g)},N.default.log("Listening for remote stream"),i.ontrack=function(c){N.default.log("Received remote stream");var g=c.streams[0],m=a.getConnection(t,o);m.type===de.Media&&e._addStreamToMediaConnection(g,m)}},n.prototype.cleanup=function(){N.default.log("Cleaning up PeerConnection to "+this.connection.peer);var i=this.connection.peerConnection;if(i){this.connection.peerConnection=null,i.onicecandidate=i.oniceconnectionstatechange=i.ondatachannel=i.ontrack=function(){};var t=!1;if(this.connection.type===de.Data){var s=this.connection.dataChannel;s&&(t=!!s.readyState&&"closed"!==s.readyState)}("closed"!==i.signalingState||t)&&i.close()}},n.prototype._makeOffer=function(){return kt(this,void 0,Promise,function(){var i,e,t,o,s,a,c;return Et(this,function(g){switch(g.label){case 0:i=this.connection.peerConnection,e=this.connection.provider,g.label=1;case 1:return g.trys.push([1,7,,8]),[4,i.createOffer(this.connection.options.constraints)];case 2:t=g.sent(),N.default.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(t.sdp=this.connection.options.sdpTransform(t.sdp)||t.sdp),g.label=3;case 3:return g.trys.push([3,5,,6]),[4,i.setLocalDescription(t)];case 4:return g.sent(),N.default.log("Set localDescription:",t,"for:".concat(this.connection.peer)),o={sdp:t,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:W.browser},this.connection.type===de.Data&&(s=this.connection,o=xt(xt({},o),{label:s.label,reliable:s.reliable,serialization:s.serialization})),e.socket.send({type:X.Offer,payload:o,dst:this.connection.peer}),[3,6];case 5:return"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=(a=g.sent())&&(e.emitError(V.WebRTC,a),N.default.log("Failed to setLocalDescription, ",a)),[3,6];case 6:return[3,8];case 7:return c=g.sent(),e.emitError(V.WebRTC,c),N.default.log("Failed to createOffer, ",c),[3,8];case 8:return[2]}})})},n.prototype._makeAnswer=function(){return kt(this,void 0,Promise,function(){var i,e,t,o,s;return Et(this,function(a){switch(a.label){case 0:i=this.connection.peerConnection,e=this.connection.provider,a.label=1;case 1:return a.trys.push([1,7,,8]),[4,i.createAnswer()];case 2:t=a.sent(),N.default.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(t.sdp=this.connection.options.sdpTransform(t.sdp)||t.sdp),a.label=3;case 3:return a.trys.push([3,5,,6]),[4,i.setLocalDescription(t)];case 4:return a.sent(),N.default.log("Set localDescription:",t,"for:".concat(this.connection.peer)),e.socket.send({type:X.Answer,payload:{sdp:t,type:this.connection.type,connectionId:this.connection.connectionId,browser:W.browser},dst:this.connection.peer}),[3,6];case 5:return o=a.sent(),e.emitError(V.WebRTC,o),N.default.log("Failed to setLocalDescription, ",o),[3,6];case 6:return[3,8];case 7:return s=a.sent(),e.emitError(V.WebRTC,s),N.default.log("Failed to create answer, ",s),[3,8];case 8:return[2]}})})},n.prototype.handleSDP=function(i,e){return kt(this,void 0,Promise,function(){var t,o,s,a;return Et(this,function(c){switch(c.label){case 0:e=new RTCSessionDescription(e),t=this.connection.peerConnection,o=this.connection.provider,N.default.log("Setting remote description",e),s=this,c.label=1;case 1:return c.trys.push([1,5,,6]),[4,t.setRemoteDescription(e)];case 2:return c.sent(),N.default.log("Set remoteDescription:".concat(i," for:").concat(this.connection.peer)),"OFFER"!==i?[3,4]:[4,s._makeAnswer()];case 3:c.sent(),c.label=4;case 4:return[3,6];case 5:return a=c.sent(),o.emitError(V.WebRTC,a),N.default.log("Failed to setRemoteDescription, ",a),[3,6];case 6:return[2]}})})},n.prototype.handleCandidate=function(i){return kt(this,void 0,Promise,function(){var e,t,o,s,a,c;return Et(this,function(g){switch(g.label){case 0:N.default.log("handleCandidate:",i),e=i.candidate,t=i.sdpMLineIndex,o=i.sdpMid,s=this.connection.peerConnection,a=this.connection.provider,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,s.addIceCandidate(new RTCIceCandidate({sdpMid:o,sdpMLineIndex:t,candidate:e}))];case 2:return g.sent(),N.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return c=g.sent(),a.emitError(V.WebRTC,c),N.default.log("Failed to handleCandidate, ",c),[3,4];case 4:return[2]}})})},n.prototype._addTracksToConnection=function(i,e){if(N.default.log("add tracks from stream ".concat(i.id," to peer connection")),!e.addTrack)return N.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");i.getTracks().forEach(function(t){e.addTrack(t,i)})},n.prototype._addStreamToMediaConnection=function(i,e){N.default.log("add stream ".concat(i.id," to media connection ").concat(e.connectionId)),e.addStream(i)},n}(),Qt={};xe(Qt,"BaseConnection",()=>lr,n=>lr=n);var Fi=function(){var n=function(i,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s])})(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}n(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}}(),lr=function(n){function i(e,t,o){var s=n.call(this)||this;return s.peer=e,s.provider=t,s.options=o,s._open=!1,s.metadata=o.metadata,s}return Fi(i,n),Object.defineProperty(i.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),i}(nt.EventEmitter),ji=function(){var n=function(i,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s])})(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}n(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}}(),Rt=function(){return Rt=Object.assign||function(n){for(var i,e=1,t=arguments.length;e<t;e++)for(var o in i=arguments[e])Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o]);return n},Rt.apply(this,arguments)},pr=function(n){function i(e,t,o){var s=n.call(this,e,t,o)||this;return s._localStream=s.options._stream,s.connectionId=s.options.connectionId||i.ID_PREFIX+W.randomToken(),s._negotiator=new Yt.Negotiator(s),s._localStream&&s._negotiator.startConnection({_stream:s._localStream,originator:!0}),s}return ji(i,n),Object.defineProperty(i.prototype,"type",{get:function(){return de.Media},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),i.prototype.addStream=function(e){N.default.log("Receiving stream",e),this._remoteStream=e,n.prototype.emit.call(this,"stream",e)},i.prototype.handleMessage=function(e){var t=e.type,o=e.payload;switch(e.type){case X.Answer:this._negotiator.handleSDP(t,o.sdp),this._open=!0;break;case X.Candidate:this._negotiator.handleCandidate(o.candidate);break;default:N.default.warn("Unrecognized message type:".concat(t," from peer:").concat(this.peer))}},i.prototype.answer=function(e,t){var o,s;if(void 0===t&&(t={}),this._localStream)N.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection(Rt(Rt({},this.options._payload),{_stream:e}));var a=this.provider._getMessages(this.connectionId);try{for(var c=function(n){var i="function"==typeof Symbol&&Symbol.iterator,e=i&&n[i],t=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&t>=n.length&&(n=void 0),{value:n&&n[t++],done:!n}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}(a),g=c.next();!g.done;g=c.next())this.handleMessage(g.value)}catch(C){o={error:C}}finally{try{g&&!g.done&&(s=c.return)&&s.call(c)}finally{if(o)throw o.error}}this._open=!0}},i.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},i.ID_PREFIX="mc_",i}(Qt.BaseConnection),Ht={};xe(Ht,"DataConnection",()=>dr,n=>dr=n);var ur={};xe(ur,"EncodingQueue",()=>fr,n=>fr=n);var Ui=function(){var n=function(i,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s])})(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}n(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}}(),fr=function(n){function i(){var e=n.call(this)||this;return e.fileReader=new FileReader,e._queue=[],e._processing=!1,e.fileReader.onload=function(t){e._processing=!1,t.target&&e.emit("done",t.target.result),e.doNextTask()},e.fileReader.onerror=function(t){N.default.error("EncodingQueue error:",t),e._processing=!1,e.destroy(),e.emit("error",t)},e}return Ui(i,n),Object.defineProperty(i.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),i.prototype.enque=function(e){this.queue.push(e),!this.processing&&this.doNextTask()},i.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},i.prototype.doNextTask=function(){0!==this.size&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},i}(nt.EventEmitter),Zi=function(){var n=function(i,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s])})(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}n(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}}(),dr=function(n){function i(e,t,o){var s=n.call(this,e,t,o)||this;return s.stringify=JSON.stringify,s.parse=JSON.parse,s._buffer=[],s._bufferSize=0,s._buffering=!1,s._chunkedData={},s._encodingQueue=new ur.EncodingQueue,s.connectionId=s.options.connectionId||i.ID_PREFIX+W.randomToken(),s.label=s.options.label||s.connectionId,s.serialization=s.options.serialization||ge.Binary,s.reliable=!!s.options.reliable,s._encodingQueue.on("done",function(a){s._bufferedSend(a)}),s._encodingQueue.on("error",function(){N.default.error("DC#".concat(s.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),s.close()}),s._negotiator=new Yt.Negotiator(s),s._negotiator.startConnection(s.options._payload||{originator:!0}),s}return Zi(i,n),Object.defineProperty(i.prototype,"type",{get:function(){return de.Data},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),i.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},i.prototype._configureDataChannel=function(){var e=this;(!W.supports.binaryBlob||W.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){N.default.log("DC#".concat(e.connectionId," dc connection success")),e._open=!0,e.emit("open")},this.dataChannel.onmessage=function(t){N.default.log("DC#".concat(e.connectionId," dc onmessage:"),t.data),e._handleDataMessage(t)},this.dataChannel.onclose=function(){N.default.log("DC#".concat(e.connectionId," dc closed for:"),e.peer),e.close()}},i.prototype._handleDataMessage=function(e){var t=this,o=e.data,s=o.constructor,c=o;if(this.serialization===ge.Binary||this.serialization===ge.BinaryUTF8){if(s===Blob)return void W.blobToArrayBuffer(o,function(m){var C=W.unpack(m);t.emit("data",C)});if(s===ArrayBuffer)c=W.unpack(o);else if(s===String){var g=W.binaryStringToArrayBuffer(o);c=W.unpack(g)}}else this.serialization===ge.JSON&&(c=this.parse(o));c.__peerData?this._handleChunk(c):n.prototype.emit.call(this,"data",c)},i.prototype._handleChunk=function(e){var t=e.__peerData,o=this._chunkedData[t]||{data:[],count:0,total:e.total};if(o.data[e.n]=e.data,o.count++,this._chunkedData[t]=o,o.total===o.count){delete this._chunkedData[t];var s=new Blob(o.data);this._handleDataMessage({data:s})}},i.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,n.prototype.emit.call(this,"close"))},i.prototype.send=function(e,t){if(this.open)if(this.serialization===ge.JSON)this._bufferedSend(this.stringify(e));else if(this.serialization===ge.Binary||this.serialization===ge.BinaryUTF8){var o=W.pack(e);if(!t&&o.size>W.chunkedMTU)return void this._sendChunks(o);W.supports.binaryBlob?this._bufferedSend(o):this._encodingQueue.enque(o)}else this._bufferedSend(e);else n.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."))},i.prototype._bufferedSend=function(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)},i.prototype._trySend=function(e){var t=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>i.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){t._buffering=!1,t._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(o){return N.default.error("DC#:".concat(this.connectionId," Error when sending:"),o),this._buffering=!0,this.close(),!1}return!0},i.prototype._tryBuffer=function(){this.open&&0!==this._buffer.length&&this._trySend(this._buffer[0])&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())},i.prototype._sendChunks=function(e){var t,o,s=W.chunk(e);N.default.log("DC#".concat(this.connectionId," Try to send ").concat(s.length," chunks..."));try{for(var a=function(n){var i="function"==typeof Symbol&&Symbol.iterator,e=i&&n[i],t=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&t>=n.length&&(n=void 0),{value:n&&n[t++],done:!n}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}(s),c=a.next();!c.done;c=a.next())this.send(c.value,!0)}catch(m){t={error:m}}finally{try{c&&!c.done&&(o=a.return)&&o.call(a)}finally{if(t)throw t.error}}},i.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case X.Answer:this._negotiator.handleSDP(e.type,t.sdp);break;case X.Candidate:this._negotiator.handleCandidate(t.candidate);break;default:N.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},i.ID_PREFIX="dc_",i.MAX_BUFFERED_AMOUNT=8388608,i}(Qt.BaseConnection),hr={};xe(hr,"API",()=>vr,n=>vr=n);var mr=function(n,i,e,t){return new(e||(e=Promise))(function(s,a){function c(C){try{m(t.next(C))}catch(R){a(R)}}function g(C){try{m(t.throw(C))}catch(R){a(R)}}function m(C){C.done?s(C.value):function o(s){return s instanceof e?s:new e(function(a){a(s)})}(C.value).then(c,g)}m((t=t.apply(n,i||[])).next())})},gr=function(n,i){var t,o,s,a,e={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(m){return function(C){return function g(m){if(t)throw new TypeError("Generator is already executing.");for(;e;)try{if(t=1,o&&(s=2&m[0]?o.return:m[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,m[1])).done)return s;switch(o=0,s&&(m=[2&m[0],s.value]),m[0]){case 0:case 1:s=m;break;case 4:return e.label++,{value:m[1],done:!1};case 5:e.label++,o=m[1],m=[0];continue;case 7:m=e.ops.pop(),e.trys.pop();continue;default:if(!(s=(s=e.trys).length>0&&s[s.length-1])&&(6===m[0]||2===m[0])){e=0;continue}if(3===m[0]&&(!s||m[1]>s[0]&&m[1]<s[3])){e.label=m[1];break}if(6===m[0]&&e.label<s[1]){e.label=s[1],s=m;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(m);break}s[2]&&e.ops.pop(),e.trys.pop();continue}m=i.call(n,e)}catch(C){m=[6,C],o=0}finally{t=s=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([m,C])}}},vr=function(){function n(i){this._options=i}return n.prototype._buildRequest=function(i){var t=this._options,o=t.host,s=t.port,a=t.path,c=t.key,g=new URL("".concat(this._options.secure?"https":"http","://").concat(o,":").concat(s).concat(a).concat(c,"/").concat(i));return g.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),g.searchParams.set("version",zt.version),fetch(g.href,{referrerPolicy:this._options.referrerPolicy})},n.prototype.retrieveId=function(){return mr(this,void 0,Promise,function(){var i,e,t;return gr(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(200!==(i=o.sent()).status)throw new Error("Error. Status:".concat(i.status));return[2,i.text()];case 2:throw e=o.sent(),N.default.error("Error retrieving ID",e),t="","/"===this._options.path&&this._options.host!==W.CLOUD_HOST&&(t=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+t);case 3:return[2]}})})},n.prototype.listAllPeers=function(){return mr(this,void 0,Promise,function(){var i,e,t;return gr(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(200!==(i=o.sent()).status)throw 401===i.status?("",e=this._options.host===W.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+e)):new Error("Error. Status:".concat(i.status));return[2,i.json()];case 2:throw t=o.sent(),N.default.error("Error retrieving list peers",t),new Error("Could not get list peers from the server."+t);case 3:return[2]}})})},n}(),Ji=function(){var n=function(i,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s])})(i,e)};return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}n(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}}(),it=function(){return it=Object.assign||function(n){for(var i,e=1,t=arguments.length;e<t;e++)for(var o in i=arguments[e])Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o]);return n},it.apply(this,arguments)},ot=function(n){var i="function"==typeof Symbol&&Symbol.iterator,e=i&&n[i],t=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&t>=n.length&&(n=void 0),{value:n&&n[t++],done:!n}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},Gi=function(n,i){var e="function"==typeof Symbol&&n[Symbol.iterator];if(!e)return n;var o,a,t=e.call(n),s=[];try{for(;(void 0===i||i-- >0)&&!(o=t.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(e=t.return)&&e.call(t)}finally{if(a)throw a.error}}return s},yr=function(n){function i(e,t){var s,o=n.call(this)||this;return o._id=null,o._lastServerId=null,o._destroyed=!1,o._disconnected=!1,o._open=!1,o._connections=new Map,o._lostMessages=new Map,e&&e.constructor==Object?t=e:e&&(s=e.toString()),t=it({debug:0,host:W.CLOUD_HOST,port:W.CLOUD_PORT,path:"/",key:i.DEFAULT_KEY,token:W.randomToken(),config:W.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},t),o._options=t,"/"===o._options.host&&(o._options.host=window.location.hostname),o._options.path&&("/"!==o._options.path[0]&&(o._options.path="/"+o._options.path),"/"!==o._options.path[o._options.path.length-1]&&(o._options.path+="/")),void 0===o._options.secure&&o._options.host!==W.CLOUD_HOST?o._options.secure=W.isSecure():o._options.host==W.CLOUD_HOST&&(o._options.secure=!0),o._options.logFunction&&N.default.setLogFunction(o._options.logFunction),N.default.logLevel=o._options.debug||0,o._api=new hr.API(t),o._socket=o._createServerConnection(),W.supports.audioVideo||W.supports.data?s&&!W.validateId(s)?(o._delayedAbort(V.InvalidID,'ID "'.concat(s,'" is invalid')),o):(s?o._initialize(s):o._api.retrieveId().then(function(a){return o._initialize(a)}).catch(function(a){return o._abort(V.ServerError,a)}),o):(o._delayedAbort(V.BrowserIncompatible,"The current browser does not support WebRTC"),o)}return Ji(i,n),Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"connections",{get:function(){var e,t,o=Object.create(null);try{for(var s=ot(this._connections),a=s.next();!a.done;a=s.next()){var c=Gi(a.value,2);o[c[0]]=c[1]}}catch(C){e={error:C}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return o},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),i.prototype._createServerConnection=function(){var e=this,t=new sr.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return t.on(he.Message,function(o){e._handleMessage(o)}),t.on(he.Error,function(o){e._abort(V.SocketError,o)}),t.on(he.Disconnected,function(){e.disconnected||(e.emitError(V.Network,"Lost connection to server."),e.disconnect())}),t.on(he.Close,function(){e.disconnected||e._abort(V.SocketClosed,"Underlying socket is already closed.")}),t},i.prototype._initialize=function(e){this._id=e,this.socket.start(e,this._options.token)},i.prototype._handleMessage=function(e){var t,o,s=e.type,a=e.payload,c=e.src;switch(s){case X.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case X.Error:this._abort(V.ServerError,a.msg);break;case X.IdTaken:this._abort(V.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case X.InvalidKey:this._abort(V.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case X.Leave:N.default.log("Received leave message from ".concat(c)),this._cleanupPeer(c),this._connections.delete(c);break;case X.Expire:this.emitError(V.PeerUnavailable,"Could not connect to peer ".concat(c));break;case X.Offer:if((ne=this.getConnection(c,te=a.connectionId))&&(ne.close(),N.default.warn("Offer received for existing Connection ID:".concat(te))),a.type===de.Media){var g=new Vt.MediaConnection(c,this,{connectionId:te,_payload:a,metadata:a.metadata});this._addConnection(c,ne=g),this.emit("call",g)}else{if(a.type!==de.Data)return void N.default.warn("Received malformed connection type:".concat(a.type));var m=new Ht.DataConnection(c,this,{connectionId:te,_payload:a,metadata:a.metadata,label:a.label,serialization:a.serialization,reliable:a.reliable});this._addConnection(c,ne=m),this.emit("connection",m)}var C=this._getMessages(te);try{for(var R=ot(C),F=R.next();!F.done;F=R.next())ne.handleMessage(F.value)}catch(da){t={error:da}}finally{try{F&&!F.done&&(o=R.return)&&o.call(R)}finally{if(t)throw t.error}}break;default:if(!a)return void N.default.warn("You received a malformed message from ".concat(c," of type ").concat(s));var te,ne;(ne=this.getConnection(c,te=a.connectionId))&&ne.peerConnection?ne.handleMessage(e):te?this._storeMessage(te,e):N.default.warn("You received an unrecognized message:",e)}},i.prototype._storeMessage=function(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)},i.prototype._getMessages=function(e){var t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]},i.prototype.connect=function(e,t){if(void 0===t&&(t={}),this.disconnected)return N.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(V.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var o=new Ht.DataConnection(e,this,t);return this._addConnection(e,o),o},i.prototype.call=function(e,t,o){if(void 0===o&&(o={}),this.disconnected)return N.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(V.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(t){var s=new Vt.MediaConnection(e,this,it(it({},o),{_stream:t}));return this._addConnection(e,s),s}N.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},i.prototype._addConnection=function(e,t){N.default.log("add connection ".concat(t.type,":").concat(t.connectionId," to peerId:").concat(e)),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)},i.prototype._removeConnection=function(e){var t=this._connections.get(e.peer);if(t){var o=t.indexOf(e);-1!==o&&t.splice(o,1)}this._lostMessages.delete(e.connectionId)},i.prototype.getConnection=function(e,t){var o,s,a=this._connections.get(e);if(!a)return null;try{for(var c=ot(a),g=c.next();!g.done;g=c.next()){var m=g.value;if(m.connectionId===t)return m}}catch(C){o={error:C}}finally{try{g&&!g.done&&(s=c.return)&&s.call(c)}finally{if(o)throw o.error}}return null},i.prototype._delayedAbort=function(e,t){var o=this;setTimeout(function(){o._abort(e,t)},0)},i.prototype._abort=function(e,t){N.default.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()},i.prototype.emitError=function(e,t){var o;N.default.error("Error:",t),(o="string"==typeof t?new Error(t):t).type=e,this.emit("error",o)},i.prototype.destroy=function(){this.destroyed||(N.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},i.prototype._cleanup=function(){var e,t;try{for(var o=ot(this._connections.keys()),s=o.next();!s.done;s=o.next()){var a=s.value;this._cleanupPeer(a),this._connections.delete(a)}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}this.socket.removeAllListeners()},i.prototype._cleanupPeer=function(e){var t,o,s=this._connections.get(e);if(s)try{for(var a=ot(s),c=a.next();!c.done;c=a.next())c.value.close()}catch(m){t={error:m}}finally{try{c&&!c.done&&(o=a.return)&&o.call(a)}finally{if(t)throw t.error}}},i.prototype.disconnect=function(){if(!this.disconnected){var e=this.id;N.default.log("Disconnect peer with ID:".concat(e)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}},i.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)N.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"));N.default.error("In a hurry? We're still trying to make the initial connection!")}},i.prototype.listAllPeers=function(e){var t=this;void 0===e&&(e=function(o){}),this._api.listAllPeers().then(function(o){return e(o)}).catch(function(o){return t._abort(V.ServerError,o)})},i.DEFAULT_KEY="peerjs",i}(nt.EventEmitter),qi=rr.Peer,_r=p(1135),Wt=p(4707),Kt=p(7414),ke=p(5698),Ze=p(9300),Ce=p(2809),Q=p(3827),re=p(8784),zi=p(6110);let Xt=(()=>{class n{constructor(e,t){this.store=e,this.cache=t,this.liveText$=new _r.X(""),this.textOutput$=new _r.X([]),this.CACHE_PERSIST_MINS=60,this.myBroadcast=!1,this.roomId=new Wt.t,this.peerMap=new Map,this.SOCKET_URL="https://socket.zipcaptions.app",this.PEER_PORT=443,this.SOCKET_CONFIG={url:`${this.SOCKET_URL}`,options:{reconnectionAttempts:10,reconnection:!0}},this.PEER_URL="peer.zipcaptions.app",this.STUN_SERVER={ZIP_SOCKET_SERVER:"https://socket.zipcaptions.app",ZIP_SOCKET_PORT:"443",ZIP_PEER_SERVER:"peer.zipcaptions.app",ZIP_PEER_PORT:"443",BUILD_YEAR:2024,BUILD_TS:1705541921658}.ZIP_STUN_SERVER||"localhost:19302",this.TURN_SERVER={ZIP_SOCKET_SERVER:"https://socket.zipcaptions.app",ZIP_SOCKET_PORT:"443",ZIP_PEER_SERVER:"peer.zipcaptions.app",ZIP_PEER_PORT:"443",BUILD_YEAR:2024,BUILD_TS:1705541921658}.ZIP_TURN_SERVER||"localhost:3478",this.TURN_PASS={ZIP_SOCKET_SERVER:"https://socket.zipcaptions.app",ZIP_SOCKET_PORT:"443",ZIP_PEER_SERVER:"peer.zipcaptions.app",ZIP_PEER_PORT:"443",BUILD_YEAR:2024,BUILD_TS:1705541921658}.ZIP_TURN_PASSWORD||"coturn",this.CONNECT_OPTS={debug:0,host:this.PEER_URL,port:this.PEER_PORT,path:"peer-server",secure:"localhost"!==this.PEER_URL,config:{iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302",`stun:${this.STUN_SERVER}`,`turn:${this.TURN_SERVER}`],credential:this.TURN_PASS}]}},this.peerServerConnected=(0,P.O4)(this.store.select(Q.jT)),this.sessionJoinCode=(0,P.O4)(this.store.select(Q.cJ)),this.peerCount=(0,P.O4)(this.store.select(Q.tF));const o=this.cache.load("userId");o?.id&&(this.myId=o.id),console.log(`Socket Server: ${this.SOCKET_CONFIG.url}`)}connectSocket(){console.log("connect socket"),this.socket&&this.socket.removeAllListeners(),this.socket=new gn(this.SOCKET_CONFIG);const e=new j.x;return this.socket.on("connect",()=>{console.log("socket connected"),this.socket.emit("setId",{id:this.myId}),this.store.dispatch(w.p.socketServerConnected()),this.myId&&(e.next(this.myId),this.peerServerConnected()||(console.log("connect peer server",this.myId),this.store.dispatch(w.p.connectPeerServer())))}),this.socket.on("disconnect",()=>this.store.dispatch(w.p.socketServerDisconnected())),this.socket.on("error",t=>{e.error(t.message),console.log("error",t),this.store.dispatch(w.p.socketServerError({error:t.message}))}),this.socket.on("endBroadcast",()=>this._disconnectAllPeers()),this.socket.on("message",t=>{switch(console.log("socket message",t),t.message){case"room joined":t.room&&(console.log("nexting room id",t.room),this.cache.save({key:"roomId",data:{room:t.room,myBroadcast:this.myBroadcast},expirationMins:this.CACHE_PERSIST_MINS}),this.roomId.next(t.room));break;case"set user id":console.log("set user id",t.id,this.myId),this.myId&&this.myId!==t.id?(this.socket.emit("setId",{id:this.myId}),t.id===this.myId&&e.next(this.myId)):t.id&&(this.myId=t.id,console.log("SAVING USER ID",t.id),this.cache.save({key:"userId",data:{id:t.id},expirationMins:this.CACHE_PERSIST_MINS}),e.next(t.id)),!this.peerServerConnected()&&this.myId&&(console.log("connect peer server",this.myId),this.store.dispatch(w.p.connectPeerServer()));break;case"user joined room":if(t.user&&t.user!==this.myId){if(!this.peer)throw new Error("Cannot connect to peer - peer server connection not established");this.myBroadcast?this._connectToPeer(t.user):console.log("not my broadcast, peer connected",t.user)}break;case"user left room":if(t.user){console.log("disconnect from peer!",t);const o=this.peerMap.get(t.user);o&&(o.addListener("close",()=>{console.log("closed!"),this.peerMap.delete(t.user)}),o.close())}break;case"connect clients":if(t.clients){const o=t.clients;console.log("clientIds",o,this.myId);for(const s of o)s!==this.myId&&this._connectToPeer(s)}break;case"broadcast expired":case"broadcast ended":t.expiredAt&&this.store.dispatch(w.p.setBroadcastEndedAt({endedAt:t.expiredAt}));break;default:console.warn("UNHANDLED MESSAGE!!!",t)}}),e.asObservable().pipe((0,Kt.V)(3e4),(0,ke.q)(1))}disconnectSocket(){const e=new j.x;return this.socket.removeListener("disconnect"),this.socket.on("disconnect",()=>{e.next(!0)}),setTimeout(()=>this.socket.disconnect(),1),e.asObservable().pipe((0,Kt.V)(500),(0,ke.q)(1))}joinRoom(e){if(this.myBroadcast=!e?.room,!e?.room){const t=this.cache.load("roomId");t?.room&&(e={room:t.room,myBroadcast:t?.myBroadcast}),void 0!==t?.myBroadcast&&(this.myBroadcast=t.myBroadcast)}if(this.myBroadcast){const t=this.cache.load("joinCode");let o;t?o=t.joinCode:(o=this._generateJoinCode(),this.cache.save({key:"joinCode",data:{joinCode:o}})),this.store.dispatch(w.p.setJoinCode({joinCode:o}))}return this.socket.volatile().emit("join",{room:e?.room,myBroadcast:this.myBroadcast}),this.roomId.asObservable().pipe((0,Ze.h)(t=>!!t))}sendServerMessage(e){this.socket.volatile().emit("message",e)}connectPeerServer(){if(!this.myId)throw new Error("Must obtain ID from socket server");if(this.peer?.id===this.myId&&!this.peer.disconnected)return console.log("peer server connection already exists and appears to be connected!!!"),(0,Z.of)(this.myId);const e=new Wt.t;return this.CONNECT_OPTS.config.iceServers[0].username=this.myId,this.peer=new qi(this.myId,this.CONNECT_OPTS),this.peer.addListener("open",()=>{console.log("peer server connection opened"),this.store.dispatch(w.p.peerServerConnected()),e.next(this.myId)}),this.peer.addListener("disconnected",()=>{console.log("peer server disconnected"),this.peerServerConnected()&&this.store.dispatch(w.p.peerServerDisconnected())}),this.peer.once("error",t=>{console.log("peer server error",t.message),this.store.dispatch(w.p.peerServerError({error:t.message})),this._reconnectPeerServer()}),this.peer.addListener("connection",t=>{console.log("incoming connection!",t),this.peerMap.set(t.connectionId,t),this._handlePeerData(t)}),e.asObservable().pipe((0,ke.q)(1))}disconnectPeerServer(){if(!this.peer)throw new Error("Peer not connected");const e=new j.x;return this.peer.removeListener("close"),this.peer.addListener("disconnected",()=>{e.next(!0)}),setTimeout(()=>{this.peer.disconnect(),console.log("peer disconnected")},1),e.asObservable().pipe((0,ke.q)(1))}sendData(e,t){const o=this.peerMap.get(e);if(!o)throw new Error(`connection ${e} not found`);o.send(t)}broadcastData(e){for(const t of this.peerMap.values())t.send(e)}endBroadcast(){const e=new Wt.t,o=this.cache.load("roomId")?.room;if(!o)throw new Error("No room defined for broadcast");return this.cache.remove("roomId"),this.cache.remove("joinCode"),this.socket.once("endBroadcast",()=>{console.log("endbroadcast response recieved"),e.next(),e.complete()}),this.socket.emit("endBroadcast",{room:o}),e}leaveSession(){console.log("leaveSession",this.peerMap.size),this.cache.remove("roomId"),this.cache.remove("joinCode"),this.peerMap.forEach(e=>{console.log("peer",e.connectionId),e.close()}),this.textOutput$.next([]),this.liveText$.next(""),this.peerMap.clear()}_reconnectPeerServer(e){let t=e||0;const o=setTimeout(()=>{this.peer?.disconnected&&t<5?(this.peer.once("error",()=>{this._reconnectPeerServer(++t)}),this.peer.once("open",()=>{t=0,clearTimeout(o)}),this.peer?.reconnect()):t<5?this._reconnectPeerServer(++t):(this.store.dispatch(w.p.connectPeerServerFailure({error:"Peer server connection lost."})),t=0,clearTimeout(o))},1e3*t+150)}_connectToPeer(e){const t=this.peer.connect(e);this._handlePeerData(t),this.peerMap.set(e,t),this._updateConnectedPeerCount(),t.on("close",()=>{console.log("connection closed",e),this.peerMap.delete(e),this._updateConnectedPeerCount()})}_updateConnectedPeerCount(){this.peerMap.size!==this.peerCount()&&this.store.dispatch(w.p.updateConnectedPeerCount({count:this.peerMap.size}))}_disconnectAllPeers(){for(const e of this.peerMap.values())e.close();this.peerMap.clear(),this._updateConnectedPeerCount()}_generateJoinCode(){let e="";for(let o=0;o<4;o++)e+="acdefghjkmnpqrstuvwxyz2345679".charAt(Math.floor(29*Math.random()));return e}_handlePeerData(e){e.on("close",()=>{console.log("connection closed"),this.myBroadcast||this.store.dispatch(w.p.setHostStatus({hostOnline:!1})),e.removeAllListeners()}),e.on("open",()=>{console.log("peer connection opened",this.myBroadcast),this.myBroadcast&&(console.log("must validate join code",this.sessionJoinCode()),e.send({request:"joinCode"}))}),e.on("data",t=>{if(t?.request)switch(t.request){case"joinCode":e.send({request:"validateJoinCode",joinCode:this.sessionJoinCode()});break;case"validateJoinCode":this._verifyJoinCode(t.joinCode)?(console.log("join code verified"),e.send({response:"valid"})):(console.log("closing connection"),e.send({response:"invalid"}));break;case"disconnect":console.log("disconnect requested"),e.close(),this.store.dispatch(w.p.setHostStatus({hostOnline:!1}));break;case"hostOffline":console.log("host offline"),this.store.dispatch(w.p.setHostStatus({hostOnline:!1}))}else if(t?.response)switch(t.response){case"valid":console.log("join code valid!"),this.store.dispatch(w.p.setHostStatus({hostOnline:!0}));break;case"invalid":e.close(),this.store.dispatch(w.p.clearJoinCode())}else if("recognition"in t&&"type"in t)switch(t.type){case"live":this.liveText$.next(t.recognition);break;case"segment":this.textOutput$.next(t.recognition)}else"status"===t?.type&&"status"in t?this.store.dispatch(w.p.setBroadcastPausedState({paused:t.status===Ce.T.paused})):console.warn("UNHANDLED DATA",t)})}_verifyJoinCode(e){const t=this.sessionJoinCode();return!(!t||!e||t!==e.toLowerCase())}static#e=this.\u0275fac=function(t){return new(t||n)(r.LFG(re.yh),r.LFG(zi.Q))};static#t=this.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Vi=(()=>{class n{constructor(e,t){this.actions$=e,this.peerService=t,this.connectSocketServer$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(w.p.connectSocketServer),(0,k.w)(()=>this.peerService.connectSocket()),(0,B.U)(o=>w.p.socketServerUserIdAssigned({id:o})),(0,O.K)(o=>(0,Z.of)(w.p.connectSocketServerFailure({error:o.message}))))),this.disconnectSocketServer$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(w.p.disconnectSocketServer),(0,k.w)(()=>this.peerService.disconnectSocket()),(0,B.U)(()=>w.p.socketServerDisconnected()))),this.connectPeerServer$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(w.p.connectPeerServer),(0,k.w)(()=>this.peerService.connectPeerServer()),(0,B.U)(o=>w.p.peerServerConnected()),(0,O.K)(o=>(0,Z.of)(w.p.connectPeerServerFailure({error:o.message}))))),this.disconnectPeerServer$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(w.p.disconnectPeerServer),(0,k.w)(()=>this.peerService.disconnectPeerServer()),(0,k.w)(()=>[w.p.peerServerDisconnected(),w.p.disconnectSocketServer()]))),this.createRoom$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(w.p.createBroadcastRoom),(0,k.w)(()=>this.peerService.joinRoom()),(0,B.U)(o=>w.p.createBroadcastRoomSuccess({id:o})),(0,O.K)(o=>(0,Z.of)(w.p.createBroadcastRoomFailure({error:o.message}))))),this.joinRoom$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(w.p.joinBroadcastRoom),(0,k.w)(({id:o})=>this.peerService.joinRoom({room:o})),(0,B.U)(()=>w.p.joinBroadcastRoomSuccess()),(0,O.K)(o=>(0,Z.of)(w.p.joinBroadcastRoomFailure({error:o.message}))))),this.leaveRoom$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(w.p.leaveBroadcastRoom),(0,B.U)(()=>this.peerService.leaveSession()),(0,B.U)(()=>w.p.leaveBroadcastRoomSuccess()),(0,O.K)(o=>(0,Z.of)(w.p.leaveBroadcastRoomFailure({error:o.message}))))),this.endBroadcast$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(w.p.endBroadcast),(0,k.w)(()=>this.peerService.endBroadcast()),(0,B.U)(()=>w.p.endBroadcastSuccess()),(0,O.K)(o=>(0,Z.of)(w.p.endBroadcastFailure({error:o.message})))))}static#e=this.\u0275fac=function(t){return new(t||n)(r.LFG(T.eX),r.LFG(Xt))};static#t=this.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac})}return n})();var Yi=p(3530),ue=p(8574),Le=p(4056),$e=p(9232),st=p(8603),Re=p(7595),we=p(2513);const Qi=["modal"],Hi=["close"];let Wi=(()=>{class n{constructor(e,t){this.store=e,this.renderer=t,this.isActive=(0,P.O4)(this.store.pipe((0,re.Ys)(we.SB),(0,B.U)(o=>o===Ce.T.connected)))}confirmEndBroadcast(){this._openModal()}endBroadcast(){this.store.dispatch(Ce.b.disconnectRecognition({id:"broadcast"})),this.store.select(we.SB).pipe((0,Ze.h)(e=>e===Ce.T.disconnected),(0,ke.q)(1)).subscribe(()=>{console.log("recognition ended, ending broadcast"),this.store.dispatch(w.p.endBroadcast())}),this._closeModal()}hideModal(){this._closeModal()}_openModal(){this.renderer.setAttribute(this.modal.nativeElement,"open","")}_closeModal(){this.closeButton.nativeElement.click()}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(re.yh),r.Y36(r.Qsj))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-end-broadcast"]],viewQuery:function(t,o){if(1&t&&(r.Gf(Qi,5,r.SBq),r.Gf(Hi,5,r.SBq)),2&t){let s;r.iGM(s=r.CRH())&&(o.modal=s.first),r.iGM(s=r.CRH())&&(o.closeButton=s.first)}},decls:17,vars:3,consts:[[1,"tooltip","tooltip-left","tooltip-warning"],[1,"btn","btn-circle","btn-info",3,"click"],["name","heroSignalSlash"],[1,"modal"],["modal",""],["method","dialog",1,"modal-box","bg-base-content","text-base-100","sm:w-11/12","justify-self-center"],["translate",""],[1,"modal-action"],["translate","","type","button",1,"btn",3,"click"],["type","button","translate","",1,"btn",3,"click"],["method","dialog",1,"modal-backdrop"],["close",""]],template:function(t,o){1&t&&(r.TgZ(0,"div",0),r.ALo(1,"translate"),r.TgZ(2,"button",1),r.NdJ("click",function(){return o.confirmEndBroadcast()}),r._UZ(3,"ng-icon",2),r.qZA()(),r.TgZ(4,"dialog",3,4)(6,"form",5)(7,"p",6),r._uU(8,"MODAL.confirmEndBroadcast"),r.qZA(),r.TgZ(9,"div",7)(10,"button",8),r.NdJ("click",function(){return o.endBroadcast()}),r._uU(11,"BUTTONS.confirm"),r.qZA(),r.TgZ(12,"button",9),r.NdJ("click",function(){return o.hideModal()}),r._uU(13,"BUTTONS.decline"),r.qZA()()(),r.TgZ(14,"form",10),r._UZ(15,"button",null,11),r.qZA()()),2&t&&r.uIk("data-tip",r.lcZ(1,1,"STREAM.endBroadcast"))},dependencies:[l._Y,l.JL,A.Fv,E.Pi,E.X$]})}return n})();function Ki(n,i){1&n&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.BQk()),2&n&&(r.xp6(1),r.Oqu(r.lcZ(2,1,"STREAM.connecting")))}function Xi(n,i){if(1&n&&(r._uU(0),r.ALo(1,"translate")),2&n){const e=r.oxw();r.hij(" ",r.lcZ(1,1,e.connected()?"STREAM.online":"STREAM.offline")," ")}}const eo=function(n,i,e){return{"badge-neutral":n,"badge-success":i,"badge-error":e}};let br=(()=>{class n{constructor(e){this.store=e,this.connected=(0,P.O4)(this.store.select(Q.sM)),this.serverError=(0,P.O4)(this.store.select(Q.ok))}reconnect(){this.connected()||this.store.dispatch(w.p.connectSocketServer())}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(re.yh))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-socket-server-status-chip"]],decls:6,vars:10,consts:[[1,"badge","h-auto",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["state",""]],template:function(t,o){if(1&t&&(r.TgZ(0,"button",0),r.NdJ("click",function(){return o.reconnect()}),r._uU(1),r.ALo(2,"translate"),r.YNc(3,Ki,3,3,"ng-container",1),r.YNc(4,Xi,2,3,"ng-template",null,2,r.W1O),r.qZA()),2&t){const s=r.MAs(5);r.Q6J("ngClass",r.kEZ(6,eo,!o.connected(),o.connected(),o.serverError())),r.xp6(1),r.hij(" ",r.lcZ(2,4,"STREAM.serverStatus"),": "),r.xp6(2),r.Q6J("ngIf",void 0===o.connected())("ngIfElse",s)}},dependencies:[f.mk,f.O5,E.X$]})}return n})();function to(n,i){1&n&&(r.ynx(0),r._uU(1),r.ALo(2,"translate"),r.BQk()),2&n&&(r.xp6(1),r.Oqu(r.lcZ(2,1,"STREAM.connecting")))}function no(n,i){if(1&n&&(r._uU(0),r.ALo(1,"translate")),2&n){const e=r.oxw();r.hij(" ",r.lcZ(1,1,e.connected()?"STREAM.online":"STREAM.offline")," ")}}const ro=function(n,i,e){return{"badge-neutral":n,"badge-success":i,"badge-error":e}};let Cr=(()=>{class n{constructor(e){this.store=e,this.connected=(0,P.O4)(this.store.select(Q.jT)),this.serverError=(0,P.O4)(this.store.select(Q.ok))}reconnect(){this.connected()||this.store.dispatch(w.p.connectPeerServer())}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(re.yh))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-peer-server-status-chip"]],decls:6,vars:10,consts:[[1,"badge","h-auto",3,"ngClass","click"],[4,"ngIf","ngIfElse"],["state",""]],template:function(t,o){if(1&t&&(r.TgZ(0,"button",0),r.NdJ("click",function(){return o.reconnect()}),r._uU(1),r.ALo(2,"translate"),r.YNc(3,to,3,3,"ng-container",1),r.YNc(4,no,2,3,"ng-template",null,2,r.W1O),r.qZA()),2&t){const s=r.MAs(5);r.Q6J("ngClass",r.kEZ(6,ro,!o.connected(),o.connected(),o.serverError())),r.xp6(1),r.hij(" ",r.lcZ(2,4,"STREAM.peerStatus"),": "),r.xp6(2),r.Q6J("ngIf",void 0===o.connected()&&!o.serverError())("ngIfElse",s)}},dependencies:[f.mk,f.O5,E.X$]})}return n})();const io=function(n,i){return{"badge-neutral":n,"badge-success":i}};let oo=(()=>{class n{constructor(e){this.store=e,this.count=(0,P.O4)(this.store.select(Q.tF))}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(re.yh))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-connected-peer-count-chip"]],decls:3,vars:8,consts:[[1,"badge","h-auto",3,"ngClass"]],template:function(t,o){1&t&&(r.TgZ(0,"div",0),r._uU(1),r.ALo(2,"translate"),r.qZA()),2&t&&(r.Q6J("ngClass",r.WLB(5,io,!o.count(),o.count())),r.xp6(1),r.AsE("",r.lcZ(2,3,"STREAM.connectedPeers"),": ",o.count(),""))},dependencies:[f.mk,E.X$]})}return n})();var ve=p(9124);function so(n,i){if(1&n){const e=r.EpF();r.TgZ(0,"div",2),r.NdJ("click",function(){r.CHM(e);const o=r.oxw();return r.KtG(o.showCopiedToClipboard())}),r.ALo(1,"translate"),r._uU(2),r.ALo(3,"translate"),r.qZA()}if(2&n){const e=r.oxw();r.Q6J("cbContent",e.roomId),r.uIk("data-tip",r.lcZ(1,4,"STREAM.copyIdTip")),r.xp6(2),r.AsE(" ",r.lcZ(3,6,"STREAM.sessionId"),": ",e.roomId.toUpperCase(),"\n")}}function ao(n,i){1&n&&(r.TgZ(0,"div",3)(1,"div",4),r._uU(2,"STREAM.sessionIdCopied"),r.qZA()()),2&n&&r.Q6J("@slideInUpOnEnter",void 0)("@fadeOutOnLeave",void 0)}let co=(()=>{class n{constructor(){this.showToast=(0,r.tdS)(!1)}showCopiedToClipboard(){this.showToast.set(!0),setTimeout(()=>this.showToast.set(!1),1500)}static#e=this.\u0275fac=function(t){return new(t||n)};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-room-id"]],inputs:{roomId:"roomId"},decls:2,vars:2,consts:[["class","badge h-auto badge-primary text-xl sm:text-2xl md:text-4xl lg:text-6xl cursor-pointer tooltip tooltip-bottom","ngxClipboard","",3,"cbContent","click",4,"ngIf"],["class","toast z-10",4,"ngIf"],["ngxClipboard","",1,"badge","h-auto","badge-primary","text-xl","sm:text-2xl","md:text-4xl","lg:text-6xl","cursor-pointer","tooltip","tooltip-bottom",3,"cbContent","click"],[1,"toast","z-10"],["translate","",1,"alert","alert-info"]],template:function(t,o){1&t&&(r.YNc(0,so,4,8,"div",0),r.YNc(1,ao,3,2,"div",1)),2&t&&(r.Q6J("ngIf",o.roomId),r.xp6(1),r.Q6J("ngIf",o.showToast()))},dependencies:[f.O5,E.Pi,u,E.X$],data:{animation:[(0,ve.Jm)(),(0,ve.QQ)()]}})}return n})();function lo(n,i){if(1&n){const e=r.EpF();r.TgZ(0,"div",2),r.NdJ("click",function(){r.CHM(e);const o=r.oxw();return r.KtG(o.showCopiedToClipboard())}),r.ALo(1,"translate"),r._uU(2),r.ALo(3,"translate"),r.qZA()}if(2&n){const e=r.oxw();r.Q6J("cbContent",e.joinCode),r.uIk("data-tip",r.lcZ(1,4,"STREAM.copyJoinCodeTip")),r.xp6(2),r.AsE(" ",r.lcZ(3,6,"STREAM.joinCode"),": ",e.joinCode.toUpperCase(),"\n")}}function po(n,i){1&n&&(r.TgZ(0,"div",3)(1,"div",4),r._uU(2,"STREAM.joinCodeCopied"),r.qZA()()),2&n&&r.Q6J("@slideInUpOnEnter",void 0)("@fadeOutOnLeave",void 0)}let uo=(()=>{class n{constructor(){this.showToast=(0,r.tdS)(!1)}showCopiedToClipboard(){this.showToast.set(!0),setTimeout(()=>this.showToast.set(!1),1500)}static#e=this.\u0275fac=function(t){return new(t||n)};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-join-code"]],inputs:{joinCode:"joinCode"},decls:2,vars:2,consts:[["class","badge h-auto badge-info text-xl sm:text-2xl md:text-4xl lg:text-6xl cursor-pointer tooltip tooltip-bottom","ngxClipboard","",3,"cbContent","click",4,"ngIf"],["class","toast z-10",4,"ngIf"],["ngxClipboard","",1,"badge","h-auto","badge-info","text-xl","sm:text-2xl","md:text-4xl","lg:text-6xl","cursor-pointer","tooltip","tooltip-bottom",3,"cbContent","click"],[1,"toast","z-10"],["translate","",1,"alert","alert-info"]],template:function(t,o){1&t&&(r.YNc(0,lo,4,8,"div",0),r.YNc(1,po,3,2,"div",1)),2&t&&(r.Q6J("ngIf",o.joinCode),r.xp6(1),r.Q6J("ngIf",o.showToast()))},dependencies:[f.O5,E.Pi,u,E.X$],data:{animation:[(0,ve.Jm)(),(0,ve.QQ)()]}})}return n})();var Je=p(2722),Sr=p(5536),fo=p(5741);let ho=(()=>{class n{constructor(e,t,o){this.store=e,this.recognitionService=t,this.peerService=o,this.onDestroy$=new j.x,this.recognitionConnected=(0,P.O4)(this.store.select(we.n7)),this.recognitionPaused=(0,P.O4)(this.store.select(we.HX)),this.liveText=(0,P.Dx)((0,r.Flj)(()=>this.recognitionConnected()||this.recognitionPaused()?this.recognitionService.getLiveOutput("broadcast")():"")),this.recognizedText=(0,P.Dx)((0,r.Flj)(()=>this.recognitionConnected()||this.recognitionPaused()?this.recognitionService.getRecognizedText("broadcast")():[]));let s=!1;(0,r.cEC)(()=>{this.recognitionPaused()?(s=!0,console.log("broadcast paused"),this.peerService.broadcastData({type:"status",status:Ce.T.paused})):s&&(console.log("broadcast resumed"),this.peerService.broadcastData({type:"status",status:Ce.T.connected}),s=!1)})}ngOnInit(){this.store.dispatch(Ce.b.connectRecognition({id:"broadcast"})),this.liveText.pipe((0,Je.R)(this.onDestroy$)).subscribe(e=>{this.peerService.broadcastData({recognition:e,type:"live"})}),this.recognizedText.pipe((0,Je.R)(this.onDestroy$)).subscribe(e=>{this.peerService.broadcastData({recognition:e,type:"segment"})})}ngOnDestroy(){this.recognitionConnected()&&this.store.dispatch(Ce.b.disconnectRecognition({id:"broadcast"})),this.onDestroy$.next()}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(re.yh),r.Y36(Sr.W),r.Y36(Xt))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-broadcast-room"]],decls:1,vars:0,consts:[[1,"flex","basis-full","overflow-y-hidden"]],template:function(t,o){1&t&&r._UZ(0,"app-recognition-render",0)},dependencies:[fo.U],data:{animation:[(0,ve.nh)(),(0,ve.B5)()]}})}return n})();const mo=["modal"];let go=(()=>{class n{constructor(e,t,o,s){this.store=e,this.renderer=t,this.router=o,this.fb=s,this.accepted=(0,P.O4)(this.store.select(st.NE)),this.saveSettingControl=this.fb.control(this.accepted())}ngAfterViewInit(){this.accepted()||this._openModal()}accept(){this.store.dispatch(Le.ql.setPeerConnectionsAccepted({accepted:!0,save:this.saveSettingControl.value})),this._closeModal()}decline(){this.store.dispatch(Le.ql.setPeerConnectionsAccepted({accepted:!1,save:this.saveSettingControl.value})),this._closeModal(),this.router.navigate([""])}_openModal(){this.renderer.setAttribute(this.modal.nativeElement,"open","")}_closeModal(){this.renderer.removeAttribute(this.modal.nativeElement,"open")}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(re.yh),r.Y36(r.Qsj),r.Y36(y.F0),r.Y36(l.qu))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-accept-peer-connections-modal"]],viewQuery:function(t,o){if(1&t&&r.Gf(mo,5,r.SBq),2&t){let s;r.iGM(s=r.CRH())&&(o.modal=s.first)}},decls:26,vars:1,consts:[[3,"click"],["open",""],[1,"modal"],["modal",""],["method","dialog",1,"modal-box","bg-base-content","text-base-100","sm:w-11/12","justify-self-center"],[1,"flex","flex-row","gap-3","items-center","bg-warning","rounded-lg","mb-3"],[1,"badge","badge-warning","h-10","w-10"],["name","heroExclamationTriangle",1,"text-error","text-3xl"],["translate","",1,"font-bold","text-2xl"],["translate","",1,"text-base","mt-2"],[1,"modal-action"],["type","button","translate","",1,"btn",3,"click"],[1,"form-control"],["translate","",1,"label","cursor-pointer"],["translate","",1,"label-text","text-base-100"],["type","checkbox",1,"checkbox","checkbox-sm","checkbox-primary",3,"formControl"]],template:function(t,o){if(1&t){const s=r.EpF();r.TgZ(0,"button",0,1),r.NdJ("click",function(){r.CHM(s);const c=r.MAs(3);return r.KtG(c.showModal())}),r.qZA(),r.TgZ(2,"dialog",2,3)(4,"form",4)(5,"div",5)(6,"div",6),r._UZ(7,"ng-icon",7),r.qZA(),r.TgZ(8,"h1",8),r._uU(9,"MODAL.accessModalTitle"),r.qZA()(),r.TgZ(10,"p",9),r._uU(11,"MODAL.accessP1"),r.qZA(),r.TgZ(12,"p",9),r._uU(13,"MODAL.accessP2"),r.qZA(),r.TgZ(14,"p",9),r._uU(15,"MODAL.accessP3"),r.qZA(),r.TgZ(16,"div",10)(17,"button",11),r.NdJ("click",function(){return o.decline()}),r._uU(18,"BUTTONS.decline"),r.qZA(),r.TgZ(19,"button",11),r.NdJ("click",function(){return o.accept()}),r._uU(20,"BUTTONS.confirm"),r.qZA()(),r.TgZ(21,"div",12)(22,"label",13)(23,"span",14),r._uU(24,"LABELS.rememberSetting"),r.qZA(),r._UZ(25,"input",15),r.qZA()()()()}2&t&&(r.xp6(25),r.Q6J("formControl",o.saveSettingControl))},dependencies:[l._Y,l.Wl,l.JJ,l.JL,l.oH,A.Fv,E.Pi]})}return n})();function vo(n,i){if(1&n&&(r.TgZ(0,"div",21),r._uU(1),r.qZA()),2&n){const e=i.ngIf;r.xp6(1),r.Oqu(e)}}function yo(n,i){1&n&&(r.TgZ(0,"div",22)(1,"div",23),r._uU(2,"CONNECTIONS.connectionEstablished"),r.qZA()())}function _o(n,i){1&n&&(r.TgZ(0,"span",24),r._uU(1,"Invalid URL"),r.qZA())}function bo(n,i){1&n&&(r.TgZ(0,"span",24),r._uU(1,"Required"),r.qZA())}function Co(n,i){1&n&&(r.TgZ(0,"span",24),r._uU(1,"Invalid URL"),r.qZA())}function So(n,i){1&n&&(r.TgZ(0,"span",24),r._uU(1,"Required"),r.qZA())}const To=function(n){return{"btn-error":n}};function xo(n,i){if(1&n&&(r.TgZ(0,"button",25),r._uU(1,"BUTTONS.connect"),r.qZA()),2&n){const e=r.oxw();r.Q6J("ngClass",r.VKq(2,To,e.formGroup.invalid&&e.formGroup.touched))("disabled",e.isConnecting())}}function ko(n,i){if(1&n){const e=r.EpF();r.TgZ(0,"button",26),r.NdJ("click",function(){r.CHM(e);const o=r.oxw();return r.KtG(o.disconnect())}),r._uU(1,"BUTTONS.disconnect"),r.qZA()}if(2&n){const e=r.oxw();r.Q6J("disabled",e.isConnecting())}}const Eo=function(n){return{"badge-success":n}},Tr=function(n){return{"text-error":n}},xr=function(n){return{"input-error":n}};let Ro=(()=>{class n{constructor(e,t){this.fb=e,this.store=t,this.connectionState=(0,P.O4)(this.store.select(Re.Q6)),this.error=(0,P.O4)(this.store.select(Re.Hb)),this.obsIsStreaming=(0,P.O4)(this.store.select(Re.l5)),this.isConnected=(0,r.Flj)(()=>this.connectionState()===$e.Sn.connected),this.isConnecting=(0,r.Flj)(()=>this.connectionState()===$e.Sn.connecting),this.formGroup=this.fb.group({ip:this.fb.control("127.0.0.1"),port:this.fb.control(null),password:this.fb.control(null)})}saveObsWebsocket(){if(this._autofillDefaultValue(this.formGroup.controls.ip,"127.0.0.1"),this._autofillDefaultValue(this.formGroup.controls.port,4455),this.formGroup.updateValueAndValidity(),this.formGroup.valid){const{ip:e,port:t,password:o}=this.formGroup.value;this.store.dispatch(ue.S.connect({ip:e,port:t,password:o}))}else this.formGroup.markAsTouched()}disconnect(){this.store.dispatch(ue.S.disconnect())}_autofillDefaultValue(e,t){return null===e.value&&e.patchValue(t),null}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(l.qu),r.Y36(re.yh))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-connect-obs"]],decls:37,vars:31,consts:[[1,"flex","flex-row","items-center","gap-3"],["translate","",1,"text-lg","text-primary","py-3"],[1,"flex","flex-grow"],[1,"badge","h-auto",3,"ngClass"],["class","badge h-auto badge-error",4,"ngIf"],["class","flex",4,"ngIf"],[1,"flex","flex-row","flex-wrap","flex-grow-0","gap-3",3,"formGroup","submit"],[1,"form-control"],[1,"label"],["translate","",1,"label-text","tooltip","tooltip-right","tooltip-warning",3,"ngClass"],["name","heroExclamationTriangle","size","18"],["type","text","placeholder","127.0.0.1","formControlName","ip",1,"input","input-bordered","input-lg",3,"ngClass"],[1,"label","no-height"],["class","label-alt-text text-error text-xs",4,"ngIf"],["translate","",1,"label-text",3,"ngClass"],["type","text","placeholder","4455","formControlName","port",1,"input","input-bordered","input-lg",3,"ngClass"],["translate","",1,"label-text"],["type","password","formControlName","password",1,"input","input-bordered","input-lg",3,"placeholder"],[1,"flex","flex-col","self-end","pb-6","gap-3"],["class","btn btn-secondary","translate","",3,"ngClass","disabled",4,"ngIf"],["class","btn btn-secondary","type","button","translate","",3,"disabled","click",4,"ngIf"],[1,"badge","h-auto","badge-error"],[1,"flex"],["translate","",1,"badge","h-auto","badge-secondary"],[1,"label-alt-text","text-error","text-xs"],["translate","",1,"btn","btn-secondary",3,"ngClass","disabled"],["type","button","translate","",1,"btn","btn-secondary",3,"disabled","click"]],template:function(t,o){1&t&&(r.TgZ(0,"div",0)(1,"div",1),r._uU(2,"CONNECTIONS.obsStudio"),r.qZA(),r._UZ(3,"div",2),r.TgZ(4,"div",3),r._uU(5),r.qZA(),r.YNc(6,vo,2,1,"div",4),r.YNc(7,yo,3,0,"div",5),r.qZA(),r.TgZ(8,"form",6),r.NdJ("submit",function(){return o.saveObsWebsocket()}),r.TgZ(9,"div",7)(10,"label",8)(11,"span",9),r.ALo(12,"translate"),r._uU(13,"CONNECTIONS.obsStudioIP "),r._UZ(14,"ng-icon",10),r.qZA()(),r._UZ(15,"input",11),r.TgZ(16,"label",12),r.YNc(17,_o,2,0,"span",13),r.YNc(18,bo,2,0,"span",13),r.qZA()(),r.TgZ(19,"div",7)(20,"label",8)(21,"span",14),r._uU(22,"CONNECTIONS.obsStudioPort"),r.qZA()(),r._UZ(23,"input",15),r.TgZ(24,"label",12),r.YNc(25,Co,2,0,"span",13),r.YNc(26,So,2,0,"span",13),r.qZA()(),r.TgZ(27,"div",7)(28,"label",8)(29,"span",16),r._uU(30,"LABELS.password"),r.qZA()(),r._UZ(31,"input",17),r.ALo(32,"translate"),r._UZ(33,"label",12),r.qZA(),r.TgZ(34,"div",18),r.YNc(35,xo,2,4,"button",19),r.YNc(36,ko,2,1,"button",20),r.qZA()()),2&t&&(r.xp6(4),r.Q6J("ngClass",r.VKq(21,Eo,o.isConnected())),r.xp6(1),r.Oqu(o.connectionState()),r.xp6(1),r.Q6J("ngIf",o.error()),r.xp6(1),r.Q6J("ngIf",o.isConnected()),r.xp6(1),r.Q6J("formGroup",o.formGroup),r.xp6(3),r.Q6J("ngClass",r.VKq(23,Tr,o.formGroup.invalid&&o.formGroup.touched)),r.uIk("data-tip",r.lcZ(12,17,"HINTS.advancedWarning")),r.xp6(4),r.Q6J("ngClass",r.VKq(25,xr,o.formGroup.invalid&&o.formGroup.touched)),r.xp6(2),r.Q6J("ngIf",o.formGroup.controls.ip.hasError("invalid")&&o.formGroup.touched),r.xp6(1),r.Q6J("ngIf",o.formGroup.controls.ip.hasError("required")&&o.formGroup.touched),r.xp6(3),r.Q6J("ngClass",r.VKq(27,Tr,o.formGroup.invalid&&o.formGroup.touched)),r.xp6(2),r.Q6J("ngClass",r.VKq(29,xr,o.formGroup.invalid&&o.formGroup.touched)),r.xp6(2),r.Q6J("ngIf",o.formGroup.controls.port.hasError("invalid")&&o.formGroup.touched),r.xp6(1),r.Q6J("ngIf",o.formGroup.controls.port.hasError("required")&&o.formGroup.touched),r.xp6(5),r.Q6J("placeholder",r.lcZ(32,19,"LABELS.optPassword")),r.xp6(4),r.Q6J("ngIf",!o.isConnected()),r.xp6(1),r.Q6J("ngIf",o.isConnected()))},dependencies:[f.mk,f.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,A.Fv,E.Pi,E.X$]})}return n})();const Po=["checkbox"];function Oo(n,i){1&n&&(r.TgZ(0,"div",7),r._uU(1,"CONNECTIONS.obsStudio"),r.qZA())}let Ao=(()=>{class n{constructor(e,t){this.store=e,this.renderer=t,this.openStateChanged=new r.vpe(!1),this.obsConnected=(0,P.O4)(this.store.pipe((0,re.Ys)(Re.Q6),(0,B.U)(o=>o===$e.Sn.connected)))}toggle(){const e=!this.checkbox.nativeElement.checked;e?this.renderer.setAttribute(this.checkbox.nativeElement,"checked","true"):this.renderer.removeAttribute(this.checkbox.nativeElement,"checked"),console.log("toggle",e),this.openStateChanged.emit(e)}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(re.yh),r.Y36(r.Qsj))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-third-party-connections"]],viewQuery:function(t,o){if(1&t&&r.Gf(Po,7),2&t){let s;r.iGM(s=r.CRH())&&(o.checkbox=s.first)}},outputs:{openStateChanged:"openStateChanged"},decls:9,vars:1,consts:[[1,"collapse","collapse-arrow","bg-base-100"],["type","checkbox"],["checkbox",""],[1,"collapse-title","flex","flex-row","items-center","gap-3",3,"click"],["translate","",1,"text-xl"],["class","badge badge-success h-auto","translate","",4,"ngIf"],[1,"collapse-content","overflow-y-auto"],["translate","",1,"badge","badge-success","h-auto"]],template:function(t,o){if(1&t&&(r.TgZ(0,"div",0),r._UZ(1,"input",1,2),r.TgZ(3,"div",3),r.NdJ("click",function(){return o.toggle()}),r.TgZ(4,"div",4),r._uU(5,"CONNECTIONS.externalConnections"),r.qZA(),r.YNc(6,Oo,2,0,"div",5),r.qZA(),r.TgZ(7,"div",6),r._UZ(8,"app-connect-obs"),r.qZA()()),2&t){const s=r.MAs(2);r.xp6(6),r.Q6J("ngIf",o.obsConnected()&&!s.checked)}},dependencies:[f.O5,E.Pi,Ro]})}return n})();var Io=p(4367);function wo(n,i){1&n&&(r.TgZ(0,"div",2),r._uU(1),r.ALo(2,"translate"),r.ALo(3,"translate"),r.qZA()),2&n&&(r.xp6(1),r.AsE("",r.lcZ(2,2,"CONNECTIONS.obsStudio"),": ",r.lcZ(3,4,"LABELS.streaming"),""))}function Bo(n,i){1&n&&(r.TgZ(0,"span"),r._uU(1),r.ALo(2,"translate"),r.ALo(3,"translate"),r.qZA()),2&n&&(r.xp6(1),r.AsE(" ",r.lcZ(2,2,"LABELS.stream"),": ",r.lcZ(3,4,"LABELS.idle")," "))}const Do=function(n){return{"badge-success":n}};function Mo(n,i){if(1&n&&(r.TgZ(0,"div",4)(1,"span"),r._uU(2),r.ALo(3,"translate"),r.ALo(4,"proper"),r.qZA(),r.YNc(5,Bo,4,6,"span",5),r.qZA()),2&n){const e=i.ngIf,t=r.oxw(2);r.Q6J("ngClass",r.VKq(8,Do,t.connected())),r.xp6(2),r.AsE(" ",r.lcZ(3,4,"CONNECTIONS.obsStudio"),": ",r.lcZ(4,6,e)," "),r.xp6(3),r.Q6J("ngIf",t.connected())}}function Lo(n,i){if(1&n&&r.YNc(0,Mo,6,10,"div",3),2&n){const e=r.oxw();r.Q6J("ngIf",e.connectionState())}}let Fo=(()=>{class n{constructor(e){this.store=e,this.connectionState=(0,P.O4)(this.store.select(Re.Q6)),this.connected=(0,r.Flj)(()=>this.connectionState()===$e.Sn.connected),this.streamingActive=(0,P.O4)(this.store.select(Re.l5))}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(re.yh))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-obs-connection-status-chip"]],decls:3,vars:2,consts:[["class","badge badge-success h-auto",4,"ngIf","ngIfElse"],["connectionBadge",""],[1,"badge","badge-success","h-auto"],["class","badge gap-1 h-auto",3,"ngClass",4,"ngIf"],[1,"badge","gap-1","h-auto",3,"ngClass"],[4,"ngIf"]],template:function(t,o){if(1&t&&(r.YNc(0,wo,4,6,"div",0),r.YNc(1,Lo,1,1,"ng-template",null,1,r.W1O)),2&t){const s=r.MAs(2);r.Q6J("ngIf",o.streamingActive())("ngIfElse",s)}},dependencies:[f.mk,f.O5,Io.w,E.X$]})}return n})();function kr(n,i,e,t,o,s,a){try{var c=n[s](a),g=c.value}catch(m){return void e(m)}c.done?i(g):Promise.resolve(g).then(t,o)}function me(n){return function(){var i=this,e=arguments;return new Promise(function(t,o){var s=n.apply(i,e);function a(g){kr(s,t,o,a,c,"next",g)}function c(g){kr(s,t,o,a,c,"throw",g)}a(void 0)})}}var jo=p(1455);const Er=p(5645);var Ge=null;typeof WebSocket<"u"?Ge=WebSocket:typeof MozWebSocket<"u"?Ge=MozWebSocket:typeof global<"u"?Ge=global.WebSocket||global.MozWebSocket:typeof window<"u"?Ge=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(Ge=self.WebSocket||self.MozWebSocket);const Rr=Ge;var Pr=p(1817),Or=p(8319);function at(){return at=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])}return n},at.apply(this,arguments)}var H=(()=>((H=H||{})[H.Hello=0]="Hello",H[H.Identify=1]="Identify",H[H.Identified=2]="Identified",H[H.Reidentify=3]="Reidentify",H[H.Event=5]="Event",H[H.Request=6]="Request",H[H.RequestResponse=7]="RequestResponse",H[H.RequestBatch=8]="RequestBatch",H[H.RequestBatchResponse=9]="RequestBatchResponse",H))();const $o=["authentication","rpcVersion"],ct=jo("obs-websocket-js");class lt extends Error{constructor(i,e){super(e),this.code=void 0,this.code=i}}let Jo=(()=>{class n extends Er{constructor(...e){super(...e),this._identified=!1,this.internalListeners=new Er,this.socket=void 0}static generateMessageId(){return String(n.requestCounter++)}get identified(){return this._identified}connect(e="ws://127.0.0.1:4455",t,o={}){var s=this;return me(function*(){var a=s;s.socket&&(yield s.disconnect());try{const c=s.internalEventPromise("ConnectionClosed"),g=s.internalEventPromise("ConnectionError");return yield Promise.race([me(function*(){const m=yield a.createConnection(e);return a.emit("Hello",m),a.identify(m,t,o)})(),new Promise((m,C)=>{g.then(R=>{R.message&&C(R)}),c.then(R=>{C(R)})})])}catch(c){throw yield s.disconnect(),c}})()}disconnect(){var e=this;return me(function*(){if(!e.socket||e.socket.readyState===Rr.CLOSED)return;const t=e.internalEventPromise("ConnectionClosed");e.socket.close(),yield t})()}reidentify(e){var t=this;return me(function*(){const o=t.internalEventPromise(`op:${H.Identified}`);return yield t.message(H.Reidentify,e),o})()}call(e,t){var o=this;return me(function*(){const s=n.generateMessageId(),a=o.internalEventPromise(`res:${s}`);yield o.message(H.Request,{requestId:s,requestType:e,requestData:t});const{requestStatus:c,responseData:g}=yield a;if(!c.result)throw new lt(c.code,c.comment);return g})()}callBatch(e,t={}){var o=this;return me(function*(){const s=n.generateMessageId(),a=o.internalEventPromise(`res:${s}`);yield o.message(H.RequestBatch,at({requestId:s,requests:e},t));const{results:c}=yield a;return c})()}cleanup(){this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket=void 0,this._identified=!1,this.internalListeners.removeAllListeners())}createConnection(e){var t=this;return me(function*(){var o;const s=t.internalEventPromise("ConnectionOpened"),a=t.internalEventPromise(`op:${H.Hello}`);t.socket=new Rr(e,t.protocol),t.socket.onopen=t.onOpen.bind(t),t.socket.onmessage=t.onMessage.bind(t),t.socket.onerror=t.onError.bind(t),t.socket.onclose=t.onClose.bind(t),yield s;const c=null==(o=t.socket)?void 0:o.protocol;if(!c)throw new lt(-1,"Server sent no subprotocol");if(c!==t.protocol)throw new lt(-1,"Server sent an invalid subprotocol");return a})()}identify(e,t,o={}){var s=this;return me(function*(){let{authentication:a,rpcVersion:c}=e,g=function Uo(n,i){if(null==n)return{};var o,s,e={},t=Object.keys(n);for(s=0;s<t.length;s++)!(i.indexOf(o=t[s])>=0)&&(e[o]=n[o]);return e}(e,$o);const m=at({rpcVersion:c},o);a&&t&&(m.authentication=function Zo(n,i,e){const t=Or.stringify(Pr(e+n));return Or.stringify(Pr(t+i))}(a.salt,a.challenge,t));const C=s.internalEventPromise(`op:${H.Identified}`);yield s.message(H.Identify,m);const R=yield C;return s._identified=!0,s.emit("Identified",R),at({rpcVersion:c},g,R)})()}message(e,t){var o=this;return me(function*(){if(!o.socket)throw new Error("Not connected");if(!o.identified&&1!==e)throw new Error("Socket not identified");const s=yield o.encodeMessage({op:e,d:t});o.socket.send(s)})()}internalEventPromise(e){var t=this;return me(function*(){return new Promise(o=>{t.internalListeners.once(e,o)})})()}onOpen(e){ct("socket.open"),this.emit("ConnectionOpened"),this.internalListeners.emit("ConnectionOpened",e)}onMessage(e){var t=this;return me(function*(){try{const{op:o,d:s}=yield t.decodeMessage(e.data);if(ct("socket.message: %d %j",o,s),void 0===o||void 0===s)return;switch(o){case H.Event:{const{eventType:a,eventData:c}=s;return void t.emit(a,c)}case H.RequestResponse:case H.RequestBatchResponse:{const{requestId:a}=s;return void t.internalListeners.emit(`res:${a}`,s)}default:t.internalListeners.emit(`op:${o}`,s)}}catch(o){ct("error handling message: %o",o)}})()}onError(e){ct("socket.error: %o",e);const t=new lt(-1,e.message);this.emit("ConnectionError",t),this.internalListeners.emit("ConnectionError",t)}onClose(e){ct("socket.close: %s (%d)",e.reason,e.code);const t=new lt(e.code,e.reason);this.emit("ConnectionClosed",t),this.internalListeners.emit("ConnectionClosed",t),this.cleanup()}}return n.requestCounter=1,n})();typeof exports<"u"&&Object.defineProperty(exports,"__esModule",{value:!0});class Go extends Jo{constructor(...i){super(...i),this.protocol="obswebsocket.json"}encodeMessage(i){return me(function*(){return JSON.stringify(i)})()}decodeMessage(i){return me(function*(){return JSON.parse(i)})()}}var Ar=p(457);let Ir=(()=>{class n{constructor(e){this.store=e,this.obs=new Go,this.obs.on("ConnectionClosed",()=>this.store.dispatch(ue.S.disconnectSuccess())),this.obs.on("ConnectionError",t=>this.store.dispatch(ue.S.errorReceived({error:t.message||"Unknown Error Occurred"}))),this.obs.on("Identified",()=>this._addObsListeners()),this.isStreaming=(0,P.O4)(this.store.select(Re.l5))}connect({ip:e,port:t,password:o}){return(0,Ar.D)(this.obs.connect(`ws://${e}:${t}`,o||void 0)).pipe((0,Kt.V)(5e3))}disconnect(){return this.obs.removeListener("ConnectionClosed"),this.obs.removeListener("ConnectionError"),(0,Ar.D)(this.obs.disconnect())}sendCaption(e){var t=this;return me(function*(){t.isStreaming()&&t.obs.call("SendStreamCaption",{captionText:e})})()}_addObsListeners(){this.obs.call("GetStreamStatus").then(e=>{this.store.dispatch(ue.S.setStreamingActive({active:e.outputActive}))}),this.obs.on("StreamStateChanged",e=>{this.store.dispatch(ue.S.setStreamingActive({active:e.outputActive}))})}static#e=this.\u0275fac=function(t){return new(t||n)(r.LFG(re.yh))};static#t=this.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var wr=p(3643),Br=p(8219);function qo(n,i){if(1&n&&r._UZ(0,"app-recognized-live-text",10),2&n){const e=r.oxw();r.Q6J("text",e.liveText)}}function zo(n,i){1&n&&(r.TgZ(0,"div",11),r._uU(1,"HINTS.recognitionPaused"),r.qZA())}function Vo(n,i){1&n&&(r.TgZ(0,"label",12),r._UZ(1,"ng-icon",13),r.qZA()),2&n&&r.Q6J("@slideInRightOnEnter",void 0)("@slideOutRightOnLeave",void 0)}let Yo=(()=>{class n{constructor(e,t,o){this.store=e,this.recognitionService=t,this.obs=o,this.onDestroy$=new j.x,this.recognitionConnected=(0,P.O4)(this.store.select(we.n7)),this.recognitionPaused=(0,P.O4)(this.store.select(we.HX)),this.liveText=(0,r.Flj)(()=>this.recognitionConnected()||this.recognitionPaused()?this.recognitionService.getLiveOutput("stream")():""),this.liveText$=(0,P.Dx)(this.liveText)}ngOnInit(){this.liveText$.pipe((0,Je.R)(this.onDestroy$)).subscribe(e=>{this.obs.sendCaption(e)})}ngOnDestroy(){this.recognitionConnected()&&this.store.dispatch(Ce.b.disconnectRecognition({id:"stream"})),this.onDestroy$.next()}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(re.yh),r.Y36(Sr.W),r.Y36(Ir))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-stream-captions"]],decls:10,vars:6,consts:[[1,"drawer","drawer-end","overflow-y-hidden","relative"],["id","drawer-enable","type","checkbox",1,"drawer-toggle"],["enable",""],[1,"drawer-content","absolute","top-0","bottom-0","left-0","right-0"],[3,"text",4,"ngIf"],["class","badge badge-warning px-6 py-3 text-center h-auto fixed top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2","translate","",4,"ngIf"],["for","drawer-enable","class","drawer-button btn btn-ghost btn-half-circle-left btn-info fixed top-1/2 right-0",4,"ngIf"],[1,"drawer-side"],["for","drawer-enable",1,"drawer-overlay","opacity-0"],[3,"showFullscreen","showTextFlow"],[3,"text"],["translate","",1,"badge","badge-warning","px-6","py-3","text-center","h-auto","fixed","top-1/2","left-1/2","-translate-y-1/2","-translate-x-1/2"],["for","drawer-enable",1,"drawer-button","btn","btn-ghost","btn-half-circle-left","btn-info","fixed","top-1/2","right-0"],["name","heroChevronLeft",1,"text-2xl"]],template:function(t,o){1&t&&(r.TgZ(0,"div",0),r._UZ(1,"input",1,2),r.TgZ(3,"div",3),r.YNc(4,qo,1,1,"app-recognized-live-text",4),r.YNc(5,zo,2,0,"div",5),r.YNc(6,Vo,2,2,"label",6),r.qZA(),r.TgZ(7,"div",7),r._UZ(8,"label",8)(9,"app-recognition-control-sidebar",9),r.qZA()()),2&t&&(r.xp6(4),r.Q6J("ngIf",o.liveText()),r.xp6(1),r.Q6J("ngIf",o.recognitionPaused()),r.xp6(1),r.Q6J("ngIf",o.recognitionConnected()||o.recognitionPaused()),r.xp6(1),r.Q6J("@slideOutRightOnLeave",void 0),r.xp6(2),r.Q6J("showFullscreen",!1)("showTextFlow",!1))},dependencies:[f.O5,A.Fv,E.Pi,wr.c,Br.h],styles:[".drawer-end[_ngcontent-%COMP%]   .drawer-toggle[_ngcontent-%COMP%] ~ .drawer-side[_ngcontent-%COMP%]{align-items:center}"],data:{animation:[(0,ve.nh)(),(0,ve.B5)()]}})}return n})();const Qo=["broadcastOpen"];function Ho(n,i){1&n&&r._UZ(0,"app-obs-connection-status-chip")}function Wo(n,i){if(1&n&&(r.ynx(0),r._UZ(1,"app-socket-server-status-chip")(2,"app-peer-server-status-chip"),r.YNc(3,Ho,1,0,"app-obs-connection-status-chip",5),r.BQk()),2&n){const e=r.oxw(2);r.xp6(3),r.Q6J("ngIf",e.showObsStatus())}}function Ko(n,i){if(1&n&&(r.TgZ(0,"div",10),r._UZ(1,"app-room-id",11)(2,"app-join-code",12),r.qZA()),2&n){const e=r.oxw(2);r.xp6(1),r.Q6J("roomId",e.roomId()),r.xp6(1),r.Q6J("joinCode",e.joinCode())}}function Xo(n,i){if(1&n&&(r.TgZ(0,"div",13),r._uU(1),r.qZA()),2&n){const e=i.ngIf;r.xp6(1),r.Oqu(e)}}function es(n,i){1&n&&(r.ynx(0),r.TgZ(1,"div",14),r._UZ(2,"app-connected-peer-count-chip")(3,"app-end-broadcast"),r.qZA(),r.BQk())}function ts(n,i){if(1&n){const e=r.EpF();r.ynx(0),r.TgZ(1,"button",15),r.NdJ("click",function(){r.CHM(e);const o=r.oxw(2);return r.KtG(o.stopWebsocketRecognition())}),r._UZ(2,"ng-icon",16),r.qZA(),r.BQk()}}function ns(n,i){if(1&n&&(r.TgZ(0,"div",6),r.YNc(1,Wo,4,1,"ng-container",3),r.YNc(2,Ko,3,2,"ng-template",null,7,r.W1O),r.YNc(4,Xo,2,1,"div",8),r._UZ(5,"div",9),r.YNc(6,es,4,0,"ng-container",5),r.YNc(7,ts,3,0,"ng-container",5),r.qZA()),2&n){const e=r.MAs(3),t=r.oxw();r.xp6(1),r.Q6J("ngIf",!t.isBroadcasting())("ngIfElse",e),r.xp6(3),r.Q6J("ngIf",t.serverError()),r.xp6(2),r.Q6J("ngIf",t.isBroadcasting()),r.xp6(1),r.Q6J("ngIf",!t.isBroadcasting()&&t.recognitionActive())}}function rs(n,i){1&n&&(r.TgZ(0,"div",17)(1,"span",18),r._uU(2,"STREAM.permissionRequired"),r.qZA()())}function is(n,i){1&n&&r._UZ(0,"app-broadcast-room",20)}function os(n,i){1&n&&r._UZ(0,"app-stream-captions",20)}function ss(n,i){if(1&n&&(r.ynx(0),r.YNc(1,is,1,0,"app-broadcast-room",19),r.YNc(2,os,1,0,"app-stream-captions",19),r.BQk()),2&n){const e=r.oxw();r.xp6(1),r.Q6J("ngIf",e.isBroadcasting()),r.xp6(1),r.Q6J("ngIf",!e.isBroadcasting()&&e.recognitionActive())}}function as(n,i){if(1&n){const e=r.EpF();r.TgZ(0,"div",45)(1,"button",46),r.NdJ("click",function(){r.CHM(e);const o=r.oxw(2);return r.KtG(o.createRoom())}),r._uU(2,"STREAM.createBroadcast"),r.qZA(),r.TgZ(3,"div",47),r._uU(4," STREAM.broadcastExplanantion "),r.qZA()()}if(2&n){const e=r.oxw(2);r.xp6(1),r.Q6J("disabled",e.serverOffline()||e.serverError())}}function cs(n,i){1&n&&(r.TgZ(0,"div",49),r._uU(1,"ERRORS.mobileBroadcast"),r.qZA())}function ls(n,i){1&n&&(r.TgZ(0,"div",49),r._uU(1,"ERRORS.unsupportedBrowserBroadcast"),r.qZA())}function ps(n,i){if(1&n&&(r.ynx(0),r.YNc(1,cs,2,0,"div",48),r.YNc(2,ls,2,0,"div",48),r.BQk()),2&n){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",e.isMobileDevice()),r.xp6(1),r.Q6J("ngIf",e.isIncompatibleBrowser())}}function us(n,i){if(1&n&&r.YNc(0,ps,3,2,"ng-container",5),2&n){const e=r.oxw(2);r.Q6J("ngIf",e.acceptedPeerConnections())}}function fs(n,i){1&n&&(r.TgZ(0,"span",50),r._uU(1,"Invalid ID"),r.qZA())}function ds(n,i){1&n&&(r.TgZ(0,"span",50),r._uU(1,"Required"),r.qZA())}function hs(n,i){1&n&&(r.TgZ(0,"span",50),r._uU(1,"Invalid ID"),r.qZA())}function ms(n,i){1&n&&(r.TgZ(0,"span",50),r._uU(1,"Required"),r.qZA())}function gs(n,i){if(1&n){const e=r.EpF();r.TgZ(0,"app-third-party-connections",51),r.NdJ("openStateChanged",function(o){r.CHM(e),r.oxw();const s=r.MAs(4);return r.KtG(s.checked=!o)}),r.qZA()}}const Dr=function(n){return{"text-error":n}},Mr=function(n){return{"input-error":n}},vs=function(n,i){return{"btn-primary":n,"btn-neutral":i}};function ys(n,i){if(1&n){const e=r.EpF();r.TgZ(0,"div",21)(1,"div",22)(2,"div",23),r._UZ(3,"input",24,25),r.TgZ(5,"div",26),r.NdJ("click",function(){r.CHM(e);const o=r.MAs(4);return r.KtG(o.checked=!o.checked)}),r.TgZ(6,"div",27),r._uU(7,"Peer Broadcasting"),r.qZA()(),r.TgZ(8,"div",28),r.YNc(9,as,5,1,"div",29),r.YNc(10,us,1,1,"ng-template",null,30,r.W1O),r.TgZ(12,"form",31),r.NdJ("submit",function(){r.CHM(e);const o=r.oxw();return r.KtG(o.joinSession())}),r.TgZ(13,"div",32),r._uU(14),r.ALo(15,"translate"),r.qZA(),r.TgZ(16,"div",33)(17,"button",34),r._uU(18,"STREAM.joinSession"),r.qZA(),r.TgZ(19,"div",35),r._uU(20," STREAM.joinSessionExplanation "),r.qZA()(),r.TgZ(21,"div",33)(22,"div",36)(23,"label",37)(24,"span",38),r._uU(25,"STREAM.sessionId"),r.qZA()(),r._UZ(26,"input",39),r.TgZ(27,"label",40),r.YNc(28,fs,2,0,"span",41),r.YNc(29,ds,2,0,"span",41),r.qZA()(),r.TgZ(30,"div",36)(31,"label",37)(32,"span",38),r._uU(33,"STREAM.joinCode"),r.qZA()(),r._UZ(34,"input",42),r.TgZ(35,"label",40),r.YNc(36,hs,2,0,"span",41),r.YNc(37,ms,2,0,"span",41),r.qZA()(),r.TgZ(38,"button",43),r._uU(39,"BUTTONS.connect"),r.qZA()()()()(),r.YNc(40,gs,1,0,"app-third-party-connections",44),r.qZA()()}if(2&n){const e=r.MAs(11),t=r.oxw();r.xp6(9),r.Q6J("ngIf",!(t.isMobileDevice()||t.isIncompatibleBrowser()))("ngIfElse",e),r.xp6(3),r.Q6J("formGroup",t.joinSessionFormGroup),r.xp6(2),r.Oqu(r.lcZ(15,16,"STREAM.joinSession")),r.xp6(3),r.Q6J("disabled",t.serverOffline()||t.serverError()),r.xp6(7),r.Q6J("ngClass",r.VKq(18,Dr,t.joinSessionFormGroup.controls.session.invalid&&t.joinSessionFormGroup.controls.session.touched)),r.xp6(2),r.Q6J("ngClass",r.VKq(20,Mr,t.joinSessionFormGroup.controls.session.invalid&&t.joinSessionFormGroup.controls.session.touched)),r.xp6(2),r.Q6J("ngIf",t.joinSessionFormGroup.controls.session.hasError("invalid")&&t.joinSessionFormGroup.controls.session.touched),r.xp6(1),r.Q6J("ngIf",t.joinSessionFormGroup.controls.session.hasError("required")&&t.joinSessionFormGroup.controls.session.touched),r.xp6(3),r.Q6J("ngClass",r.VKq(22,Dr,t.joinSessionFormGroup.controls.joinCode.invalid&&t.joinSessionFormGroup.controls.joinCode.touched)),r.xp6(2),r.Q6J("ngClass",r.VKq(24,Mr,t.joinSessionFormGroup.controls.joinCode.invalid&&t.joinSessionFormGroup.controls.joinCode.touched)),r.xp6(2),r.Q6J("ngIf",t.joinSessionFormGroup.controls.joinCode.hasError("invalid")&&t.joinSessionFormGroup.controls.joinCode.touched),r.xp6(1),r.Q6J("ngIf",t.joinSessionFormGroup.controls.joinCode.hasError("required")&&t.joinSessionFormGroup.controls.joinCode.touched),r.xp6(1),r.Q6J("ngClass",r.WLB(26,vs,t.joinSessionFormGroup.valid,t.joinSessionFormGroup.invalid))("disabled",t.serverOffline()||t.serverError()),r.xp6(2),r.Q6J("ngIf",!(t.isMobileDevice()||t.isIncompatibleBrowser()))}}function _s(n,i){1&n&&r._UZ(0,"app-accept-peer-connections-modal")}let bs=(()=>{class n{constructor(e,t,o,s){this.store=e,this.fb=t,this.router=o,this.route=s,this.joinSessionFormGroup=this.fb.group({session:this.fb.control("",[l.kI.required,a=>this._validateSessionId(a)]),joinCode:this.fb.control("",[l.kI.required,a=>this._validateJoinCode(a)])}),this.acceptedPeerConnections=(0,P.O4)(this.store.select(st.NE)),this.socketServerConnected=(0,P.O4)(this.store.select(Q.sM)),this.peerServerConnected=(0,P.O4)(this.store.select(Q.jT)),this.roomId=(0,P.O4)(this.store.select(Q.Zc)),this.joinCode=(0,P.O4)(this.store.select(Q.cJ)),this.isBroadcasting=(0,P.O4)(this.store.select(Q.fg)),this.recognitionActive=(0,P.O4)(this.store.select(we.dz)),this.showObsStatus=(0,P.O4)(this.store.pipe((0,re.Ys)(Re.Q6),(0,B.U)(a=>a!==$e.Sn.uninitialized))),this.serverError=(0,P.O4)(this.store.select(Q.ok)),this.serverOffline=(0,P.O4)(this.store.select(Q.gR)),this.store.select(st.$W),this.isMobileDevice=(0,P.O4)(this.store.pipe((0,re.Ys)(st.$W),(0,B.U)(a=>a===Le.hx.mobile))),this.isIncompatibleBrowser=(0,P.O4)(this.store.pipe((0,re.Ys)(st.$W),(0,B.U)(a=>a===Le.hx.unsupported))),this._injectDashIfRequired(),(0,r.cEC)(()=>{this.acceptedPeerConnections()&&!this.socketServerConnected()&&this.store.dispatch(w.p.connectSocketServer())},{allowSignalWrites:!0})}ngOnDestroy(){this.store.dispatch(Ce.b.resetRecogntionState())}stopWebsocketRecognition(){this.store.dispatch(ue.S.disconnect()),this.store.select(Re.Q6).pipe((0,Ze.h)(e=>e===$e.Sn.disconnected),(0,ke.q)(1)).subscribe(()=>this.store.dispatch(Ce.b.disconnectRecognition({id:"stream"})))}canDeactivate(){return!(0,P.O4)(this.store.select(Q.fg))()}createRoom(){this.store.dispatch(w.p.createBroadcastRoom())}joinSession(){if(this.joinSessionFormGroup.updateValueAndValidity(),this.joinSessionFormGroup.valid){const e=this.joinSessionFormGroup.value.session,t=this.joinSessionFormGroup.value.joinCode;this.store.dispatch(w.p.setJoinCode({joinCode:t})),this.router.navigate([e],{queryParams:{joinCode:t},relativeTo:this.route})}else this.joinSessionFormGroup.markAllAsTouched();return!1}_validateSessionId(e){return e.value&&!new RegExp(/^([acdefghjkmnpqrstuvwxyz2345679]{4})-([acdefghjkmnpqrstuvwxyz2345679]{4})$/i).test(e.value)?{invalid:!0}:null}_validateJoinCode(e){return e.value&&!new RegExp(/^([acdefghjkmnpqrstuvwxyz2345679]{4})$/i).test(e.value)?{invalid:!0}:null}_injectDashIfRequired(){const e=this.joinSessionFormGroup.controls.session;e.valueChanges.pipe((0,P.sL)()).subscribe(t=>{t&&t.length>4&&"-"!==t[4]&&e.setValue(t.slice(0,4)+"-"+t.slice(4,t.length))})}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(re.yh),r.Y36(l.qu),r.Y36(y.F0),r.Y36(y.gz))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-peer-landing"]],viewQuery:function(t,o){if(1&t&&r.Gf(Qo,5),2&t){let s;r.iGM(s=r.CRH())&&(o.broadcastCheckbox=s.first)}},hostBindings:function(t,o){1&t&&r.NdJ("beforeunload",function(){return o.broadcastCheckbox()},!1,r.Jf7)},decls:8,vars:5,consts:[[1,"flex","flex-col","basis-full","overflow-hidden","flex-grow-0","bg-base-300","text-base-content"],["class","flex flex-row gap-3 items-center p-3",4,"ngIf","ngIfElse"],["acceptPermissions",""],[4,"ngIf","ngIfElse"],["landing",""],[4,"ngIf"],[1,"flex","flex-row","gap-3","items-center","p-3"],["broadcastControls",""],["class","badge h-auto badge-error",4,"ngIf"],[1,"flex","flex-1"],[1,"flex","flex-row","flex-wrap","gap-3"],[3,"roomId"],[3,"joinCode"],[1,"badge","h-auto","badge-error"],[1,"flex","flex-grow","flex-row","flex-wrap-reverse","items-center","gap-3","justify-end"],[1,"btn","btn-circle","btn-ghost",3,"click"],["name","heroMicrophoneSlash"],[1,"flex","flex-row","self-stretch","gap-3","items-center","justify-center","p-3","text-warning","text-lg"],["translate",""],["class","flex basis-full overflow-y-hidden",4,"ngIf"],[1,"flex","basis-full","overflow-y-hidden"],[1,"flex","basis-full","items-stretch","justify-center","overflow-y-auto"],[1,"max-w-4xl","p-3"],[1,"collapse","collapse-arrow","bg-base-100","mb-6","sm:mb-12"],["type","checkbox","checked",""],["broadcastOpen",""],[1,"collapse-title","flex","flex-row","items-center","gap-3",3,"click"],["translate","",1,"text-xl"],[1,"collapse-content"],["class","form-row mb-6 sm:mb-12",4,"ngIf","ngIfElse"],["broadcastingNotAvailable",""],[1,"flex","flex-col","sm:gap-12","gap-6",3,"formGroup","submit"],[1,"sm:hidden","divider","divider-vertical","uppercase"],[1,"form-row"],["translate","",1,"hidden","sm:block","w-64","btn","btn-primary","btn-lg",3,"disabled"],["translate","",1,"flex","basis-full","sm:basis-1/2"],[1,"form-control"],[1,"label"],["translate","",1,"label-text",3,"ngClass"],["type","text","maxlength","9","placeholder","A79E-F2GV","formControlName","session",1,"input","input-bordered","input-lg",3,"ngClass"],[1,"label","no-height"],["class","label-alt-text text-error text-xs",4,"ngIf"],["type","text","maxlength","4","placeholder","E5F6","formControlName","joinCode",1,"input","input-bordered","input-lg",3,"ngClass"],["translate","",1,"w-64","btn","btn-lg","mt-3",3,"ngClass","disabled"],[3,"openStateChanged",4,"ngIf"],[1,"form-row","mb-6","sm:mb-12"],["translate","",1,"w-64","btn","btn-primary","btn-lg",3,"disabled","click"],["translate","",1,"flex","basis-1/2"],["class","text-warning text-center","translate","",4,"ngIf"],["translate","",1,"text-warning","text-center"],[1,"label-alt-text","text-error","text-xs"],[3,"openStateChanged"]],template:function(t,o){if(1&t&&(r.TgZ(0,"div",0),r.YNc(1,ns,8,5,"div",1),r.YNc(2,rs,3,0,"ng-template",null,2,r.W1O),r.YNc(4,ss,3,2,"ng-container",3),r.YNc(5,ys,41,29,"ng-template",null,4,r.W1O),r.YNc(7,_s,1,0,"app-accept-peer-connections-modal",5),r.qZA()),2&t){const s=r.MAs(3),a=r.MAs(6);r.xp6(1),r.Q6J("ngIf",o.acceptedPeerConnections())("ngIfElse",s),r.xp6(3),r.Q6J("ngIf",o.isBroadcasting()||o.recognitionActive())("ngIfElse",a),r.xp6(3),r.Q6J("ngIf",!o.acceptedPeerConnections())}},dependencies:[f.mk,f.O5,l._Y,l.Fj,l.JJ,l.JL,l.nD,l.sg,l.u,A.Fv,E.Pi,Wi,br,Cr,oo,co,uo,ho,go,Ao,Fo,Yo,E.X$],styles:[".form-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;align-items:center;justify-content:center;gap:.75rem}@media (min-width: 640px){.form-row[_ngcontent-%COMP%]{justify-content:space-between;gap:1.5rem}}@media (min-width: 1024px){.form-row[_ngcontent-%COMP%]{gap:3rem}}"]})}return n})();var Cs=p(8505),Ss=p(4986),Ts=p(2805),ks=p(4482),Es=p(5403);const Ps=["modal"],Os=["close"];let As=(()=>{class n{set showDialog(e){e&&this._openModal()}constructor(e,t,o,s){this.store=e,this.renderer=t,this.router=o,this.route=s,this.dialogClosed=new r.vpe,this.confirmationRequired=(0,P.O4)(this.store.select(Q.tN))}confirmLeaveBroadcast(){this.confirmationRequired()?this._openModal():this.leaveBroadcast()}leaveBroadcast(){this.store.dispatch(w.p.leaveBroadcastRoom()),this.store.select(Q.mo).pipe((0,Ze.h)(e=>!e),(0,ke.q)(1)).subscribe(()=>{this.dialogClosed.next(!0)}),this._closeModal(),this.router.navigate([".."],{queryParams:{joinCode:null},queryParamsHandling:"merge",relativeTo:this.route})}hideModal(){this.dialogClosed.next(!1),this._closeModal()}_openModal(){this.renderer.setAttribute(this.modal.nativeElement,"open","")}_closeModal(){this.closeButton.nativeElement.click()}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(re.yh),r.Y36(r.Qsj),r.Y36(y.F0),r.Y36(y.gz))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-leave-session"]],viewQuery:function(t,o){if(1&t&&(r.Gf(Ps,5,r.SBq),r.Gf(Os,5,r.SBq)),2&t){let s;r.iGM(s=r.CRH())&&(o.modal=s.first),r.iGM(s=r.CRH())&&(o.closeButton=s.first)}},inputs:{showDialog:"showDialog"},outputs:{dialogClosed:"dialogClosed"},decls:15,vars:0,consts:[["translate","",1,"btn","btn-sm",3,"click"],[1,"modal"],["modal",""],["method","dialog",1,"modal-box","bg-base-content","text-base-100","sm:w-11/12","justify-self-center"],["translate",""],[1,"modal-action"],["translate","","type","button",1,"btn",3,"click"],["type","button","translate","",1,"btn",3,"click"],["method","dialog",1,"modal-backdrop"],["close",""]],template:function(t,o){1&t&&(r.TgZ(0,"button",0),r.NdJ("click",function(){return o.confirmLeaveBroadcast()}),r._uU(1,"STREAM.leaveSession"),r.qZA(),r.TgZ(2,"dialog",1,2)(4,"form",3)(5,"p",4),r._uU(6,"MODAL.confirmLeaveSession"),r.qZA(),r.TgZ(7,"div",5)(8,"button",6),r.NdJ("click",function(){return o.leaveBroadcast()}),r._uU(9,"BUTTONS.confirm"),r.qZA(),r.TgZ(10,"button",7),r.NdJ("click",function(){return o.hideModal()}),r._uU(11,"BUTTONS.decline"),r.qZA()()(),r.TgZ(12,"form",8),r._UZ(13,"button",null,9),r.qZA()())},dependencies:[l._Y,l.JL,E.Pi]})}return n})();var Lr=p(8783),Is=p(4359),ws=p(1589);const Bs=["enable"];function Ds(n,i){if(1&n&&r._UZ(0,"app-recognized-text",11),2&n){const e=r.oxw();r.Q6J("renderHistory",e.renderHistory)("connected",e.connected)("hasLiveResults",e.hasLiveResults)("textOutput",e.textOutput)("error",e.error)}}function Ms(n,i){1&n&&(r.TgZ(0,"label",12),r._UZ(1,"ng-icon",13),r.qZA()),2&n&&r.Q6J("@slideInRightOnEnter",void 0)("@slideOutRightOnLeave",void 0)}function Ls(n,i){1&n&&r._UZ(0,"app-recognition-control-sidebar"),2&n&&r.Q6J("@slideInRightOnEnter",void 0)}const Fs=function(n,i){return{"flex-col-reverse justify-start":n,"flex-col justify-end":i}};let js=(()=>{class n{constructor(e,t,o,s,a){this.store=e,this.el=t,this.fullScreen=o,this.peerService=s,this.cd=a,this.liveText=(0,r.tdS)(""),this.textOutput=(0,r.tdS)([]),this.onDestroy$=new j.x;const c=(0,P.O4)(this.store.select(Q.jT)),g=(0,P.O4)(this.store.select(Q.tN));this.connected=(0,r.Flj)(()=>c()&&g()),this.error=(0,P.O4)(this.store.select(we.W5)),this.textFlowDown=(0,P.O4)(this.store.pipe((0,re.Ys)(Lr.ZF),(0,B.U)(m=>"top-down"===m))),this.hasLiveResults=(0,r.Flj)(()=>!(""==this.liveText()&&0===this.textOutput().length)),this.fullScreen.isAvailable&&(0,r.cEC)(()=>{this.fullScreen.isFullscreen()&&(this.sidebarCheckbox.nativeElement.checked=!1),this.cd.detectChanges()}),this.renderHistory=(0,P.O4)(this.store.select(Lr.or))}ngOnInit(){this.peerService.liveText$.pipe((0,Je.R)(this.onDestroy$)).subscribe(e=>{this.liveText.set(e),this.cd.detectChanges()}),this.peerService.textOutput$.pipe((0,Je.R)(this.onDestroy$)).subscribe(e=>{this.textOutput.set(e),this.cd.detectChanges()}),this.fullScreen.isAvailable&&this.fullScreen.registerElement(this.el)}ngOnDestroy(){this.fullScreen.isAvailable&&(this.fullScreen.deregisterElement(),this.store.select(Q.gc).pipe((0,Je.R)(this.onDestroy$)).subscribe(()=>{console.log("pause changed"),this.cd.detectChanges()})),this.onDestroy$.next()}updateDom(){this.cd.detectChanges()}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(re.yh),r.Y36(r.SBq),r.Y36(Is.E),r.Y36(Xt),r.Y36(r.sBO))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-broadcast-render"]],viewQuery:function(t,o){if(1&t&&r.Gf(Bs,5),2&t){let s;r.iGM(s=r.CRH())&&(o.sidebarCheckbox=s.first)}},decls:11,vars:8,consts:[[1,"drawer","drawer-end","overflow-y-hidden","py-6"],["id","drawer-enable","type","checkbox",1,"drawer-toggle",3,"change"],["enable",""],[1,"drawer-content","absolute","top-0","bottom-0","left-0","right-0"],[1,"flex","flex-grow-0","h-full","overflow-hidden","bg-base-100",3,"ngClass"],["hintText","HINTS.streamConnected","class","flex flex-grow-0 flex-shrink basis-full overflow-hidden",3,"renderHistory","connected","hasLiveResults","textOutput","error",4,"ngIf"],[3,"text"],["for","drawer-enable","class","drawer-button btn btn-ghost btn-half-circle-left btn-info fixed top-1/2 right-0",4,"ngIf"],[1,"drawer-side"],["for","drawer-enable",1,"drawer-overlay","opacity-0"],[4,"ngIf"],["hintText","HINTS.streamConnected",1,"flex","flex-grow-0","flex-shrink","basis-full","overflow-hidden",3,"renderHistory","connected","hasLiveResults","textOutput","error"],["for","drawer-enable",1,"drawer-button","btn","btn-ghost","btn-half-circle-left","btn-info","fixed","top-1/2","right-0"],["name","heroChevronLeft",1,"text-2xl"]],template:function(t,o){if(1&t&&(r.TgZ(0,"div",0)(1,"input",1,2),r.NdJ("change",function(){return o.updateDom()}),r.qZA(),r.TgZ(3,"div",3)(4,"div",4),r.YNc(5,Ds,1,5,"app-recognized-text",5),r._UZ(6,"app-recognized-live-text",6),r.qZA(),r.YNc(7,Ms,2,2,"label",7),r.qZA(),r.TgZ(8,"div",8),r._UZ(9,"label",9),r.YNc(10,Ls,1,1,"app-recognition-control-sidebar",10),r.qZA()()),2&t){const s=r.MAs(2);r.xp6(4),r.Q6J("ngClass",r.WLB(5,Fs,o.textFlowDown(),!o.textFlowDown())),r.xp6(1),r.Q6J("ngIf",o.renderHistory()),r.xp6(1),r.Q6J("text",o.liveText),r.xp6(1),r.Q6J("ngIf",o.connected()),r.xp6(3),r.Q6J("ngIf",s.checked)}},dependencies:[f.mk,f.O5,A.Fv,ws.M,wr.c,Br.h],styles:[".drawer-end[_ngcontent-%COMP%]   .drawer-toggle[_ngcontent-%COMP%] ~ .drawer-side[_ngcontent-%COMP%]{align-items:center}"],data:{animation:[(0,ve.nh)(),(0,ve.Jm)(),(0,ve.vc)(),(0,ve.B5)(),(0,ve.QP)()]}})}return n})();var Fr=p(2847);function Ns(n,i){1&n&&(r.TgZ(0,"div",12),r._uU(1,"HINTS.hostConnecting"),r.qZA())}const Us=function(n,i){return{"badge-success":n,"badge-info":i}};function Zs(n,i){if(1&n){const e=r.EpF();r.TgZ(0,"div",8)(1,"div",9),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.YNc(4,Ns,2,0,"div",10),r.TgZ(5,"app-leave-session",11),r.NdJ("dialogClosed",function(o){r.CHM(e);const s=r.oxw(3);return r.KtG(s.leaveSessionDialogClosed(o))}),r.qZA()()}if(2&n){const e=r.oxw(3);r.xp6(1),r.Q6J("ngClass",r.WLB(6,Us,e.hostOnline(),!e.hostOnline())),r.xp6(1),r.Oqu(r.lcZ(3,4,e.hostOnline()?"STREAM.connected":"HINTS.verifyingConnection")),r.xp6(2),r.Q6J("ngIf",!e.hostOnline()),r.xp6(1),r.Q6J("showDialog",e.showLeaveBroadcastDialog())}}const jr=function(){return[".."]};function $s(n,i){1&n&&(r.TgZ(0,"div",13)(1,"button",14),r._uU(2,"BUTTONS.goBack"),r.qZA()()),2&n&&(r.xp6(1),r.Q6J("routerLink",r.DdM(1,jr)))}function Js(n,i){if(1&n&&(r.TgZ(0,"div"),r._uU(1),r.ALo(2,"translate"),r.ALo(3,"timeago"),r.qZA()),2&n){const e=r.oxw().ngIf;r.xp6(1),r.AsE(" ",r.lcZ(2,2,"STREAM.broadcastEnded")," ",r.lcZ(3,4,e),". ")}}function Gs(n,i){1&n&&(r.TgZ(0,"div",17),r._uU(1,"STREAM.noSessionForRoom"),r.qZA())}function qs(n,i){if(1&n&&(r.TgZ(0,"div",15),r.YNc(1,Js,4,6,"div",1),r.YNc(2,Gs,2,0,"ng-template",null,16,r.W1O),r.qZA()),2&n){const e=i.ngIf,t=r.MAs(3);r.xp6(1),r.Q6J("ngIf",e>1)("ngIfElse",t)}}function zs(n,i){1&n&&r._UZ(0,"app-broadcast-render",18)}function Vs(n,i){if(1&n&&(r.TgZ(0,"span"),r._uU(1),r.qZA()),2&n){const e=r.oxw(2).ngIf,t=r.oxw(3);r.xp6(1),r.hij("Time left: ",t.HOST_ONLINE_TIMEOUT_SECONDS-e,"")}}function Ys(n,i){1&n&&(r.TgZ(0,"span",17),r._uU(1,"STREAM.noSessionForRoom"),r.qZA())}function Qs(n,i){if(1&n&&(r.ynx(0),r.YNc(1,Vs,2,1,"span",1),r.YNc(2,Ys,2,0,"ng-template",null,20,r.W1O),r.BQk()),2&n){const e=r.MAs(3),t=r.oxw().ngIf,o=r.oxw(3);r.xp6(1),r.Q6J("ngIf",t<o.HOST_ONLINE_TIMEOUT_SECONDS)("ngIfElse",e)}}function Hs(n,i){1&n&&(r.TgZ(0,"span",17),r._uU(1,"STREAM.hostOffline"),r.qZA())}function Ws(n,i){if(1&n&&(r.TgZ(0,"div",15),r.YNc(1,Qs,4,2,"ng-container",1),r.YNc(2,Hs,2,0,"ng-template",null,19,r.W1O),r.qZA()),2&n){const e=r.MAs(3),t=r.oxw(3);r.xp6(1),r.Q6J("ngIf",void 0===t.hostOnline())("ngIfElse",e)}}function Ks(n,i){if(1&n&&(r.ynx(0),r.YNc(1,Zs,6,9,"div",4),r.YNc(2,$s,3,2,"div",5),r.YNc(3,qs,4,2,"div",6),r.YNc(4,zs,1,0,"app-broadcast-render",7),r.YNc(5,Ws,4,2,"div",6),r.ALo(6,"async"),r.BQk()),2&n){const e=r.oxw(2);r.xp6(1),r.Q6J("ngIf",e.isViewing()),r.xp6(1),r.Q6J("ngIf",e.broadcastEndedTimestamp()),r.xp6(1),r.Q6J("ngIf",e.broadcastEndedTimestamp()),r.xp6(1),r.Q6J("ngIf",e.hostOnline()),r.xp6(1),r.Q6J("ngIf",!e.broadcastEndedTimestamp()&&!e.hostOnline()&&e.verifyJoinCodeTimer&&r.lcZ(6,5,e.verifyJoinCodeTimer))}}function Xs(n,i){if(1&n&&(r.ynx(0),r.YNc(1,Ks,7,7,"ng-container",1),r.BQk()),2&n){const e=r.oxw(),t=r.MAs(5);r.xp6(1),r.Q6J("ngIf",e.joinCode())("ngIfElse",t)}}function ea(n,i){1&n&&(r.TgZ(0,"div",21)(1,"div",22),r._uU(2,"STREAM.connectionPendingHint"),r.qZA(),r._UZ(3,"app-socket-server-status-chip")(4,"app-peer-server-status-chip"),r.qZA())}function ta(n,i){1&n&&(r.TgZ(0,"span",36),r._uU(1,"Invalid ID"),r.qZA())}function na(n,i){1&n&&(r.TgZ(0,"span",36),r._uU(1,"Required"),r.qZA())}const ra=function(n){return{"text-error":n}},ia=function(n){return{"input-error":n}};function oa(n,i){if(1&n){const e=r.EpF();r.TgZ(0,"div",23)(1,"form",24),r.NdJ("submit",function(){r.CHM(e);const o=r.oxw();return r.KtG(o.rejoin())}),r.TgZ(2,"div",25),r._uU(3,"STREAM.joinCodeRequired"),r.qZA(),r.TgZ(4,"div",26)(5,"div",27)(6,"label",28)(7,"span",29),r._uU(8,"STREAM.joinCode"),r.qZA()(),r._UZ(9,"input",30),r.TgZ(10,"label",31),r.YNc(11,ta,2,0,"span",32),r.YNc(12,na,2,0,"span",32),r.qZA()(),r.TgZ(13,"div",33)(14,"button",34),r._uU(15,"BUTTONS.connect"),r.qZA(),r.TgZ(16,"button",35),r._uU(17,"BUTTONS.cancel"),r.qZA()()()()()}if(2&n){const e=r.oxw();r.xp6(1),r.Q6J("formGroup",e.formGroup),r.xp6(6),r.Q6J("ngClass",r.VKq(6,ra,e.formGroup.controls.joinCode.invalid&&e.formGroup.controls.joinCode.touched)),r.xp6(2),r.Q6J("ngClass",r.VKq(8,ia,e.formGroup.controls.joinCode.invalid&&e.formGroup.controls.joinCode.touched)),r.xp6(2),r.Q6J("ngIf",e.formGroup.controls.joinCode.hasError("invalid")&&e.formGroup.controls.joinCode.touched),r.xp6(1),r.Q6J("ngIf",e.formGroup.controls.joinCode.hasError("required")&&e.formGroup.controls.joinCode.touched),r.xp6(4),r.Q6J("routerLink",r.DdM(10,jr))}}let sa=(()=>{class n{constructor(e,t,o,s){this.route=e,this.router=t,this.fb=o,this.store=s,this.showLeaveBroadcastDialog=(0,r.tdS)(!1),this.dialogClosedSubject=new j.x,this.HOST_ONLINE_TIMEOUT_SECONDS=30,this.roomId=this.route.snapshot.params.id.toLowerCase(),this.joinCode=(0,P.O4)(this.store.select(Q.cJ)),this.isViewing=(0,P.O4)(this.store.select(Q.mo)),this.hostOnline=(0,P.O4)(this.store.select(Q.tN)),this.serverError=(0,P.O4)(this.store.select(Q.ok)),this.broadcastEndedTimestamp=(0,P.O4)(this.store.select(Q.XF));const a=(0,P.O4)(this.store.select(Q.sM)),c=(0,P.O4)(this.store.select(Q.jT));this.connected=(0,r.Flj)(()=>a()&&c()),this.formGroup=this.fb.group({joinCode:this.fb.control("",[l.kI.required,l.kI.minLength(4),l.kI.maxLength(4)])}),"joinCode"in this.route.snapshot.queryParams&&this.route.snapshot.queryParams.joinCode!==this.joinCode()?this._updateJoinCodeAndConnect(this.route.snapshot.queryParams.joinCode.toLowerCase()):this._joinRoom(),(0,r.cEC)(()=>{this.isViewing()?this.store.dispatch(Le.ql.hideFooter()):this.store.dispatch(Le.ql.showFooter())},{allowSignalWrites:!0})}canDeactivate(){return!this.isViewing()||!this.hostOnline()||(this.showLeaveBroadcastDialog.set(!0),this.dialogClosedSubject.asObservable().pipe((0,ke.q)(1),(0,Cs.b)(()=>this.showLeaveBroadcastDialog.set(!1))))}ngOnDestroy(){(this.isViewing()||this.broadcastEndedTimestamp())&&this.store.dispatch(w.p.leaveBroadcastRoom()),this.store.dispatch(Le.ql.showFooter())}rejoin(){if(this.formGroup.updateValueAndValidity(),this.formGroup.valid){const e=this.formGroup.value.joinCode;this._updateQueryParamsCode(e),this._updateJoinCodeAndConnect(e)}else this.formGroup.markAllAsTouched()}leaveSessionDialogClosed(e){this.dialogClosedSubject.next(e)}_updateQueryParamsCode(e){this.router.navigate([],{relativeTo:this.route,queryParams:{joinCode:e},queryParamsHandling:"merge"})}_joinRoom(){this.connected()?this.store.dispatch(w.p.joinBroadcastRoom({id:this.roomId})):(this.store.pipe((0,re.Ys)(Q.jT),(0,Ze.h)(e=>!!e),(0,ke.q)(1)).subscribe(()=>{this.store.dispatch(w.p.joinBroadcastRoom({id:this.roomId}))}),this.store.dispatch(w.p.connectSocketServer())),this.verifyJoinCodeTimer=function xs(n=0,i=Ss.z){return n<0&&(n=0),(0,Ts.H)(n,n,i)}(1e3).pipe(function Rs(n,i=!1){return(0,ks.e)((e,t)=>{let o=0;e.subscribe((0,Es.x)(t,s=>{const a=n(s,o++);(a||i)&&t.next(s),!a&&t.complete()}))})}(e=>e<this.HOST_ONLINE_TIMEOUT_SECONDS&&void 0===this.hostOnline()),(0,B.U)(e=>e+1))}_updateJoinCodeAndConnect(e){this.store.dispatch(w.p.setJoinCode({joinCode:e})),this.store.select(Q.cJ).pipe((0,Ze.h)(t=>t===e),(0,ke.q)(1)).subscribe(()=>{this._joinRoom()})}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(y.gz),r.Y36(y.F0),r.Y36(l.qu),r.Y36(re.yh))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-view-broadcast"]],hostBindings:function(t,o){1&t&&r.NdJ("beforeunload",function(){return o.joinCode()},!1,r.Jf7)},decls:6,vars:2,consts:[[1,"flex","flex-col","w-full","h-full"],[4,"ngIf","ngIfElse"],["connectingToServer",""],["setJoinCode",""],["class","flex flex-row items-center justify-between p-3",4,"ngIf"],["class","flex flex-row items-center justify-end p-3",4,"ngIf"],["class","flex flex-col basis-full self-center justify-center px-3 text-center",4,"ngIf"],["class","flex basis-full overflow-y-hidden",4,"ngIf"],[1,"flex","flex-row","items-center","justify-between","p-3"],[1,"badge","h-auto",3,"ngClass"],["class","text-sm text-accent flex flex-row text-center","translate","",4,"ngIf"],[3,"showDialog","dialogClosed"],["translate","",1,"text-sm","text-accent","flex","flex-row","text-center"],[1,"flex","flex-row","items-center","justify-end","p-3"],["translate","",1,"btn","btn-primary",3,"routerLink"],[1,"flex","flex-col","basis-full","self-center","justify-center","px-3","text-center"],["noRoomFound",""],["translate",""],[1,"flex","basis-full","overflow-y-hidden"],["hostDisconnected",""],["timedOut",""],[1,"flex","flex-col","basis-full","justify-center","items-center","gap-12"],["translate","",1,"text-2xl","text-error-content","w-1/2","text-center"],[1,"flex","basis-full","justify-center"],[1,"flex","flex-col","gap-12","p-3","sm:p-12","max-w-2xl",3,"formGroup","submit"],["translate","",1,"text-3xl","sm:text-5xl","text-center"],[1,"flex","flex-row","flex-wrap","items-center","justify-between","gap-12","sm:gap-24"],[1,"form-control"],[1,"label"],["translate","",1,"label-text",3,"ngClass"],["type","text","placeholder","E5F6","formControlName","joinCode",1,"input","input-bordered","input-lg",3,"ngClass"],[1,"label","no-height"],["class","label-alt-text text-error text-xs",4,"ngIf"],[1,"flex","flex-row","gap-3"],["translate","",1,"btn","btn-lg","btn-primary","mt-3"],["translate","","type","button",1,"btn","btn-lg","mt-3",3,"routerLink"],[1,"label-alt-text","text-error","text-xs"]],template:function(t,o){if(1&t&&(r.TgZ(0,"div",0),r.YNc(1,Xs,2,2,"ng-container",1),r.YNc(2,ea,5,0,"ng-template",null,2,r.W1O),r.YNc(4,oa,18,11,"ng-template",null,3,r.W1O),r.qZA()),2&t){const s=r.MAs(3);r.xp6(1),r.Q6J("ngIf",o.connected())("ngIfElse",s)}},dependencies:[f.mk,f.O5,y.rH,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,E.Pi,As,br,Cr,js,f.Ov,E.X$,Fr.wr]})}return n})();const Nr=(n,i,e,t)=>n.canDeactivate?n.canDeactivate():confirm("WARNING: Leaving this page will end the current broadcast."),aa=[{path:"",component:bs,canDeactivate:[Nr]},{path:":id",component:sa,canDeactivate:[Nr]}];let ca=(()=>{class n{static#e=this.\u0275fac=function(t){return new(t||n)};static#t=this.\u0275mod=r.oAB({type:n});static#n=this.\u0275inj=r.cJS({imports:[y.Bz.forChild(aa),y.Bz]})}return n})(),la=(()=>{class n{constructor(e){this.store=e,this.userId=(0,P.O4)(this.store.pipe((0,re.Ys)(Q.h4),(0,B.U)(t=>t.id)))}sendSocketDisconnected(){console.log("dispatching socket disconnected"),this.store.dispatch(w.p.socketServerDisconnected())}sendUserIdAssigned(){console.log("dispatching socketUserIdAssigned",this.userId()),this.store.dispatch(w.p.socketServerUserIdAssigned({id:this.userId()||""}))}sendConnectPeerServer(){this.store.dispatch(w.p.connectPeerServer())}static#e=this.\u0275fac=function(t){return new(t||n)(r.Y36(re.yh))};static#t=this.\u0275cmp=r.Xpm({type:n,selectors:[["app-socket-debug"]],standalone:!0,features:[r.jDz],decls:7,vars:0,consts:[[1,"flex","flex-col","gap-3","bg-transparent"],[1,"btn","btn-sm",3,"click"]],template:function(t,o){1&t&&(r.TgZ(0,"div",0)(1,"button",1),r.NdJ("click",function(){return o.sendSocketDisconnected()}),r._uU(2,"Socket Disconnected Event"),r.qZA(),r.TgZ(3,"button",1),r.NdJ("click",function(){return o.sendUserIdAssigned()}),r._uU(4,"User Id Assigned Event"),r.qZA(),r.TgZ(5,"button",1),r.NdJ("click",function(){return o.sendConnectPeerServer()}),r._uU(6,"Connect Peer Server Event"),r.qZA()())},dependencies:[f.ez]})}return n})(),pa=(()=>{class n{constructor(e,t){this.actions$=e,this.obsService=t,this.connectServer$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(ue.S.connect),(0,k.w)(o=>this.obsService.connect(o).pipe((0,B.U)(()=>ue.S.connectSuccess()),(0,O.K)(s=>(0,Z.of)(ue.S.connectFailure({error:s.message||"Connection Failed for unknown reason"}))))))),this.disconnectServer$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(ue.S.disconnect),(0,k.w)(()=>this.obsService.disconnect().pipe((0,B.U)(()=>ue.S.disconnectSuccess()),(0,O.K)(o=>(0,Z.of)(ue.S.disconnectFailure({error:o.message||"Disconnect Failed for unknown reason"}))))))),this.sendCaption$=(0,T.GW)(()=>this.actions$.pipe((0,T.l4)(ue.S.sendCaption),(0,B.U)(({text:o})=>this.obsService.sendCaption(o)),(0,B.U)(()=>ue.S.sendCaptionSuccess())))}static#e=this.\u0275fac=function(t){return new(t||n)(r.LFG(T.eX),r.LFG(Ir))};static#t=this.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac})}return n})();var ua=p(5543);let fa=(()=>{class n{static#e=this.\u0275fac=function(t){return new(t||n)};static#t=this.\u0275mod=r.oAB({type:n});static#n=this.\u0275inj=r.cJS({imports:[f.ez,ca,y.Bz,l.UX,A.sU,ua.e,E.aw.forChild({extend:!0}),T.sQ.forFeature([Vi,pa]),Yi.c,b,Fr.$L,la]})}return n})()},7585:function(ee,x,p){var h;ee.exports=(h=h||function(_,I){var S;if(typeof window<"u"&&window.crypto&&(S=window.crypto),typeof self<"u"&&self.crypto&&(S=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(S=globalThis.crypto),!S&&typeof window<"u"&&window.msCrypto&&(S=window.msCrypto),!S&&typeof global<"u"&&global.crypto&&(S=global.crypto),!S)try{S=p(2480)}catch{}var M=function(){if(S){if("function"==typeof S.getRandomValues)try{return S.getRandomValues(new Uint32Array(1))[0]}catch{}if("function"==typeof S.randomBytes)try{return S.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},U=Object.create||function(){function u(){}return function(v){var b;return u.prototype=v,b=new u,u.prototype=null,b}}(),D={},f=D.lib={},l=f.Base={extend:function(u){var v=U(this);return u&&v.mixIn(u),(!v.hasOwnProperty("init")||this.init===v.init)&&(v.init=function(){v.$super.init.apply(this,arguments)}),v.init.prototype=v,v.$super=this,v},create:function(){var u=this.extend();return u.init.apply(u,arguments),u},init:function(){},mixIn:function(u){for(var v in u)u.hasOwnProperty(v)&&(this[v]=u[v]);u.hasOwnProperty("toString")&&(this.toString=u.toString)},clone:function(){return this.init.prototype.extend(this)}},y=f.WordArray=l.extend({init:function(u,v){u=this.words=u||[],this.sigBytes=null!=v?v:4*u.length},toString:function(u){return(u||T).stringify(this)},concat:function(u){var v=this.words,b=u.words,k=this.sigBytes,B=u.sigBytes;if(this.clamp(),k%4)for(var O=0;O<B;O++)v[k+O>>>2]|=(b[O>>>2]>>>24-O%4*8&255)<<24-(k+O)%4*8;else for(var w=0;w<B;w+=4)v[k+w>>>2]=b[w>>>2];return this.sigBytes+=B,this},clamp:function(){var u=this.words,v=this.sigBytes;u[v>>>2]&=4294967295<<32-v%4*8,u.length=_.ceil(v/4)},clone:function(){var u=l.clone.call(this);return u.words=this.words.slice(0),u},random:function(u){for(var v=[],b=0;b<u;b+=4)v.push(M());return new y.init(v,u)}}),A=D.enc={},T=A.Hex={stringify:function(u){for(var v=u.words,b=u.sigBytes,k=[],B=0;B<b;B++){var O=v[B>>>2]>>>24-B%4*8&255;k.push((O>>>4).toString(16)),k.push((15&O).toString(16))}return k.join("")},parse:function(u){for(var v=u.length,b=[],k=0;k<v;k+=2)b[k>>>3]|=parseInt(u.substr(k,2),16)<<24-k%8*4;return new y.init(b,v/2)}},E=A.Latin1={stringify:function(u){for(var v=u.words,b=u.sigBytes,k=[],B=0;B<b;B++)k.push(String.fromCharCode(v[B>>>2]>>>24-B%4*8&255));return k.join("")},parse:function(u){for(var v=u.length,b=[],k=0;k<v;k++)b[k>>>2]|=(255&u.charCodeAt(k))<<24-k%4*8;return new y.init(b,v)}},r=A.Utf8={stringify:function(u){try{return decodeURIComponent(escape(E.stringify(u)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(u){return E.parse(unescape(encodeURIComponent(u)))}},L=f.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new y.init,this._nDataBytes=0},_append:function(u){"string"==typeof u&&(u=r.parse(u)),this._data.concat(u),this._nDataBytes+=u.sigBytes},_process:function(u){var v,b=this._data,k=b.words,B=b.sigBytes,O=this.blockSize,w=B/(4*O),P=(w=u?_.ceil(w):_.max((0|w)-this._minBufferSize,0))*O,$=_.min(4*P,B);if(P){for(var oe=0;oe<P;oe+=O)this._doProcessBlock(k,oe);v=k.splice(0,P),b.sigBytes-=$}return new y.init(v,$)},clone:function(){var u=l.clone.call(this);return u._data=this._data.clone(),u},_minBufferSize:0}),d=(f.Hasher=L.extend({cfg:l.extend(),init:function(u){this.cfg=this.cfg.extend(u),this.reset()},reset:function(){L.reset.call(this),this._doReset()},update:function(u){return this._append(u),this._process(),this},finalize:function(u){return u&&this._append(u),this._doFinalize()},blockSize:16,_createHelper:function(u){return function(v,b){return new u.init(b).finalize(v)}},_createHmacHelper:function(u){return function(v,b){return new d.HMAC.init(u,b).finalize(v)}}}),D.algo={});return D}(Math),h)},8319:function(ee,x,p){var h,S;ee.exports=(h=p(7585),S=h.lib.WordArray,h.enc.Base64={stringify:function(f){var l=f.words,y=f.sigBytes,A=this._map;f.clamp();for(var T=[],E=0;E<y;E+=3)for(var d=(l[E>>>2]>>>24-E%4*8&255)<<16|(l[E+1>>>2]>>>24-(E+1)%4*8&255)<<8|l[E+2>>>2]>>>24-(E+2)%4*8&255,u=0;u<4&&E+.75*u<y;u++)T.push(A.charAt(d>>>6*(3-u)&63));var v=A.charAt(64);if(v)for(;T.length%4;)T.push(v);return T.join("")},parse:function(f){var l=f.length,y=this._map,A=this._reverseMap;if(!A){A=this._reverseMap=[];for(var T=0;T<y.length;T++)A[y.charCodeAt(T)]=T}var E=y.charAt(64);if(E){var r=f.indexOf(E);-1!==r&&(l=r)}return function D(f,l,y){for(var A=[],T=0,E=0;E<l;E++)if(E%4){var r=y[f.charCodeAt(E-1)]<<E%4*2,L=y[f.charCodeAt(E)]>>>6-E%4*2;A[T>>>2]|=(r|L)<<24-T%4*8,T++}return S.create(A,T)}(f,l,A)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},h.enc.Base64)},1817:function(ee,x,p){var h;ee.exports=(h=p(7585),function(_){var I=h,S=I.lib,M=S.WordArray,U=S.Hasher,D=I.algo,f=[],l=[];!function(){function T(j){for(var d=_.sqrt(j),u=2;u<=d;u++)if(!(j%u))return!1;return!0}function E(j){return 4294967296*(j-(0|j))|0}for(var r=2,L=0;L<64;)T(r)&&(L<8&&(f[L]=E(_.pow(r,.5))),l[L]=E(_.pow(r,1/3)),L++),r++}();var y=[],A=D.SHA256=U.extend({_doReset:function(){this._hash=new M.init(f.slice(0))},_doProcessBlock:function(T,E){for(var r=this._hash.words,L=r[0],j=r[1],d=r[2],u=r[3],v=r[4],b=r[5],k=r[6],B=r[7],O=0;O<64;O++){if(O<16)y[O]=0|T[E+O];else{var Z=y[O-15],P=y[O-2];y[O]=((Z<<25|Z>>>7)^(Z<<14|Z>>>18)^Z>>>3)+y[O-7]+((P<<15|P>>>17)^(P<<13|P>>>19)^P>>>10)+y[O-16]}var Y=L&j^L&d^j&d,ae=B+((v<<26|v>>>6)^(v<<21|v>>>11)^(v<<7|v>>>25))+(v&b^~v&k)+l[O]+y[O];B=k,k=b,b=v,v=u+ae|0,u=d,d=j,j=L,L=ae+(((L<<30|L>>>2)^(L<<19|L>>>13)^(L<<10|L>>>22))+Y)|0}r[0]=r[0]+L|0,r[1]=r[1]+j|0,r[2]=r[2]+d|0,r[3]=r[3]+u|0,r[4]=r[4]+v|0,r[5]=r[5]+b|0,r[6]=r[6]+k|0,r[7]=r[7]+B|0},_doFinalize:function(){var T=this._data,E=T.words,r=8*this._nDataBytes,L=8*T.sigBytes;return E[L>>>5]|=128<<24-L%32,E[14+(L+64>>>9<<4)]=_.floor(r/4294967296),E[15+(L+64>>>9<<4)]=r,T.sigBytes=4*E.length,this._process(),this._hash},clone:function(){var T=U.clone.call(this);return T._hash=this._hash.clone(),T}});I.SHA256=U._createHelper(A),I.HmacSHA256=U._createHmacHelper(A)}(Math),h.SHA256)},1455:(ee,x,p)=>{x.formatArgs=function _(D){if(D[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+D[0]+(this.useColors?"%c ":" ")+"+"+ee.exports.humanize(this.diff),!this.useColors)return;const f="color: "+this.color;D.splice(1,0,f,"color: inherit");let l=0,y=0;D[0].replace(/%[a-zA-Z%]/g,A=>{"%%"!==A&&(l++,"%c"===A&&(y=l))}),D.splice(y,0,f)},x.save=function I(D){try{D?x.storage.setItem("debug",D):x.storage.removeItem("debug")}catch{}},x.load=function S(){let D;try{D=x.storage.getItem("debug")}catch{}return!D&&typeof process<"u"&&"env"in process&&(D={ZIP_SOCKET_SERVER:"https://socket.zipcaptions.app",ZIP_SOCKET_PORT:"443",ZIP_PEER_SERVER:"peer.zipcaptions.app",ZIP_PEER_PORT:"443",BUILD_YEAR:2024,BUILD_TS:1705541921658}.DEBUG),D},x.useColors=function h(){return!(!(typeof window<"u"&&window.process)||"renderer"!==window.process.type&&!window.process.__nwjs)||!(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},x.storage=function M(){try{return localStorage}catch{}}(),x.destroy=(()=>{let D=!1;return()=>{D||(D=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),x.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],x.log=console.debug||console.log||(()=>{}),ee.exports=p(3283)(x);const{formatters:U}=ee.exports;U.j=function(D){try{return JSON.stringify(D)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}},3283:(ee,x,p)=>{ee.exports=function h(_){function S(T){let E,L,j,r=null;function d(...u){if(!d.enabled)return;const v=d,b=Number(new Date);v.diff=b-(E||b),v.prev=E,v.curr=b,E=b,u[0]=S.coerce(u[0]),"string"!=typeof u[0]&&u.unshift("%O");let B=0;u[0]=u[0].replace(/%([a-zA-Z%])/g,(Z,w)=>{if("%%"===Z)return"%";B++;const P=S.formatters[w];return"function"==typeof P&&(Z=P.call(v,u[B]),u.splice(B,1),B--),Z}),S.formatArgs.call(v,u),(v.log||S.log).apply(v,u)}return d.namespace=T,d.useColors=S.useColors(),d.color=S.selectColor(T),d.extend=M,d.destroy=S.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==r?r:(L!==S.namespaces&&(L=S.namespaces,j=S.enabled(T)),j),set:u=>{r=u}}),"function"==typeof S.init&&S.init(d),d}function M(T,E){const r=S(this.namespace+(typeof E>"u"?":":E)+T);return r.log=this.log,r}function l(T){return T.toString().substring(2,T.toString().length-2).replace(/\.\*\?$/,"*")}return S.debug=S,S.default=S,S.coerce=function y(T){return T instanceof Error?T.stack||T.message:T},S.disable=function D(){const T=[...S.names.map(l),...S.skips.map(l).map(E=>"-"+E)].join(",");return S.enable(""),T},S.enable=function U(T){let E;S.save(T),S.namespaces=T,S.names=[],S.skips=[];const r=("string"==typeof T?T:"").split(/[\s,]+/),L=r.length;for(E=0;E<L;E++)r[E]&&("-"===(T=r[E].replace(/\*/g,".*?"))[0]?S.skips.push(new RegExp("^"+T.slice(1)+"$")):S.names.push(new RegExp("^"+T+"$")))},S.enabled=function f(T){if("*"===T[T.length-1])return!0;let E,r;for(E=0,r=S.skips.length;E<r;E++)if(S.skips[E].test(T))return!1;for(E=0,r=S.names.length;E<r;E++)if(S.names[E].test(T))return!0;return!1},S.humanize=p(4366),S.destroy=function A(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(_).forEach(T=>{S[T]=_[T]}),S.names=[],S.skips=[],S.formatters={},S.selectColor=function I(T){let E=0;for(let r=0;r<T.length;r++)E=(E<<5)-E+T.charCodeAt(r),E|=0;return S.colors[Math.abs(E)%S.colors.length]},S.enable(S.load()),S}},4366:ee=>{var x=1e3,p=60*x,h=60*p,_=24*h;function f(l,y,A,T){var E=y>=1.5*A;return Math.round(l/A)+" "+T+(E?"s":"")}ee.exports=function(l,y){y=y||{};var A=typeof l;if("string"===A&&l.length>0)return function M(l){if(!((l=String(l)).length>100)){var y=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(l);if(y){var A=parseFloat(y[1]);switch((y[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*A;case"weeks":case"week":case"w":return 6048e5*A;case"days":case"day":case"d":return A*_;case"hours":case"hour":case"hrs":case"hr":case"h":return A*h;case"minutes":case"minute":case"mins":case"min":case"m":return A*p;case"seconds":case"second":case"secs":case"sec":case"s":return A*x;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return A;default:return}}}}(l);if("number"===A&&isFinite(l))return y.long?function D(l){var y=Math.abs(l);return y>=_?f(l,y,_,"day"):y>=h?f(l,y,h,"hour"):y>=p?f(l,y,p,"minute"):y>=x?f(l,y,x,"second"):l+" ms"}(l):function U(l){var y=Math.abs(l);return y>=_?Math.round(l/_)+"d":y>=h?Math.round(l/h)+"h":y>=p?Math.round(l/p)+"m":y>=x?Math.round(l/x)+"s":l+"ms"}(l);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(l))}},5645:ee=>{"use strict";var x=Object.prototype.hasOwnProperty,p="~";function h(){}function _(U,D,f){this.fn=U,this.context=D,this.once=f||!1}function I(U,D,f,l,y){if("function"!=typeof f)throw new TypeError("The listener must be a function");var A=new _(f,l||U,y),T=p?p+D:D;return U._events[T]?U._events[T].fn?U._events[T]=[U._events[T],A]:U._events[T].push(A):(U._events[T]=A,U._eventsCount++),U}function S(U,D){0==--U._eventsCount?U._events=new h:delete U._events[D]}function M(){this._events=new h,this._eventsCount=0}Object.create&&(h.prototype=Object.create(null),(new h).__proto__||(p=!1)),M.prototype.eventNames=function(){var f,l,D=[];if(0===this._eventsCount)return D;for(l in f=this._events)x.call(f,l)&&D.push(p?l.slice(1):l);return Object.getOwnPropertySymbols?D.concat(Object.getOwnPropertySymbols(f)):D},M.prototype.listeners=function(D){var l=this._events[p?p+D:D];if(!l)return[];if(l.fn)return[l.fn];for(var y=0,A=l.length,T=new Array(A);y<A;y++)T[y]=l[y].fn;return T},M.prototype.listenerCount=function(D){var l=this._events[p?p+D:D];return l?l.fn?1:l.length:0},M.prototype.emit=function(D,f,l,y,A,T){var E=p?p+D:D;if(!this._events[E])return!1;var j,d,r=this._events[E],L=arguments.length;if(r.fn){switch(r.once&&this.removeListener(D,r.fn,void 0,!0),L){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,f),!0;case 3:return r.fn.call(r.context,f,l),!0;case 4:return r.fn.call(r.context,f,l,y),!0;case 5:return r.fn.call(r.context,f,l,y,A),!0;case 6:return r.fn.call(r.context,f,l,y,A,T),!0}for(d=1,j=new Array(L-1);d<L;d++)j[d-1]=arguments[d];r.fn.apply(r.context,j)}else{var v,u=r.length;for(d=0;d<u;d++)switch(r[d].once&&this.removeListener(D,r[d].fn,void 0,!0),L){case 1:r[d].fn.call(r[d].context);break;case 2:r[d].fn.call(r[d].context,f);break;case 3:r[d].fn.call(r[d].context,f,l);break;case 4:r[d].fn.call(r[d].context,f,l,y);break;default:if(!j)for(v=1,j=new Array(L-1);v<L;v++)j[v-1]=arguments[v];r[d].fn.apply(r[d].context,j)}}return!0},M.prototype.on=function(D,f,l){return I(this,D,f,l,!1)},M.prototype.once=function(D,f,l){return I(this,D,f,l,!0)},M.prototype.removeListener=function(D,f,l,y){var A=p?p+D:D;if(!this._events[A])return this;if(!f)return S(this,A),this;var T=this._events[A];if(T.fn)T.fn===f&&(!y||T.once)&&(!l||T.context===l)&&S(this,A);else{for(var E=0,r=[],L=T.length;E<L;E++)(T[E].fn!==f||y&&!T[E].once||l&&T[E].context!==l)&&r.push(T[E]);r.length?this._events[A]=1===r.length?r[0]:r:S(this,A)}return this},M.prototype.removeAllListeners=function(D){var f;return D?this._events[f=p?p+D:D]&&S(this,f):(this._events=new h,this._eventsCount=0),this},M.prototype.off=M.prototype.removeListener,M.prototype.addListener=M.prototype.on,M.prefixed=p,M.EventEmitter=M,ee.exports=M},8819:(ee,x,p)=>{var h=p(3417).MY,_=p(3417).cx;function S(f){this.index=0,this.dataBuffer=f,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function M(){this.bufferBuilder=new h}function U(f){var l=f.charCodeAt(0);return l<=2047?"00":l<=65535?"000":l<=2097151?"0000":l<=67108863?"00000":"000000"}ee.exports={unpack:function(f){return new S(f).unpack()},pack:function(f){var l=new M;return l.pack(f),l.getBuffer()}},S.prototype.unpack=function(){var l,f=this.unpack_uint8();if(f<128)return f;if((224^f)<32)return(224^f)-32;if((l=160^f)<=15)return this.unpack_raw(l);if((l=176^f)<=15)return this.unpack_string(l);if((l=144^f)<=15)return this.unpack_array(l);if((l=128^f)<=15)return this.unpack_map(l);switch(f){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return l=this.unpack_uint16(),this.unpack_string(l);case 217:return l=this.unpack_uint32(),this.unpack_string(l);case 218:return l=this.unpack_uint16(),this.unpack_raw(l);case 219:return l=this.unpack_uint32(),this.unpack_raw(l);case 220:return l=this.unpack_uint16(),this.unpack_array(l);case 221:return l=this.unpack_uint32(),this.unpack_array(l);case 222:return l=this.unpack_uint16(),this.unpack_map(l);case 223:return l=this.unpack_uint32(),this.unpack_map(l)}},S.prototype.unpack_uint8=function(){var f=255&this.dataView[this.index];return this.index++,f},S.prototype.unpack_uint16=function(){var f=this.read(2),l=256*(255&f[0])+(255&f[1]);return this.index+=2,l},S.prototype.unpack_uint32=function(){var f=this.read(4),l=256*(256*(256*f[0]+f[1])+f[2])+f[3];return this.index+=4,l},S.prototype.unpack_uint64=function(){var f=this.read(8),l=256*(256*(256*(256*(256*(256*(256*f[0]+f[1])+f[2])+f[3])+f[4])+f[5])+f[6])+f[7];return this.index+=8,l},S.prototype.unpack_int8=function(){var f=this.unpack_uint8();return f<128?f:f-256},S.prototype.unpack_int16=function(){var f=this.unpack_uint16();return f<32768?f:f-65536},S.prototype.unpack_int32=function(){var f=this.unpack_uint32();return f<Math.pow(2,31)?f:f-Math.pow(2,32)},S.prototype.unpack_int64=function(){var f=this.unpack_uint64();return f<Math.pow(2,63)?f:f-Math.pow(2,64)},S.prototype.unpack_raw=function(f){if(this.length<this.index+f)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+f+" "+this.length);var l=this.dataBuffer.slice(this.index,this.index+f);return this.index+=f,l},S.prototype.unpack_string=function(f){for(var T,E,l=this.read(f),y=0,A="";y<f;)(T=l[y])<128?(A+=String.fromCharCode(T),y++):(192^T)<32?(E=(192^T)<<6|63&l[y+1],A+=String.fromCharCode(E),y+=2):(E=(15&T)<<12|(63&l[y+1])<<6|63&l[y+2],A+=String.fromCharCode(E),y+=3);return this.index+=f,A},S.prototype.unpack_array=function(f){for(var l=new Array(f),y=0;y<f;y++)l[y]=this.unpack();return l},S.prototype.unpack_map=function(f){for(var l={},y=0;y<f;y++){var A=this.unpack(),T=this.unpack();l[A]=T}return l},S.prototype.unpack_float=function(){var f=this.unpack_uint32();return(0==f>>31?1:-1)*(8388607&f|8388608)*Math.pow(2,(f>>23&255)-127-23)},S.prototype.unpack_double=function(){var f=this.unpack_uint32(),l=this.unpack_uint32(),A=(f>>20&2047)-1023;return(0==f>>31?1:-1)*((1048575&f|1048576)*Math.pow(2,A-20)+l*Math.pow(2,A-52))},S.prototype.read=function(f){var l=this.index;if(l+f<=this.length)return this.dataView.subarray(l,l+f);throw new Error("BinaryPackFailure: read index out of range")},M.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},M.prototype.pack=function(f){var l=typeof f;if("string"===l)this.pack_string(f);else if("number"===l)Math.floor(f)===f?this.pack_integer(f):this.pack_double(f);else if("boolean"===l)!0===f?this.bufferBuilder.append(195):!1===f&&this.bufferBuilder.append(194);else if("undefined"===l)this.bufferBuilder.append(192);else{if("object"!==l)throw new Error('Type "'+l+'" not yet supported');if(null===f)this.bufferBuilder.append(192);else{var y=f.constructor;if(y==Array)this.pack_array(f);else if(y==Blob||y==File||f instanceof Blob||f instanceof File)this.pack_bin(f);else if(y==ArrayBuffer)this.pack_bin(_.useArrayBufferView?new Uint8Array(f):f);else if("BYTES_PER_ELEMENT"in f)this.pack_bin(_.useArrayBufferView?new Uint8Array(f.buffer):f.buffer);else if(y==Object||y.toString().startsWith("class"))this.pack_object(f);else if(y==Date)this.pack_string(f.toString());else{if("function"!=typeof f.toBinaryPack)throw new Error('Type "'+y.toString()+'" not yet supported');this.bufferBuilder.append(f.toBinaryPack())}}}this.bufferBuilder.flush()},M.prototype.pack_bin=function(f){var l=f.length||f.byteLength||f.size;if(l<=15)this.pack_uint8(160+l);else if(l<=65535)this.bufferBuilder.append(218),this.pack_uint16(l);else{if(!(l<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(l)}this.bufferBuilder.append(f)},M.prototype.pack_string=function(f){var l=function D(f){return f.length>600?new Blob([f]).size:f.replace(/[^\u0000-\u007F]/g,U).length}(f);if(l<=15)this.pack_uint8(176+l);else if(l<=65535)this.bufferBuilder.append(216),this.pack_uint16(l);else{if(!(l<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(l)}this.bufferBuilder.append(f)},M.prototype.pack_array=function(f){var l=f.length;if(l<=15)this.pack_uint8(144+l);else if(l<=65535)this.bufferBuilder.append(220),this.pack_uint16(l);else{if(!(l<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(l)}for(var y=0;y<l;y++)this.pack(f[y])},M.prototype.pack_integer=function(f){if(f>=-32&&f<=127)this.bufferBuilder.append(255&f);else if(f>=0&&f<=255)this.bufferBuilder.append(204),this.pack_uint8(f);else if(f>=-128&&f<=127)this.bufferBuilder.append(208),this.pack_int8(f);else if(f>=0&&f<=65535)this.bufferBuilder.append(205),this.pack_uint16(f);else if(f>=-32768&&f<=32767)this.bufferBuilder.append(209),this.pack_int16(f);else if(f>=0&&f<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(f);else if(f>=-2147483648&&f<=2147483647)this.bufferBuilder.append(210),this.pack_int32(f);else if(f>=-0x8000000000000000&&f<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(f);else{if(!(f>=0&&f<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(f)}},M.prototype.pack_double=function(f){var l=0;f<0&&(l=1,f=-f);var y=Math.floor(Math.log(f)/Math.LN2),A=f/Math.pow(2,y)-1,T=Math.floor(A*Math.pow(2,52)),E=Math.pow(2,32),r=l<<31|y+1023<<20|T/E&1048575,L=T%E;this.bufferBuilder.append(203),this.pack_int32(r),this.pack_int32(L)},M.prototype.pack_object=function(f){var y=Object.keys(f).length;if(y<=15)this.pack_uint8(128+y);else if(y<=65535)this.bufferBuilder.append(222),this.pack_uint16(y);else{if(!(y<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(y)}for(var A in f)f.hasOwnProperty(A)&&(this.pack(A),this.pack(f[A]))},M.prototype.pack_uint8=function(f){this.bufferBuilder.append(f)},M.prototype.pack_uint16=function(f){this.bufferBuilder.append(f>>8),this.bufferBuilder.append(255&f)},M.prototype.pack_uint32=function(f){var l=4294967295&f;this.bufferBuilder.append((4278190080&l)>>>24),this.bufferBuilder.append((16711680&l)>>>16),this.bufferBuilder.append((65280&l)>>>8),this.bufferBuilder.append(255&l)},M.prototype.pack_uint64=function(f){var l=f/Math.pow(2,32),y=f%Math.pow(2,32);this.bufferBuilder.append((4278190080&l)>>>24),this.bufferBuilder.append((16711680&l)>>>16),this.bufferBuilder.append((65280&l)>>>8),this.bufferBuilder.append(255&l),this.bufferBuilder.append((4278190080&y)>>>24),this.bufferBuilder.append((16711680&y)>>>16),this.bufferBuilder.append((65280&y)>>>8),this.bufferBuilder.append(255&y)},M.prototype.pack_int8=function(f){this.bufferBuilder.append(255&f)},M.prototype.pack_int16=function(f){this.bufferBuilder.append((65280&f)>>8),this.bufferBuilder.append(255&f)},M.prototype.pack_int32=function(f){this.bufferBuilder.append(f>>>24&255),this.bufferBuilder.append((16711680&f)>>>16),this.bufferBuilder.append((65280&f)>>>8),this.bufferBuilder.append(255&f)},M.prototype.pack_int64=function(f){var l=Math.floor(f/Math.pow(2,32)),y=f%Math.pow(2,32);this.bufferBuilder.append((4278190080&l)>>>24),this.bufferBuilder.append((16711680&l)>>>16),this.bufferBuilder.append((65280&l)>>>8),this.bufferBuilder.append(255&l),this.bufferBuilder.append((4278190080&y)>>>24),this.bufferBuilder.append((16711680&y)>>>16),this.bufferBuilder.append((65280&y)>>>8),this.bufferBuilder.append(255&y)}},3417:ee=>{var x={};x.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),x.useArrayBufferView=!x.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch{return!0}}(),ee.exports.cx=x;var p=ee.exports.xE;function h(){this._pieces=[],this._parts=[]}typeof window<"u"&&(p=ee.exports.xE=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),h.prototype.append=function(_){"number"==typeof _?this._pieces.push(_):(this.flush(),this._parts.push(_))},h.prototype.flush=function(){if(this._pieces.length>0){var _=new Uint8Array(this._pieces);x.useArrayBufferView||(_=_.buffer),this._parts.push(_),this._pieces=[]}},h.prototype.getBuffer=function(){if(this.flush(),x.useBlobBuilder){for(var _=new p,I=0,S=this._parts.length;I<S;I++)_.append(this._parts[I]);return _.getBlob()}return new Blob(this._parts)},ee.exports.MY=h},6334:(ee,x,p)=>{"use strict";var h=p(7463);function I(l,y,A,T,E){var r=h.writeRtpDescription(l.kind,y);if(r+=h.writeIceParameters(l.iceGatherer.getLocalParameters()),r+=h.writeDtlsParameters(l.dtlsTransport.getLocalParameters(),"offer"===A?"actpass":E||"active"),r+="a=mid:"+l.mid+"\r\n",r+=l.rtpSender&&l.rtpReceiver?"a=sendrecv\r\n":l.rtpSender?"a=sendonly\r\n":l.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",l.rtpSender){var L=l.rtpSender._initialTrackId||l.rtpSender.track.id;l.rtpSender._initialTrackId=L;var j="msid:"+(T?T.id:"-")+" "+L+"\r\n";r+="a="+j,r+="a=ssrc:"+l.sendEncodingParameters[0].ssrc+" "+j,l.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+l.sendEncodingParameters[0].rtx.ssrc+" "+j,r+="a=ssrc-group:FID "+l.sendEncodingParameters[0].ssrc+" "+l.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return r+="a=ssrc:"+l.sendEncodingParameters[0].ssrc+" cname:"+h.localCName+"\r\n",l.rtpSender&&l.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+l.sendEncodingParameters[0].rtx.ssrc+" cname:"+h.localCName+"\r\n"),r}function M(l,y){var A={codecs:[],headerExtensions:[],fecMechanisms:[]},T=function(r,L){r=parseInt(r,10);for(var j=0;j<L.length;j++)if(L[j].payloadType===r||L[j].preferredPayloadType===r)return L[j]},E=function(r,L,j,d){var u=T(r.parameters.apt,j),v=T(L.parameters.apt,d);return u&&v&&u.name.toLowerCase()===v.name.toLowerCase()};return l.codecs.forEach(function(r){for(var L=0;L<y.codecs.length;L++){var j=y.codecs[L];if(r.name.toLowerCase()===j.name.toLowerCase()&&r.clockRate===j.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&j.parameters.apt&&!E(r,j,l.codecs,y.codecs))continue;(j=JSON.parse(JSON.stringify(j))).numChannels=Math.min(r.numChannels,j.numChannels),A.codecs.push(j),j.rtcpFeedback=j.rtcpFeedback.filter(function(d){for(var u=0;u<r.rtcpFeedback.length;u++)if(r.rtcpFeedback[u].type===d.type&&r.rtcpFeedback[u].parameter===d.parameter)return!0;return!1});break}}}),l.headerExtensions.forEach(function(r){for(var L=0;L<y.headerExtensions.length;L++){var j=y.headerExtensions[L];if(r.uri===j.uri){A.headerExtensions.push(j);break}}}),A}function U(l,y,A){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[y][l].indexOf(A)}function D(l,y){var A=l.getRemoteCandidates().find(function(T){return y.foundation===T.foundation&&y.ip===T.ip&&y.port===T.port&&y.priority===T.priority&&y.protocol===T.protocol&&y.type===T.type});return A||l.addRemoteCandidate(y),!A}function f(l,y){var A=new Error(y);return A.name=l,A.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[l],A}ee.exports=function(l,y){function A(d,u){u.addTrack(d),u.dispatchEvent(new l.MediaStreamTrackEvent("addtrack",{track:d}))}function E(d,u,v,b){var k=new Event("track");k.track=u,k.receiver=v,k.transceiver={receiver:v},k.streams=b,l.setTimeout(function(){d._dispatchEvent("track",k)})}var r=function(d){var u=this,v=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(k){u[k]=v[k].bind(v)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",d=JSON.parse(JSON.stringify(d||{})),this.usingBundle="max-bundle"===d.bundlePolicy,"negotiate"===d.rtcpMuxPolicy)throw f("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(d.rtcpMuxPolicy||(d.rtcpMuxPolicy="require"),d.iceTransportPolicy){case"all":case"relay":break;default:d.iceTransportPolicy="all"}switch(d.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:d.bundlePolicy="balanced"}if(d.iceServers=function S(l,y){var A=!1;return(l=JSON.parse(JSON.stringify(l))).filter(function(T){if(T&&(T.urls||T.url)){var E=T.urls||T.url;T.url&&!T.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r="string"==typeof E;return r&&(E=[E]),E=E.filter(function(L){return 0!==L.indexOf("turn:")||-1===L.indexOf("transport=udp")||-1!==L.indexOf("turn:[")||A?0===L.indexOf("stun:")&&y>=14393&&-1===L.indexOf("?transport=udp"):(A=!0,!0)}),delete T.url,T.urls=r?E[0]:E,!!E.length}})}(d.iceServers||[],y),this._iceGatherers=[],d.iceCandidatePoolSize)for(var b=d.iceCandidatePoolSize;b>0;b--)this._iceGatherers.push(new l.RTCIceGatherer({iceServers:d.iceServers,gatherPolicy:d.iceTransportPolicy}));else d.iceCandidatePoolSize=0;this._config=d,this.transceivers=[],this._sdpSessionId=h.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(d,u){this._isClosed||(this.dispatchEvent(u),"function"==typeof this["on"+d]&&this["on"+d](u))},r.prototype._emitGatheringStateChange=function(){var d=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",d)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(d,u){var b={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:d,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&this.transceivers.length>0)b.iceTransport=this.transceivers[0].iceTransport,b.dtlsTransport=this.transceivers[0].dtlsTransport;else{var k=this._createIceAndDtlsTransports();b.iceTransport=k.iceTransport,b.dtlsTransport=k.dtlsTransport}return u||this.transceivers.push(b),b},r.prototype.addTrack=function(d,u){if(this._isClosed)throw f("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(B){return B.track===d}))throw f("InvalidAccessError","Track already exists.");for(var b,k=0;k<this.transceivers.length;k++)!this.transceivers[k].track&&this.transceivers[k].kind===d.kind&&(b=this.transceivers[k]);return b||(b=this._createTransceiver(d.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(u)&&this.localStreams.push(u),b.track=d,b.stream=u,b.rtpSender=new l.RTCRtpSender(d,b.dtlsTransport),b.rtpSender},r.prototype.addStream=function(d){var u=this;if(y>=15025)d.getTracks().forEach(function(b){u.addTrack(b,d)});else{var v=d.clone();d.getTracks().forEach(function(b,k){var B=v.getTracks()[k];b.addEventListener("enabled",function(O){B.enabled=O.enabled})}),v.getTracks().forEach(function(b){u.addTrack(b,v)})}},r.prototype.removeTrack=function(d){if(this._isClosed)throw f("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(d instanceof l.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var u=this.transceivers.find(function(k){return k.rtpSender===d});if(!u)throw f("InvalidAccessError","Sender was not created by this connection.");var v=u.stream;u.rtpSender.stop(),u.rtpSender=null,u.track=null,u.stream=null,-1===this.transceivers.map(function(k){return k.stream}).indexOf(v)&&this.localStreams.indexOf(v)>-1&&this.localStreams.splice(this.localStreams.indexOf(v),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(d){var u=this;d.getTracks().forEach(function(v){var b=u.getSenders().find(function(k){return k.track===v});b&&u.removeTrack(b)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(d){return!!d.rtpSender}).map(function(d){return d.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(d){return!!d.rtpReceiver}).map(function(d){return d.rtpReceiver})},r.prototype._createIceGatherer=function(d,u){var v=this;if(u&&d>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var b=new l.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(b,"state",{value:"new",writable:!0}),this.transceivers[d].bufferedCandidateEvents=[],this.transceivers[d].bufferCandidates=function(k){var B=!k.candidate||0===Object.keys(k.candidate).length;b.state=B?"completed":"gathering",null!==v.transceivers[d].bufferedCandidateEvents&&v.transceivers[d].bufferedCandidateEvents.push(k)},b.addEventListener("localcandidate",this.transceivers[d].bufferCandidates),b},r.prototype._gather=function(d,u){var v=this,b=this.transceivers[u].iceGatherer;if(!b.onlocalcandidate){var k=this.transceivers[u].bufferedCandidateEvents;this.transceivers[u].bufferedCandidateEvents=null,b.removeEventListener("localcandidate",this.transceivers[u].bufferCandidates),b.onlocalcandidate=function(B){if(!(v.usingBundle&&u>0)){var O=new Event("icecandidate");O.candidate={sdpMid:d,sdpMLineIndex:u};var Z=B.candidate,w=!Z||0===Object.keys(Z).length;if(w)("new"===b.state||"gathering"===b.state)&&(b.state="completed");else{"new"===b.state&&(b.state="gathering"),Z.component=1,Z.ufrag=b.getLocalParameters().usernameFragment;var P=h.writeCandidate(Z);O.candidate=Object.assign(O.candidate,h.parseCandidate(P)),O.candidate.candidate=P,O.candidate.toJSON=function(){return{candidate:O.candidate.candidate,sdpMid:O.candidate.sdpMid,sdpMLineIndex:O.candidate.sdpMLineIndex,usernameFragment:O.candidate.usernameFragment}}}var $=h.getMediaSections(v._localDescription.sdp);$[O.candidate.sdpMLineIndex]+=w?"a=end-of-candidates\r\n":"a="+O.candidate.candidate+"\r\n",v._localDescription.sdp=h.getDescription(v._localDescription.sdp)+$.join("");var oe=v.transceivers.every(function(Y){return Y.iceGatherer&&"completed"===Y.iceGatherer.state});"gathering"!==v.iceGatheringState&&(v.iceGatheringState="gathering",v._emitGatheringStateChange()),w||v._dispatchEvent("icecandidate",O),oe&&(v._dispatchEvent("icecandidate",new Event("icecandidate")),v.iceGatheringState="complete",v._emitGatheringStateChange())}},l.setTimeout(function(){k.forEach(function(B){b.onlocalcandidate(B)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var d=this,u=new l.RTCIceTransport(null);u.onicestatechange=function(){d._updateIceConnectionState(),d._updateConnectionState()};var v=new l.RTCDtlsTransport(u);return v.ondtlsstatechange=function(){d._updateConnectionState()},v.onerror=function(){Object.defineProperty(v,"state",{value:"failed",writable:!0}),d._updateConnectionState()},{iceTransport:u,dtlsTransport:v}},r.prototype._disposeIceAndDtlsTransports=function(d){var u=this.transceivers[d].iceGatherer;u&&(delete u.onlocalcandidate,delete this.transceivers[d].iceGatherer);var v=this.transceivers[d].iceTransport;v&&(delete v.onicestatechange,delete this.transceivers[d].iceTransport);var b=this.transceivers[d].dtlsTransport;b&&(delete b.ondtlsstatechange,delete b.onerror,delete this.transceivers[d].dtlsTransport)},r.prototype._transceive=function(d,u,v){var b=M(d.localCapabilities,d.remoteCapabilities);u&&d.rtpSender&&(b.encodings=d.sendEncodingParameters,b.rtcp={cname:h.localCName,compound:d.rtcpParameters.compound},d.recvEncodingParameters.length&&(b.rtcp.ssrc=d.recvEncodingParameters[0].ssrc),d.rtpSender.send(b)),v&&d.rtpReceiver&&b.codecs.length>0&&("video"===d.kind&&d.recvEncodingParameters&&y<15019&&d.recvEncodingParameters.forEach(function(k){delete k.rtx}),b.encodings=d.recvEncodingParameters.length?d.recvEncodingParameters:[{}],b.rtcp={compound:d.rtcpParameters.compound},d.rtcpParameters.cname&&(b.rtcp.cname=d.rtcpParameters.cname),d.sendEncodingParameters.length&&(b.rtcp.ssrc=d.sendEncodingParameters[0].ssrc),d.rtpReceiver.receive(b))},r.prototype.setLocalDescription=function(d){var v,b,u=this;if(-1===["offer","answer"].indexOf(d.type))return Promise.reject(f("TypeError",'Unsupported type "'+d.type+'"'));if(!U("setLocalDescription",d.type,u.signalingState)||u._isClosed)return Promise.reject(f("InvalidStateError","Can not set local "+d.type+" in state "+u.signalingState));if("offer"===d.type)v=h.splitSections(d.sdp),b=v.shift(),v.forEach(function(B,O){var Z=h.parseRtpParameters(B);u.transceivers[O].localCapabilities=Z}),u.transceivers.forEach(function(B,O){u._gather(B.mid,O)});else if("answer"===d.type){v=h.splitSections(u._remoteDescription.sdp),b=v.shift();var k=h.matchPrefix(b,"a=ice-lite").length>0;v.forEach(function(B,O){var Z=u.transceivers[O],w=Z.iceGatherer,P=Z.iceTransport,$=Z.dtlsTransport,oe=Z.localCapabilities,Y=Z.remoteCapabilities;if(!(h.isRejected(B)&&0===h.matchPrefix(B,"a=bundle-only").length||Z.rejected)){var ce=h.getIceParameters(B,b),ae=h.getDtlsParameters(B,b);k&&(ae.role="server"),(!u.usingBundle||0===O)&&(u._gather(Z.mid,O),"new"===P.state&&P.start(w,ce,k?"controlling":"controlled"),"new"===$.state&&$.start(ae));var se=M(oe,Y);u._transceive(Z,se.codecs.length>0,!1)}})}return u._localDescription={type:d.type,sdp:d.sdp},u._updateSignalingState("offer"===d.type?"have-local-offer":"stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(d){var u=this;if(-1===["offer","answer"].indexOf(d.type))return Promise.reject(f("TypeError",'Unsupported type "'+d.type+'"'));if(!U("setRemoteDescription",d.type,u.signalingState)||u._isClosed)return Promise.reject(f("InvalidStateError","Can not set remote "+d.type+" in state "+u.signalingState));var v={};u.remoteStreams.forEach(function(P){v[P.id]=P});var b=[],k=h.splitSections(d.sdp),B=k.shift(),O=h.matchPrefix(B,"a=ice-lite").length>0,Z=h.matchPrefix(B,"a=group:BUNDLE ").length>0;u.usingBundle=Z;var w=h.matchPrefix(B,"a=ice-options:")[0];return u.canTrickleIceCandidates=!!w&&w.substr(14).split(" ").indexOf("trickle")>=0,k.forEach(function(P,$){var oe=h.splitLines(P),Y=h.getKind(P),K=h.isRejected(P)&&0===h.matchPrefix(P,"a=bundle-only").length,ce=oe[0].substr(2).split(" ")[2],ae=h.getDirection(P,B),se=h.parseMsid(P),qe=h.getMid(P)||h.generateIdentifier();if(K||"application"===Y&&("DTLS/SCTP"===ce||"UDP/DTLS/SCTP"===ce))u.transceivers[$]={mid:qe,kind:Y,protocol:ce,rejected:!0};else{!K&&u.transceivers[$]&&u.transceivers[$].rejected&&(u.transceivers[$]=u._createTransceiver(Y,!0));var G,ze,Pe,Be,ye,Se,Ee,Fe,_e,je,Ve,pt=h.parseRtpParameters(P);K||(je=h.getIceParameters(P,B),(Ve=h.getDtlsParameters(P,B)).role="client"),Ee=h.parseRtpEncodingParameters(P);var Ye=h.parseRtcpParameters(P),Qe=h.matchPrefix(P,"a=end-of-candidates",B).length>0,Oe=h.matchPrefix(P,"a=candidate:").map(function(z){return h.parseCandidate(z)}).filter(function(z){return 1===z.component});if(("offer"===d.type||"answer"===d.type)&&!K&&Z&&$>0&&u.transceivers[$]&&(u._disposeIceAndDtlsTransports($),u.transceivers[$].iceGatherer=u.transceivers[0].iceGatherer,u.transceivers[$].iceTransport=u.transceivers[0].iceTransport,u.transceivers[$].dtlsTransport=u.transceivers[0].dtlsTransport,u.transceivers[$].rtpSender&&u.transceivers[$].rtpSender.setTransport(u.transceivers[0].dtlsTransport),u.transceivers[$].rtpReceiver&&u.transceivers[$].rtpReceiver.setTransport(u.transceivers[0].dtlsTransport)),"offer"!==d.type||K)"answer"!==d.type||K||(ze=(G=u.transceivers[$]).iceGatherer,Pe=G.iceTransport,Be=G.dtlsTransport,ye=G.rtpReceiver,Se=G.sendEncodingParameters,Fe=G.localCapabilities,u.transceivers[$].recvEncodingParameters=Ee,u.transceivers[$].remoteCapabilities=pt,u.transceivers[$].rtcpParameters=Ye,Oe.length&&"new"===Pe.state&&(!O&&!Qe||Z&&0!==$?Oe.forEach(function(z){D(G.iceTransport,z)}):Pe.setRemoteCandidates(Oe)),(!Z||0===$)&&("new"===Pe.state&&Pe.start(ze,je,"controlling"),"new"===Be.state&&Be.start(Ve)),!M(G.localCapabilities,G.remoteCapabilities).codecs.filter(function(z){return"rtx"===z.name.toLowerCase()}).length&&G.sendEncodingParameters[0].rtx&&delete G.sendEncodingParameters[0].rtx,u._transceive(G,"sendrecv"===ae||"recvonly"===ae,"sendrecv"===ae||"sendonly"===ae),!ye||"sendrecv"!==ae&&"sendonly"!==ae?delete G.rtpReceiver:(_e=ye.track,se?(v[se.stream]||(v[se.stream]=new l.MediaStream),A(_e,v[se.stream]),b.push([_e,ye,v[se.stream]])):(v.default||(v.default=new l.MediaStream),A(_e,v.default),b.push([_e,ye,v.default]))));else{(G=u.transceivers[$]||u._createTransceiver(Y)).mid=qe,G.iceGatherer||(G.iceGatherer=u._createIceGatherer($,Z)),Oe.length&&"new"===G.iceTransport.state&&(!Qe||Z&&0!==$?Oe.forEach(function(z){D(G.iceTransport,z)}):G.iceTransport.setRemoteCandidates(Oe)),Fe=l.RTCRtpReceiver.getCapabilities(Y),y<15019&&(Fe.codecs=Fe.codecs.filter(function(z){return"rtx"!==z.name})),Se=G.sendEncodingParameters||[{ssrc:1001*(2*$+2)}];var Te,He=!1;"sendrecv"===ae||"sendonly"===ae?(He=!G.rtpReceiver,ye=G.rtpReceiver||new l.RTCRtpReceiver(G.dtlsTransport,Y),He&&(_e=ye.track,se&&"-"===se.stream||(se?(v[se.stream]||(v[se.stream]=new l.MediaStream,Object.defineProperty(v[se.stream],"id",{get:function(){return se.stream}})),Object.defineProperty(_e,"id",{get:function(){return se.track}}),Te=v[se.stream]):(v.default||(v.default=new l.MediaStream),Te=v.default)),Te&&(A(_e,Te),G.associatedRemoteMediaStreams.push(Te)),b.push([_e,ye,Te]))):G.rtpReceiver&&G.rtpReceiver.track&&(G.associatedRemoteMediaStreams.forEach(function(z){var ft=z.getTracks().find(function(fe){return fe.id===G.rtpReceiver.track.id});ft&&function T(d,u){u.removeTrack(d),u.dispatchEvent(new l.MediaStreamTrackEvent("removetrack",{track:d}))}(ft,z)}),G.associatedRemoteMediaStreams=[]),G.localCapabilities=Fe,G.remoteCapabilities=pt,G.rtpReceiver=ye,G.rtcpParameters=Ye,G.sendEncodingParameters=Se,G.recvEncodingParameters=Ee,u._transceive(u.transceivers[$],!1,He)}}}),void 0===u._dtlsRole&&(u._dtlsRole="offer"===d.type?"active":"passive"),u._remoteDescription={type:d.type,sdp:d.sdp},u._updateSignalingState("offer"===d.type?"have-remote-offer":"stable"),Object.keys(v).forEach(function(P){var $=v[P];if($.getTracks().length){if(-1===u.remoteStreams.indexOf($)){u.remoteStreams.push($);var oe=new Event("addstream");oe.stream=$,l.setTimeout(function(){u._dispatchEvent("addstream",oe)})}b.forEach(function(Y){$.id===Y[2].id&&E(u,Y[0],Y[1],[$])})}}),b.forEach(function(P){P[2]||E(u,P[0],P[1],[])}),l.setTimeout(function(){u&&u.transceivers&&u.transceivers.forEach(function(P){P.iceTransport&&"new"===P.iceTransport.state&&P.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),P.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(d){d.iceTransport&&d.iceTransport.stop(),d.dtlsTransport&&d.dtlsTransport.stop(),d.rtpSender&&d.rtpSender.stop(),d.rtpReceiver&&d.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(d){this.signalingState=d;var u=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",u)},r.prototype._maybeFireNegotiationNeeded=function(){var d=this;"stable"!==this.signalingState||!0===this.needNegotiation||(this.needNegotiation=!0,l.setTimeout(function(){if(d.needNegotiation){d.needNegotiation=!1;var u=new Event("negotiationneeded");d._dispatchEvent("negotiationneeded",u)}},0))},r.prototype._updateIceConnectionState=function(){var d,u={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(b){b.iceTransport&&!b.rejected&&u[b.iceTransport.state]++}),d="new",u.failed>0?d="failed":u.checking>0?d="checking":u.disconnected>0?d="disconnected":u.new>0?d="new":u.connected>0?d="connected":u.completed>0&&(d="completed"),d!==this.iceConnectionState){this.iceConnectionState=d;var v=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",v)}},r.prototype._updateConnectionState=function(){var d,u={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(b){b.iceTransport&&b.dtlsTransport&&!b.rejected&&(u[b.iceTransport.state]++,u[b.dtlsTransport.state]++)}),u.connected+=u.completed,d="new",u.failed>0?d="failed":u.connecting>0?d="connecting":u.disconnected>0?d="disconnected":u.new>0?d="new":u.connected>0&&(d="connected"),d!==this.connectionState){this.connectionState=d;var v=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",v)}},r.prototype.createOffer=function(){var d=this;if(d._isClosed)return Promise.reject(f("InvalidStateError","Can not call createOffer after close"));var u=d.transceivers.filter(function(O){return"audio"===O.kind}).length,v=d.transceivers.filter(function(O){return"video"===O.kind}).length,b=arguments[0];if(b){if(b.mandatory||b.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==b.offerToReceiveAudio&&(u=!0===b.offerToReceiveAudio?1:!1===b.offerToReceiveAudio?0:b.offerToReceiveAudio),void 0!==b.offerToReceiveVideo&&(v=!0===b.offerToReceiveVideo?1:!1===b.offerToReceiveVideo?0:b.offerToReceiveVideo)}for(d.transceivers.forEach(function(O){"audio"===O.kind?--u<0&&(O.wantReceive=!1):"video"===O.kind&&--v<0&&(O.wantReceive=!1)});u>0||v>0;)u>0&&(d._createTransceiver("audio"),u--),v>0&&(d._createTransceiver("video"),v--);var k=h.writeSessionBoilerplate(d._sdpSessionId,d._sdpSessionVersion++);d.transceivers.forEach(function(O,Z){var w=O.track,P=O.kind,$=O.mid||h.generateIdentifier();O.mid=$,O.iceGatherer||(O.iceGatherer=d._createIceGatherer(Z,d.usingBundle));var oe=l.RTCRtpSender.getCapabilities(P);y<15019&&(oe.codecs=oe.codecs.filter(function(K){return"rtx"!==K.name})),oe.codecs.forEach(function(K){"H264"===K.name&&void 0===K.parameters["level-asymmetry-allowed"]&&(K.parameters["level-asymmetry-allowed"]="1"),O.remoteCapabilities&&O.remoteCapabilities.codecs&&O.remoteCapabilities.codecs.forEach(function(ce){K.name.toLowerCase()===ce.name.toLowerCase()&&K.clockRate===ce.clockRate&&(K.preferredPayloadType=ce.payloadType)})}),oe.headerExtensions.forEach(function(K){(O.remoteCapabilities&&O.remoteCapabilities.headerExtensions||[]).forEach(function(ae){K.uri===ae.uri&&(K.id=ae.id)})});var Y=O.sendEncodingParameters||[{ssrc:1001*(2*Z+1)}];w&&y>=15019&&"video"===P&&!Y[0].rtx&&(Y[0].rtx={ssrc:Y[0].ssrc+1}),O.wantReceive&&(O.rtpReceiver=new l.RTCRtpReceiver(O.dtlsTransport,P)),O.localCapabilities=oe,O.sendEncodingParameters=Y}),"max-compat"!==d._config.bundlePolicy&&(k+="a=group:BUNDLE "+d.transceivers.map(function(O){return O.mid}).join(" ")+"\r\n"),k+="a=ice-options:trickle\r\n",d.transceivers.forEach(function(O,Z){k+=I(O,O.localCapabilities,"offer",O.stream,d._dtlsRole),k+="a=rtcp-rsize\r\n",O.iceGatherer&&"new"!==d.iceGatheringState&&(0===Z||!d.usingBundle)&&(O.iceGatherer.getLocalCandidates().forEach(function(w){w.component=1,k+="a="+h.writeCandidate(w)+"\r\n"}),"completed"===O.iceGatherer.state&&(k+="a=end-of-candidates\r\n"))});var B=new l.RTCSessionDescription({type:"offer",sdp:k});return Promise.resolve(B)},r.prototype.createAnswer=function(){var d=this;if(d._isClosed)return Promise.reject(f("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==d.signalingState&&"have-local-pranswer"!==d.signalingState)return Promise.reject(f("InvalidStateError","Can not call createAnswer in signalingState "+d.signalingState));var u=h.writeSessionBoilerplate(d._sdpSessionId,d._sdpSessionVersion++);d.usingBundle&&(u+="a=group:BUNDLE "+d.transceivers.map(function(k){return k.mid}).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n";var v=h.getMediaSections(d._remoteDescription.sdp).length;d.transceivers.forEach(function(k,B){if(!(B+1>v)){if(k.rejected)return"application"===k.kind?u+="DTLS/SCTP"===k.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+k.protocol+" webrtc-datachannel\r\n":"audio"===k.kind?u+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===k.kind&&(u+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(u+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+k.mid+"\r\n");var O;k.stream&&("audio"===k.kind?O=k.stream.getAudioTracks()[0]:"video"===k.kind&&(O=k.stream.getVideoTracks()[0]),O&&y>=15019&&"video"===k.kind&&!k.sendEncodingParameters[0].rtx&&(k.sendEncodingParameters[0].rtx={ssrc:k.sendEncodingParameters[0].ssrc+1}));var Z=M(k.localCapabilities,k.remoteCapabilities);!Z.codecs.filter(function(P){return"rtx"===P.name.toLowerCase()}).length&&k.sendEncodingParameters[0].rtx&&delete k.sendEncodingParameters[0].rtx,u+=I(k,Z,"answer",k.stream,d._dtlsRole),k.rtcpParameters&&k.rtcpParameters.reducedSize&&(u+="a=rtcp-rsize\r\n")}});var b=new l.RTCSessionDescription({type:"answer",sdp:u});return Promise.resolve(b)},r.prototype.addIceCandidate=function(d){var v,u=this;return d&&void 0===d.sdpMLineIndex&&!d.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(b,k){if(!u._remoteDescription)return k(f("InvalidStateError","Can not add ICE candidate without a remote description"));if(d&&""!==d.candidate){var O=d.sdpMLineIndex;if(d.sdpMid)for(var Z=0;Z<u.transceivers.length;Z++)if(u.transceivers[Z].mid===d.sdpMid){O=Z;break}var w=u.transceivers[O];if(!w)return k(f("OperationError","Can not add ICE candidate"));if(w.rejected)return b();var P=Object.keys(d.candidate).length>0?h.parseCandidate(d.candidate):{};if("tcp"===P.protocol&&(0===P.port||9===P.port)||P.component&&1!==P.component)return b();if((0===O||O>0&&w.iceTransport!==u.transceivers[0].iceTransport)&&!D(w.iceTransport,P))return k(f("OperationError","Can not add ICE candidate"));var $=d.candidate.trim();0===$.indexOf("a=")&&($=$.substr(2)),(v=h.getMediaSections(u._remoteDescription.sdp))[O]+="a="+(P.type?$:"end-of-candidates")+"\r\n",u._remoteDescription.sdp=h.getDescription(u._remoteDescription.sdp)+v.join("")}else for(var B=0;B<u.transceivers.length&&(u.transceivers[B].rejected||(u.transceivers[B].iceTransport.addRemoteCandidate({}),(v=h.getMediaSections(u._remoteDescription.sdp))[B]+="a=end-of-candidates\r\n",u._remoteDescription.sdp=h.getDescription(u._remoteDescription.sdp)+v.join(""),!u.usingBundle));B++);b()})},r.prototype.getStats=function(d){if(d&&d instanceof l.MediaStreamTrack){var u=null;if(this.transceivers.forEach(function(b){b.rtpSender&&b.rtpSender.track===d?u=b.rtpSender:b.rtpReceiver&&b.rtpReceiver.track===d&&(u=b.rtpReceiver)}),!u)throw f("InvalidAccessError","Invalid selector.");return u.getStats()}var v=[];return this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(k){b[k]&&v.push(b[k].getStats())})}),Promise.all(v).then(function(b){var k=new Map;return b.forEach(function(B){B.forEach(function(O){k.set(O.id,O)})}),k})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(d){var u=l[d];if(u&&u.prototype&&u.prototype.getStats){var v=u.prototype.getStats;u.prototype.getStats=function(){return v.apply(this).then(function(b){var k=new Map;return Object.keys(b).forEach(function(B){b[B].type=function _(l){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[l.type]||l.type}(b[B]),k.set(B,b[B])}),k})}}});var j=["createOffer","createAnswer"];return j.forEach(function(d){var u=r.prototype[d];r.prototype[d]=function(){var v=arguments;return"function"==typeof v[0]||"function"==typeof v[1]?u.apply(this,[arguments[2]]).then(function(b){"function"==typeof v[0]&&v[0].apply(null,[b])},function(b){"function"==typeof v[1]&&v[1].apply(null,[b])}):u.apply(this,arguments)}}),(j=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(d){var u=r.prototype[d];r.prototype[d]=function(){var v=arguments;return"function"==typeof v[1]||"function"==typeof v[2]?u.apply(this,arguments).then(function(){"function"==typeof v[1]&&v[1].apply(null)},function(b){"function"==typeof v[2]&&v[2].apply(null,[b])}):u.apply(this,arguments)}}),["getStats"].forEach(function(d){var u=r.prototype[d];r.prototype[d]=function(){var v=arguments;return"function"==typeof v[1]?u.apply(this,arguments).then(function(){"function"==typeof v[1]&&v[1].apply(null)}):u.apply(this,arguments)}}),r}},7463:ee=>{"use strict";var x={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};x.localCName=x.generateIdentifier(),x.splitLines=function(p){return p.trim().split("\n").map(function(h){return h.trim()})},x.splitSections=function(p){return p.split("\nm=").map(function(_,I){return(I>0?"m="+_:_).trim()+"\r\n"})},x.getDescription=function(p){var h=x.splitSections(p);return h&&h[0]},x.getMediaSections=function(p){var h=x.splitSections(p);return h.shift(),h},x.matchPrefix=function(p,h){return x.splitLines(p).filter(function(_){return 0===_.indexOf(h)})},x.parseCandidate=function(p){for(var h,_={foundation:(h=0===p.indexOf("a=candidate:")?p.substring(12).split(" "):p.substring(10).split(" "))[0],component:parseInt(h[1],10),protocol:h[2].toLowerCase(),priority:parseInt(h[3],10),ip:h[4],address:h[4],port:parseInt(h[5],10),type:h[7]},I=8;I<h.length;I+=2)switch(h[I]){case"raddr":_.relatedAddress=h[I+1];break;case"rport":_.relatedPort=parseInt(h[I+1],10);break;case"tcptype":_.tcpType=h[I+1];break;case"ufrag":_.ufrag=h[I+1],_.usernameFragment=h[I+1];break;default:_[h[I]]=h[I+1]}return _},x.writeCandidate=function(p){var h=[];h.push(p.foundation),h.push(p.component),h.push(p.protocol.toUpperCase()),h.push(p.priority),h.push(p.address||p.ip),h.push(p.port);var _=p.type;return h.push("typ"),h.push(_),"host"!==_&&p.relatedAddress&&p.relatedPort&&(h.push("raddr"),h.push(p.relatedAddress),h.push("rport"),h.push(p.relatedPort)),p.tcpType&&"tcp"===p.protocol.toLowerCase()&&(h.push("tcptype"),h.push(p.tcpType)),(p.usernameFragment||p.ufrag)&&(h.push("ufrag"),h.push(p.usernameFragment||p.ufrag)),"candidate:"+h.join(" ")},x.parseIceOptions=function(p){return p.substr(14).split(" ")},x.parseRtpMap=function(p){var h=p.substr(9).split(" "),_={payloadType:parseInt(h.shift(),10)};return h=h[0].split("/"),_.name=h[0],_.clockRate=parseInt(h[1],10),_.channels=3===h.length?parseInt(h[2],10):1,_.numChannels=_.channels,_},x.writeRtpMap=function(p){var h=p.payloadType;void 0!==p.preferredPayloadType&&(h=p.preferredPayloadType);var _=p.channels||p.numChannels||1;return"a=rtpmap:"+h+" "+p.name+"/"+p.clockRate+(1!==_?"/"+_:"")+"\r\n"},x.parseExtmap=function(p){var h=p.substr(9).split(" ");return{id:parseInt(h[0],10),direction:h[0].indexOf("/")>0?h[0].split("/")[1]:"sendrecv",uri:h[1]}},x.writeExtmap=function(p){return"a=extmap:"+(p.id||p.preferredId)+(p.direction&&"sendrecv"!==p.direction?"/"+p.direction:"")+" "+p.uri+"\r\n"},x.parseFmtp=function(p){for(var _,h={},I=p.substr(p.indexOf(" ")+1).split(";"),S=0;S<I.length;S++)h[(_=I[S].trim().split("="))[0].trim()]=_[1];return h},x.writeFmtp=function(p){var h="",_=p.payloadType;if(void 0!==p.preferredPayloadType&&(_=p.preferredPayloadType),p.parameters&&Object.keys(p.parameters).length){var I=[];Object.keys(p.parameters).forEach(function(S){I.push(p.parameters[S]?S+"="+p.parameters[S]:S)}),h+="a=fmtp:"+_+" "+I.join(";")+"\r\n"}return h},x.parseRtcpFb=function(p){var h=p.substr(p.indexOf(" ")+1).split(" ");return{type:h.shift(),parameter:h.join(" ")}},x.writeRtcpFb=function(p){var h="",_=p.payloadType;return void 0!==p.preferredPayloadType&&(_=p.preferredPayloadType),p.rtcpFeedback&&p.rtcpFeedback.length&&p.rtcpFeedback.forEach(function(I){h+="a=rtcp-fb:"+_+" "+I.type+(I.parameter&&I.parameter.length?" "+I.parameter:"")+"\r\n"}),h},x.parseSsrcMedia=function(p){var h=p.indexOf(" "),_={ssrc:parseInt(p.substr(7,h-7),10)},I=p.indexOf(":",h);return I>-1?(_.attribute=p.substr(h+1,I-h-1),_.value=p.substr(I+1)):_.attribute=p.substr(h+1),_},x.parseSsrcGroup=function(p){var h=p.substr(13).split(" ");return{semantics:h.shift(),ssrcs:h.map(function(_){return parseInt(_,10)})}},x.getMid=function(p){var h=x.matchPrefix(p,"a=mid:")[0];if(h)return h.substr(6)},x.parseFingerprint=function(p){var h=p.substr(14).split(" ");return{algorithm:h[0].toLowerCase(),value:h[1]}},x.getDtlsParameters=function(p,h){return{role:"auto",fingerprints:x.matchPrefix(p+h,"a=fingerprint:").map(x.parseFingerprint)}},x.writeDtlsParameters=function(p,h){var _="a=setup:"+h+"\r\n";return p.fingerprints.forEach(function(I){_+="a=fingerprint:"+I.algorithm+" "+I.value+"\r\n"}),_},x.parseCryptoLine=function(p){var h=p.substr(9).split(" ");return{tag:parseInt(h[0],10),cryptoSuite:h[1],keyParams:h[2],sessionParams:h.slice(3)}},x.writeCryptoLine=function(p){return"a=crypto:"+p.tag+" "+p.cryptoSuite+" "+("object"==typeof p.keyParams?x.writeCryptoKeyParams(p.keyParams):p.keyParams)+(p.sessionParams?" "+p.sessionParams.join(" "):"")+"\r\n"},x.parseCryptoKeyParams=function(p){if(0!==p.indexOf("inline:"))return null;var h=p.substr(7).split("|");return{keyMethod:"inline",keySalt:h[0],lifeTime:h[1],mkiValue:h[2]?h[2].split(":")[0]:void 0,mkiLength:h[2]?h[2].split(":")[1]:void 0}},x.writeCryptoKeyParams=function(p){return p.keyMethod+":"+p.keySalt+(p.lifeTime?"|"+p.lifeTime:"")+(p.mkiValue&&p.mkiLength?"|"+p.mkiValue+":"+p.mkiLength:"")},x.getCryptoParameters=function(p,h){return x.matchPrefix(p+h,"a=crypto:").map(x.parseCryptoLine)},x.getIceParameters=function(p,h){var _=x.matchPrefix(p+h,"a=ice-ufrag:")[0],I=x.matchPrefix(p+h,"a=ice-pwd:")[0];return _&&I?{usernameFragment:_.substr(12),password:I.substr(10)}:null},x.writeIceParameters=function(p){return"a=ice-ufrag:"+p.usernameFragment+"\r\na=ice-pwd:"+p.password+"\r\n"},x.parseRtpParameters=function(p){for(var h={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},I=x.splitLines(p)[0].split(" "),S=3;S<I.length;S++){var M=I[S],U=x.matchPrefix(p,"a=rtpmap:"+M+" ")[0];if(U){var D=x.parseRtpMap(U),f=x.matchPrefix(p,"a=fmtp:"+M+" ");switch(D.parameters=f.length?x.parseFmtp(f[0]):{},D.rtcpFeedback=x.matchPrefix(p,"a=rtcp-fb:"+M+" ").map(x.parseRtcpFb),h.codecs.push(D),D.name.toUpperCase()){case"RED":case"ULPFEC":h.fecMechanisms.push(D.name.toUpperCase())}}}return x.matchPrefix(p,"a=extmap:").forEach(function(l){h.headerExtensions.push(x.parseExtmap(l))}),h},x.writeRtpDescription=function(p,h){var _="";_+="m="+p+" ",_+=h.codecs.length>0?"9":"0",_+=" UDP/TLS/RTP/SAVPF ",_+=h.codecs.map(function(S){return void 0!==S.preferredPayloadType?S.preferredPayloadType:S.payloadType}).join(" ")+"\r\n",_+="c=IN IP4 0.0.0.0\r\n",_+="a=rtcp:9 IN IP4 0.0.0.0\r\n",h.codecs.forEach(function(S){_+=x.writeRtpMap(S),_+=x.writeFmtp(S),_+=x.writeRtcpFb(S)});var I=0;return h.codecs.forEach(function(S){S.maxptime>I&&(I=S.maxptime)}),I>0&&(_+="a=maxptime:"+I+"\r\n"),_+="a=rtcp-mux\r\n",h.headerExtensions&&h.headerExtensions.forEach(function(S){_+=x.writeExtmap(S)}),_},x.parseRtpEncodingParameters=function(p){var D,h=[],_=x.parseRtpParameters(p),I=-1!==_.fecMechanisms.indexOf("RED"),S=-1!==_.fecMechanisms.indexOf("ULPFEC"),M=x.matchPrefix(p,"a=ssrc:").map(function(y){return x.parseSsrcMedia(y)}).filter(function(y){return"cname"===y.attribute}),U=M.length>0&&M[0].ssrc,f=x.matchPrefix(p,"a=ssrc-group:FID").map(function(y){return y.substr(17).split(" ").map(function(T){return parseInt(T,10)})});f.length>0&&f[0].length>1&&f[0][0]===U&&(D=f[0][1]),_.codecs.forEach(function(y){if("RTX"===y.name.toUpperCase()&&y.parameters.apt){var A={ssrc:U,codecPayloadType:parseInt(y.parameters.apt,10)};U&&D&&(A.rtx={ssrc:D}),h.push(A),I&&((A=JSON.parse(JSON.stringify(A))).fec={ssrc:U,mechanism:S?"red+ulpfec":"red"},h.push(A))}}),0===h.length&&U&&h.push({ssrc:U});var l=x.matchPrefix(p,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,h.forEach(function(y){y.maxBitrate=l})),h},x.parseRtcpParameters=function(p){var h={},_=x.matchPrefix(p,"a=ssrc:").map(function(M){return x.parseSsrcMedia(M)}).filter(function(M){return"cname"===M.attribute})[0];_&&(h.cname=_.value,h.ssrc=_.ssrc);var I=x.matchPrefix(p,"a=rtcp-rsize");h.reducedSize=I.length>0,h.compound=0===I.length;var S=x.matchPrefix(p,"a=rtcp-mux");return h.mux=S.length>0,h},x.parseMsid=function(p){var h,_=x.matchPrefix(p,"a=msid:");if(1===_.length)return{stream:(h=_[0].substr(7).split(" "))[0],track:h[1]};var I=x.matchPrefix(p,"a=ssrc:").map(function(S){return x.parseSsrcMedia(S)}).filter(function(S){return"msid"===S.attribute});return I.length>0?{stream:(h=I[0].value.split(" "))[0],track:h[1]}:void 0},x.parseSctpDescription=function(p){var I,h=x.parseMLine(p),_=x.matchPrefix(p,"a=max-message-size:");_.length>0&&(I=parseInt(_[0].substr(19),10)),isNaN(I)&&(I=65536);var S=x.matchPrefix(p,"a=sctp-port:");if(S.length>0)return{port:parseInt(S[0].substr(12),10),protocol:h.fmt,maxMessageSize:I};if(x.matchPrefix(p,"a=sctpmap:").length>0){var U=x.matchPrefix(p,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(U[0],10),protocol:U[1],maxMessageSize:I}}},x.writeSctpDescription=function(p,h){var _=[];return _="DTLS/SCTP"!==p.protocol?["m="+p.kind+" 9 "+p.protocol+" "+h.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+h.port+"\r\n"]:["m="+p.kind+" 9 "+p.protocol+" "+h.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+h.port+" "+h.protocol+" 65535\r\n"],void 0!==h.maxMessageSize&&_.push("a=max-message-size:"+h.maxMessageSize+"\r\n"),_.join("")},x.generateSessionId=function(){return Math.random().toString().substr(2,21)},x.writeSessionBoilerplate=function(p,h,_){var S=void 0!==h?h:2;return"v=0\r\no="+(_||"thisisadapterortc")+" "+(p||x.generateSessionId())+" "+S+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},x.writeMediaSection=function(p,h,_,I){var S=x.writeRtpDescription(p.kind,h);if(S+=x.writeIceParameters(p.iceGatherer.getLocalParameters()),S+=x.writeDtlsParameters(p.dtlsTransport.getLocalParameters(),"offer"===_?"actpass":"active"),S+="a=mid:"+p.mid+"\r\n",S+=p.direction?"a="+p.direction+"\r\n":p.rtpSender&&p.rtpReceiver?"a=sendrecv\r\n":p.rtpSender?"a=sendonly\r\n":p.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",p.rtpSender){var M="msid:"+I.id+" "+p.rtpSender.track.id+"\r\n";S+="a="+M,S+="a=ssrc:"+p.sendEncodingParameters[0].ssrc+" "+M,p.sendEncodingParameters[0].rtx&&(S+="a=ssrc:"+p.sendEncodingParameters[0].rtx.ssrc+" "+M,S+="a=ssrc-group:FID "+p.sendEncodingParameters[0].ssrc+" "+p.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return S+="a=ssrc:"+p.sendEncodingParameters[0].ssrc+" cname:"+x.localCName+"\r\n",p.rtpSender&&p.sendEncodingParameters[0].rtx&&(S+="a=ssrc:"+p.sendEncodingParameters[0].rtx.ssrc+" cname:"+x.localCName+"\r\n"),S},x.getDirection=function(p,h){for(var _=x.splitLines(p),I=0;I<_.length;I++)switch(_[I]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return _[I].substr(2)}return h?x.getDirection(h):"sendrecv"},x.getKind=function(p){return x.splitLines(p)[0].split(" ")[0].substr(2)},x.isRejected=function(p){return"0"===p.split(" ",2)[1]},x.parseMLine=function(p){var _=x.splitLines(p)[0].substr(2).split(" ");return{kind:_[0],port:parseInt(_[1],10),protocol:_[2],fmt:_.slice(3).join(" ")}},x.parseOLine=function(p){var _=x.matchPrefix(p,"o=")[0].substr(2).split(" ");return{username:_[0],sessionId:_[1],sessionVersion:parseInt(_[2],10),netType:_[3],addressType:_[4],address:_[5]}},x.isValidSDP=function(p){if("string"!=typeof p||0===p.length)return!1;for(var h=x.splitLines(p),_=0;_<h.length;_++)if(h[_].length<2||"="!==h[_].charAt(1))return!1;return!0},ee.exports=x},2480:()=>{}}]);