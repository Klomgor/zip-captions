"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[986],{986:(W,v,h)=>{h.r(v),h.d(v,{AuthModule:()=>$});var P=h(4755),b=h(9812),a=h(2223),L=h(5855),l=h(5429),g=h(8784);const S=n=>n.auth,I=(0,g.P1)(S,n=>n.loggedIn);(0,g.P1)(S,n=>n.loading),(0,g.P1)(S,n=>n.email),(0,g.P1)(S,n=>n.uuid),(0,g.P1)(S,n=>n.error);var U=h(6110),y=h(9129),d=h(8505),p=h(9646),m=h(4004),_=h(262);class c{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(o,r=!1){return this.onePassHasher.start().appendStr(o).end(r)}static hashAsciiStr(o,r=!1){return this.onePassHasher.start().appendAsciiStr(o).end(r)}static _hex(o){const r=c.hexChars,e=c.hexOut;let t,s,i,u;for(u=0;u<4;u+=1)for(s=8*u,t=o[u],i=0;i<8;i+=2)e[s+1+i]=r.charAt(15&t),t>>>=4,e[s+0+i]=r.charAt(15&t),t>>>=4;return e.join("")}static _md5cycle(o,r){let e=o[0],t=o[1],s=o[2],i=o[3];e+=(t&s|~t&i)+r[0]-680876936|0,e=(e<<7|e>>>25)+t|0,i+=(e&t|~e&s)+r[1]-389564586|0,i=(i<<12|i>>>20)+e|0,s+=(i&e|~i&t)+r[2]+606105819|0,s=(s<<17|s>>>15)+i|0,t+=(s&i|~s&e)+r[3]-1044525330|0,t=(t<<22|t>>>10)+s|0,e+=(t&s|~t&i)+r[4]-176418897|0,e=(e<<7|e>>>25)+t|0,i+=(e&t|~e&s)+r[5]+1200080426|0,i=(i<<12|i>>>20)+e|0,s+=(i&e|~i&t)+r[6]-1473231341|0,s=(s<<17|s>>>15)+i|0,t+=(s&i|~s&e)+r[7]-45705983|0,t=(t<<22|t>>>10)+s|0,e+=(t&s|~t&i)+r[8]+1770035416|0,e=(e<<7|e>>>25)+t|0,i+=(e&t|~e&s)+r[9]-1958414417|0,i=(i<<12|i>>>20)+e|0,s+=(i&e|~i&t)+r[10]-42063|0,s=(s<<17|s>>>15)+i|0,t+=(s&i|~s&e)+r[11]-1990404162|0,t=(t<<22|t>>>10)+s|0,e+=(t&s|~t&i)+r[12]+1804603682|0,e=(e<<7|e>>>25)+t|0,i+=(e&t|~e&s)+r[13]-40341101|0,i=(i<<12|i>>>20)+e|0,s+=(i&e|~i&t)+r[14]-1502002290|0,s=(s<<17|s>>>15)+i|0,t+=(s&i|~s&e)+r[15]+1236535329|0,t=(t<<22|t>>>10)+s|0,e+=(t&i|s&~i)+r[1]-165796510|0,e=(e<<5|e>>>27)+t|0,i+=(e&s|t&~s)+r[6]-1069501632|0,i=(i<<9|i>>>23)+e|0,s+=(i&t|e&~t)+r[11]+643717713|0,s=(s<<14|s>>>18)+i|0,t+=(s&e|i&~e)+r[0]-373897302|0,t=(t<<20|t>>>12)+s|0,e+=(t&i|s&~i)+r[5]-701558691|0,e=(e<<5|e>>>27)+t|0,i+=(e&s|t&~s)+r[10]+38016083|0,i=(i<<9|i>>>23)+e|0,s+=(i&t|e&~t)+r[15]-660478335|0,s=(s<<14|s>>>18)+i|0,t+=(s&e|i&~e)+r[4]-405537848|0,t=(t<<20|t>>>12)+s|0,e+=(t&i|s&~i)+r[9]+568446438|0,e=(e<<5|e>>>27)+t|0,i+=(e&s|t&~s)+r[14]-1019803690|0,i=(i<<9|i>>>23)+e|0,s+=(i&t|e&~t)+r[3]-187363961|0,s=(s<<14|s>>>18)+i|0,t+=(s&e|i&~e)+r[8]+1163531501|0,t=(t<<20|t>>>12)+s|0,e+=(t&i|s&~i)+r[13]-1444681467|0,e=(e<<5|e>>>27)+t|0,i+=(e&s|t&~s)+r[2]-51403784|0,i=(i<<9|i>>>23)+e|0,s+=(i&t|e&~t)+r[7]+1735328473|0,s=(s<<14|s>>>18)+i|0,t+=(s&e|i&~e)+r[12]-1926607734|0,t=(t<<20|t>>>12)+s|0,e+=(t^s^i)+r[5]-378558|0,e=(e<<4|e>>>28)+t|0,i+=(e^t^s)+r[8]-2022574463|0,i=(i<<11|i>>>21)+e|0,s+=(i^e^t)+r[11]+1839030562|0,s=(s<<16|s>>>16)+i|0,t+=(s^i^e)+r[14]-35309556|0,t=(t<<23|t>>>9)+s|0,e+=(t^s^i)+r[1]-1530992060|0,e=(e<<4|e>>>28)+t|0,i+=(e^t^s)+r[4]+1272893353|0,i=(i<<11|i>>>21)+e|0,s+=(i^e^t)+r[7]-155497632|0,s=(s<<16|s>>>16)+i|0,t+=(s^i^e)+r[10]-1094730640|0,t=(t<<23|t>>>9)+s|0,e+=(t^s^i)+r[13]+681279174|0,e=(e<<4|e>>>28)+t|0,i+=(e^t^s)+r[0]-358537222|0,i=(i<<11|i>>>21)+e|0,s+=(i^e^t)+r[3]-722521979|0,s=(s<<16|s>>>16)+i|0,t+=(s^i^e)+r[6]+76029189|0,t=(t<<23|t>>>9)+s|0,e+=(t^s^i)+r[9]-640364487|0,e=(e<<4|e>>>28)+t|0,i+=(e^t^s)+r[12]-421815835|0,i=(i<<11|i>>>21)+e|0,s+=(i^e^t)+r[15]+530742520|0,s=(s<<16|s>>>16)+i|0,t+=(s^i^e)+r[2]-995338651|0,t=(t<<23|t>>>9)+s|0,e+=(s^(t|~i))+r[0]-198630844|0,e=(e<<6|e>>>26)+t|0,i+=(t^(e|~s))+r[7]+1126891415|0,i=(i<<10|i>>>22)+e|0,s+=(e^(i|~t))+r[14]-1416354905|0,s=(s<<15|s>>>17)+i|0,t+=(i^(s|~e))+r[5]-57434055|0,t=(t<<21|t>>>11)+s|0,e+=(s^(t|~i))+r[12]+1700485571|0,e=(e<<6|e>>>26)+t|0,i+=(t^(e|~s))+r[3]-1894986606|0,i=(i<<10|i>>>22)+e|0,s+=(e^(i|~t))+r[10]-1051523|0,s=(s<<15|s>>>17)+i|0,t+=(i^(s|~e))+r[1]-2054922799|0,t=(t<<21|t>>>11)+s|0,e+=(s^(t|~i))+r[8]+1873313359|0,e=(e<<6|e>>>26)+t|0,i+=(t^(e|~s))+r[15]-30611744|0,i=(i<<10|i>>>22)+e|0,s+=(e^(i|~t))+r[6]-1560198380|0,s=(s<<15|s>>>17)+i|0,t+=(i^(s|~e))+r[13]+1309151649|0,t=(t<<21|t>>>11)+s|0,e+=(s^(t|~i))+r[4]-145523070|0,e=(e<<6|e>>>26)+t|0,i+=(t^(e|~s))+r[11]-1120210379|0,i=(i<<10|i>>>22)+e|0,s+=(e^(i|~t))+r[2]+718787259|0,s=(s<<15|s>>>17)+i|0,t+=(i^(s|~e))+r[9]-343485551|0,t=(t<<21|t>>>11)+s|0,o[0]=e+o[0]|0,o[1]=t+o[1]|0,o[2]=s+o[2]|0,o[3]=i+o[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(c.stateIdentity),this}appendStr(o){const r=this._buffer8,e=this._buffer32;let s,i,t=this._bufferLength;for(i=0;i<o.length;i+=1){if(s=o.charCodeAt(i),s<128)r[t++]=s;else if(s<2048)r[t++]=192+(s>>>6),r[t++]=63&s|128;else if(s<55296||s>56319)r[t++]=224+(s>>>12),r[t++]=s>>>6&63|128,r[t++]=63&s|128;else{if(s=1024*(s-55296)+(o.charCodeAt(++i)-56320)+65536,s>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");r[t++]=240+(s>>>18),r[t++]=s>>>12&63|128,r[t++]=s>>>6&63|128,r[t++]=63&s|128}t>=64&&(this._dataLength+=64,c._md5cycle(this._state,e),t-=64,e[0]=e[16])}return this._bufferLength=t,this}appendAsciiStr(o){const r=this._buffer8,e=this._buffer32;let s,t=this._bufferLength,i=0;for(;;){for(s=Math.min(o.length-i,64-t);s--;)r[t++]=o.charCodeAt(i++);if(t<64)break;this._dataLength+=64,c._md5cycle(this._state,e),t=0}return this._bufferLength=t,this}appendByteArray(o){const r=this._buffer8,e=this._buffer32;let s,t=this._bufferLength,i=0;for(;;){for(s=Math.min(o.length-i,64-t);s--;)r[t++]=o[i++];if(t<64)break;this._dataLength+=64,c._md5cycle(this._state,e),t=0}return this._bufferLength=t,this}getState(){const o=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[o[0],o[1],o[2],o[3]]}}setState(o){const r=o.buffer,e=o.state,t=this._state;let s;for(this._dataLength=o.length,this._bufferLength=o.buflen,t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],s=0;s<r.length;s+=1)this._buffer8[s]=r.charCodeAt(s)}end(o=!1){const r=this._bufferLength,e=this._buffer8,t=this._buffer32,s=1+(r>>2);this._dataLength+=r;const i=8*this._dataLength;if(e[r]=128,e[r+1]=e[r+2]=e[r+3]=0,t.set(c.buffer32Identity.subarray(s),s),r>55&&(c._md5cycle(this._state,t),t.set(c.buffer32Identity)),i<=4294967295)t[14]=i;else{const u=i.toString(16).match(/(.*?)(.{0,8})$/);if(null===u)return;const A=parseInt(u[2],16),B=parseInt(u[1],16)||0;t[14]=A,t[15]=B}return c._md5cycle(this._state,t),o?this._state:c._hex(this._state)}}if(c.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),c.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),c.hexChars="0123456789abcdef",c.hexOut=[],c.onePassHasher=new c,"5d41402abc4b2a76b9719d911017c592"!==c.hashStr("hello"))throw new Error("Md5 self test failed.");var x=h(3144);let F=(()=>{class n{constructor(r,e){this.http=r,this.cache=e,this.userSessionExists=(0,a.tdS)(!1),this.authEndpoint=`${{ZIP_SOCKET_SERVER:"https://socket.zipcaptions.app",ZIP_SOCKET_PORT:"443",ZIP_PEER_SERVER:"peer.zipcaptions.app",ZIP_PEER_PORT:"443",BUILD_YEAR:2024,BUILD_TS:1705542014844}.ZIP_AUTH_API_URL||"http://localhost:3000"}/${{ZIP_SOCKET_SERVER:"https://socket.zipcaptions.app",ZIP_SOCKET_PORT:"443",ZIP_PEER_SERVER:"peer.zipcaptions.app",ZIP_PEER_PORT:"443",BUILD_YEAR:2024,BUILD_TS:1705542014844}.ZIP_AUTH_API_VERSION||"v1"}/${{ZIP_SOCKET_SERVER:"https://socket.zipcaptions.app",ZIP_SOCKET_PORT:"443",ZIP_PEER_SERVER:"peer.zipcaptions.app",ZIP_PEER_PORT:"443",BUILD_YEAR:2024,BUILD_TS:1705542014844}.ZIP_AUTH_API_ROUTE||"auth"}`}login(r,e){const t=this._hashString(e);return this.http.post(`${this.authEndpoint}/login`,{username:r,password:t},{withCredentials:!0}).pipe((0,d.b)(s=>{console.log("login response",s),s.uuid&&this.userSessionExists.set(!0)}))}validate(r,e){const t=this._hashString(e);return this.http.post(`${this.authEndpoint}/validate`,{username:r,password:t},{withCredentials:!0}).pipe((0,d.b)(s=>console.log("validate response",s)))}userIsAuthenticated(){return!!this.userSessionExists()||this._checkSession().pipe((0,d.b)(r=>this.userSessionExists.set(r)))}logout(){return this.userSessionExists.set(!1),this.cache.remove("google_fragment"),(0,p.of)({message:"ok"})}signUp(r,e){const t=this._hashString(e);return this.http.post(`${this.authEndpoint}/signup`,{username:r,password:t},{withCredentials:!0}).pipe((0,d.b)(s=>{console.log("signUp response",s),s.uuid&&this.userSessionExists.set(!0)}))}loginWithGoogle(r,e){const t=this._parseGoogleUrlFragment(r);if("error"in t)throw this.cache.remove("google_fragment"),new Error(t.error);return e||this.cache.save({key:"google_fragment",data:{fragment:r}}),this.http.post(`${this.authEndpoint}/loginWithGoogle`,{creds:t},{withCredentials:!0}).pipe((0,d.b)(s=>{console.log("loginWithGoogle response",s),s.uuid&&this.userSessionExists.set(!0)}))}getGoogleLoginUrl(){return this.http.get(`${this.authEndpoint}/google-login`).pipe((0,d.b)(r=>console.log("google-login string",r)))}_hashString(r){return c.hashStr(r)}_checkSession(){console.log("check session");const r=this.cache.load("google_fragment");return r?(console.log("cached fragment",r.fragment),this.loginWithGoogle(r.fragment,!0).pipe((0,m.U)(e=>(console.log("check session response",e),!0)),(0,_.K)(()=>(0,p.of)(!1)))):(0,p.of)(!1)}_parseGoogleUrlFragment(r){return r.split("&").reduce((s,i)=>{const[u,A]=i.split("=");return s[u]=A,s},{})}static#t=this.\u0275fac=function(e){return new(e||n)(a.LFG(x.eN),a.LFG(U.Q))};static#e=this.\u0275prov=a.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),R=(()=>{class n{constructor(r){this.authService=r,this.authLink=(0,L.O4)(this.authService.getGoogleLoginUrl())}static#t=this.\u0275fac=function(e){return new(e||n)(a.Y36(F))};static#e=this.\u0275cmp=a.Xpm({type:n,selectors:[["app-google-oauth-login"]],decls:3,vars:1,consts:[[3,"href"],["translate","",1,"btn","btn-primary"]],template:function(e,t){1&e&&(a.TgZ(0,"a",0)(1,"button",1),a._uU(2,"AUTH.loginWithGoogle"),a.qZA()()),2&e&&a.Q6J("href",t.authLink(),a.LSH)},dependencies:[y.Pi]})}return n})();const C=[{path:"login",component:(()=>{class n{constructor(r,e,t,s){this.store=r,this.router=e,this.route=t,this.cache=s;const i=(0,L.O4)(this.store.select(I));if((0,a.cEC)(()=>{i()&&this.router.navigate(["auth","user"])}),this.route.snapshot.fragment)this.route.snapshot.fragment.match("access_token")&&this.store.dispatch(l.u.loginWithGoogleToken({fragment:this.route.snapshot.fragment}));else{const u=this.cache.load("google_fragment");u&&(console.log("loaded cached fragment",u),this.store.dispatch(l.u.loginWithGoogleToken({fragment:u.fragment})))}}static#t=this.\u0275fac=function(e){return new(e||n)(a.Y36(g.yh),a.Y36(b.F0),a.Y36(b.gz),a.Y36(U.Q))};static#e=this.\u0275cmp=a.Xpm({type:n,selectors:[["app-login"]],decls:4,vars:0,consts:[[1,"flex","flex-col","basis-full","items-center","justify-center","gap-6"],["translate","",1,"text-xl"]],template:function(e,t){1&e&&(a.TgZ(0,"div",0)(1,"div",1),a._uU(2," AUTH.genericLogin "),a.qZA(),a._UZ(3,"app-google-oauth-login"),a.qZA())},dependencies:[y.Pi,R]})}return n})()},{path:"user",component:(()=>{class n{constructor(r,e){this.store=r,this.router=e}logout(){this.store.dispatch(l.u.logout()),this.router.navigate([""])}static#t=this.\u0275fac=function(e){return new(e||n)(a.Y36(g.yh),a.Y36(b.F0))};static#e=this.\u0275cmp=a.Xpm({type:n,selectors:[["app-user-home"]],decls:2,vars:0,consts:[[1,"btn","btn-accent",3,"click"]],template:function(e,t){1&e&&(a.TgZ(0,"button",0),a.NdJ("click",function(){return t.logout()}),a._uU(1,"Logout"),a.qZA())}})}return n})(),canActivate:[(n,o)=>(0,a.f3M)(F).userIsAuthenticated()]},{path:"**",redirectTo:"login",pathMatch:"full"}];let T=(()=>{class n{static#t=this.\u0275fac=function(e){return new(e||n)};static#e=this.\u0275mod=a.oAB({type:n});static#s=this.\u0275inj=a.cJS({imports:[b.Bz.forChild(C),b.Bz]})}return n})();var G=h(5543),w=h(9401),f=h(9507),E=h(3900);let Z=(()=>{class n{constructor(r,e){this.actions$=r,this.authService=e,this.login$=(0,f.GW)(()=>this.actions$.pipe((0,f.l4)(l.u.login),(0,E.w)(({email:t,password:s})=>this.authService.login(t,s).pipe((0,m.U)(i=>l.u.loginSuccess({data:i})),(0,_.K)(i=>(0,p.of)(l.u.loginFailure({error:i.message}))))))),this.validate$=(0,f.GW)(()=>this.actions$.pipe((0,f.l4)(l.u.validate),(0,E.w)(({email:t,password:s})=>this.authService.validate(t,s).pipe((0,m.U)(i=>l.u.validateResponse({data:i})))))),this.logout$=(0,f.GW)(()=>this.actions$.pipe((0,f.l4)(l.u.logout),(0,E.w)(()=>this.authService.logout().pipe((0,m.U)(()=>l.u.logoutSuccess()),(0,_.K)(t=>(0,p.of)(l.u.logoutFailure({error:t.message}))))))),this.signup$=(0,f.GW)(()=>this.actions$.pipe((0,f.l4)(l.u.signUp),(0,E.w)(({email:t,password:s})=>this.authService.signUp(t,s).pipe((0,m.U)(i=>l.u.signUpSuccess({data:i})),(0,_.K)(i=>(0,p.of)(l.u.signUpFailure({error:i.message}))))))),this.loginWithGoogle$=(0,f.GW)(()=>this.actions$.pipe((0,f.l4)(l.u.loginWithGoogleToken),(0,E.w)(({fragment:t})=>this.authService.loginWithGoogle(t).pipe((0,m.U)(s=>l.u.loginWithGoogleSuccess({data:s})),(0,_.K)(s=>(0,p.of)(l.u.loginWithGoogleFailure({error:s.message})))))))}static#t=this.\u0275fac=function(e){return new(e||n)(a.LFG(f.eX),a.LFG(F))};static#e=this.\u0275prov=a.Yz7({token:n,factory:n.\u0275fac})}return n})();var z=h(4461),O=h(285);let $=(()=>{class n{static#t=this.\u0275fac=function(e){return new(e||n)};static#e=this.\u0275mod=a.oAB({type:n});static#s=this.\u0275inj=a.cJS({imports:[P.ez,T,G.e,O.sU,w.UX,y.aw.forChild({extend:!0}),f.sQ.forFeature([Z]),g.Aw.forFeature("auth",z.d)]})}return n})()}}]);